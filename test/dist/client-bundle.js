/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./test/client.ts");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./lib/AttachAddon.js":
/*!****************************!*\
  !*** ./lib/AttachAddon.js ***!
  \****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var AttachAddon = (function () {
    function AttachAddon(socket, options) {
        this._disposables = [];
        this._socket = socket;
        this._socket.binaryType = 'arraybuffer';
        this._bidirectional = (options && options.bidirectional === false) ? false : true;
        this._utf8 = !!(options && options.inputUtf8);
    }
    AttachAddon.prototype.activate = function (terminal) {
        var _this = this;
        if (this._utf8) {
            this._disposables.push(addSocketListener(this._socket, 'message', function (ev) { return terminal.writeUtf8(new Uint8Array(ev.data)); }));
        }
        else {
            this._disposables.push(addSocketListener(this._socket, 'message', function (ev) { return terminal.write(ev.data); }));
        }
        if (this._bidirectional) {
            this._disposables.push(terminal.addDisposableListener('data', function (data) { return _this._sendData(data); }));
        }
        this._disposables.push(addSocketListener(this._socket, 'close', function () { return _this.dispose(); }));
        this._disposables.push(addSocketListener(this._socket, 'error', function () { return _this.dispose(); }));
    };
    AttachAddon.prototype.dispose = function () {
        this._disposables.forEach(function (d) { return d.dispose(); });
    };
    AttachAddon.prototype._sendData = function (data) {
        if (this._socket.readyState !== 1) {
            return;
        }
        this._socket.send(data);
    };
    return AttachAddon;
}());
exports.AttachAddon = AttachAddon;
function addSocketListener(socket, type, handler) {
    socket.addEventListener(type, handler);
    return {
        dispose: function () {
            if (!handler) {
                return;
            }
            socket.removeEventListener(type, handler);
        }
    };
}


/***/ }),

/***/ "./node_modules/xterm/lib/AccessibilityManager.js":
/*!********************************************************!*\
  !*** ./node_modules/xterm/lib/AccessibilityManager.js ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Strings = __webpack_require__(/*! ./Strings */ "./node_modules/xterm/lib/Strings.js");
var Platform_1 = __webpack_require__(/*! ./common/Platform */ "./node_modules/xterm/lib/common/Platform.js");
var RenderDebouncer_1 = __webpack_require__(/*! ./ui/RenderDebouncer */ "./node_modules/xterm/lib/ui/RenderDebouncer.js");
var Lifecycle_1 = __webpack_require__(/*! ./ui/Lifecycle */ "./node_modules/xterm/lib/ui/Lifecycle.js");
var Lifecycle_2 = __webpack_require__(/*! ./common/Lifecycle */ "./node_modules/xterm/lib/common/Lifecycle.js");
var MAX_ROWS_TO_READ = 20;
var AccessibilityManager = (function (_super) {
    __extends(AccessibilityManager, _super);
    function AccessibilityManager(_terminal) {
        var _this = _super.call(this) || this;
        _this._terminal = _terminal;
        _this._liveRegionLineCount = 0;
        _this._charsToConsume = [];
        _this._accessibilityTreeRoot = document.createElement('div');
        _this._accessibilityTreeRoot.classList.add('xterm-accessibility');
        _this._rowContainer = document.createElement('div');
        _this._rowContainer.classList.add('xterm-accessibility-tree');
        _this._rowElements = [];
        for (var i = 0; i < _this._terminal.rows; i++) {
            _this._rowElements[i] = _this._createAccessibilityTreeNode();
            _this._rowContainer.appendChild(_this._rowElements[i]);
        }
        _this._topBoundaryFocusListener = function (e) { return _this._onBoundaryFocus(e, 0); };
        _this._bottomBoundaryFocusListener = function (e) { return _this._onBoundaryFocus(e, 1); };
        _this._rowElements[0].addEventListener('focus', _this._topBoundaryFocusListener);
        _this._rowElements[_this._rowElements.length - 1].addEventListener('focus', _this._bottomBoundaryFocusListener);
        _this._refreshRowsDimensions();
        _this._accessibilityTreeRoot.appendChild(_this._rowContainer);
        _this._renderRowsDebouncer = new RenderDebouncer_1.RenderDebouncer(_this._renderRows.bind(_this));
        _this._refreshRows();
        _this._liveRegion = document.createElement('div');
        _this._liveRegion.classList.add('live-region');
        _this._liveRegion.setAttribute('aria-live', 'assertive');
        _this._accessibilityTreeRoot.appendChild(_this._liveRegion);
        _this._terminal.element.insertAdjacentElement('afterbegin', _this._accessibilityTreeRoot);
        _this.register(_this._renderRowsDebouncer);
        _this.register(_this._terminal.onResize(function (e) { return _this._onResize(e.rows); }));
        _this.register(_this._terminal.onRender(function (e) { return _this._refreshRows(e.start, e.end); }));
        _this.register(_this._terminal.onScroll(function () { return _this._refreshRows(); }));
        _this.register(_this._terminal.addDisposableListener('a11y.char', function (char) { return _this._onChar(char); }));
        _this.register(_this._terminal.onLineFeed(function () { return _this._onChar('\n'); }));
        _this.register(_this._terminal.addDisposableListener('a11y.tab', function (spaceCount) { return _this._onTab(spaceCount); }));
        _this.register(_this._terminal.onKey(function (e) { return _this._onKey(e.key); }));
        _this.register(_this._terminal.addDisposableListener('blur', function () { return _this._clearLiveRegion(); }));
        _this.register(_this._terminal.addDisposableListener('dprchange', function () { return _this._refreshRowsDimensions(); }));
        _this.register(_this._terminal.renderer.onCanvasResize(function () { return _this._refreshRowsDimensions(); }));
        _this.register(Lifecycle_1.addDisposableDomListener(window, 'resize', function () { return _this._refreshRowsDimensions(); }));
        return _this;
    }
    AccessibilityManager.prototype.dispose = function () {
        _super.prototype.dispose.call(this);
        this._terminal.element.removeChild(this._accessibilityTreeRoot);
        this._rowElements.length = 0;
    };
    AccessibilityManager.prototype._onBoundaryFocus = function (e, position) {
        var boundaryElement = e.target;
        var beforeBoundaryElement = this._rowElements[position === 0 ? 1 : this._rowElements.length - 2];
        var posInSet = boundaryElement.getAttribute('aria-posinset');
        var lastRowPos = position === 0 ? '1' : "" + this._terminal.buffer.lines.length;
        if (posInSet === lastRowPos) {
            return;
        }
        if (e.relatedTarget !== beforeBoundaryElement) {
            return;
        }
        var topBoundaryElement;
        var bottomBoundaryElement;
        if (position === 0) {
            topBoundaryElement = boundaryElement;
            bottomBoundaryElement = this._rowElements.pop();
            this._rowContainer.removeChild(bottomBoundaryElement);
        }
        else {
            topBoundaryElement = this._rowElements.shift();
            bottomBoundaryElement = boundaryElement;
            this._rowContainer.removeChild(topBoundaryElement);
        }
        topBoundaryElement.removeEventListener('focus', this._topBoundaryFocusListener);
        bottomBoundaryElement.removeEventListener('focus', this._bottomBoundaryFocusListener);
        if (position === 0) {
            var newElement = this._createAccessibilityTreeNode();
            this._rowElements.unshift(newElement);
            this._rowContainer.insertAdjacentElement('afterbegin', newElement);
        }
        else {
            var newElement = this._createAccessibilityTreeNode();
            this._rowElements.push(newElement);
            this._rowContainer.appendChild(newElement);
        }
        this._rowElements[0].addEventListener('focus', this._topBoundaryFocusListener);
        this._rowElements[this._rowElements.length - 1].addEventListener('focus', this._bottomBoundaryFocusListener);
        this._terminal.scrollLines(position === 0 ? -1 : 1);
        this._rowElements[position === 0 ? 1 : this._rowElements.length - 2].focus();
        e.preventDefault();
        e.stopImmediatePropagation();
    };
    AccessibilityManager.prototype._onResize = function (rows) {
        this._rowElements[this._rowElements.length - 1].removeEventListener('focus', this._bottomBoundaryFocusListener);
        for (var i = this._rowContainer.children.length; i < this._terminal.rows; i++) {
            this._rowElements[i] = this._createAccessibilityTreeNode();
            this._rowContainer.appendChild(this._rowElements[i]);
        }
        while (this._rowElements.length > rows) {
            this._rowContainer.removeChild(this._rowElements.pop());
        }
        this._rowElements[this._rowElements.length - 1].addEventListener('focus', this._bottomBoundaryFocusListener);
        this._refreshRowsDimensions();
    };
    AccessibilityManager.prototype._createAccessibilityTreeNode = function () {
        var element = document.createElement('div');
        element.setAttribute('role', 'listitem');
        element.tabIndex = -1;
        this._refreshRowDimensions(element);
        return element;
    };
    AccessibilityManager.prototype._onTab = function (spaceCount) {
        for (var i = 0; i < spaceCount; i++) {
            this._onChar(' ');
        }
    };
    AccessibilityManager.prototype._onChar = function (char) {
        var _this = this;
        if (this._liveRegionLineCount < MAX_ROWS_TO_READ + 1) {
            if (this._charsToConsume.length > 0) {
                var shiftedChar = this._charsToConsume.shift();
                if (shiftedChar !== char) {
                    this._announceCharacter(char);
                }
            }
            else {
                this._announceCharacter(char);
            }
            if (char === '\n') {
                this._liveRegionLineCount++;
                if (this._liveRegionLineCount === MAX_ROWS_TO_READ + 1) {
                    this._liveRegion.textContent += Strings.tooMuchOutput;
                }
            }
            if (Platform_1.isMac) {
                if (this._liveRegion.textContent && this._liveRegion.textContent.length > 0 && !this._liveRegion.parentNode) {
                    setTimeout(function () {
                        _this._accessibilityTreeRoot.appendChild(_this._liveRegion);
                    }, 0);
                }
            }
        }
    };
    AccessibilityManager.prototype._clearLiveRegion = function () {
        this._liveRegion.textContent = '';
        this._liveRegionLineCount = 0;
        if (Platform_1.isMac) {
            if (this._liveRegion.parentNode) {
                this._accessibilityTreeRoot.removeChild(this._liveRegion);
            }
        }
    };
    AccessibilityManager.prototype._onKey = function (keyChar) {
        this._clearLiveRegion();
        this._charsToConsume.push(keyChar);
    };
    AccessibilityManager.prototype._refreshRows = function (start, end) {
        this._renderRowsDebouncer.refresh(start, end, this._terminal.rows);
    };
    AccessibilityManager.prototype._renderRows = function (start, end) {
        var buffer = this._terminal.buffer;
        var setSize = buffer.lines.length.toString();
        for (var i = start; i <= end; i++) {
            var lineData = buffer.translateBufferLineToString(buffer.ydisp + i, true);
            var posInSet = (buffer.ydisp + i + 1).toString();
            var element = this._rowElements[i];
            element.textContent = lineData.length === 0 ? Strings.blankLine : lineData;
            element.setAttribute('aria-posinset', posInSet);
            element.setAttribute('aria-setsize', setSize);
        }
    };
    AccessibilityManager.prototype._refreshRowsDimensions = function () {
        if (!this._terminal.renderer.dimensions.actualCellHeight) {
            return;
        }
        if (this._rowElements.length !== this._terminal.rows) {
            this._onResize(this._terminal.rows);
        }
        for (var i = 0; i < this._terminal.rows; i++) {
            this._refreshRowDimensions(this._rowElements[i]);
        }
    };
    AccessibilityManager.prototype._refreshRowDimensions = function (element) {
        element.style.height = this._terminal.renderer.dimensions.actualCellHeight + "px";
    };
    AccessibilityManager.prototype._announceCharacter = function (char) {
        if (char === ' ') {
            this._liveRegion.innerHTML += '&nbsp;';
        }
        else {
            this._liveRegion.textContent += char;
        }
    };
    return AccessibilityManager;
}(Lifecycle_2.Disposable));
exports.AccessibilityManager = AccessibilityManager;
//# sourceMappingURL=AccessibilityManager.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/Buffer.js":
/*!******************************************!*\
  !*** ./node_modules/xterm/lib/Buffer.js ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var CircularList_1 = __webpack_require__(/*! ./common/CircularList */ "./node_modules/xterm/lib/common/CircularList.js");
var BufferLine_1 = __webpack_require__(/*! ./core/buffer/BufferLine */ "./node_modules/xterm/lib/core/buffer/BufferLine.js");
var BufferReflow_1 = __webpack_require__(/*! ./BufferReflow */ "./node_modules/xterm/lib/BufferReflow.js");
var EventEmitter2_1 = __webpack_require__(/*! ./common/EventEmitter2 */ "./node_modules/xterm/lib/common/EventEmitter2.js");
var Lifecycle_1 = __webpack_require__(/*! ./common/Lifecycle */ "./node_modules/xterm/lib/common/Lifecycle.js");
exports.MAX_BUFFER_SIZE = 4294967295;
var Buffer = (function () {
    function Buffer(_terminal, _hasScrollback) {
        this._terminal = _terminal;
        this._hasScrollback = _hasScrollback;
        this.savedCurAttrData = BufferLine_1.DEFAULT_ATTR_DATA.clone();
        this.markers = [];
        this._nullCell = BufferLine_1.CellData.fromCharData([0, BufferLine_1.NULL_CELL_CHAR, BufferLine_1.NULL_CELL_WIDTH, BufferLine_1.NULL_CELL_CODE]);
        this._whitespaceCell = BufferLine_1.CellData.fromCharData([0, BufferLine_1.WHITESPACE_CELL_CHAR, BufferLine_1.WHITESPACE_CELL_WIDTH, BufferLine_1.WHITESPACE_CELL_CODE]);
        this._cols = this._terminal.cols;
        this._rows = this._terminal.rows;
        this.clear();
    }
    Buffer.prototype.getNullCell = function (attr) {
        if (attr) {
            this._nullCell.fg = attr.fg;
            this._nullCell.bg = attr.bg;
        }
        else {
            this._nullCell.fg = 0;
            this._nullCell.bg = 0;
        }
        return this._nullCell;
    };
    Buffer.prototype.getWhitespaceCell = function (attr) {
        if (attr) {
            this._whitespaceCell.fg = attr.fg;
            this._whitespaceCell.bg = attr.bg;
        }
        else {
            this._whitespaceCell.fg = 0;
            this._whitespaceCell.bg = 0;
        }
        return this._whitespaceCell;
    };
    Buffer.prototype.getBlankLine = function (attr, isWrapped) {
        return new BufferLine_1.BufferLine(this._terminal.cols, this.getNullCell(attr), isWrapped);
    };
    Object.defineProperty(Buffer.prototype, "hasScrollback", {
        get: function () {
            return this._hasScrollback && this.lines.maxLength > this._rows;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Buffer.prototype, "isCursorInViewport", {
        get: function () {
            var absoluteY = this.ybase + this.y;
            var relativeY = absoluteY - this.ydisp;
            return (relativeY >= 0 && relativeY < this._rows);
        },
        enumerable: true,
        configurable: true
    });
    Buffer.prototype._getCorrectBufferLength = function (rows) {
        if (!this._hasScrollback) {
            return rows;
        }
        var correctBufferLength = rows + this._terminal.options.scrollback;
        return correctBufferLength > exports.MAX_BUFFER_SIZE ? exports.MAX_BUFFER_SIZE : correctBufferLength;
    };
    Buffer.prototype.fillViewportRows = function (fillAttr) {
        if (this.lines.length === 0) {
            if (fillAttr === undefined) {
                fillAttr = BufferLine_1.DEFAULT_ATTR_DATA;
            }
            var i = this._rows;
            while (i--) {
                this.lines.push(this.getBlankLine(fillAttr));
            }
        }
    };
    Buffer.prototype.clear = function () {
        this.ydisp = 0;
        this.ybase = 0;
        this.y = 0;
        this.x = 0;
        this.lines = new CircularList_1.CircularList(this._getCorrectBufferLength(this._rows));
        this.scrollTop = 0;
        this.scrollBottom = this._rows - 1;
        this.setupTabStops();
    };
    Buffer.prototype.resize = function (newCols, newRows) {
        var nullCell = this.getNullCell(BufferLine_1.DEFAULT_ATTR_DATA);
        var newMaxLength = this._getCorrectBufferLength(newRows);
        if (newMaxLength > this.lines.maxLength) {
            this.lines.maxLength = newMaxLength;
        }
        if (this.lines.length > 0) {
            if (this._cols < newCols) {
                for (var i = 0; i < this.lines.length; i++) {
                    this.lines.get(i).resize(newCols, nullCell);
                }
            }
            var addToY = 0;
            if (this._rows < newRows) {
                for (var y = this._rows; y < newRows; y++) {
                    if (this.lines.length < newRows + this.ybase) {
                        if (this.ybase > 0 && this.lines.length <= this.ybase + this.y + addToY + 1) {
                            this.ybase--;
                            addToY++;
                            if (this.ydisp > 0) {
                                this.ydisp--;
                            }
                        }
                        else {
                            this.lines.push(new BufferLine_1.BufferLine(newCols, nullCell));
                        }
                    }
                }
            }
            else {
                for (var y = this._rows; y > newRows; y--) {
                    if (this.lines.length > newRows + this.ybase) {
                        if (this.lines.length > this.ybase + this.y + 1) {
                            this.lines.pop();
                        }
                        else {
                            this.ybase++;
                            this.ydisp++;
                        }
                    }
                }
            }
            if (newMaxLength < this.lines.maxLength) {
                var amountToTrim = this.lines.length - newMaxLength;
                if (amountToTrim > 0) {
                    this.lines.trimStart(amountToTrim);
                    this.ybase = Math.max(this.ybase - amountToTrim, 0);
                    this.ydisp = Math.max(this.ydisp - amountToTrim, 0);
                }
                this.lines.maxLength = newMaxLength;
            }
            this.x = Math.min(this.x, newCols - 1);
            this.y = Math.min(this.y, newRows - 1);
            if (addToY) {
                this.y += addToY;
            }
            this.savedY = Math.min(this.savedY, newRows - 1);
            this.savedX = Math.min(this.savedX, newCols - 1);
            this.scrollTop = 0;
        }
        this.scrollBottom = newRows - 1;
        if (this._isReflowEnabled) {
            this._reflow(newCols, newRows);
            if (this._cols > newCols) {
                for (var i = 0; i < this.lines.length; i++) {
                    this.lines.get(i).resize(newCols, nullCell);
                }
            }
        }
        this._cols = newCols;
        this._rows = newRows;
    };
    Object.defineProperty(Buffer.prototype, "_isReflowEnabled", {
        get: function () {
            return this._hasScrollback && !this._terminal.options.windowsMode;
        },
        enumerable: true,
        configurable: true
    });
    Buffer.prototype._reflow = function (newCols, newRows) {
        if (this._cols === newCols) {
            return;
        }
        if (newCols > this._cols) {
            this._reflowLarger(newCols, newRows);
        }
        else {
            this._reflowSmaller(newCols, newRows);
        }
    };
    Buffer.prototype._reflowLarger = function (newCols, newRows) {
        var toRemove = BufferReflow_1.reflowLargerGetLinesToRemove(this.lines, this._cols, newCols, this.ybase + this.y, this.getNullCell(BufferLine_1.DEFAULT_ATTR_DATA));
        if (toRemove.length > 0) {
            var newLayoutResult = BufferReflow_1.reflowLargerCreateNewLayout(this.lines, toRemove);
            BufferReflow_1.reflowLargerApplyNewLayout(this.lines, newLayoutResult.layout);
            this._reflowLargerAdjustViewport(newCols, newRows, newLayoutResult.countRemoved);
        }
    };
    Buffer.prototype._reflowLargerAdjustViewport = function (newCols, newRows, countRemoved) {
        var nullCell = this.getNullCell(BufferLine_1.DEFAULT_ATTR_DATA);
        var viewportAdjustments = countRemoved;
        while (viewportAdjustments-- > 0) {
            if (this.ybase === 0) {
                if (this.y > 0) {
                    this.y--;
                }
                if (this.lines.length < newRows) {
                    this.lines.push(new BufferLine_1.BufferLine(newCols, nullCell));
                }
            }
            else {
                if (this.ydisp === this.ybase) {
                    this.ydisp--;
                }
                this.ybase--;
            }
        }
    };
    Buffer.prototype._reflowSmaller = function (newCols, newRows) {
        var nullCell = this.getNullCell(BufferLine_1.DEFAULT_ATTR_DATA);
        var toInsert = [];
        var countToInsert = 0;
        for (var y = this.lines.length - 1; y >= 0; y--) {
            var nextLine = this.lines.get(y);
            if (!nextLine.isWrapped && nextLine.getTrimmedLength() <= newCols) {
                continue;
            }
            var wrappedLines = [nextLine];
            while (nextLine.isWrapped && y > 0) {
                nextLine = this.lines.get(--y);
                wrappedLines.unshift(nextLine);
            }
            var absoluteY = this.ybase + this.y;
            if (absoluteY >= y && absoluteY < y + wrappedLines.length) {
                continue;
            }
            var lastLineLength = wrappedLines[wrappedLines.length - 1].getTrimmedLength();
            var destLineLengths = BufferReflow_1.reflowSmallerGetNewLineLengths(wrappedLines, this._cols, newCols);
            var linesToAdd = destLineLengths.length - wrappedLines.length;
            var trimmedLines = void 0;
            if (this.ybase === 0 && this.y !== this.lines.length - 1) {
                trimmedLines = Math.max(0, this.y - this.lines.maxLength + linesToAdd);
            }
            else {
                trimmedLines = Math.max(0, this.lines.length - this.lines.maxLength + linesToAdd);
            }
            var newLines = [];
            for (var i = 0; i < linesToAdd; i++) {
                var newLine = this.getBlankLine(BufferLine_1.DEFAULT_ATTR_DATA, true);
                newLines.push(newLine);
            }
            if (newLines.length > 0) {
                toInsert.push({
                    start: y + wrappedLines.length + countToInsert,
                    newLines: newLines
                });
                countToInsert += newLines.length;
            }
            wrappedLines.push.apply(wrappedLines, newLines);
            var destLineIndex = destLineLengths.length - 1;
            var destCol = destLineLengths[destLineIndex];
            if (destCol === 0) {
                destLineIndex--;
                destCol = destLineLengths[destLineIndex];
            }
            var srcLineIndex = wrappedLines.length - linesToAdd - 1;
            var srcCol = lastLineLength;
            while (srcLineIndex >= 0) {
                var cellsToCopy = Math.min(srcCol, destCol);
                wrappedLines[destLineIndex].copyCellsFrom(wrappedLines[srcLineIndex], srcCol - cellsToCopy, destCol - cellsToCopy, cellsToCopy, true);
                destCol -= cellsToCopy;
                if (destCol === 0) {
                    destLineIndex--;
                    destCol = destLineLengths[destLineIndex];
                }
                srcCol -= cellsToCopy;
                if (srcCol === 0) {
                    srcLineIndex--;
                    var wrappedLinesIndex = Math.max(srcLineIndex, 0);
                    srcCol = BufferReflow_1.getWrappedLineTrimmedLength(wrappedLines, wrappedLinesIndex, this._cols);
                }
            }
            for (var i = 0; i < wrappedLines.length; i++) {
                if (destLineLengths[i] < newCols) {
                    wrappedLines[i].setCell(destLineLengths[i], nullCell);
                }
            }
            var viewportAdjustments = linesToAdd - trimmedLines;
            while (viewportAdjustments-- > 0) {
                if (this.ybase === 0) {
                    if (this.y < newRows - 1) {
                        this.y++;
                        this.lines.pop();
                    }
                    else {
                        this.ybase++;
                        this.ydisp++;
                    }
                }
                else {
                    if (this.ybase < Math.min(this.lines.maxLength, this.lines.length + countToInsert) - newRows) {
                        if (this.ybase === this.ydisp) {
                            this.ydisp++;
                        }
                        this.ybase++;
                    }
                }
            }
        }
        if (toInsert.length > 0) {
            var insertEvents = [];
            var originalLines = [];
            for (var i = 0; i < this.lines.length; i++) {
                originalLines.push(this.lines.get(i));
            }
            var originalLinesLength = this.lines.length;
            var originalLineIndex = originalLinesLength - 1;
            var nextToInsertIndex = 0;
            var nextToInsert = toInsert[nextToInsertIndex];
            this.lines.length = Math.min(this.lines.maxLength, this.lines.length + countToInsert);
            var countInsertedSoFar = 0;
            for (var i = Math.min(this.lines.maxLength - 1, originalLinesLength + countToInsert - 1); i >= 0; i--) {
                if (nextToInsert && nextToInsert.start > originalLineIndex + countInsertedSoFar) {
                    for (var nextI = nextToInsert.newLines.length - 1; nextI >= 0; nextI--) {
                        this.lines.set(i--, nextToInsert.newLines[nextI]);
                    }
                    i++;
                    insertEvents.push({
                        index: originalLineIndex + 1,
                        amount: nextToInsert.newLines.length
                    });
                    countInsertedSoFar += nextToInsert.newLines.length;
                    nextToInsert = toInsert[++nextToInsertIndex];
                }
                else {
                    this.lines.set(i, originalLines[originalLineIndex--]);
                }
            }
            var insertCountEmitted = 0;
            for (var i = insertEvents.length - 1; i >= 0; i--) {
                insertEvents[i].index += insertCountEmitted;
                this.lines.onInsertEmitter.fire(insertEvents[i]);
                insertCountEmitted += insertEvents[i].amount;
            }
            var amountToTrim = Math.max(0, originalLinesLength + countToInsert - this.lines.maxLength);
            if (amountToTrim > 0) {
                this.lines.onTrimEmitter.fire(amountToTrim);
            }
        }
    };
    Buffer.prototype.stringIndexToBufferIndex = function (lineIndex, stringIndex, trimRight) {
        if (trimRight === void 0) { trimRight = false; }
        while (stringIndex) {
            var line = this.lines.get(lineIndex);
            if (!line) {
                return [-1, -1];
            }
            var length_1 = (trimRight) ? line.getTrimmedLength() : line.length;
            for (var i = 0; i < length_1; ++i) {
                if (line.get(i)[BufferLine_1.CHAR_DATA_WIDTH_INDEX]) {
                    stringIndex -= line.get(i)[BufferLine_1.CHAR_DATA_CHAR_INDEX].length || 1;
                }
                if (stringIndex < 0) {
                    return [lineIndex, i];
                }
            }
            lineIndex++;
        }
        return [lineIndex, 0];
    };
    Buffer.prototype.translateBufferLineToString = function (lineIndex, trimRight, startCol, endCol) {
        if (startCol === void 0) { startCol = 0; }
        var line = this.lines.get(lineIndex);
        if (!line) {
            return '';
        }
        return line.translateToString(trimRight, startCol, endCol);
    };
    Buffer.prototype.getWrappedRangeForLine = function (y) {
        var first = y;
        var last = y;
        while (first > 0 && this.lines.get(first).isWrapped) {
            first--;
        }
        while (last + 1 < this.lines.length && this.lines.get(last + 1).isWrapped) {
            last++;
        }
        return { first: first, last: last };
    };
    Buffer.prototype.setupTabStops = function (i) {
        if (i !== null && i !== undefined) {
            if (!this.tabs[i]) {
                i = this.prevStop(i);
            }
        }
        else {
            this.tabs = {};
            i = 0;
        }
        for (; i < this._cols; i += this._terminal.options.tabStopWidth) {
            this.tabs[i] = true;
        }
    };
    Buffer.prototype.prevStop = function (x) {
        if (x === null || x === undefined) {
            x = this.x;
        }
        while (!this.tabs[--x] && x > 0)
            ;
        return x >= this._cols ? this._cols - 1 : x < 0 ? 0 : x;
    };
    Buffer.prototype.nextStop = function (x) {
        if (x === null || x === undefined) {
            x = this.x;
        }
        while (!this.tabs[++x] && x < this._cols)
            ;
        return x >= this._cols ? this._cols - 1 : x < 0 ? 0 : x;
    };
    Buffer.prototype.addMarker = function (y) {
        var _this = this;
        var marker = new Marker(y);
        this.markers.push(marker);
        marker.register(this.lines.onTrim(function (amount) {
            marker.line -= amount;
            if (marker.line < 0) {
                marker.dispose();
            }
        }));
        marker.register(this.lines.onInsert(function (event) {
            if (marker.line >= event.index) {
                marker.line += event.amount;
            }
        }));
        marker.register(this.lines.onDelete(function (event) {
            if (marker.line >= event.index && marker.line < event.index + event.amount) {
                marker.dispose();
            }
            if (marker.line > event.index) {
                marker.line -= event.amount;
            }
        }));
        marker.register(marker.onDispose(function () { return _this._removeMarker(marker); }));
        return marker;
    };
    Buffer.prototype._removeMarker = function (marker) {
        this.markers.splice(this.markers.indexOf(marker), 1);
    };
    Buffer.prototype.iterator = function (trimRight, startIndex, endIndex, startOverscan, endOverscan) {
        return new BufferStringIterator(this, trimRight, startIndex, endIndex, startOverscan, endOverscan);
    };
    return Buffer;
}());
exports.Buffer = Buffer;
var Marker = (function (_super) {
    __extends(Marker, _super);
    function Marker(line) {
        var _this = _super.call(this) || this;
        _this.line = line;
        _this._id = Marker._nextId++;
        _this.isDisposed = false;
        _this._onDispose = new EventEmitter2_1.EventEmitter2();
        return _this;
    }
    Object.defineProperty(Marker.prototype, "id", {
        get: function () { return this._id; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Marker.prototype, "onDispose", {
        get: function () { return this._onDispose.event; },
        enumerable: true,
        configurable: true
    });
    Marker.prototype.dispose = function () {
        if (this.isDisposed) {
            return;
        }
        this.isDisposed = true;
        this._onDispose.fire();
    };
    Marker._nextId = 1;
    return Marker;
}(Lifecycle_1.Disposable));
exports.Marker = Marker;
var BufferStringIterator = (function () {
    function BufferStringIterator(_buffer, _trimRight, _startIndex, _endIndex, _startOverscan, _endOverscan) {
        if (_startIndex === void 0) { _startIndex = 0; }
        if (_endIndex === void 0) { _endIndex = _buffer.lines.length; }
        if (_startOverscan === void 0) { _startOverscan = 0; }
        if (_endOverscan === void 0) { _endOverscan = 0; }
        this._buffer = _buffer;
        this._trimRight = _trimRight;
        this._startIndex = _startIndex;
        this._endIndex = _endIndex;
        this._startOverscan = _startOverscan;
        this._endOverscan = _endOverscan;
        if (this._startIndex < 0) {
            this._startIndex = 0;
        }
        if (this._endIndex > this._buffer.lines.length) {
            this._endIndex = this._buffer.lines.length;
        }
        this._current = this._startIndex;
    }
    BufferStringIterator.prototype.hasNext = function () {
        return this._current < this._endIndex;
    };
    BufferStringIterator.prototype.next = function () {
        var range = this._buffer.getWrappedRangeForLine(this._current);
        if (range.first < this._startIndex - this._startOverscan) {
            range.first = this._startIndex - this._startOverscan;
        }
        if (range.last > this._endIndex + this._endOverscan) {
            range.last = this._endIndex + this._endOverscan;
        }
        range.first = Math.max(range.first, 0);
        range.last = Math.min(range.last, this._buffer.lines.length);
        var result = '';
        for (var i = range.first; i <= range.last; ++i) {
            result += this._buffer.translateBufferLineToString(i, this._trimRight);
        }
        this._current = range.last + 1;
        return { range: range, content: result };
    };
    return BufferStringIterator;
}());
exports.BufferStringIterator = BufferStringIterator;
//# sourceMappingURL=Buffer.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/BufferReflow.js":
/*!************************************************!*\
  !*** ./node_modules/xterm/lib/BufferReflow.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
function reflowLargerGetLinesToRemove(lines, oldCols, newCols, bufferAbsoluteY, nullCell) {
    var toRemove = [];
    for (var y = 0; y < lines.length - 1; y++) {
        var i = y;
        var nextLine = lines.get(++i);
        if (!nextLine.isWrapped) {
            continue;
        }
        var wrappedLines = [lines.get(y)];
        while (i < lines.length && nextLine.isWrapped) {
            wrappedLines.push(nextLine);
            nextLine = lines.get(++i);
        }
        if (bufferAbsoluteY >= y && bufferAbsoluteY < i) {
            y += wrappedLines.length - 1;
            continue;
        }
        var destLineIndex = 0;
        var destCol = getWrappedLineTrimmedLength(wrappedLines, destLineIndex, oldCols);
        var srcLineIndex = 1;
        var srcCol = 0;
        while (srcLineIndex < wrappedLines.length) {
            var srcTrimmedTineLength = getWrappedLineTrimmedLength(wrappedLines, srcLineIndex, oldCols);
            var srcRemainingCells = srcTrimmedTineLength - srcCol;
            var destRemainingCells = newCols - destCol;
            var cellsToCopy = Math.min(srcRemainingCells, destRemainingCells);
            wrappedLines[destLineIndex].copyCellsFrom(wrappedLines[srcLineIndex], srcCol, destCol, cellsToCopy, false);
            destCol += cellsToCopy;
            if (destCol === newCols) {
                destLineIndex++;
                destCol = 0;
            }
            srcCol += cellsToCopy;
            if (srcCol === srcTrimmedTineLength) {
                srcLineIndex++;
                srcCol = 0;
            }
            if (destCol === 0 && destLineIndex !== 0) {
                if (wrappedLines[destLineIndex - 1].getWidth(newCols - 1) === 2) {
                    wrappedLines[destLineIndex].copyCellsFrom(wrappedLines[destLineIndex - 1], newCols - 1, destCol++, 1, false);
                    wrappedLines[destLineIndex - 1].setCell(newCols - 1, nullCell);
                }
            }
        }
        wrappedLines[destLineIndex].replaceCells(destCol, newCols, nullCell);
        var countToRemove = 0;
        for (var i_1 = wrappedLines.length - 1; i_1 > 0; i_1--) {
            if (i_1 > destLineIndex || wrappedLines[i_1].getTrimmedLength() === 0) {
                countToRemove++;
            }
            else {
                break;
            }
        }
        if (countToRemove > 0) {
            toRemove.push(y + wrappedLines.length - countToRemove);
            toRemove.push(countToRemove);
        }
        y += wrappedLines.length - 1;
    }
    return toRemove;
}
exports.reflowLargerGetLinesToRemove = reflowLargerGetLinesToRemove;
function reflowLargerCreateNewLayout(lines, toRemove) {
    var layout = [];
    var nextToRemoveIndex = 0;
    var nextToRemoveStart = toRemove[nextToRemoveIndex];
    var countRemovedSoFar = 0;
    for (var i = 0; i < lines.length; i++) {
        if (nextToRemoveStart === i) {
            var countToRemove = toRemove[++nextToRemoveIndex];
            lines.onDeleteEmitter.fire({
                index: i - countRemovedSoFar,
                amount: countToRemove
            });
            i += countToRemove - 1;
            countRemovedSoFar += countToRemove;
            nextToRemoveStart = toRemove[++nextToRemoveIndex];
        }
        else {
            layout.push(i);
        }
    }
    return {
        layout: layout,
        countRemoved: countRemovedSoFar
    };
}
exports.reflowLargerCreateNewLayout = reflowLargerCreateNewLayout;
function reflowLargerApplyNewLayout(lines, newLayout) {
    var newLayoutLines = [];
    for (var i = 0; i < newLayout.length; i++) {
        newLayoutLines.push(lines.get(newLayout[i]));
    }
    for (var i = 0; i < newLayoutLines.length; i++) {
        lines.set(i, newLayoutLines[i]);
    }
    lines.length = newLayout.length;
}
exports.reflowLargerApplyNewLayout = reflowLargerApplyNewLayout;
function reflowSmallerGetNewLineLengths(wrappedLines, oldCols, newCols) {
    var newLineLengths = [];
    var cellsNeeded = wrappedLines.map(function (l, i) { return getWrappedLineTrimmedLength(wrappedLines, i, oldCols); }).reduce(function (p, c) { return p + c; });
    var srcCol = 0;
    var srcLine = 0;
    var cellsAvailable = 0;
    while (cellsAvailable < cellsNeeded) {
        if (cellsNeeded - cellsAvailable < newCols) {
            newLineLengths.push(cellsNeeded - cellsAvailable);
            break;
        }
        srcCol += newCols;
        var oldTrimmedLength = getWrappedLineTrimmedLength(wrappedLines, srcLine, oldCols);
        if (srcCol > oldTrimmedLength) {
            srcCol -= oldTrimmedLength;
            srcLine++;
        }
        var endsWithWide = wrappedLines[srcLine].getWidth(srcCol - 1) === 2;
        if (endsWithWide) {
            srcCol--;
        }
        var lineLength = endsWithWide ? newCols - 1 : newCols;
        newLineLengths.push(lineLength);
        cellsAvailable += lineLength;
    }
    return newLineLengths;
}
exports.reflowSmallerGetNewLineLengths = reflowSmallerGetNewLineLengths;
function getWrappedLineTrimmedLength(lines, i, cols) {
    if (i === lines.length - 1) {
        return lines[i].getTrimmedLength();
    }
    var endsInNull = !(lines[i].hasContent(cols - 1)) && lines[i].getWidth(cols - 1) === 1;
    var followingLineStartsWithWide = lines[i + 1].getWidth(0) === 2;
    if (endsInNull && followingLineStartsWithWide) {
        return cols - 1;
    }
    return cols;
}
exports.getWrappedLineTrimmedLength = getWrappedLineTrimmedLength;
//# sourceMappingURL=BufferReflow.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/BufferSet.js":
/*!*********************************************!*\
  !*** ./node_modules/xterm/lib/BufferSet.js ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var Buffer_1 = __webpack_require__(/*! ./Buffer */ "./node_modules/xterm/lib/Buffer.js");
var EventEmitter2_1 = __webpack_require__(/*! ./common/EventEmitter2 */ "./node_modules/xterm/lib/common/EventEmitter2.js");
var BufferSet = (function () {
    function BufferSet(_terminal) {
        this._terminal = _terminal;
        this._onBufferActivate = new EventEmitter2_1.EventEmitter2();
        this._normal = new Buffer_1.Buffer(this._terminal, true);
        this._normal.fillViewportRows();
        this._alt = new Buffer_1.Buffer(this._terminal, false);
        this._activeBuffer = this._normal;
        this.setupTabStops();
    }
    Object.defineProperty(BufferSet.prototype, "onBufferActivate", {
        get: function () { return this._onBufferActivate.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BufferSet.prototype, "alt", {
        get: function () {
            return this._alt;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BufferSet.prototype, "active", {
        get: function () {
            return this._activeBuffer;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BufferSet.prototype, "normal", {
        get: function () {
            return this._normal;
        },
        enumerable: true,
        configurable: true
    });
    BufferSet.prototype.activateNormalBuffer = function () {
        if (this._activeBuffer === this._normal) {
            return;
        }
        this._normal.x = this._alt.x;
        this._normal.y = this._alt.y;
        this._alt.clear();
        this._activeBuffer = this._normal;
        this._onBufferActivate.fire({
            activeBuffer: this._normal,
            inactiveBuffer: this._alt
        });
    };
    BufferSet.prototype.activateAltBuffer = function (fillAttr) {
        if (this._activeBuffer === this._alt) {
            return;
        }
        this._alt.fillViewportRows(fillAttr);
        this._alt.x = this._normal.x;
        this._alt.y = this._normal.y;
        this._activeBuffer = this._alt;
        this._onBufferActivate.fire({
            activeBuffer: this._alt,
            inactiveBuffer: this._normal
        });
    };
    BufferSet.prototype.resize = function (newCols, newRows) {
        this._normal.resize(newCols, newRows);
        this._alt.resize(newCols, newRows);
    };
    BufferSet.prototype.setupTabStops = function (i) {
        this._normal.setupTabStops(i);
        this._alt.setupTabStops(i);
    };
    return BufferSet;
}());
exports.BufferSet = BufferSet;
//# sourceMappingURL=BufferSet.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/CharMeasure.js":
/*!***********************************************!*\
  !*** ./node_modules/xterm/lib/CharMeasure.js ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var EventEmitter2_1 = __webpack_require__(/*! ./common/EventEmitter2 */ "./node_modules/xterm/lib/common/EventEmitter2.js");
var CharMeasure = (function () {
    function CharMeasure(document, parentElement) {
        this._onCharSizeChanged = new EventEmitter2_1.EventEmitter2();
        this._document = document;
        this._parentElement = parentElement;
        this._measureElement = this._document.createElement('span');
        this._measureElement.classList.add('xterm-char-measure-element');
        this._measureElement.textContent = 'W';
        this._measureElement.setAttribute('aria-hidden', 'true');
        this._parentElement.appendChild(this._measureElement);
    }
    Object.defineProperty(CharMeasure.prototype, "onCharSizeChanged", {
        get: function () { return this._onCharSizeChanged.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CharMeasure.prototype, "width", {
        get: function () {
            return this._width;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CharMeasure.prototype, "height", {
        get: function () {
            return this._height;
        },
        enumerable: true,
        configurable: true
    });
    CharMeasure.prototype.measure = function (options) {
        this._measureElement.style.fontFamily = options.fontFamily;
        this._measureElement.style.fontSize = options.fontSize + "px";
        var geometry = this._measureElement.getBoundingClientRect();
        if (geometry.width === 0 || geometry.height === 0) {
            return;
        }
        var adjustedHeight = Math.ceil(geometry.height);
        if (this._width !== geometry.width || this._height !== adjustedHeight) {
            this._width = geometry.width;
            this._height = adjustedHeight;
            this._onCharSizeChanged.fire();
        }
    };
    return CharMeasure;
}());
exports.CharMeasure = CharMeasure;
//# sourceMappingURL=CharMeasure.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/CharWidth.js":
/*!*********************************************!*\
  !*** ./node_modules/xterm/lib/CharWidth.js ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var TypedArrayUtils_1 = __webpack_require__(/*! ./common/TypedArrayUtils */ "./node_modules/xterm/lib/common/TypedArrayUtils.js");
exports.wcwidth = (function (opts) {
    var COMBINING_BMP = [
        [0x0300, 0x036F], [0x0483, 0x0486], [0x0488, 0x0489],
        [0x0591, 0x05BD], [0x05BF, 0x05BF], [0x05C1, 0x05C2],
        [0x05C4, 0x05C5], [0x05C7, 0x05C7], [0x0600, 0x0603],
        [0x0610, 0x0615], [0x064B, 0x065E], [0x0670, 0x0670],
        [0x06D6, 0x06E4], [0x06E7, 0x06E8], [0x06EA, 0x06ED],
        [0x070F, 0x070F], [0x0711, 0x0711], [0x0730, 0x074A],
        [0x07A6, 0x07B0], [0x07EB, 0x07F3], [0x0901, 0x0902],
        [0x093C, 0x093C], [0x0941, 0x0948], [0x094D, 0x094D],
        [0x0951, 0x0954], [0x0962, 0x0963], [0x0981, 0x0981],
        [0x09BC, 0x09BC], [0x09C1, 0x09C4], [0x09CD, 0x09CD],
        [0x09E2, 0x09E3], [0x0A01, 0x0A02], [0x0A3C, 0x0A3C],
        [0x0A41, 0x0A42], [0x0A47, 0x0A48], [0x0A4B, 0x0A4D],
        [0x0A70, 0x0A71], [0x0A81, 0x0A82], [0x0ABC, 0x0ABC],
        [0x0AC1, 0x0AC5], [0x0AC7, 0x0AC8], [0x0ACD, 0x0ACD],
        [0x0AE2, 0x0AE3], [0x0B01, 0x0B01], [0x0B3C, 0x0B3C],
        [0x0B3F, 0x0B3F], [0x0B41, 0x0B43], [0x0B4D, 0x0B4D],
        [0x0B56, 0x0B56], [0x0B82, 0x0B82], [0x0BC0, 0x0BC0],
        [0x0BCD, 0x0BCD], [0x0C3E, 0x0C40], [0x0C46, 0x0C48],
        [0x0C4A, 0x0C4D], [0x0C55, 0x0C56], [0x0CBC, 0x0CBC],
        [0x0CBF, 0x0CBF], [0x0CC6, 0x0CC6], [0x0CCC, 0x0CCD],
        [0x0CE2, 0x0CE3], [0x0D41, 0x0D43], [0x0D4D, 0x0D4D],
        [0x0DCA, 0x0DCA], [0x0DD2, 0x0DD4], [0x0DD6, 0x0DD6],
        [0x0E31, 0x0E31], [0x0E34, 0x0E3A], [0x0E47, 0x0E4E],
        [0x0EB1, 0x0EB1], [0x0EB4, 0x0EB9], [0x0EBB, 0x0EBC],
        [0x0EC8, 0x0ECD], [0x0F18, 0x0F19], [0x0F35, 0x0F35],
        [0x0F37, 0x0F37], [0x0F39, 0x0F39], [0x0F71, 0x0F7E],
        [0x0F80, 0x0F84], [0x0F86, 0x0F87], [0x0F90, 0x0F97],
        [0x0F99, 0x0FBC], [0x0FC6, 0x0FC6], [0x102D, 0x1030],
        [0x1032, 0x1032], [0x1036, 0x1037], [0x1039, 0x1039],
        [0x1058, 0x1059], [0x1160, 0x11FF], [0x135F, 0x135F],
        [0x1712, 0x1714], [0x1732, 0x1734], [0x1752, 0x1753],
        [0x1772, 0x1773], [0x17B4, 0x17B5], [0x17B7, 0x17BD],
        [0x17C6, 0x17C6], [0x17C9, 0x17D3], [0x17DD, 0x17DD],
        [0x180B, 0x180D], [0x18A9, 0x18A9], [0x1920, 0x1922],
        [0x1927, 0x1928], [0x1932, 0x1932], [0x1939, 0x193B],
        [0x1A17, 0x1A18], [0x1B00, 0x1B03], [0x1B34, 0x1B34],
        [0x1B36, 0x1B3A], [0x1B3C, 0x1B3C], [0x1B42, 0x1B42],
        [0x1B6B, 0x1B73], [0x1DC0, 0x1DCA], [0x1DFE, 0x1DFF],
        [0x200B, 0x200F], [0x202A, 0x202E], [0x2060, 0x2063],
        [0x206A, 0x206F], [0x20D0, 0x20EF], [0x302A, 0x302F],
        [0x3099, 0x309A], [0xA806, 0xA806], [0xA80B, 0xA80B],
        [0xA825, 0xA826], [0xFB1E, 0xFB1E], [0xFE00, 0xFE0F],
        [0xFE20, 0xFE23], [0xFEFF, 0xFEFF], [0xFFF9, 0xFFFB]
    ];
    var COMBINING_HIGH = [
        [0x10A01, 0x10A03], [0x10A05, 0x10A06], [0x10A0C, 0x10A0F],
        [0x10A38, 0x10A3A], [0x10A3F, 0x10A3F], [0x1D167, 0x1D169],
        [0x1D173, 0x1D182], [0x1D185, 0x1D18B], [0x1D1AA, 0x1D1AD],
        [0x1D242, 0x1D244], [0xE0001, 0xE0001], [0xE0020, 0xE007F],
        [0xE0100, 0xE01EF]
    ];
    function bisearch(ucs, data) {
        var min = 0;
        var max = data.length - 1;
        var mid;
        if (ucs < data[0][0] || ucs > data[max][1]) {
            return false;
        }
        while (max >= min) {
            mid = (min + max) >> 1;
            if (ucs > data[mid][1]) {
                min = mid + 1;
            }
            else if (ucs < data[mid][0]) {
                max = mid - 1;
            }
            else {
                return true;
            }
        }
        return false;
    }
    function wcwidthHigh(ucs) {
        if (bisearch(ucs, COMBINING_HIGH)) {
            return 0;
        }
        if ((ucs >= 0x20000 && ucs <= 0x2fffd) || (ucs >= 0x30000 && ucs <= 0x3fffd)) {
            return 2;
        }
        return 1;
    }
    var control = opts.control | 0;
    var table = new Uint8Array(65536);
    TypedArrayUtils_1.fill(table, 1);
    table[0] = opts.nul;
    TypedArrayUtils_1.fill(table, opts.control, 1, 32);
    TypedArrayUtils_1.fill(table, opts.control, 0x7f, 0xa0);
    TypedArrayUtils_1.fill(table, 2, 0x1100, 0x1160);
    table[0x2329] = 2;
    table[0x232a] = 2;
    TypedArrayUtils_1.fill(table, 2, 0x2e80, 0xa4d0);
    table[0x303f] = 1;
    TypedArrayUtils_1.fill(table, 2, 0xac00, 0xd7a4);
    TypedArrayUtils_1.fill(table, 2, 0xf900, 0xfb00);
    TypedArrayUtils_1.fill(table, 2, 0xfe10, 0xfe1a);
    TypedArrayUtils_1.fill(table, 2, 0xfe30, 0xfe70);
    TypedArrayUtils_1.fill(table, 2, 0xff00, 0xff61);
    TypedArrayUtils_1.fill(table, 2, 0xffe0, 0xffe7);
    for (var r = 0; r < COMBINING_BMP.length; ++r) {
        TypedArrayUtils_1.fill(table, 0, COMBINING_BMP[r][0], COMBINING_BMP[r][1] + 1);
    }
    return function (num) {
        if (num < 32) {
            return control | 0;
        }
        if (num < 127) {
            return 1;
        }
        if (num < 65536) {
            return table[num];
        }
        return wcwidthHigh(num);
    };
})({ nul: 0, control: 0 });
function getStringCellWidth(s) {
    var result = 0;
    var length = s.length;
    for (var i = 0; i < length; ++i) {
        var code = s.charCodeAt(i);
        if (0xD800 <= code && code <= 0xDBFF) {
            if (++i >= length) {
                return result + exports.wcwidth(code);
            }
            var second = s.charCodeAt(i);
            if (0xDC00 <= second && second <= 0xDFFF) {
                code = (code - 0xD800) * 0x400 + second - 0xDC00 + 0x10000;
            }
            else {
                result += exports.wcwidth(second);
            }
        }
        result += exports.wcwidth(code);
    }
    return result;
}
exports.getStringCellWidth = getStringCellWidth;
//# sourceMappingURL=CharWidth.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/Clipboard.js":
/*!*********************************************!*\
  !*** ./node_modules/xterm/lib/Clipboard.js ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
function prepareTextForTerminal(text) {
    return text.replace(/\r?\n/g, '\r');
}
exports.prepareTextForTerminal = prepareTextForTerminal;
function bracketTextForPaste(text, bracketedPasteMode) {
    if (bracketedPasteMode) {
        return '\x1b[200~' + text + '\x1b[201~';
    }
    return text;
}
exports.bracketTextForPaste = bracketTextForPaste;
function copyHandler(ev, term, selectionManager) {
    if (term.browser.isMSIE) {
        window.clipboardData.setData('Text', selectionManager.selectionText);
    }
    else {
        ev.clipboardData.setData('text/plain', selectionManager.selectionText);
    }
    ev.preventDefault();
}
exports.copyHandler = copyHandler;
function pasteHandler(ev, term) {
    ev.stopPropagation();
    var text;
    var dispatchPaste = function (text) {
        text = prepareTextForTerminal(text);
        text = bracketTextForPaste(text, term.bracketedPasteMode);
        term.handler(text);
        term.textarea.value = '';
        term.emit('paste', text);
        term.cancel(ev);
    };
    if (term.browser.isMSIE) {
        if (window.clipboardData) {
            text = window.clipboardData.getData('Text');
            dispatchPaste(text);
        }
    }
    else {
        if (ev.clipboardData) {
            text = ev.clipboardData.getData('text/plain');
            dispatchPaste(text);
        }
    }
}
exports.pasteHandler = pasteHandler;
function moveTextAreaUnderMouseCursor(ev, term) {
    var pos = term.screenElement.getBoundingClientRect();
    var left = ev.clientX - pos.left - 10;
    var top = ev.clientY - pos.top - 10;
    term.textarea.style.position = 'absolute';
    term.textarea.style.width = '20px';
    term.textarea.style.height = '20px';
    term.textarea.style.left = left + "px";
    term.textarea.style.top = top + "px";
    term.textarea.style.zIndex = '1000';
    term.textarea.focus();
    setTimeout(function () {
        term.textarea.style.position = null;
        term.textarea.style.width = null;
        term.textarea.style.height = null;
        term.textarea.style.left = null;
        term.textarea.style.top = null;
        term.textarea.style.zIndex = null;
    }, 200);
}
exports.moveTextAreaUnderMouseCursor = moveTextAreaUnderMouseCursor;
function rightClickHandler(ev, term, selectionManager, shouldSelectWord) {
    moveTextAreaUnderMouseCursor(ev, term);
    if (shouldSelectWord && !selectionManager.isClickInSelection(ev)) {
        selectionManager.selectWordAtCursor(ev);
    }
    term.textarea.value = selectionManager.selectionText;
    term.textarea.select();
}
exports.rightClickHandler = rightClickHandler;
//# sourceMappingURL=Clipboard.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/CompositionHelper.js":
/*!*****************************************************!*\
  !*** ./node_modules/xterm/lib/CompositionHelper.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var CompositionHelper = (function () {
    function CompositionHelper(_textarea, _compositionView, _terminal) {
        this._textarea = _textarea;
        this._compositionView = _compositionView;
        this._terminal = _terminal;
        this._isComposing = false;
        this._isSendingComposition = false;
        this._compositionPosition = { start: null, end: null };
    }
    CompositionHelper.prototype.compositionstart = function () {
        this._isComposing = true;
        this._compositionPosition.start = this._textarea.value.length;
        this._compositionView.textContent = '';
        this._compositionView.classList.add('active');
    };
    CompositionHelper.prototype.compositionupdate = function (ev) {
        var _this = this;
        this._compositionView.textContent = ev.data;
        this.updateCompositionElements();
        setTimeout(function () {
            _this._compositionPosition.end = _this._textarea.value.length;
        }, 0);
    };
    CompositionHelper.prototype.compositionend = function () {
        this._finalizeComposition(true);
    };
    CompositionHelper.prototype.keydown = function (ev) {
        if (this._isComposing || this._isSendingComposition) {
            if (ev.keyCode === 229) {
                return false;
            }
            else if (ev.keyCode === 16 || ev.keyCode === 17 || ev.keyCode === 18) {
                return false;
            }
            this._finalizeComposition(false);
        }
        if (ev.keyCode === 229) {
            this._handleAnyTextareaChanges();
            return false;
        }
        return true;
    };
    CompositionHelper.prototype._finalizeComposition = function (waitForPropagation) {
        var _this = this;
        this._compositionView.classList.remove('active');
        this._isComposing = false;
        this._clearTextareaPosition();
        if (!waitForPropagation) {
            this._isSendingComposition = false;
            var input = this._textarea.value.substring(this._compositionPosition.start, this._compositionPosition.end);
            this._terminal.handler(input);
        }
        else {
            var currentCompositionPosition_1 = {
                start: this._compositionPosition.start,
                end: this._compositionPosition.end
            };
            this._isSendingComposition = true;
            setTimeout(function () {
                if (_this._isSendingComposition) {
                    _this._isSendingComposition = false;
                    var input = void 0;
                    if (_this._isComposing) {
                        input = _this._textarea.value.substring(currentCompositionPosition_1.start, currentCompositionPosition_1.end);
                    }
                    else {
                        input = _this._textarea.value.substring(currentCompositionPosition_1.start);
                    }
                    _this._terminal.handler(input);
                }
            }, 0);
        }
    };
    CompositionHelper.prototype._handleAnyTextareaChanges = function () {
        var _this = this;
        var oldValue = this._textarea.value;
        setTimeout(function () {
            if (!_this._isComposing) {
                var newValue = _this._textarea.value;
                var diff = newValue.replace(oldValue, '');
                if (diff.length > 0) {
                    _this._terminal.handler(diff);
                }
            }
        }, 0);
    };
    CompositionHelper.prototype.updateCompositionElements = function (dontRecurse) {
        var _this = this;
        if (!this._isComposing) {
            return;
        }
        if (this._terminal.buffer.isCursorInViewport) {
            var cellHeight = Math.ceil(this._terminal.charMeasure.height * this._terminal.options.lineHeight);
            var cursorTop = this._terminal.buffer.y * cellHeight;
            var cursorLeft = this._terminal.buffer.x * this._terminal.charMeasure.width;
            this._compositionView.style.left = cursorLeft + 'px';
            this._compositionView.style.top = cursorTop + 'px';
            this._compositionView.style.height = cellHeight + 'px';
            this._compositionView.style.lineHeight = cellHeight + 'px';
            this._compositionView.style.fontFamily = this._terminal.options.fontFamily;
            this._compositionView.style.fontSize = this._terminal.options.fontSize + 'px';
            var compositionViewBounds = this._compositionView.getBoundingClientRect();
            this._textarea.style.left = cursorLeft + 'px';
            this._textarea.style.top = cursorTop + 'px';
            this._textarea.style.width = compositionViewBounds.width + 'px';
            this._textarea.style.height = compositionViewBounds.height + 'px';
            this._textarea.style.lineHeight = compositionViewBounds.height + 'px';
        }
        if (!dontRecurse) {
            setTimeout(function () { return _this.updateCompositionElements(true); }, 0);
        }
    };
    CompositionHelper.prototype._clearTextareaPosition = function () {
        this._textarea.style.left = '';
        this._textarea.style.top = '';
    };
    return CompositionHelper;
}());
exports.CompositionHelper = CompositionHelper;
//# sourceMappingURL=CompositionHelper.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/EscapeSequenceParser.js":
/*!********************************************************!*\
  !*** ./node_modules/xterm/lib/EscapeSequenceParser.js ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Lifecycle_1 = __webpack_require__(/*! ./common/Lifecycle */ "./node_modules/xterm/lib/common/Lifecycle.js");
var TextDecoder_1 = __webpack_require__(/*! ./core/input/TextDecoder */ "./node_modules/xterm/lib/core/input/TextDecoder.js");
function r(low, high) {
    var c = high - low;
    var arr = new Array(c);
    while (c--) {
        arr[c] = --high;
    }
    return arr;
}
var TransitionTable = (function () {
    function TransitionTable(length) {
        this.table = (typeof Uint8Array === 'undefined')
            ? new Array(length)
            : new Uint8Array(length);
    }
    TransitionTable.prototype.add = function (code, state, action, next) {
        this.table[state << 8 | code] = ((action | 0) << 4) | ((next === undefined) ? state : next);
    };
    TransitionTable.prototype.addMany = function (codes, state, action, next) {
        for (var i = 0; i < codes.length; i++) {
            this.add(codes[i], state, action, next);
        }
    };
    return TransitionTable;
}());
exports.TransitionTable = TransitionTable;
var PRINTABLES = r(0x20, 0x7f);
var EXECUTABLES = r(0x00, 0x18);
EXECUTABLES.push(0x19);
EXECUTABLES.push.apply(EXECUTABLES, r(0x1c, 0x20));
var NON_ASCII_PRINTABLE = 0xA0;
exports.VT500_TRANSITION_TABLE = (function () {
    var table = new TransitionTable(4095);
    var states = r(0, 13 + 1);
    var state;
    for (state in states) {
        for (var code = 0; code <= NON_ASCII_PRINTABLE; ++code) {
            table.add(code, state, 1, 0);
        }
    }
    table.addMany(PRINTABLES, 0, 2, 0);
    for (state in states) {
        table.addMany([0x18, 0x1a, 0x99, 0x9a], state, 3, 0);
        table.addMany(r(0x80, 0x90), state, 3, 0);
        table.addMany(r(0x90, 0x98), state, 3, 0);
        table.add(0x9c, state, 0, 0);
        table.add(0x1b, state, 11, 1);
        table.add(0x9d, state, 4, 8);
        table.addMany([0x98, 0x9e, 0x9f], state, 0, 7);
        table.add(0x9b, state, 11, 3);
        table.add(0x90, state, 11, 9);
    }
    table.addMany(EXECUTABLES, 0, 3, 0);
    table.addMany(EXECUTABLES, 1, 3, 1);
    table.add(0x7f, 1, 0, 1);
    table.addMany(EXECUTABLES, 8, 0, 8);
    table.addMany(EXECUTABLES, 3, 3, 3);
    table.add(0x7f, 3, 0, 3);
    table.addMany(EXECUTABLES, 4, 3, 4);
    table.add(0x7f, 4, 0, 4);
    table.addMany(EXECUTABLES, 6, 3, 6);
    table.addMany(EXECUTABLES, 5, 3, 5);
    table.add(0x7f, 5, 0, 5);
    table.addMany(EXECUTABLES, 2, 3, 2);
    table.add(0x7f, 2, 0, 2);
    table.add(0x5d, 1, 4, 8);
    table.addMany(PRINTABLES, 8, 5, 8);
    table.add(0x7f, 8, 5, 8);
    table.addMany([0x9c, 0x1b, 0x18, 0x1a, 0x07], 8, 6, 0);
    table.addMany(r(0x1c, 0x20), 8, 0, 8);
    table.addMany([0x58, 0x5e, 0x5f], 1, 0, 7);
    table.addMany(PRINTABLES, 7, 0, 7);
    table.addMany(EXECUTABLES, 7, 0, 7);
    table.add(0x9c, 7, 0, 0);
    table.add(0x7f, 7, 0, 7);
    table.add(0x5b, 1, 11, 3);
    table.addMany(r(0x40, 0x7f), 3, 7, 0);
    table.addMany(r(0x30, 0x3a), 3, 8, 4);
    table.add(0x3b, 3, 8, 4);
    table.addMany([0x3c, 0x3d, 0x3e, 0x3f], 3, 9, 4);
    table.addMany(r(0x30, 0x3a), 4, 8, 4);
    table.add(0x3b, 4, 8, 4);
    table.addMany(r(0x40, 0x7f), 4, 7, 0);
    table.addMany([0x3a, 0x3c, 0x3d, 0x3e, 0x3f], 4, 0, 6);
    table.addMany(r(0x20, 0x40), 6, 0, 6);
    table.add(0x7f, 6, 0, 6);
    table.addMany(r(0x40, 0x7f), 6, 0, 0);
    table.add(0x3a, 3, 0, 6);
    table.addMany(r(0x20, 0x30), 3, 9, 5);
    table.addMany(r(0x20, 0x30), 5, 9, 5);
    table.addMany(r(0x30, 0x40), 5, 0, 6);
    table.addMany(r(0x40, 0x7f), 5, 7, 0);
    table.addMany(r(0x20, 0x30), 4, 9, 5);
    table.addMany(r(0x20, 0x30), 1, 9, 2);
    table.addMany(r(0x20, 0x30), 2, 9, 2);
    table.addMany(r(0x30, 0x7f), 2, 10, 0);
    table.addMany(r(0x30, 0x50), 1, 10, 0);
    table.addMany(r(0x51, 0x58), 1, 10, 0);
    table.addMany([0x59, 0x5a, 0x5c], 1, 10, 0);
    table.addMany(r(0x60, 0x7f), 1, 10, 0);
    table.add(0x50, 1, 11, 9);
    table.addMany(EXECUTABLES, 9, 0, 9);
    table.add(0x7f, 9, 0, 9);
    table.addMany(r(0x1c, 0x20), 9, 0, 9);
    table.addMany(r(0x20, 0x30), 9, 9, 12);
    table.add(0x3a, 9, 0, 11);
    table.addMany(r(0x30, 0x3a), 9, 8, 10);
    table.add(0x3b, 9, 8, 10);
    table.addMany([0x3c, 0x3d, 0x3e, 0x3f], 9, 9, 10);
    table.addMany(EXECUTABLES, 11, 0, 11);
    table.addMany(r(0x20, 0x80), 11, 0, 11);
    table.addMany(r(0x1c, 0x20), 11, 0, 11);
    table.addMany(EXECUTABLES, 10, 0, 10);
    table.add(0x7f, 10, 0, 10);
    table.addMany(r(0x1c, 0x20), 10, 0, 10);
    table.addMany(r(0x30, 0x3a), 10, 8, 10);
    table.add(0x3b, 10, 8, 10);
    table.addMany([0x3a, 0x3c, 0x3d, 0x3e, 0x3f], 10, 0, 11);
    table.addMany(r(0x20, 0x30), 10, 9, 12);
    table.addMany(EXECUTABLES, 12, 0, 12);
    table.add(0x7f, 12, 0, 12);
    table.addMany(r(0x1c, 0x20), 12, 0, 12);
    table.addMany(r(0x20, 0x30), 12, 9, 12);
    table.addMany(r(0x30, 0x40), 12, 0, 11);
    table.addMany(r(0x40, 0x7f), 12, 12, 13);
    table.addMany(r(0x40, 0x7f), 10, 12, 13);
    table.addMany(r(0x40, 0x7f), 9, 12, 13);
    table.addMany(EXECUTABLES, 13, 13, 13);
    table.addMany(PRINTABLES, 13, 13, 13);
    table.add(0x7f, 13, 0, 13);
    table.addMany([0x1b, 0x9c], 13, 14, 0);
    table.add(NON_ASCII_PRINTABLE, 8, 5, 8);
    return table;
})();
var DcsDummy = (function () {
    function DcsDummy() {
    }
    DcsDummy.prototype.hook = function (collect, params, flag) { };
    DcsDummy.prototype.put = function (data, start, end) { };
    DcsDummy.prototype.unhook = function () { };
    return DcsDummy;
}());
var EscapeSequenceParser = (function (_super) {
    __extends(EscapeSequenceParser, _super);
    function EscapeSequenceParser(TRANSITIONS) {
        if (TRANSITIONS === void 0) { TRANSITIONS = exports.VT500_TRANSITION_TABLE; }
        var _this = _super.call(this) || this;
        _this.TRANSITIONS = TRANSITIONS;
        _this.initialState = 0;
        _this.currentState = _this.initialState;
        _this._osc = '';
        _this._params = [0];
        _this._collect = '';
        _this._printHandlerFb = function (data, start, end) { };
        _this._executeHandlerFb = function (code) { };
        _this._csiHandlerFb = function (collect, params, flag) { };
        _this._escHandlerFb = function (collect, flag) { };
        _this._oscHandlerFb = function (identifier, data) { };
        _this._dcsHandlerFb = new DcsDummy();
        _this._errorHandlerFb = function (state) { return state; };
        _this._printHandler = _this._printHandlerFb;
        _this._executeHandlers = Object.create(null);
        _this._csiHandlers = Object.create(null);
        _this._escHandlers = Object.create(null);
        _this._oscHandlers = Object.create(null);
        _this._dcsHandlers = Object.create(null);
        _this._activeDcsHandler = null;
        _this._errorHandler = _this._errorHandlerFb;
        _this.setEscHandler('\\', function () { });
        return _this;
    }
    EscapeSequenceParser.prototype.dispose = function () {
        this._printHandlerFb = null;
        this._executeHandlerFb = null;
        this._csiHandlerFb = null;
        this._escHandlerFb = null;
        this._oscHandlerFb = null;
        this._dcsHandlerFb = null;
        this._errorHandlerFb = null;
        this._printHandler = null;
        this._executeHandlers = null;
        this._escHandlers = null;
        this._csiHandlers = null;
        this._oscHandlers = null;
        this._dcsHandlers = null;
        this._activeDcsHandler = null;
        this._errorHandler = null;
    };
    EscapeSequenceParser.prototype.setPrintHandler = function (callback) {
        this._printHandler = callback;
    };
    EscapeSequenceParser.prototype.clearPrintHandler = function () {
        this._printHandler = this._printHandlerFb;
    };
    EscapeSequenceParser.prototype.setExecuteHandler = function (flag, callback) {
        this._executeHandlers[flag.charCodeAt(0)] = callback;
    };
    EscapeSequenceParser.prototype.clearExecuteHandler = function (flag) {
        if (this._executeHandlers[flag.charCodeAt(0)])
            delete this._executeHandlers[flag.charCodeAt(0)];
    };
    EscapeSequenceParser.prototype.setExecuteHandlerFallback = function (callback) {
        this._executeHandlerFb = callback;
    };
    EscapeSequenceParser.prototype.addCsiHandler = function (flag, callback) {
        var index = flag.charCodeAt(0);
        if (this._csiHandlers[index] === undefined) {
            this._csiHandlers[index] = [];
        }
        var handlerList = this._csiHandlers[index];
        handlerList.push(callback);
        return {
            dispose: function () {
                var handlerIndex = handlerList.indexOf(callback);
                if (handlerIndex !== -1) {
                    handlerList.splice(handlerIndex, 1);
                }
            }
        };
    };
    EscapeSequenceParser.prototype.setCsiHandler = function (flag, callback) {
        this._csiHandlers[flag.charCodeAt(0)] = [callback];
    };
    EscapeSequenceParser.prototype.clearCsiHandler = function (flag) {
        if (this._csiHandlers[flag.charCodeAt(0)])
            delete this._csiHandlers[flag.charCodeAt(0)];
    };
    EscapeSequenceParser.prototype.setCsiHandlerFallback = function (callback) {
        this._csiHandlerFb = callback;
    };
    EscapeSequenceParser.prototype.setEscHandler = function (collectAndFlag, callback) {
        this._escHandlers[collectAndFlag] = callback;
    };
    EscapeSequenceParser.prototype.clearEscHandler = function (collectAndFlag) {
        if (this._escHandlers[collectAndFlag])
            delete this._escHandlers[collectAndFlag];
    };
    EscapeSequenceParser.prototype.setEscHandlerFallback = function (callback) {
        this._escHandlerFb = callback;
    };
    EscapeSequenceParser.prototype.addOscHandler = function (ident, callback) {
        if (this._oscHandlers[ident] === undefined) {
            this._oscHandlers[ident] = [];
        }
        var handlerList = this._oscHandlers[ident];
        handlerList.push(callback);
        return {
            dispose: function () {
                var handlerIndex = handlerList.indexOf(callback);
                if (handlerIndex !== -1) {
                    handlerList.splice(handlerIndex, 1);
                }
            }
        };
    };
    EscapeSequenceParser.prototype.setOscHandler = function (ident, callback) {
        this._oscHandlers[ident] = [callback];
    };
    EscapeSequenceParser.prototype.clearOscHandler = function (ident) {
        if (this._oscHandlers[ident])
            delete this._oscHandlers[ident];
    };
    EscapeSequenceParser.prototype.setOscHandlerFallback = function (callback) {
        this._oscHandlerFb = callback;
    };
    EscapeSequenceParser.prototype.setDcsHandler = function (collectAndFlag, handler) {
        this._dcsHandlers[collectAndFlag] = handler;
    };
    EscapeSequenceParser.prototype.clearDcsHandler = function (collectAndFlag) {
        if (this._dcsHandlers[collectAndFlag])
            delete this._dcsHandlers[collectAndFlag];
    };
    EscapeSequenceParser.prototype.setDcsHandlerFallback = function (handler) {
        this._dcsHandlerFb = handler;
    };
    EscapeSequenceParser.prototype.setErrorHandler = function (callback) {
        this._errorHandler = callback;
    };
    EscapeSequenceParser.prototype.clearErrorHandler = function () {
        this._errorHandler = this._errorHandlerFb;
    };
    EscapeSequenceParser.prototype.reset = function () {
        this.currentState = this.initialState;
        this._osc = '';
        this._params = [0];
        this._collect = '';
        this._activeDcsHandler = null;
    };
    EscapeSequenceParser.prototype.parse = function (data, length) {
        var code = 0;
        var transition = 0;
        var error = false;
        var currentState = this.currentState;
        var print = -1;
        var dcs = -1;
        var osc = this._osc;
        var collect = this._collect;
        var params = this._params;
        var table = this.TRANSITIONS.table;
        var dcsHandler = this._activeDcsHandler;
        var callback = null;
        for (var i = 0; i < length; ++i) {
            code = data[i];
            if (currentState === 0 && code > 0x1f && code < 0x80) {
                print = (~print) ? print : i;
                do
                    i++;
                while (i < length && data[i] > 0x1f && data[i] < 0x80);
                i--;
                continue;
            }
            if (currentState === 4 && (code > 0x2f && code < 0x39)) {
                params[params.length - 1] = params[params.length - 1] * 10 + code - 48;
                continue;
            }
            transition = table[currentState << 8 | (code < 0xa0 ? code : NON_ASCII_PRINTABLE)];
            switch (transition >> 4) {
                case 2:
                    print = (~print) ? print : i;
                    break;
                case 3:
                    if (~print) {
                        this._printHandler(data, print, i);
                        print = -1;
                    }
                    callback = this._executeHandlers[code];
                    if (callback)
                        callback();
                    else
                        this._executeHandlerFb(code);
                    break;
                case 0:
                    if (~print) {
                        this._printHandler(data, print, i);
                        print = -1;
                    }
                    else if (~dcs) {
                        dcsHandler.put(data, dcs, i);
                        dcs = -1;
                    }
                    break;
                case 1:
                    if (code > 0x9f) {
                        switch (currentState) {
                            case 0:
                                print = (~print) ? print : i;
                                break;
                            case 6:
                                transition |= 6;
                                break;
                            case 11:
                                transition |= 11;
                                break;
                            case 13:
                                dcs = (~dcs) ? dcs : i;
                                transition |= 13;
                                break;
                            default:
                                error = true;
                        }
                    }
                    else {
                        error = true;
                    }
                    if (error) {
                        var inject = this._errorHandler({
                            position: i,
                            code: code,
                            currentState: currentState,
                            print: print,
                            dcs: dcs,
                            osc: osc,
                            collect: collect,
                            params: params,
                            abort: false
                        });
                        if (inject.abort)
                            return;
                        error = false;
                    }
                    break;
                case 7:
                    var handlers = this._csiHandlers[code];
                    var j = handlers ? handlers.length - 1 : -1;
                    for (; j >= 0; j--) {
                        if (handlers[j](params, collect) !== false) {
                            break;
                        }
                    }
                    if (j < 0) {
                        this._csiHandlerFb(collect, params, code);
                    }
                    break;
                case 8:
                    if (code === 0x3b)
                        params.push(0);
                    else
                        params[params.length - 1] = params[params.length - 1] * 10 + code - 48;
                    break;
                case 9:
                    collect += String.fromCharCode(code);
                    break;
                case 10:
                    callback = this._escHandlers[collect + String.fromCharCode(code)];
                    if (callback)
                        callback(collect, code);
                    else
                        this._escHandlerFb(collect, code);
                    break;
                case 11:
                    if (~print) {
                        this._printHandler(data, print, i);
                        print = -1;
                    }
                    osc = '';
                    params = [0];
                    collect = '';
                    dcs = -1;
                    break;
                case 12:
                    dcsHandler = this._dcsHandlers[collect + String.fromCharCode(code)];
                    if (!dcsHandler)
                        dcsHandler = this._dcsHandlerFb;
                    dcsHandler.hook(collect, params, code);
                    break;
                case 13:
                    dcs = (~dcs) ? dcs : i;
                    break;
                case 14:
                    if (dcsHandler) {
                        if (~dcs)
                            dcsHandler.put(data, dcs, i);
                        dcsHandler.unhook();
                        dcsHandler = null;
                    }
                    if (code === 0x1b)
                        transition |= 1;
                    osc = '';
                    params = [0];
                    collect = '';
                    dcs = -1;
                    break;
                case 4:
                    if (~print) {
                        this._printHandler(data, print, i);
                        print = -1;
                    }
                    osc = '';
                    break;
                case 5:
                    for (var j_1 = i + 1;; j_1++) {
                        if (j_1 >= length
                            || (code = data[j_1]) < 0x20
                            || (code > 0x7f && code <= 0x9f)) {
                            osc += TextDecoder_1.utf32ToString(data, i, j_1);
                            i = j_1 - 1;
                            break;
                        }
                    }
                    break;
                case 6:
                    if (osc && code !== 0x18 && code !== 0x1a) {
                        var idx = osc.indexOf(';');
                        if (idx === -1) {
                            this._oscHandlerFb(-1, osc);
                        }
                        else {
                            var identifier = parseInt(osc.substring(0, idx));
                            var content = osc.substring(idx + 1);
                            var handlers_1 = this._oscHandlers[identifier];
                            var j_2 = handlers_1 ? handlers_1.length - 1 : -1;
                            for (; j_2 >= 0; j_2--) {
                                if (handlers_1[j_2](content) !== false) {
                                    break;
                                }
                            }
                            if (j_2 < 0) {
                                this._oscHandlerFb(identifier, content);
                            }
                        }
                    }
                    if (code === 0x1b)
                        transition |= 1;
                    osc = '';
                    params = [0];
                    collect = '';
                    dcs = -1;
                    break;
            }
            currentState = transition & 15;
        }
        if (currentState === 0 && ~print) {
            this._printHandler(data, print, length);
        }
        else if (currentState === 13 && ~dcs && dcsHandler) {
            dcsHandler.put(data, dcs, length);
        }
        this._osc = osc;
        this._collect = collect;
        this._params = params;
        this._activeDcsHandler = dcsHandler;
        this.currentState = currentState;
    };
    return EscapeSequenceParser;
}(Lifecycle_1.Disposable));
exports.EscapeSequenceParser = EscapeSequenceParser;
//# sourceMappingURL=EscapeSequenceParser.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/InputHandler.js":
/*!************************************************!*\
  !*** ./node_modules/xterm/lib/InputHandler.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var EscapeSequences_1 = __webpack_require__(/*! ./common/data/EscapeSequences */ "./node_modules/xterm/lib/common/data/EscapeSequences.js");
var Charsets_1 = __webpack_require__(/*! ./core/data/Charsets */ "./node_modules/xterm/lib/core/data/Charsets.js");
var CharWidth_1 = __webpack_require__(/*! ./CharWidth */ "./node_modules/xterm/lib/CharWidth.js");
var EscapeSequenceParser_1 = __webpack_require__(/*! ./EscapeSequenceParser */ "./node_modules/xterm/lib/EscapeSequenceParser.js");
var Lifecycle_1 = __webpack_require__(/*! ./common/Lifecycle */ "./node_modules/xterm/lib/common/Lifecycle.js");
var TypedArrayUtils_1 = __webpack_require__(/*! ./common/TypedArrayUtils */ "./node_modules/xterm/lib/common/TypedArrayUtils.js");
var TextDecoder_1 = __webpack_require__(/*! ./core/input/TextDecoder */ "./node_modules/xterm/lib/core/input/TextDecoder.js");
var BufferLine_1 = __webpack_require__(/*! ./core/buffer/BufferLine */ "./node_modules/xterm/lib/core/buffer/BufferLine.js");
var EventEmitter2_1 = __webpack_require__(/*! ./common/EventEmitter2 */ "./node_modules/xterm/lib/common/EventEmitter2.js");
var GLEVEL = { '(': 0, ')': 1, '*': 2, '+': 3, '-': 1, '.': 2 };
var DECRQSS = (function () {
    function DECRQSS(_terminal) {
        this._terminal = _terminal;
        this._data = new Uint32Array(0);
    }
    DECRQSS.prototype.hook = function (collect, params, flag) {
        this._data = new Uint32Array(0);
    };
    DECRQSS.prototype.put = function (data, start, end) {
        this._data = TypedArrayUtils_1.concat(this._data, data.subarray(start, end));
    };
    DECRQSS.prototype.unhook = function () {
        var data = TextDecoder_1.utf32ToString(this._data);
        this._data = new Uint32Array(0);
        switch (data) {
            case '"q':
                return this._terminal.handler(EscapeSequences_1.C0.ESC + "P1$r0\"q" + EscapeSequences_1.C0.ESC + "\\");
            case '"p':
                return this._terminal.handler(EscapeSequences_1.C0.ESC + "P1$r61\"p" + EscapeSequences_1.C0.ESC + "\\");
            case 'r':
                var pt = '' + (this._terminal.buffer.scrollTop + 1) +
                    ';' + (this._terminal.buffer.scrollBottom + 1) + 'r';
                return this._terminal.handler(EscapeSequences_1.C0.ESC + "P1$r" + pt + EscapeSequences_1.C0.ESC + "\\");
            case 'm':
                return this._terminal.handler(EscapeSequences_1.C0.ESC + "P1$r0m" + EscapeSequences_1.C0.ESC + "\\");
            case ' q':
                var STYLES = { 'block': 2, 'underline': 4, 'bar': 6 };
                var style = STYLES[this._terminal.getOption('cursorStyle')];
                style -= this._terminal.getOption('cursorBlink');
                return this._terminal.handler(EscapeSequences_1.C0.ESC + "P1$r" + style + " q" + EscapeSequences_1.C0.ESC + "\\");
            default:
                this._terminal.error('Unknown DCS $q %s', data);
                this._terminal.handler(EscapeSequences_1.C0.ESC + "P0$r" + EscapeSequences_1.C0.ESC + "\\");
        }
    };
    return DECRQSS;
}());
var InputHandler = (function (_super) {
    __extends(InputHandler, _super);
    function InputHandler(_terminal, _parser) {
        if (_parser === void 0) { _parser = new EscapeSequenceParser_1.EscapeSequenceParser(); }
        var _this = _super.call(this) || this;
        _this._terminal = _terminal;
        _this._parser = _parser;
        _this._parseBuffer = new Uint32Array(4096);
        _this._stringDecoder = new TextDecoder_1.StringToUtf32();
        _this._workCell = new BufferLine_1.CellData();
        _this._onCursorMove = new EventEmitter2_1.EventEmitter2();
        _this._onData = new EventEmitter2_1.EventEmitter2();
        _this._onLineFeed = new EventEmitter2_1.EventEmitter2();
        _this._onScroll = new EventEmitter2_1.EventEmitter2();
        _this.register(_this._parser);
        _this._parser.setCsiHandlerFallback(function (collect, params, flag) {
            _this._terminal.error('Unknown CSI code: ', { collect: collect, params: params, flag: String.fromCharCode(flag) });
        });
        _this._parser.setEscHandlerFallback(function (collect, flag) {
            _this._terminal.error('Unknown ESC code: ', { collect: collect, flag: String.fromCharCode(flag) });
        });
        _this._parser.setExecuteHandlerFallback(function (code) {
            _this._terminal.error('Unknown EXECUTE code: ', { code: code });
        });
        _this._parser.setOscHandlerFallback(function (identifier, data) {
            _this._terminal.error('Unknown OSC code: ', { identifier: identifier, data: data });
        });
        _this._parser.setPrintHandler(function (data, start, end) { return _this.print(data, start, end); });
        _this._parser.setCsiHandler('@', function (params, collect) { return _this.insertChars(params); });
        _this._parser.setCsiHandler('A', function (params, collect) { return _this.cursorUp(params); });
        _this._parser.setCsiHandler('B', function (params, collect) { return _this.cursorDown(params); });
        _this._parser.setCsiHandler('C', function (params, collect) { return _this.cursorForward(params); });
        _this._parser.setCsiHandler('D', function (params, collect) { return _this.cursorBackward(params); });
        _this._parser.setCsiHandler('E', function (params, collect) { return _this.cursorNextLine(params); });
        _this._parser.setCsiHandler('F', function (params, collect) { return _this.cursorPrecedingLine(params); });
        _this._parser.setCsiHandler('G', function (params, collect) { return _this.cursorCharAbsolute(params); });
        _this._parser.setCsiHandler('H', function (params, collect) { return _this.cursorPosition(params); });
        _this._parser.setCsiHandler('I', function (params, collect) { return _this.cursorForwardTab(params); });
        _this._parser.setCsiHandler('J', function (params, collect) { return _this.eraseInDisplay(params); });
        _this._parser.setCsiHandler('K', function (params, collect) { return _this.eraseInLine(params); });
        _this._parser.setCsiHandler('L', function (params, collect) { return _this.insertLines(params); });
        _this._parser.setCsiHandler('M', function (params, collect) { return _this.deleteLines(params); });
        _this._parser.setCsiHandler('P', function (params, collect) { return _this.deleteChars(params); });
        _this._parser.setCsiHandler('S', function (params, collect) { return _this.scrollUp(params); });
        _this._parser.setCsiHandler('T', function (params, collect) { return _this.scrollDown(params, collect); });
        _this._parser.setCsiHandler('X', function (params, collect) { return _this.eraseChars(params); });
        _this._parser.setCsiHandler('Z', function (params, collect) { return _this.cursorBackwardTab(params); });
        _this._parser.setCsiHandler('`', function (params, collect) { return _this.charPosAbsolute(params); });
        _this._parser.setCsiHandler('a', function (params, collect) { return _this.hPositionRelative(params); });
        _this._parser.setCsiHandler('b', function (params, collect) { return _this.repeatPrecedingCharacter(params); });
        _this._parser.setCsiHandler('c', function (params, collect) { return _this.sendDeviceAttributes(params, collect); });
        _this._parser.setCsiHandler('d', function (params, collect) { return _this.linePosAbsolute(params); });
        _this._parser.setCsiHandler('e', function (params, collect) { return _this.vPositionRelative(params); });
        _this._parser.setCsiHandler('f', function (params, collect) { return _this.hVPosition(params); });
        _this._parser.setCsiHandler('g', function (params, collect) { return _this.tabClear(params); });
        _this._parser.setCsiHandler('h', function (params, collect) { return _this.setMode(params, collect); });
        _this._parser.setCsiHandler('l', function (params, collect) { return _this.resetMode(params, collect); });
        _this._parser.setCsiHandler('m', function (params, collect) { return _this.charAttributes(params); });
        _this._parser.setCsiHandler('n', function (params, collect) { return _this.deviceStatus(params, collect); });
        _this._parser.setCsiHandler('p', function (params, collect) { return _this.softReset(params, collect); });
        _this._parser.setCsiHandler('q', function (params, collect) { return _this.setCursorStyle(params, collect); });
        _this._parser.setCsiHandler('r', function (params, collect) { return _this.setScrollRegion(params, collect); });
        _this._parser.setCsiHandler('s', function (params, collect) { return _this.saveCursor(params); });
        _this._parser.setCsiHandler('u', function (params, collect) { return _this.restoreCursor(params); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C0.BEL, function () { return _this.bell(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C0.LF, function () { return _this.lineFeed(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C0.VT, function () { return _this.lineFeed(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C0.FF, function () { return _this.lineFeed(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C0.CR, function () { return _this.carriageReturn(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C0.BS, function () { return _this.backspace(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C0.HT, function () { return _this.tab(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C0.SO, function () { return _this.shiftOut(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C0.SI, function () { return _this.shiftIn(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C1.IND, function () { return _this.index(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C1.NEL, function () { return _this.nextLine(); });
        _this._parser.setExecuteHandler(EscapeSequences_1.C1.HTS, function () { return _this.tabSet(); });
        _this._parser.setOscHandler(0, function (data) { return _this.setTitle(data); });
        _this._parser.setOscHandler(2, function (data) { return _this.setTitle(data); });
        _this._parser.setEscHandler('7', function () { return _this.saveCursor([]); });
        _this._parser.setEscHandler('8', function () { return _this.restoreCursor([]); });
        _this._parser.setEscHandler('D', function () { return _this.index(); });
        _this._parser.setEscHandler('E', function () { return _this.nextLine(); });
        _this._parser.setEscHandler('H', function () { return _this.tabSet(); });
        _this._parser.setEscHandler('M', function () { return _this.reverseIndex(); });
        _this._parser.setEscHandler('=', function () { return _this.keypadApplicationMode(); });
        _this._parser.setEscHandler('>', function () { return _this.keypadNumericMode(); });
        _this._parser.setEscHandler('c', function () { return _this.reset(); });
        _this._parser.setEscHandler('n', function () { return _this.setgLevel(2); });
        _this._parser.setEscHandler('o', function () { return _this.setgLevel(3); });
        _this._parser.setEscHandler('|', function () { return _this.setgLevel(3); });
        _this._parser.setEscHandler('}', function () { return _this.setgLevel(2); });
        _this._parser.setEscHandler('~', function () { return _this.setgLevel(1); });
        _this._parser.setEscHandler('%@', function () { return _this.selectDefaultCharset(); });
        _this._parser.setEscHandler('%G', function () { return _this.selectDefaultCharset(); });
        var _loop_1 = function (flag) {
            this_1._parser.setEscHandler('(' + flag, function () { return _this.selectCharset('(' + flag); });
            this_1._parser.setEscHandler(')' + flag, function () { return _this.selectCharset(')' + flag); });
            this_1._parser.setEscHandler('*' + flag, function () { return _this.selectCharset('*' + flag); });
            this_1._parser.setEscHandler('+' + flag, function () { return _this.selectCharset('+' + flag); });
            this_1._parser.setEscHandler('-' + flag, function () { return _this.selectCharset('-' + flag); });
            this_1._parser.setEscHandler('.' + flag, function () { return _this.selectCharset('.' + flag); });
            this_1._parser.setEscHandler('/' + flag, function () { return _this.selectCharset('/' + flag); });
        };
        var this_1 = this;
        for (var flag in Charsets_1.CHARSETS) {
            _loop_1(flag);
        }
        _this._parser.setErrorHandler(function (state) {
            _this._terminal.error('Parsing error: ', state);
            return state;
        });
        _this._parser.setDcsHandler('$q', new DECRQSS(_this._terminal));
        return _this;
    }
    Object.defineProperty(InputHandler.prototype, "onCursorMove", {
        get: function () { return this._onCursorMove.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(InputHandler.prototype, "onData", {
        get: function () { return this._onData.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(InputHandler.prototype, "onLineFeed", {
        get: function () { return this._onLineFeed.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(InputHandler.prototype, "onScroll", {
        get: function () { return this._onScroll.event; },
        enumerable: true,
        configurable: true
    });
    InputHandler.prototype.dispose = function () {
        _super.prototype.dispose.call(this);
        this._terminal = null;
    };
    InputHandler.prototype.parse = function (data) {
        if (!this._terminal) {
            return;
        }
        var buffer = this._terminal.buffer;
        var cursorStartX = buffer.x;
        var cursorStartY = buffer.y;
        if (this._terminal.debug) {
            this._terminal.log('data: ' + data);
        }
        if (this._parseBuffer.length < data.length) {
            this._parseBuffer = new Uint32Array(data.length);
        }
        this._parser.parse(this._parseBuffer, this._stringDecoder.decode(data, this._parseBuffer));
        buffer = this._terminal.buffer;
        if (buffer.x !== cursorStartX || buffer.y !== cursorStartY) {
            this._onCursorMove.fire();
        }
    };
    InputHandler.prototype.print = function (data, start, end) {
        var code;
        var chWidth;
        var buffer = this._terminal.buffer;
        var charset = this._terminal.charset;
        var screenReaderMode = this._terminal.options.screenReaderMode;
        var cols = this._terminal.cols;
        var wraparoundMode = this._terminal.wraparoundMode;
        var insertMode = this._terminal.insertMode;
        var curAttr = this._terminal.curAttrData;
        var bufferRow = buffer.lines.get(buffer.y + buffer.ybase);
        this._terminal.updateRange(buffer.y);
        for (var pos = start; pos < end; ++pos) {
            code = data[pos];
            chWidth = CharWidth_1.wcwidth(code);
            if (code < 127 && charset) {
                var ch = charset[String.fromCharCode(code)];
                if (ch) {
                    code = ch.charCodeAt(0);
                }
            }
            if (screenReaderMode) {
                this._terminal.emit('a11y.char', TextDecoder_1.stringFromCodePoint(code));
            }
            if (!chWidth && buffer.x) {
                if (!bufferRow.getWidth(buffer.x - 1)) {
                    bufferRow.addCodepointToCell(buffer.x - 2, code);
                }
                else {
                    bufferRow.addCodepointToCell(buffer.x - 1, code);
                }
                continue;
            }
            if (buffer.x + chWidth - 1 >= cols) {
                if (wraparoundMode) {
                    buffer.x = 0;
                    buffer.y++;
                    if (buffer.y > buffer.scrollBottom) {
                        buffer.y--;
                        this._terminal.scroll(true);
                    }
                    else {
                        buffer.lines.get(buffer.y).isWrapped = true;
                    }
                    bufferRow = buffer.lines.get(buffer.y + buffer.ybase);
                }
                else {
                    if (chWidth === 2) {
                        continue;
                    }
                }
            }
            if (insertMode) {
                bufferRow.insertCells(buffer.x, chWidth, buffer.getNullCell(curAttr));
                if (bufferRow.getWidth(cols - 1) === 2) {
                    bufferRow.setCellFromCodePoint(cols - 1, BufferLine_1.NULL_CELL_CODE, BufferLine_1.NULL_CELL_WIDTH, curAttr.fg, curAttr.bg);
                }
            }
            bufferRow.setCellFromCodePoint(buffer.x++, code, chWidth, curAttr.fg, curAttr.bg);
            if (chWidth > 0) {
                while (--chWidth) {
                    bufferRow.setCellFromCodePoint(buffer.x++, 0, 0, curAttr.fg, curAttr.bg);
                }
            }
        }
        this._terminal.updateRange(buffer.y);
    };
    InputHandler.prototype.addCsiHandler = function (flag, callback) {
        return this._parser.addCsiHandler(flag, callback);
    };
    InputHandler.prototype.addOscHandler = function (ident, callback) {
        return this._parser.addOscHandler(ident, callback);
    };
    InputHandler.prototype.bell = function () {
        this._terminal.bell();
    };
    InputHandler.prototype.lineFeed = function () {
        var buffer = this._terminal.buffer;
        if (this._terminal.options.convertEol) {
            buffer.x = 0;
        }
        buffer.y++;
        if (buffer.y > buffer.scrollBottom) {
            buffer.y--;
            this._terminal.scroll();
        }
        if (buffer.x >= this._terminal.cols) {
            buffer.x--;
        }
        this._onLineFeed.fire();
    };
    InputHandler.prototype.carriageReturn = function () {
        this._terminal.buffer.x = 0;
    };
    InputHandler.prototype.backspace = function () {
        if (this._terminal.buffer.x > 0) {
            this._terminal.buffer.x--;
        }
    };
    InputHandler.prototype.tab = function () {
        var originalX = this._terminal.buffer.x;
        this._terminal.buffer.x = this._terminal.buffer.nextStop();
        if (this._terminal.options.screenReaderMode) {
            this._terminal.emit('a11y.tab', this._terminal.buffer.x - originalX);
        }
    };
    InputHandler.prototype.shiftOut = function () {
        this._terminal.setgLevel(1);
    };
    InputHandler.prototype.shiftIn = function () {
        this._terminal.setgLevel(0);
    };
    InputHandler.prototype.insertChars = function (params) {
        this._terminal.buffer.lines.get(this._terminal.buffer.y + this._terminal.buffer.ybase).insertCells(this._terminal.buffer.x, params[0] || 1, this._terminal.buffer.getNullCell(this._terminal.eraseAttrData()));
        this._terminal.updateRange(this._terminal.buffer.y);
    };
    InputHandler.prototype.cursorUp = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        this._terminal.buffer.y -= param;
        if (this._terminal.buffer.y < 0) {
            this._terminal.buffer.y = 0;
        }
    };
    InputHandler.prototype.cursorDown = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        this._terminal.buffer.y += param;
        if (this._terminal.buffer.y >= this._terminal.rows) {
            this._terminal.buffer.y = this._terminal.rows - 1;
        }
        if (this._terminal.buffer.x >= this._terminal.cols) {
            this._terminal.buffer.x--;
        }
    };
    InputHandler.prototype.cursorForward = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        this._terminal.buffer.x += param;
        if (this._terminal.buffer.x >= this._terminal.cols) {
            this._terminal.buffer.x = this._terminal.cols - 1;
        }
    };
    InputHandler.prototype.cursorBackward = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        if (this._terminal.buffer.x >= this._terminal.cols) {
            this._terminal.buffer.x--;
        }
        this._terminal.buffer.x -= param;
        if (this._terminal.buffer.x < 0) {
            this._terminal.buffer.x = 0;
        }
    };
    InputHandler.prototype.cursorNextLine = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        this._terminal.buffer.y += param;
        if (this._terminal.buffer.y >= this._terminal.rows) {
            this._terminal.buffer.y = this._terminal.rows - 1;
        }
        this._terminal.buffer.x = 0;
    };
    InputHandler.prototype.cursorPrecedingLine = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        this._terminal.buffer.y -= param;
        if (this._terminal.buffer.y < 0) {
            this._terminal.buffer.y = 0;
        }
        this._terminal.buffer.x = 0;
    };
    InputHandler.prototype.cursorCharAbsolute = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        this._terminal.buffer.x = param - 1;
    };
    InputHandler.prototype.cursorPosition = function (params) {
        var col;
        var row = params[0] - 1;
        if (params.length >= 2) {
            col = params[1] - 1;
        }
        else {
            col = 0;
        }
        if (row < 0) {
            row = 0;
        }
        else if (row >= this._terminal.rows) {
            row = this._terminal.rows - 1;
        }
        if (col < 0) {
            col = 0;
        }
        else if (col >= this._terminal.cols) {
            col = this._terminal.cols - 1;
        }
        this._terminal.buffer.x = col;
        this._terminal.buffer.y = row;
    };
    InputHandler.prototype.cursorForwardTab = function (params) {
        var param = params[0] || 1;
        while (param--) {
            this._terminal.buffer.x = this._terminal.buffer.nextStop();
        }
    };
    InputHandler.prototype._eraseInBufferLine = function (y, start, end, clearWrap) {
        if (clearWrap === void 0) { clearWrap = false; }
        var line = this._terminal.buffer.lines.get(this._terminal.buffer.ybase + y);
        line.replaceCells(start, end, this._terminal.buffer.getNullCell(this._terminal.eraseAttrData()));
        if (clearWrap) {
            line.isWrapped = false;
        }
    };
    InputHandler.prototype._resetBufferLine = function (y) {
        this._eraseInBufferLine(y, 0, this._terminal.cols, true);
    };
    InputHandler.prototype.eraseInDisplay = function (params) {
        var j;
        switch (params[0]) {
            case 0:
                j = this._terminal.buffer.y;
                this._terminal.updateRange(j);
                this._eraseInBufferLine(j++, this._terminal.buffer.x, this._terminal.cols, this._terminal.buffer.x === 0);
                for (; j < this._terminal.rows; j++) {
                    this._resetBufferLine(j);
                }
                this._terminal.updateRange(j);
                break;
            case 1:
                j = this._terminal.buffer.y;
                this._terminal.updateRange(j);
                this._eraseInBufferLine(j, 0, this._terminal.buffer.x + 1, true);
                if (this._terminal.buffer.x + 1 >= this._terminal.cols) {
                    this._terminal.buffer.lines.get(j + 1).isWrapped = false;
                }
                while (j--) {
                    this._resetBufferLine(j);
                }
                this._terminal.updateRange(0);
                break;
            case 2:
                j = this._terminal.rows;
                this._terminal.updateRange(j - 1);
                while (j--) {
                    this._resetBufferLine(j);
                }
                this._terminal.updateRange(0);
                break;
            case 3:
                var scrollBackSize = this._terminal.buffer.lines.length - this._terminal.rows;
                if (scrollBackSize > 0) {
                    this._terminal.buffer.lines.trimStart(scrollBackSize);
                    this._terminal.buffer.ybase = Math.max(this._terminal.buffer.ybase - scrollBackSize, 0);
                    this._terminal.buffer.ydisp = Math.max(this._terminal.buffer.ydisp - scrollBackSize, 0);
                    this._onScroll.fire(0);
                }
                break;
        }
    };
    InputHandler.prototype.eraseInLine = function (params) {
        switch (params[0]) {
            case 0:
                this._eraseInBufferLine(this._terminal.buffer.y, this._terminal.buffer.x, this._terminal.cols);
                break;
            case 1:
                this._eraseInBufferLine(this._terminal.buffer.y, 0, this._terminal.buffer.x + 1);
                break;
            case 2:
                this._eraseInBufferLine(this._terminal.buffer.y, 0, this._terminal.cols);
                break;
        }
        this._terminal.updateRange(this._terminal.buffer.y);
    };
    InputHandler.prototype.insertLines = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        var buffer = this._terminal.buffer;
        var row = buffer.y + buffer.ybase;
        var scrollBottomRowsOffset = this._terminal.rows - 1 - buffer.scrollBottom;
        var scrollBottomAbsolute = this._terminal.rows - 1 + buffer.ybase - scrollBottomRowsOffset + 1;
        while (param--) {
            buffer.lines.splice(scrollBottomAbsolute - 1, 1);
            buffer.lines.splice(row, 0, buffer.getBlankLine(this._terminal.eraseAttrData()));
        }
        this._terminal.updateRange(buffer.y);
        this._terminal.updateRange(buffer.scrollBottom);
    };
    InputHandler.prototype.deleteLines = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        var buffer = this._terminal.buffer;
        var row = buffer.y + buffer.ybase;
        var j;
        j = this._terminal.rows - 1 - buffer.scrollBottom;
        j = this._terminal.rows - 1 + buffer.ybase - j;
        while (param--) {
            buffer.lines.splice(row, 1);
            buffer.lines.splice(j, 0, buffer.getBlankLine(this._terminal.eraseAttrData()));
        }
        this._terminal.updateRange(buffer.y);
        this._terminal.updateRange(buffer.scrollBottom);
    };
    InputHandler.prototype.deleteChars = function (params) {
        this._terminal.buffer.lines.get(this._terminal.buffer.y + this._terminal.buffer.ybase).deleteCells(this._terminal.buffer.x, params[0] || 1, this._terminal.buffer.getNullCell(this._terminal.eraseAttrData()));
        this._terminal.updateRange(this._terminal.buffer.y);
    };
    InputHandler.prototype.scrollUp = function (params) {
        var param = params[0] || 1;
        var buffer = this._terminal.buffer;
        while (param--) {
            buffer.lines.splice(buffer.ybase + buffer.scrollTop, 1);
            buffer.lines.splice(buffer.ybase + buffer.scrollBottom, 0, buffer.getBlankLine(BufferLine_1.DEFAULT_ATTR_DATA));
        }
        this._terminal.updateRange(buffer.scrollTop);
        this._terminal.updateRange(buffer.scrollBottom);
    };
    InputHandler.prototype.scrollDown = function (params, collect) {
        if (params.length < 2 && !collect) {
            var param = params[0] || 1;
            var buffer = this._terminal.buffer;
            while (param--) {
                buffer.lines.splice(buffer.ybase + buffer.scrollBottom, 1);
                buffer.lines.splice(buffer.ybase + buffer.scrollTop, 0, buffer.getBlankLine(BufferLine_1.DEFAULT_ATTR_DATA));
            }
            this._terminal.updateRange(buffer.scrollTop);
            this._terminal.updateRange(buffer.scrollBottom);
        }
    };
    InputHandler.prototype.eraseChars = function (params) {
        this._terminal.buffer.lines.get(this._terminal.buffer.y + this._terminal.buffer.ybase).replaceCells(this._terminal.buffer.x, this._terminal.buffer.x + (params[0] || 1), this._terminal.buffer.getNullCell(this._terminal.eraseAttrData()));
    };
    InputHandler.prototype.cursorBackwardTab = function (params) {
        var param = params[0] || 1;
        var buffer = this._terminal.buffer;
        while (param--) {
            buffer.x = buffer.prevStop();
        }
    };
    InputHandler.prototype.charPosAbsolute = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        this._terminal.buffer.x = param - 1;
        if (this._terminal.buffer.x >= this._terminal.cols) {
            this._terminal.buffer.x = this._terminal.cols - 1;
        }
    };
    InputHandler.prototype.hPositionRelative = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        this._terminal.buffer.x += param;
        if (this._terminal.buffer.x >= this._terminal.cols) {
            this._terminal.buffer.x = this._terminal.cols - 1;
        }
    };
    InputHandler.prototype.repeatPrecedingCharacter = function (params) {
        var buffer = this._terminal.buffer;
        var line = buffer.lines.get(buffer.ybase + buffer.y);
        line.loadCell(buffer.x - 1, this._workCell);
        line.replaceCells(buffer.x, buffer.x + (params[0] || 1), (this._workCell.content !== undefined) ? this._workCell : buffer.getNullCell(BufferLine_1.DEFAULT_ATTR_DATA));
    };
    InputHandler.prototype.sendDeviceAttributes = function (params, collect) {
        if (params[0] > 0) {
            return;
        }
        if (!collect) {
            if (this._terminal.is('xterm') || this._terminal.is('rxvt-unicode') || this._terminal.is('screen')) {
                this._terminal.handler(EscapeSequences_1.C0.ESC + '[?1;2c');
            }
            else if (this._terminal.is('linux')) {
                this._terminal.handler(EscapeSequences_1.C0.ESC + '[?6c');
            }
        }
        else if (collect === '>') {
            if (this._terminal.is('xterm')) {
                this._terminal.handler(EscapeSequences_1.C0.ESC + '[>0;276;0c');
            }
            else if (this._terminal.is('rxvt-unicode')) {
                this._terminal.handler(EscapeSequences_1.C0.ESC + '[>85;95;0c');
            }
            else if (this._terminal.is('linux')) {
                this._terminal.handler(params[0] + 'c');
            }
            else if (this._terminal.is('screen')) {
                this._terminal.handler(EscapeSequences_1.C0.ESC + '[>83;40003;0c');
            }
        }
    };
    InputHandler.prototype.linePosAbsolute = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        this._terminal.buffer.y = param - 1;
        if (this._terminal.buffer.y >= this._terminal.rows) {
            this._terminal.buffer.y = this._terminal.rows - 1;
        }
    };
    InputHandler.prototype.vPositionRelative = function (params) {
        var param = params[0];
        if (param < 1) {
            param = 1;
        }
        this._terminal.buffer.y += param;
        if (this._terminal.buffer.y >= this._terminal.rows) {
            this._terminal.buffer.y = this._terminal.rows - 1;
        }
        if (this._terminal.buffer.x >= this._terminal.cols) {
            this._terminal.buffer.x--;
        }
    };
    InputHandler.prototype.hVPosition = function (params) {
        if (params[0] < 1)
            params[0] = 1;
        if (params[1] < 1)
            params[1] = 1;
        this._terminal.buffer.y = params[0] - 1;
        if (this._terminal.buffer.y >= this._terminal.rows) {
            this._terminal.buffer.y = this._terminal.rows - 1;
        }
        this._terminal.buffer.x = params[1] - 1;
        if (this._terminal.buffer.x >= this._terminal.cols) {
            this._terminal.buffer.x = this._terminal.cols - 1;
        }
    };
    InputHandler.prototype.tabClear = function (params) {
        var param = params[0];
        if (param <= 0) {
            delete this._terminal.buffer.tabs[this._terminal.buffer.x];
        }
        else if (param === 3) {
            this._terminal.buffer.tabs = {};
        }
    };
    InputHandler.prototype.setMode = function (params, collect) {
        if (params.length > 1) {
            for (var i = 0; i < params.length; i++) {
                this.setMode([params[i]]);
            }
            return;
        }
        if (!collect) {
            switch (params[0]) {
                case 4:
                    this._terminal.insertMode = true;
                    break;
                case 20:
                    break;
            }
        }
        else if (collect === '?') {
            switch (params[0]) {
                case 1:
                    this._terminal.applicationCursor = true;
                    break;
                case 2:
                    this._terminal.setgCharset(0, Charsets_1.DEFAULT_CHARSET);
                    this._terminal.setgCharset(1, Charsets_1.DEFAULT_CHARSET);
                    this._terminal.setgCharset(2, Charsets_1.DEFAULT_CHARSET);
                    this._terminal.setgCharset(3, Charsets_1.DEFAULT_CHARSET);
                    break;
                case 3:
                    this._terminal.savedCols = this._terminal.cols;
                    this._terminal.resize(132, this._terminal.rows);
                    break;
                case 6:
                    this._terminal.originMode = true;
                    break;
                case 7:
                    this._terminal.wraparoundMode = true;
                    break;
                case 12:
                    break;
                case 66:
                    this._terminal.log('Serial port requested application keypad.');
                    this._terminal.applicationKeypad = true;
                    if (this._terminal.viewport) {
                        this._terminal.viewport.syncScrollArea();
                    }
                    break;
                case 9:
                case 1000:
                case 1002:
                case 1003:
                    this._terminal.x10Mouse = params[0] === 9;
                    this._terminal.vt200Mouse = params[0] === 1000;
                    this._terminal.normalMouse = params[0] > 1000;
                    this._terminal.mouseEvents = true;
                    if (this._terminal.element) {
                        this._terminal.element.classList.add('enable-mouse-events');
                    }
                    if (this._terminal.selectionManager) {
                        this._terminal.selectionManager.disable();
                    }
                    this._terminal.log('Binding to mouse events.');
                    break;
                case 1004:
                    this._terminal.sendFocus = true;
                    break;
                case 1005:
                    this._terminal.utfMouse = true;
                    break;
                case 1006:
                    this._terminal.sgrMouse = true;
                    break;
                case 1015:
                    this._terminal.urxvtMouse = true;
                    break;
                case 25:
                    this._terminal.cursorHidden = false;
                    break;
                case 1048:
                    this.saveCursor(params);
                    break;
                case 1049:
                    this.saveCursor(params);
                case 47:
                case 1047:
                    this._terminal.buffers.activateAltBuffer(this._terminal.eraseAttrData());
                    this._terminal.refresh(0, this._terminal.rows - 1);
                    if (this._terminal.viewport) {
                        this._terminal.viewport.syncScrollArea();
                    }
                    this._terminal.showCursor();
                    break;
                case 2004:
                    this._terminal.bracketedPasteMode = true;
                    break;
            }
        }
    };
    InputHandler.prototype.resetMode = function (params, collect) {
        if (params.length > 1) {
            for (var i = 0; i < params.length; i++) {
                this.resetMode([params[i]]);
            }
            return;
        }
        if (!collect) {
            switch (params[0]) {
                case 4:
                    this._terminal.insertMode = false;
                    break;
                case 20:
                    break;
            }
        }
        else if (collect === '?') {
            switch (params[0]) {
                case 1:
                    this._terminal.applicationCursor = false;
                    break;
                case 3:
                    if (this._terminal.cols === 132 && this._terminal.savedCols) {
                        this._terminal.resize(this._terminal.savedCols, this._terminal.rows);
                    }
                    delete this._terminal.savedCols;
                    break;
                case 6:
                    this._terminal.originMode = false;
                    break;
                case 7:
                    this._terminal.wraparoundMode = false;
                    break;
                case 12:
                    break;
                case 66:
                    this._terminal.log('Switching back to normal keypad.');
                    this._terminal.applicationKeypad = false;
                    if (this._terminal.viewport) {
                        this._terminal.viewport.syncScrollArea();
                    }
                    break;
                case 9:
                case 1000:
                case 1002:
                case 1003:
                    this._terminal.x10Mouse = false;
                    this._terminal.vt200Mouse = false;
                    this._terminal.normalMouse = false;
                    this._terminal.mouseEvents = false;
                    if (this._terminal.element) {
                        this._terminal.element.classList.remove('enable-mouse-events');
                    }
                    if (this._terminal.selectionManager) {
                        this._terminal.selectionManager.enable();
                    }
                    break;
                case 1004:
                    this._terminal.sendFocus = false;
                    break;
                case 1005:
                    this._terminal.utfMouse = false;
                    break;
                case 1006:
                    this._terminal.sgrMouse = false;
                    break;
                case 1015:
                    this._terminal.urxvtMouse = false;
                    break;
                case 25:
                    this._terminal.cursorHidden = true;
                    break;
                case 1048:
                    this.restoreCursor(params);
                    break;
                case 1049:
                case 47:
                case 1047:
                    this._terminal.buffers.activateNormalBuffer();
                    if (params[0] === 1049) {
                        this.restoreCursor(params);
                    }
                    this._terminal.refresh(0, this._terminal.rows - 1);
                    if (this._terminal.viewport) {
                        this._terminal.viewport.syncScrollArea();
                    }
                    this._terminal.showCursor();
                    break;
                case 2004:
                    this._terminal.bracketedPasteMode = false;
                    break;
            }
        }
    };
    InputHandler.prototype.charAttributes = function (params) {
        if (params.length === 1 && params[0] === 0) {
            this._terminal.curAttrData.fg = BufferLine_1.DEFAULT_ATTR_DATA.fg;
            this._terminal.curAttrData.bg = BufferLine_1.DEFAULT_ATTR_DATA.bg;
            return;
        }
        var l = params.length;
        var p;
        var attr = this._terminal.curAttrData;
        for (var i = 0; i < l; i++) {
            p = params[i];
            if (p >= 30 && p <= 37) {
                attr.fg &= ~(50331648 | 255);
                attr.fg |= 16777216 | (p - 30);
            }
            else if (p >= 40 && p <= 47) {
                attr.bg &= ~(50331648 | 255);
                attr.bg |= 16777216 | (p - 40);
            }
            else if (p >= 90 && p <= 97) {
                attr.fg &= ~(50331648 | 255);
                attr.fg |= 16777216 | (p - 90) | 8;
            }
            else if (p >= 100 && p <= 107) {
                attr.bg &= ~(50331648 | 255);
                attr.bg |= 16777216 | (p - 100) | 8;
            }
            else if (p === 0) {
                attr.fg = BufferLine_1.DEFAULT_ATTR_DATA.fg;
                attr.bg = BufferLine_1.DEFAULT_ATTR_DATA.bg;
            }
            else if (p === 1) {
                attr.fg |= 134217728;
            }
            else if (p === 3) {
                attr.bg |= 67108864;
            }
            else if (p === 4) {
                attr.fg |= 268435456;
            }
            else if (p === 5) {
                attr.fg |= 536870912;
            }
            else if (p === 7) {
                attr.fg |= 67108864;
            }
            else if (p === 8) {
                attr.fg |= 1073741824;
            }
            else if (p === 2) {
                attr.bg |= 134217728;
            }
            else if (p === 22) {
                attr.fg &= ~134217728;
                attr.bg &= ~134217728;
            }
            else if (p === 23) {
                attr.bg &= ~67108864;
            }
            else if (p === 24) {
                attr.fg &= ~268435456;
            }
            else if (p === 25) {
                attr.fg &= ~536870912;
            }
            else if (p === 27) {
                attr.fg &= ~67108864;
            }
            else if (p === 28) {
                attr.fg &= ~1073741824;
            }
            else if (p === 39) {
                attr.fg &= ~(50331648 | 16777215);
                attr.fg |= BufferLine_1.DEFAULT_ATTR_DATA.fg & (255 | 16777215);
            }
            else if (p === 49) {
                attr.bg &= ~(50331648 | 16777215);
                attr.bg |= BufferLine_1.DEFAULT_ATTR_DATA.bg & (255 | 16777215);
            }
            else if (p === 38) {
                if (params[i + 1] === 2) {
                    i += 2;
                    attr.fg |= 50331648;
                    attr.fg &= ~16777215;
                    attr.fg |= BufferLine_1.AttributeData.fromColorRGB([params[i], params[i + 1], params[i + 2]]);
                    i += 2;
                }
                else if (params[i + 1] === 5) {
                    i += 2;
                    p = params[i] & 0xff;
                    attr.fg &= ~255;
                    attr.fg |= 33554432 | p;
                }
            }
            else if (p === 48) {
                if (params[i + 1] === 2) {
                    i += 2;
                    attr.bg |= 50331648;
                    attr.bg &= ~16777215;
                    attr.bg |= BufferLine_1.AttributeData.fromColorRGB([params[i], params[i + 1], params[i + 2]]);
                    i += 2;
                }
                else if (params[i + 1] === 5) {
                    i += 2;
                    p = params[i] & 0xff;
                    attr.bg &= ~255;
                    attr.bg |= 33554432 | p;
                }
            }
            else if (p === 100) {
                attr.fg &= ~(50331648 | 16777215);
                attr.fg |= BufferLine_1.DEFAULT_ATTR_DATA.fg & (255 | 16777215);
                attr.bg &= ~(50331648 | 16777215);
                attr.bg |= BufferLine_1.DEFAULT_ATTR_DATA.bg & (255 | 16777215);
            }
            else {
                this._terminal.error('Unknown SGR attribute: %d.', p);
            }
        }
    };
    InputHandler.prototype.deviceStatus = function (params, collect) {
        if (!collect) {
            switch (params[0]) {
                case 5:
                    this._onData.fire(EscapeSequences_1.C0.ESC + "[0n");
                    break;
                case 6:
                    var y = this._terminal.buffer.y + 1;
                    var x = this._terminal.buffer.x + 1;
                    this._onData.fire(EscapeSequences_1.C0.ESC + "[" + y + ";" + x + "R");
                    break;
            }
        }
        else if (collect === '?') {
            switch (params[0]) {
                case 6:
                    var y = this._terminal.buffer.y + 1;
                    var x = this._terminal.buffer.x + 1;
                    this._onData.fire(EscapeSequences_1.C0.ESC + "[?" + y + ";" + x + "R");
                    break;
                case 15:
                    break;
                case 25:
                    break;
                case 26:
                    break;
                case 53:
                    break;
            }
        }
    };
    InputHandler.prototype.softReset = function (params, collect) {
        if (collect === '!') {
            this._terminal.cursorHidden = false;
            this._terminal.insertMode = false;
            this._terminal.originMode = false;
            this._terminal.wraparoundMode = true;
            this._terminal.applicationKeypad = false;
            if (this._terminal.viewport) {
                this._terminal.viewport.syncScrollArea();
            }
            this._terminal.applicationCursor = false;
            this._terminal.buffer.scrollTop = 0;
            this._terminal.buffer.scrollBottom = this._terminal.rows - 1;
            this._terminal.curAttrData = BufferLine_1.DEFAULT_ATTR_DATA;
            this._terminal.buffer.x = this._terminal.buffer.y = 0;
            this._terminal.charset = null;
            this._terminal.glevel = 0;
            this._terminal.charsets = [null];
        }
    };
    InputHandler.prototype.setCursorStyle = function (params, collect) {
        if (collect === ' ') {
            var param = params[0] < 1 ? 1 : params[0];
            switch (param) {
                case 1:
                case 2:
                    this._terminal.setOption('cursorStyle', 'block');
                    break;
                case 3:
                case 4:
                    this._terminal.setOption('cursorStyle', 'underline');
                    break;
                case 5:
                case 6:
                    this._terminal.setOption('cursorStyle', 'bar');
                    break;
            }
            var isBlinking = param % 2 === 1;
            this._terminal.setOption('cursorBlink', isBlinking);
        }
    };
    InputHandler.prototype.setScrollRegion = function (params, collect) {
        if (collect) {
            return;
        }
        this._terminal.buffer.scrollTop = (params[0] || 1) - 1;
        this._terminal.buffer.scrollBottom = (params[1] && params[1] <= this._terminal.rows ? params[1] : this._terminal.rows) - 1;
        this._terminal.buffer.x = 0;
        this._terminal.buffer.y = 0;
    };
    InputHandler.prototype.saveCursor = function (params) {
        this._terminal.buffer.savedX = this._terminal.buffer.x;
        this._terminal.buffer.savedY = this._terminal.buffer.y;
        this._terminal.buffer.savedCurAttrData.fg = this._terminal.curAttrData.fg;
        this._terminal.buffer.savedCurAttrData.bg = this._terminal.curAttrData.bg;
    };
    InputHandler.prototype.restoreCursor = function (params) {
        this._terminal.buffer.x = this._terminal.buffer.savedX || 0;
        this._terminal.buffer.y = this._terminal.buffer.savedY || 0;
        this._terminal.curAttrData.fg = this._terminal.buffer.savedCurAttrData.fg;
        this._terminal.curAttrData.bg = this._terminal.buffer.savedCurAttrData.bg;
    };
    InputHandler.prototype.setTitle = function (data) {
        this._terminal.handleTitle(data);
    };
    InputHandler.prototype.nextLine = function () {
        this._terminal.buffer.x = 0;
        this.index();
    };
    InputHandler.prototype.keypadApplicationMode = function () {
        this._terminal.log('Serial port requested application keypad.');
        this._terminal.applicationKeypad = true;
        if (this._terminal.viewport) {
            this._terminal.viewport.syncScrollArea();
        }
    };
    InputHandler.prototype.keypadNumericMode = function () {
        this._terminal.log('Switching back to normal keypad.');
        this._terminal.applicationKeypad = false;
        if (this._terminal.viewport) {
            this._terminal.viewport.syncScrollArea();
        }
    };
    InputHandler.prototype.selectDefaultCharset = function () {
        this._terminal.setgLevel(0);
        this._terminal.setgCharset(0, Charsets_1.DEFAULT_CHARSET);
    };
    InputHandler.prototype.selectCharset = function (collectAndFlag) {
        if (collectAndFlag.length !== 2) {
            this.selectDefaultCharset();
            return;
        }
        if (collectAndFlag[0] === '/') {
            return;
        }
        this._terminal.setgCharset(GLEVEL[collectAndFlag[0]], Charsets_1.CHARSETS[collectAndFlag[1]] || Charsets_1.DEFAULT_CHARSET);
        return;
    };
    InputHandler.prototype.index = function () {
        this._terminal.index();
    };
    InputHandler.prototype.tabSet = function () {
        this._terminal.tabSet();
    };
    InputHandler.prototype.reverseIndex = function () {
        this._terminal.reverseIndex();
    };
    InputHandler.prototype.reset = function () {
        this._parser.reset();
        this._terminal.reset();
    };
    InputHandler.prototype.setgLevel = function (level) {
        this._terminal.setgLevel(level);
    };
    return InputHandler;
}(Lifecycle_1.Disposable));
exports.InputHandler = InputHandler;
//# sourceMappingURL=InputHandler.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/Linkifier.js":
/*!*********************************************!*\
  !*** ./node_modules/xterm/lib/Linkifier.js ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var MouseZoneManager_1 = __webpack_require__(/*! ./MouseZoneManager */ "./node_modules/xterm/lib/MouseZoneManager.js");
var CharWidth_1 = __webpack_require__(/*! ./CharWidth */ "./node_modules/xterm/lib/CharWidth.js");
var EventEmitter2_1 = __webpack_require__(/*! ./common/EventEmitter2 */ "./node_modules/xterm/lib/common/EventEmitter2.js");
var Linkifier = (function () {
    function Linkifier(_terminal) {
        this._terminal = _terminal;
        this._linkMatchers = [];
        this._nextLinkMatcherId = 0;
        this._onLinkHover = new EventEmitter2_1.EventEmitter2();
        this._onLinkLeave = new EventEmitter2_1.EventEmitter2();
        this._onLinkTooltip = new EventEmitter2_1.EventEmitter2();
        this._rowsToLinkify = {
            start: null,
            end: null
        };
    }
    Object.defineProperty(Linkifier.prototype, "onLinkHover", {
        get: function () { return this._onLinkHover.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Linkifier.prototype, "onLinkLeave", {
        get: function () { return this._onLinkLeave.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Linkifier.prototype, "onLinkTooltip", {
        get: function () { return this._onLinkTooltip.event; },
        enumerable: true,
        configurable: true
    });
    Linkifier.prototype.attachToDom = function (mouseZoneManager) {
        this._mouseZoneManager = mouseZoneManager;
    };
    Linkifier.prototype.linkifyRows = function (start, end) {
        var _this = this;
        if (!this._mouseZoneManager) {
            return;
        }
        if (this._rowsToLinkify.start === null) {
            this._rowsToLinkify.start = start;
            this._rowsToLinkify.end = end;
        }
        else {
            this._rowsToLinkify.start = Math.min(this._rowsToLinkify.start, start);
            this._rowsToLinkify.end = Math.max(this._rowsToLinkify.end, end);
        }
        this._mouseZoneManager.clearAll(start, end);
        if (this._rowsTimeoutId) {
            clearTimeout(this._rowsTimeoutId);
        }
        this._rowsTimeoutId = setTimeout(function () { return _this._linkifyRows(); }, Linkifier.TIME_BEFORE_LINKIFY);
    };
    Linkifier.prototype._linkifyRows = function () {
        this._rowsTimeoutId = null;
        var buffer = this._terminal.buffer;
        var absoluteRowIndexStart = buffer.ydisp + this._rowsToLinkify.start;
        if (absoluteRowIndexStart >= buffer.lines.length) {
            return;
        }
        var absoluteRowIndexEnd = buffer.ydisp + Math.min(this._rowsToLinkify.end, this._terminal.rows) + 1;
        var overscanLineLimit = Math.ceil(Linkifier.OVERSCAN_CHAR_LIMIT / this._terminal.cols);
        var iterator = this._terminal.buffer.iterator(false, absoluteRowIndexStart, absoluteRowIndexEnd, overscanLineLimit, overscanLineLimit);
        while (iterator.hasNext()) {
            var lineData = iterator.next();
            for (var i = 0; i < this._linkMatchers.length; i++) {
                this._doLinkifyRow(lineData.range.first, lineData.content, this._linkMatchers[i]);
            }
        }
        this._rowsToLinkify.start = null;
        this._rowsToLinkify.end = null;
    };
    Linkifier.prototype.registerLinkMatcher = function (regex, handler, options) {
        if (options === void 0) { options = {}; }
        if (!handler) {
            throw new Error('handler must be defined');
        }
        var matcher = {
            id: this._nextLinkMatcherId++,
            regex: regex,
            handler: handler,
            matchIndex: options.matchIndex,
            validationCallback: options.validationCallback,
            hoverTooltipCallback: options.tooltipCallback,
            hoverLeaveCallback: options.leaveCallback,
            willLinkActivate: options.willLinkActivate,
            priority: options.priority || 0
        };
        this._addLinkMatcherToList(matcher);
        return matcher.id;
    };
    Linkifier.prototype._addLinkMatcherToList = function (matcher) {
        if (this._linkMatchers.length === 0) {
            this._linkMatchers.push(matcher);
            return;
        }
        for (var i = this._linkMatchers.length - 1; i >= 0; i--) {
            if (matcher.priority <= this._linkMatchers[i].priority) {
                this._linkMatchers.splice(i + 1, 0, matcher);
                return;
            }
        }
        this._linkMatchers.splice(0, 0, matcher);
    };
    Linkifier.prototype.deregisterLinkMatcher = function (matcherId) {
        for (var i = 0; i < this._linkMatchers.length; i++) {
            if (this._linkMatchers[i].id === matcherId) {
                this._linkMatchers.splice(i, 1);
                return true;
            }
        }
        return false;
    };
    Linkifier.prototype._doLinkifyRow = function (rowIndex, text, matcher) {
        var _this = this;
        var rex = new RegExp(matcher.regex.source, matcher.regex.flags + 'g');
        var match;
        var stringIndex = -1;
        var _loop_1 = function () {
            var uri = match[typeof matcher.matchIndex !== 'number' ? 0 : matcher.matchIndex];
            if (!uri) {
                if (this_1._terminal.debug) {
                    console.log({ match: match, matcher: matcher });
                    throw new Error('match found without corresponding matchIndex');
                }
                return "break";
            }
            stringIndex = text.indexOf(uri, stringIndex + 1);
            rex.lastIndex = stringIndex + uri.length;
            if (stringIndex < 0) {
                return "break";
            }
            var bufferIndex = this_1._terminal.buffer.stringIndexToBufferIndex(rowIndex, stringIndex);
            if (bufferIndex[0] < 0) {
                return "break";
            }
            var line = this_1._terminal.buffer.lines.get(bufferIndex[0]);
            var attr = line.getFg(bufferIndex[1]);
            var fg;
            if (attr) {
                fg = (attr >> 9) & 0x1ff;
            }
            if (matcher.validationCallback) {
                matcher.validationCallback(uri, function (isValid) {
                    if (_this._rowsTimeoutId) {
                        return;
                    }
                    if (isValid) {
                        _this._addLink(bufferIndex[1], bufferIndex[0] - _this._terminal.buffer.ydisp, uri, matcher, fg);
                    }
                });
            }
            else {
                this_1._addLink(bufferIndex[1], bufferIndex[0] - this_1._terminal.buffer.ydisp, uri, matcher, fg);
            }
        };
        var this_1 = this;
        while ((match = rex.exec(text)) !== null) {
            var state_1 = _loop_1();
            if (state_1 === "break")
                break;
        }
    };
    Linkifier.prototype._addLink = function (x, y, uri, matcher, fg) {
        var _this = this;
        var width = CharWidth_1.getStringCellWidth(uri);
        var x1 = x % this._terminal.cols;
        var y1 = y + Math.floor(x / this._terminal.cols);
        var x2 = (x1 + width) % this._terminal.cols;
        var y2 = y1 + Math.floor((x1 + width) / this._terminal.cols);
        if (x2 === 0) {
            x2 = this._terminal.cols;
            y2--;
        }
        this._mouseZoneManager.add(new MouseZoneManager_1.MouseZone(x1 + 1, y1 + 1, x2 + 1, y2 + 1, function (e) {
            if (matcher.handler) {
                return matcher.handler(e, uri);
            }
            window.open(uri, '_blank');
        }, function () {
            _this._onLinkHover.fire(_this._createLinkHoverEvent(x1, y1, x2, y2, fg));
            _this._terminal.element.classList.add('xterm-cursor-pointer');
        }, function (e) {
            _this._onLinkTooltip.fire(_this._createLinkHoverEvent(x1, y1, x2, y2, fg));
            if (matcher.hoverTooltipCallback) {
                matcher.hoverTooltipCallback(e, uri);
            }
        }, function () {
            _this._onLinkLeave.fire(_this._createLinkHoverEvent(x1, y1, x2, y2, fg));
            _this._terminal.element.classList.remove('xterm-cursor-pointer');
            if (matcher.hoverLeaveCallback) {
                matcher.hoverLeaveCallback();
            }
        }, function (e) {
            if (matcher.willLinkActivate) {
                return matcher.willLinkActivate(e, uri);
            }
            return true;
        }));
    };
    Linkifier.prototype._createLinkHoverEvent = function (x1, y1, x2, y2, fg) {
        return { x1: x1, y1: y1, x2: x2, y2: y2, cols: this._terminal.cols, fg: fg };
    };
    Linkifier.TIME_BEFORE_LINKIFY = 200;
    Linkifier.OVERSCAN_CHAR_LIMIT = 2000;
    return Linkifier;
}());
exports.Linkifier = Linkifier;
//# sourceMappingURL=Linkifier.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/MouseHelper.js":
/*!***********************************************!*\
  !*** ./node_modules/xterm/lib/MouseHelper.js ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var MouseHelper = (function () {
    function MouseHelper(_renderer) {
        this._renderer = _renderer;
    }
    MouseHelper.prototype.setRenderer = function (renderer) {
        this._renderer = renderer;
    };
    MouseHelper.getCoordsRelativeToElement = function (event, element) {
        var rect = element.getBoundingClientRect();
        return [event.clientX - rect.left, event.clientY - rect.top];
    };
    MouseHelper.prototype.getCoords = function (event, element, charMeasure, colCount, rowCount, isSelection) {
        if (!charMeasure.width || !charMeasure.height) {
            return null;
        }
        var coords = MouseHelper.getCoordsRelativeToElement(event, element);
        if (!coords) {
            return null;
        }
        coords[0] = Math.ceil((coords[0] + (isSelection ? this._renderer.dimensions.actualCellWidth / 2 : 0)) / this._renderer.dimensions.actualCellWidth);
        coords[1] = Math.ceil(coords[1] / this._renderer.dimensions.actualCellHeight);
        coords[0] = Math.min(Math.max(coords[0], 1), colCount + (isSelection ? 1 : 0));
        coords[1] = Math.min(Math.max(coords[1], 1), rowCount);
        return coords;
    };
    MouseHelper.prototype.getRawByteCoords = function (event, element, charMeasure, colCount, rowCount) {
        var coords = this.getCoords(event, element, charMeasure, colCount, rowCount);
        var x = coords[0];
        var y = coords[1];
        x += 32;
        y += 32;
        return { x: x, y: y };
    };
    return MouseHelper;
}());
exports.MouseHelper = MouseHelper;
//# sourceMappingURL=MouseHelper.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/MouseZoneManager.js":
/*!****************************************************!*\
  !*** ./node_modules/xterm/lib/MouseZoneManager.js ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Lifecycle_1 = __webpack_require__(/*! ./common/Lifecycle */ "./node_modules/xterm/lib/common/Lifecycle.js");
var Lifecycle_2 = __webpack_require__(/*! ./ui/Lifecycle */ "./node_modules/xterm/lib/ui/Lifecycle.js");
var HOVER_DURATION = 500;
var MouseZoneManager = (function (_super) {
    __extends(MouseZoneManager, _super);
    function MouseZoneManager(_terminal) {
        var _this = _super.call(this) || this;
        _this._terminal = _terminal;
        _this._zones = [];
        _this._areZonesActive = false;
        _this._tooltipTimeout = null;
        _this._currentZone = null;
        _this._lastHoverCoords = [null, null];
        _this.register(Lifecycle_2.addDisposableDomListener(_this._terminal.element, 'mousedown', function (e) { return _this._onMouseDown(e); }));
        _this._mouseMoveListener = function (e) { return _this._onMouseMove(e); };
        _this._mouseLeaveListener = function (e) { return _this._onMouseLeave(e); };
        _this._clickListener = function (e) { return _this._onClick(e); };
        return _this;
    }
    MouseZoneManager.prototype.dispose = function () {
        _super.prototype.dispose.call(this);
        this._deactivate();
    };
    MouseZoneManager.prototype.add = function (zone) {
        this._zones.push(zone);
        if (this._zones.length === 1) {
            this._activate();
        }
    };
    MouseZoneManager.prototype.clearAll = function (start, end) {
        if (this._zones.length === 0) {
            return;
        }
        if (!end) {
            start = 0;
            end = this._terminal.rows - 1;
        }
        for (var i = 0; i < this._zones.length; i++) {
            var zone = this._zones[i];
            if ((zone.y1 > start && zone.y1 <= end + 1) ||
                (zone.y2 > start && zone.y2 <= end + 1) ||
                (zone.y1 < start && zone.y2 > end + 1)) {
                if (this._currentZone && this._currentZone === zone) {
                    this._currentZone.leaveCallback();
                    this._currentZone = null;
                }
                this._zones.splice(i--, 1);
            }
        }
        if (this._zones.length === 0) {
            this._deactivate();
        }
    };
    MouseZoneManager.prototype._activate = function () {
        if (!this._areZonesActive) {
            this._areZonesActive = true;
            this._terminal.element.addEventListener('mousemove', this._mouseMoveListener);
            this._terminal.element.addEventListener('mouseleave', this._mouseLeaveListener);
            this._terminal.element.addEventListener('click', this._clickListener);
        }
    };
    MouseZoneManager.prototype._deactivate = function () {
        if (this._areZonesActive) {
            this._areZonesActive = false;
            this._terminal.element.removeEventListener('mousemove', this._mouseMoveListener);
            this._terminal.element.removeEventListener('mouseleave', this._mouseLeaveListener);
            this._terminal.element.removeEventListener('click', this._clickListener);
        }
    };
    MouseZoneManager.prototype._onMouseMove = function (e) {
        if (this._lastHoverCoords[0] !== e.pageX || this._lastHoverCoords[1] !== e.pageY) {
            this._onHover(e);
            this._lastHoverCoords = [e.pageX, e.pageY];
        }
    };
    MouseZoneManager.prototype._onHover = function (e) {
        var _this = this;
        var zone = this._findZoneEventAt(e);
        if (zone === this._currentZone) {
            return;
        }
        if (this._currentZone) {
            this._currentZone.leaveCallback();
            this._currentZone = null;
            if (this._tooltipTimeout) {
                clearTimeout(this._tooltipTimeout);
            }
        }
        if (!zone) {
            return;
        }
        this._currentZone = zone;
        if (zone.hoverCallback) {
            zone.hoverCallback(e);
        }
        this._tooltipTimeout = setTimeout(function () { return _this._onTooltip(e); }, HOVER_DURATION);
    };
    MouseZoneManager.prototype._onTooltip = function (e) {
        this._tooltipTimeout = null;
        var zone = this._findZoneEventAt(e);
        if (zone && zone.tooltipCallback) {
            zone.tooltipCallback(e);
        }
    };
    MouseZoneManager.prototype._onMouseDown = function (e) {
        this._initialSelectionLength = this._terminal.getSelection().length;
        if (!this._areZonesActive) {
            return;
        }
        var zone = this._findZoneEventAt(e);
        if (zone) {
            if (zone.willLinkActivate(e)) {
                e.preventDefault();
                e.stopImmediatePropagation();
            }
        }
    };
    MouseZoneManager.prototype._onMouseLeave = function (e) {
        if (this._currentZone) {
            this._currentZone.leaveCallback();
            this._currentZone = null;
            if (this._tooltipTimeout) {
                clearTimeout(this._tooltipTimeout);
            }
        }
    };
    MouseZoneManager.prototype._onClick = function (e) {
        var zone = this._findZoneEventAt(e);
        var currentSelectionLength = this._terminal.getSelection().length;
        if (zone && currentSelectionLength === this._initialSelectionLength) {
            zone.clickCallback(e);
            e.preventDefault();
            e.stopImmediatePropagation();
        }
    };
    MouseZoneManager.prototype._findZoneEventAt = function (e) {
        var coords = this._terminal.mouseHelper.getCoords(e, this._terminal.screenElement, this._terminal.charMeasure, this._terminal.cols, this._terminal.rows);
        if (!coords) {
            return null;
        }
        var x = coords[0];
        var y = coords[1];
        for (var i = 0; i < this._zones.length; i++) {
            var zone = this._zones[i];
            if (zone.y1 === zone.y2) {
                if (y === zone.y1 && x >= zone.x1 && x < zone.x2) {
                    return zone;
                }
            }
            else {
                if ((y === zone.y1 && x >= zone.x1) ||
                    (y === zone.y2 && x < zone.x2) ||
                    (y > zone.y1 && y < zone.y2)) {
                    return zone;
                }
            }
        }
        return null;
    };
    return MouseZoneManager;
}(Lifecycle_1.Disposable));
exports.MouseZoneManager = MouseZoneManager;
var MouseZone = (function () {
    function MouseZone(x1, y1, x2, y2, clickCallback, hoverCallback, tooltipCallback, leaveCallback, willLinkActivate) {
        this.x1 = x1;
        this.y1 = y1;
        this.x2 = x2;
        this.y2 = y2;
        this.clickCallback = clickCallback;
        this.hoverCallback = hoverCallback;
        this.tooltipCallback = tooltipCallback;
        this.leaveCallback = leaveCallback;
        this.willLinkActivate = willLinkActivate;
    }
    return MouseZone;
}());
exports.MouseZone = MouseZone;
//# sourceMappingURL=MouseZoneManager.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/SelectionManager.js":
/*!****************************************************!*\
  !*** ./node_modules/xterm/lib/SelectionManager.js ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var MouseHelper_1 = __webpack_require__(/*! ./MouseHelper */ "./node_modules/xterm/lib/MouseHelper.js");
var Browser = __webpack_require__(/*! ./common/Platform */ "./node_modules/xterm/lib/common/Platform.js");
var SelectionModel_1 = __webpack_require__(/*! ./SelectionModel */ "./node_modules/xterm/lib/SelectionModel.js");
var AltClickHandler_1 = __webpack_require__(/*! ./handlers/AltClickHandler */ "./node_modules/xterm/lib/handlers/AltClickHandler.js");
var BufferLine_1 = __webpack_require__(/*! ./core/buffer/BufferLine */ "./node_modules/xterm/lib/core/buffer/BufferLine.js");
var EventEmitter2_1 = __webpack_require__(/*! ./common/EventEmitter2 */ "./node_modules/xterm/lib/common/EventEmitter2.js");
var DRAG_SCROLL_MAX_THRESHOLD = 50;
var DRAG_SCROLL_MAX_SPEED = 15;
var DRAG_SCROLL_INTERVAL = 50;
var ALT_CLICK_MOVE_CURSOR_TIME = 500;
var WORD_SEPARATORS = ' ()[]{}\'"';
var NON_BREAKING_SPACE_CHAR = String.fromCharCode(160);
var ALL_NON_BREAKING_SPACE_REGEX = new RegExp(NON_BREAKING_SPACE_CHAR, 'g');
var SelectionManager = (function () {
    function SelectionManager(_terminal, _charMeasure) {
        this._terminal = _terminal;
        this._charMeasure = _charMeasure;
        this._enabled = true;
        this._workCell = new BufferLine_1.CellData();
        this._onLinuxMouseSelection = new EventEmitter2_1.EventEmitter2();
        this._onRedrawRequest = new EventEmitter2_1.EventEmitter2();
        this._onSelectionChange = new EventEmitter2_1.EventEmitter2();
        this._initListeners();
        this.enable();
        this._model = new SelectionModel_1.SelectionModel(_terminal);
        this._activeSelectionMode = 0;
    }
    Object.defineProperty(SelectionManager.prototype, "onLinuxMouseSelection", {
        get: function () { return this._onLinuxMouseSelection.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SelectionManager.prototype, "onRedrawRequest", {
        get: function () { return this._onRedrawRequest.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SelectionManager.prototype, "onSelectionChange", {
        get: function () { return this._onSelectionChange.event; },
        enumerable: true,
        configurable: true
    });
    SelectionManager.prototype.dispose = function () {
        this._removeMouseDownListeners();
    };
    Object.defineProperty(SelectionManager.prototype, "_buffer", {
        get: function () {
            return this._terminal.buffers.active;
        },
        enumerable: true,
        configurable: true
    });
    SelectionManager.prototype._initListeners = function () {
        var _this = this;
        this._mouseMoveListener = function (event) { return _this._onMouseMove(event); };
        this._mouseUpListener = function (event) { return _this._onMouseUp(event); };
        this.initBuffersListeners();
    };
    SelectionManager.prototype.initBuffersListeners = function () {
        var _this = this;
        this._trimListener = this._terminal.buffer.lines.onTrim(function (amount) { return _this._onTrim(amount); });
        this._terminal.buffers.onBufferActivate(function (e) { return _this._onBufferActivate(e); });
    };
    SelectionManager.prototype.disable = function () {
        this.clearSelection();
        this._enabled = false;
    };
    SelectionManager.prototype.enable = function () {
        this._enabled = true;
    };
    Object.defineProperty(SelectionManager.prototype, "selectionStart", {
        get: function () { return this._model.finalSelectionStart; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SelectionManager.prototype, "selectionEnd", {
        get: function () { return this._model.finalSelectionEnd; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SelectionManager.prototype, "hasSelection", {
        get: function () {
            var start = this._model.finalSelectionStart;
            var end = this._model.finalSelectionEnd;
            if (!start || !end) {
                return false;
            }
            return start[0] !== end[0] || start[1] !== end[1];
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SelectionManager.prototype, "selectionText", {
        get: function () {
            var start = this._model.finalSelectionStart;
            var end = this._model.finalSelectionEnd;
            if (!start || !end) {
                return '';
            }
            var result = [];
            if (this._activeSelectionMode === 3) {
                if (start[0] === end[0]) {
                    return '';
                }
                for (var i = start[1]; i <= end[1]; i++) {
                    var lineText = this._buffer.translateBufferLineToString(i, true, start[0], end[0]);
                    result.push(lineText);
                }
            }
            else {
                var startRowEndCol = start[1] === end[1] ? end[0] : undefined;
                result.push(this._buffer.translateBufferLineToString(start[1], true, start[0], startRowEndCol));
                for (var i = start[1] + 1; i <= end[1] - 1; i++) {
                    var bufferLine = this._buffer.lines.get(i);
                    var lineText = this._buffer.translateBufferLineToString(i, true);
                    if (bufferLine.isWrapped) {
                        result[result.length - 1] += lineText;
                    }
                    else {
                        result.push(lineText);
                    }
                }
                if (start[1] !== end[1]) {
                    var bufferLine = this._buffer.lines.get(end[1]);
                    var lineText = this._buffer.translateBufferLineToString(end[1], true, 0, end[0]);
                    if (bufferLine.isWrapped) {
                        result[result.length - 1] += lineText;
                    }
                    else {
                        result.push(lineText);
                    }
                }
            }
            var formattedResult = result.map(function (line) {
                return line.replace(ALL_NON_BREAKING_SPACE_REGEX, ' ');
            }).join(Browser.isMSWindows ? '\r\n' : '\n');
            return formattedResult;
        },
        enumerable: true,
        configurable: true
    });
    SelectionManager.prototype.clearSelection = function () {
        this._model.clearSelection();
        this._removeMouseDownListeners();
        this.refresh();
        this._onSelectionChange.fire();
    };
    SelectionManager.prototype.refresh = function (isLinuxMouseSelection) {
        var _this = this;
        if (!this._refreshAnimationFrame) {
            this._refreshAnimationFrame = window.requestAnimationFrame(function () { return _this._refresh(); });
        }
        if (Browser.isLinux && isLinuxMouseSelection) {
            var selectionText = this.selectionText;
            if (selectionText.length) {
                this._onLinuxMouseSelection.fire(this.selectionText);
            }
        }
    };
    SelectionManager.prototype._refresh = function () {
        this._refreshAnimationFrame = null;
        this._onRedrawRequest.fire({
            start: this._model.finalSelectionStart,
            end: this._model.finalSelectionEnd,
            columnSelectMode: this._activeSelectionMode === 3
        });
    };
    SelectionManager.prototype.isClickInSelection = function (event) {
        var coords = this._getMouseBufferCoords(event);
        var start = this._model.finalSelectionStart;
        var end = this._model.finalSelectionEnd;
        if (!start || !end) {
            return false;
        }
        return this._areCoordsInSelection(coords, start, end);
    };
    SelectionManager.prototype._areCoordsInSelection = function (coords, start, end) {
        return (coords[1] > start[1] && coords[1] < end[1]) ||
            (start[1] === end[1] && coords[1] === start[1] && coords[0] >= start[0] && coords[0] < end[0]) ||
            (start[1] < end[1] && coords[1] === end[1] && coords[0] < end[0]) ||
            (start[1] < end[1] && coords[1] === start[1] && coords[0] >= start[0]);
    };
    SelectionManager.prototype.selectWordAtCursor = function (event) {
        var coords = this._getMouseBufferCoords(event);
        if (coords) {
            this._selectWordAt(coords, false);
            this._model.selectionEnd = null;
            this.refresh(true);
        }
    };
    SelectionManager.prototype.selectAll = function () {
        this._model.isSelectAllActive = true;
        this.refresh();
        this._onSelectionChange.fire();
    };
    SelectionManager.prototype.selectLines = function (start, end) {
        this._model.clearSelection();
        start = Math.max(start, 0);
        end = Math.min(end, this._terminal.buffer.lines.length - 1);
        this._model.selectionStart = [0, start];
        this._model.selectionEnd = [this._terminal.cols, end];
        this.refresh();
        this._onSelectionChange.fire();
    };
    SelectionManager.prototype._onTrim = function (amount) {
        var needsRefresh = this._model.onTrim(amount);
        if (needsRefresh) {
            this.refresh();
        }
    };
    SelectionManager.prototype._getMouseBufferCoords = function (event) {
        var coords = this._terminal.mouseHelper.getCoords(event, this._terminal.screenElement, this._charMeasure, this._terminal.cols, this._terminal.rows, true);
        if (!coords) {
            return null;
        }
        coords[0]--;
        coords[1]--;
        coords[1] += this._terminal.buffer.ydisp;
        return coords;
    };
    SelectionManager.prototype._getMouseEventScrollAmount = function (event) {
        var offset = MouseHelper_1.MouseHelper.getCoordsRelativeToElement(event, this._terminal.screenElement)[1];
        var terminalHeight = this._terminal.rows * Math.ceil(this._charMeasure.height * this._terminal.options.lineHeight);
        if (offset >= 0 && offset <= terminalHeight) {
            return 0;
        }
        if (offset > terminalHeight) {
            offset -= terminalHeight;
        }
        offset = Math.min(Math.max(offset, -DRAG_SCROLL_MAX_THRESHOLD), DRAG_SCROLL_MAX_THRESHOLD);
        offset /= DRAG_SCROLL_MAX_THRESHOLD;
        return (offset / Math.abs(offset)) + Math.round(offset * (DRAG_SCROLL_MAX_SPEED - 1));
    };
    SelectionManager.prototype.shouldForceSelection = function (event) {
        if (Browser.isMac) {
            return event.altKey && this._terminal.options.macOptionClickForcesSelection;
        }
        return event.shiftKey;
    };
    SelectionManager.prototype.onMouseDown = function (event) {
        this._mouseDownTimeStamp = event.timeStamp;
        if (event.button === 2 && this.hasSelection) {
            return;
        }
        if (event.button !== 0) {
            return;
        }
        if (!this._enabled) {
            if (!this.shouldForceSelection(event)) {
                return;
            }
            event.stopPropagation();
        }
        event.preventDefault();
        this._dragScrollAmount = 0;
        if (this._enabled && event.shiftKey) {
            this._onIncrementalClick(event);
        }
        else {
            if (event.detail === 1) {
                this._onSingleClick(event);
            }
            else if (event.detail === 2) {
                this._onDoubleClick(event);
            }
            else if (event.detail === 3) {
                this._onTripleClick(event);
            }
        }
        this._addMouseDownListeners();
        this.refresh(true);
    };
    SelectionManager.prototype._addMouseDownListeners = function () {
        var _this = this;
        this._terminal.element.ownerDocument.addEventListener('mousemove', this._mouseMoveListener);
        this._terminal.element.ownerDocument.addEventListener('mouseup', this._mouseUpListener);
        this._dragScrollIntervalTimer = setInterval(function () { return _this._dragScroll(); }, DRAG_SCROLL_INTERVAL);
    };
    SelectionManager.prototype._removeMouseDownListeners = function () {
        if (this._terminal.element.ownerDocument) {
            this._terminal.element.ownerDocument.removeEventListener('mousemove', this._mouseMoveListener);
            this._terminal.element.ownerDocument.removeEventListener('mouseup', this._mouseUpListener);
        }
        clearInterval(this._dragScrollIntervalTimer);
        this._dragScrollIntervalTimer = null;
    };
    SelectionManager.prototype._onIncrementalClick = function (event) {
        if (this._model.selectionStart) {
            this._model.selectionEnd = this._getMouseBufferCoords(event);
        }
    };
    SelectionManager.prototype._onSingleClick = function (event) {
        this._model.selectionStartLength = 0;
        this._model.isSelectAllActive = false;
        this._activeSelectionMode = this.shouldColumnSelect(event) ? 3 : 0;
        this._model.selectionStart = this._getMouseBufferCoords(event);
        if (!this._model.selectionStart) {
            return;
        }
        this._model.selectionEnd = null;
        var line = this._buffer.lines.get(this._model.selectionStart[1]);
        if (!line) {
            return;
        }
        if (line.length >= this._model.selectionStart[0]) {
            return;
        }
        if (line.hasWidth(this._model.selectionStart[0]) === 0) {
            this._model.selectionStart[0]++;
        }
    };
    SelectionManager.prototype._onDoubleClick = function (event) {
        var coords = this._getMouseBufferCoords(event);
        if (coords) {
            this._activeSelectionMode = 1;
            this._selectWordAt(coords, true);
        }
    };
    SelectionManager.prototype._onTripleClick = function (event) {
        var coords = this._getMouseBufferCoords(event);
        if (coords) {
            this._activeSelectionMode = 2;
            this._selectLineAt(coords[1]);
        }
    };
    SelectionManager.prototype.shouldColumnSelect = function (event) {
        return event.altKey && !(Browser.isMac && this._terminal.options.macOptionClickForcesSelection);
    };
    SelectionManager.prototype._onMouseMove = function (event) {
        event.stopImmediatePropagation();
        var previousSelectionEnd = this._model.selectionEnd ? [this._model.selectionEnd[0], this._model.selectionEnd[1]] : null;
        this._model.selectionEnd = this._getMouseBufferCoords(event);
        if (!this._model.selectionEnd) {
            this.refresh(true);
            return;
        }
        if (this._activeSelectionMode === 2) {
            if (this._model.selectionEnd[1] < this._model.selectionStart[1]) {
                this._model.selectionEnd[0] = 0;
            }
            else {
                this._model.selectionEnd[0] = this._terminal.cols;
            }
        }
        else if (this._activeSelectionMode === 1) {
            this._selectToWordAt(this._model.selectionEnd);
        }
        this._dragScrollAmount = this._getMouseEventScrollAmount(event);
        if (this._activeSelectionMode !== 3) {
            if (this._dragScrollAmount > 0) {
                this._model.selectionEnd[0] = this._terminal.cols;
            }
            else if (this._dragScrollAmount < 0) {
                this._model.selectionEnd[0] = 0;
            }
        }
        if (this._model.selectionEnd[1] < this._buffer.lines.length) {
            if (this._buffer.lines.get(this._model.selectionEnd[1]).hasWidth(this._model.selectionEnd[0]) === 0) {
                this._model.selectionEnd[0]++;
            }
        }
        if (!previousSelectionEnd ||
            previousSelectionEnd[0] !== this._model.selectionEnd[0] ||
            previousSelectionEnd[1] !== this._model.selectionEnd[1]) {
            this.refresh(true);
        }
    };
    SelectionManager.prototype._dragScroll = function () {
        if (this._dragScrollAmount) {
            this._terminal.scrollLines(this._dragScrollAmount, false);
            if (this._dragScrollAmount > 0) {
                if (this._activeSelectionMode !== 3) {
                    this._model.selectionEnd[0] = this._terminal.cols;
                }
                this._model.selectionEnd[1] = Math.min(this._terminal.buffer.ydisp + this._terminal.rows, this._terminal.buffer.lines.length - 1);
            }
            else {
                if (this._activeSelectionMode !== 3) {
                    this._model.selectionEnd[0] = 0;
                }
                this._model.selectionEnd[1] = this._terminal.buffer.ydisp;
            }
            this.refresh();
        }
    };
    SelectionManager.prototype._onMouseUp = function (event) {
        var timeElapsed = event.timeStamp - this._mouseDownTimeStamp;
        this._removeMouseDownListeners();
        if (this.selectionText.length <= 1 && timeElapsed < ALT_CLICK_MOVE_CURSOR_TIME) {
            (new AltClickHandler_1.AltClickHandler(event, this._terminal)).move();
        }
        else if (this.hasSelection) {
            this._onSelectionChange.fire();
        }
    };
    SelectionManager.prototype._onBufferActivate = function (e) {
        var _this = this;
        this.clearSelection();
        if (this._trimListener) {
            this._trimListener.dispose();
        }
        this._trimListener = e.activeBuffer.lines.onTrim(function (amount) { return _this._onTrim(amount); });
    };
    SelectionManager.prototype._convertViewportColToCharacterIndex = function (bufferLine, coords) {
        var charIndex = coords[0];
        for (var i = 0; coords[0] >= i; i++) {
            var length_1 = bufferLine.loadCell(i, this._workCell).getChars().length;
            if (this._workCell.getWidth() === 0) {
                charIndex--;
            }
            else if (length_1 > 1 && coords[0] !== i) {
                charIndex += length_1 - 1;
            }
        }
        return charIndex;
    };
    SelectionManager.prototype.setSelection = function (col, row, length) {
        this._model.clearSelection();
        this._removeMouseDownListeners();
        this._model.selectionStart = [col, row];
        this._model.selectionStartLength = length;
        this.refresh();
    };
    SelectionManager.prototype._getWordAt = function (coords, allowWhitespaceOnlySelection, followWrappedLinesAbove, followWrappedLinesBelow) {
        if (followWrappedLinesAbove === void 0) { followWrappedLinesAbove = true; }
        if (followWrappedLinesBelow === void 0) { followWrappedLinesBelow = true; }
        if (coords[0] >= this._terminal.cols) {
            return null;
        }
        var bufferLine = this._buffer.lines.get(coords[1]);
        if (!bufferLine) {
            return null;
        }
        var line = this._buffer.translateBufferLineToString(coords[1], false);
        var startIndex = this._convertViewportColToCharacterIndex(bufferLine, coords);
        var endIndex = startIndex;
        var charOffset = coords[0] - startIndex;
        var leftWideCharCount = 0;
        var rightWideCharCount = 0;
        var leftLongCharOffset = 0;
        var rightLongCharOffset = 0;
        if (line.charAt(startIndex) === ' ') {
            while (startIndex > 0 && line.charAt(startIndex - 1) === ' ') {
                startIndex--;
            }
            while (endIndex < line.length && line.charAt(endIndex + 1) === ' ') {
                endIndex++;
            }
        }
        else {
            var startCol = coords[0];
            var endCol = coords[0];
            if (bufferLine.getWidth(startCol) === 0) {
                leftWideCharCount++;
                startCol--;
            }
            if (bufferLine.getWidth(endCol) === 2) {
                rightWideCharCount++;
                endCol++;
            }
            var length_2 = bufferLine.getString(endCol).length;
            if (length_2 > 1) {
                rightLongCharOffset += length_2 - 1;
                endIndex += length_2 - 1;
            }
            while (startCol > 0 && startIndex > 0 && !this._isCharWordSeparator(bufferLine.loadCell(startCol - 1, this._workCell))) {
                bufferLine.loadCell(startCol - 1, this._workCell);
                var length_3 = this._workCell.getChars().length;
                if (this._workCell.getWidth() === 0) {
                    leftWideCharCount++;
                    startCol--;
                }
                else if (length_3 > 1) {
                    leftLongCharOffset += length_3 - 1;
                    startIndex -= length_3 - 1;
                }
                startIndex--;
                startCol--;
            }
            while (endCol < bufferLine.length && endIndex + 1 < line.length && !this._isCharWordSeparator(bufferLine.loadCell(endCol + 1, this._workCell))) {
                bufferLine.loadCell(endCol + 1, this._workCell);
                var length_4 = this._workCell.getChars().length;
                if (this._workCell.getWidth() === 2) {
                    rightWideCharCount++;
                    endCol++;
                }
                else if (length_4 > 1) {
                    rightLongCharOffset += length_4 - 1;
                    endIndex += length_4 - 1;
                }
                endIndex++;
                endCol++;
            }
        }
        endIndex++;
        var start = startIndex
            + charOffset
            - leftWideCharCount
            + leftLongCharOffset;
        var length = Math.min(this._terminal.cols, endIndex
            - startIndex
            + leftWideCharCount
            + rightWideCharCount
            - leftLongCharOffset
            - rightLongCharOffset);
        if (!allowWhitespaceOnlySelection && line.slice(startIndex, endIndex).trim() === '') {
            return null;
        }
        if (followWrappedLinesAbove) {
            if (start === 0 && bufferLine.getCodePoint(0) !== 32) {
                var previousBufferLine = this._buffer.lines.get(coords[1] - 1);
                if (previousBufferLine && bufferLine.isWrapped && previousBufferLine.getCodePoint(this._terminal.cols - 1) !== 32) {
                    var previousLineWordPosition = this._getWordAt([this._terminal.cols - 1, coords[1] - 1], false, true, false);
                    if (previousLineWordPosition) {
                        var offset = this._terminal.cols - previousLineWordPosition.start;
                        start -= offset;
                        length += offset;
                    }
                }
            }
        }
        if (followWrappedLinesBelow) {
            if (start + length === this._terminal.cols && bufferLine.getCodePoint(this._terminal.cols - 1) !== 32) {
                var nextBufferLine = this._buffer.lines.get(coords[1] + 1);
                if (nextBufferLine && nextBufferLine.isWrapped && nextBufferLine.getCodePoint(0) !== 32) {
                    var nextLineWordPosition = this._getWordAt([0, coords[1] + 1], false, false, true);
                    if (nextLineWordPosition) {
                        length += nextLineWordPosition.length;
                    }
                }
            }
        }
        return { start: start, length: length };
    };
    SelectionManager.prototype._selectWordAt = function (coords, allowWhitespaceOnlySelection) {
        var wordPosition = this._getWordAt(coords, allowWhitespaceOnlySelection);
        if (wordPosition) {
            while (wordPosition.start < 0) {
                wordPosition.start += this._terminal.cols;
                coords[1]--;
            }
            this._model.selectionStart = [wordPosition.start, coords[1]];
            this._model.selectionStartLength = wordPosition.length;
        }
    };
    SelectionManager.prototype._selectToWordAt = function (coords) {
        var wordPosition = this._getWordAt(coords, true);
        if (wordPosition) {
            var endRow = coords[1];
            while (wordPosition.start < 0) {
                wordPosition.start += this._terminal.cols;
                endRow--;
            }
            if (!this._model.areSelectionValuesReversed()) {
                while (wordPosition.start + wordPosition.length > this._terminal.cols) {
                    wordPosition.length -= this._terminal.cols;
                    endRow++;
                }
            }
            this._model.selectionEnd = [this._model.areSelectionValuesReversed() ? wordPosition.start : wordPosition.start + wordPosition.length, endRow];
        }
    };
    SelectionManager.prototype._isCharWordSeparator = function (cell) {
        if (cell.getWidth() === 0) {
            return false;
        }
        return WORD_SEPARATORS.indexOf(cell.getChars()) >= 0;
    };
    SelectionManager.prototype._selectLineAt = function (line) {
        var wrappedRange = this._buffer.getWrappedRangeForLine(line);
        this._model.selectionStart = [0, wrappedRange.first];
        this._model.selectionEnd = [this._terminal.cols, wrappedRange.last];
        this._model.selectionStartLength = 0;
    };
    return SelectionManager;
}());
exports.SelectionManager = SelectionManager;
//# sourceMappingURL=SelectionManager.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/SelectionModel.js":
/*!**************************************************!*\
  !*** ./node_modules/xterm/lib/SelectionModel.js ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var SelectionModel = (function () {
    function SelectionModel(_terminal) {
        this._terminal = _terminal;
        this.clearSelection();
    }
    SelectionModel.prototype.clearSelection = function () {
        this.selectionStart = null;
        this.selectionEnd = null;
        this.isSelectAllActive = false;
        this.selectionStartLength = 0;
    };
    Object.defineProperty(SelectionModel.prototype, "finalSelectionStart", {
        get: function () {
            if (this.isSelectAllActive) {
                return [0, 0];
            }
            if (!this.selectionEnd || !this.selectionStart) {
                return this.selectionStart;
            }
            return this.areSelectionValuesReversed() ? this.selectionEnd : this.selectionStart;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(SelectionModel.prototype, "finalSelectionEnd", {
        get: function () {
            if (this.isSelectAllActive) {
                return [this._terminal.cols, this._terminal.buffer.ybase + this._terminal.rows - 1];
            }
            if (!this.selectionStart) {
                return null;
            }
            if (!this.selectionEnd || this.areSelectionValuesReversed()) {
                var startPlusLength = this.selectionStart[0] + this.selectionStartLength;
                if (startPlusLength > this._terminal.cols) {
                    return [startPlusLength % this._terminal.cols, this.selectionStart[1] + Math.floor(startPlusLength / this._terminal.cols)];
                }
                return [startPlusLength, this.selectionStart[1]];
            }
            if (this.selectionStartLength) {
                if (this.selectionEnd[1] === this.selectionStart[1]) {
                    return [Math.max(this.selectionStart[0] + this.selectionStartLength, this.selectionEnd[0]), this.selectionEnd[1]];
                }
            }
            return this.selectionEnd;
        },
        enumerable: true,
        configurable: true
    });
    SelectionModel.prototype.areSelectionValuesReversed = function () {
        var start = this.selectionStart;
        var end = this.selectionEnd;
        if (!start || !end) {
            return false;
        }
        return start[1] > end[1] || (start[1] === end[1] && start[0] > end[0]);
    };
    SelectionModel.prototype.onTrim = function (amount) {
        if (this.selectionStart) {
            this.selectionStart[1] -= amount;
        }
        if (this.selectionEnd) {
            this.selectionEnd[1] -= amount;
        }
        if (this.selectionEnd && this.selectionEnd[1] < 0) {
            this.clearSelection();
            return true;
        }
        if (this.selectionStart && this.selectionStart[1] < 0) {
            this.selectionStart[1] = 0;
        }
        return false;
    };
    return SelectionModel;
}());
exports.SelectionModel = SelectionModel;
//# sourceMappingURL=SelectionModel.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/SoundManager.js":
/*!************************************************!*\
  !*** ./node_modules/xterm/lib/SoundManager.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.DEFAULT_BELL_SOUND = 'data:audio/wav;base64,UklGRigBAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQBAADpAFgCwAMlBZoG/wdmCcoKRAypDQ8PbRDBEQQTOxRtFYcWlBePGIUZXhoiG88bcBz7HHIdzh0WHlMeZx51HmkeUx4WHs8dah0AHXwc3hs9G4saxRnyGBIYGBcQFv8U4RPAEoYRQBACD70NWwwHC6gJOwjWBloF7gOBAhABkf8b/qv8R/ve+Xf4Ife79W/0JfPZ8Z/wde9N7ijtE+wU6xvqM+lb6H7nw+YX5mrlxuQz5Mzje+Ma49fioeKD4nXiYeJy4pHitOL04j/jn+MN5IPkFOWs5U3mDefM55/ogOl36m7rdOyE7abuyu8D8Unyj/Pg9D/2qfcb+Yn6/vuK/Qj/lAAlAg==';
var SoundManager = (function () {
    function SoundManager(_terminal) {
        this._terminal = _terminal;
    }
    Object.defineProperty(SoundManager, "audioContext", {
        get: function () {
            if (!SoundManager._audioContext) {
                var audioContextCtor = window.AudioContext || window.webkitAudioContext;
                if (!audioContextCtor) {
                    console.warn('Web Audio API is not supported by this browser. Consider upgrading to the latest version');
                    return null;
                }
                SoundManager._audioContext = new audioContextCtor();
            }
            return SoundManager._audioContext;
        },
        enumerable: true,
        configurable: true
    });
    SoundManager.prototype.playBellSound = function () {
        var ctx = SoundManager.audioContext;
        if (!ctx) {
            return;
        }
        var bellAudioSource = ctx.createBufferSource();
        ctx.decodeAudioData(this._base64ToArrayBuffer(this._removeMimeType(this._terminal.options.bellSound)), function (buffer) {
            bellAudioSource.buffer = buffer;
            bellAudioSource.connect(ctx.destination);
            bellAudioSource.start(0);
        });
    };
    SoundManager.prototype._base64ToArrayBuffer = function (base64) {
        var binaryString = window.atob(base64);
        var len = binaryString.length;
        var bytes = new Uint8Array(len);
        for (var i = 0; i < len; i++) {
            bytes[i] = binaryString.charCodeAt(i);
        }
        return bytes.buffer;
    };
    SoundManager.prototype._removeMimeType = function (dataURI) {
        var splitUri = dataURI.split(',');
        return splitUri[1];
    };
    return SoundManager;
}());
exports.SoundManager = SoundManager;
//# sourceMappingURL=SoundManager.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/Strings.js":
/*!*******************************************!*\
  !*** ./node_modules/xterm/lib/Strings.js ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.blankLine = 'Blank line';
exports.promptLabel = 'Terminal input';
exports.tooMuchOutput = 'Too much output to announce, navigate to rows manually to read';
//# sourceMappingURL=Strings.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/Terminal.js":
/*!********************************************!*\
  !*** ./node_modules/xterm/lib/Terminal.js ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var BufferSet_1 = __webpack_require__(/*! ./BufferSet */ "./node_modules/xterm/lib/BufferSet.js");
var Buffer_1 = __webpack_require__(/*! ./Buffer */ "./node_modules/xterm/lib/Buffer.js");
var CompositionHelper_1 = __webpack_require__(/*! ./CompositionHelper */ "./node_modules/xterm/lib/CompositionHelper.js");
var EventEmitter_1 = __webpack_require__(/*! ./common/EventEmitter */ "./node_modules/xterm/lib/common/EventEmitter.js");
var Viewport_1 = __webpack_require__(/*! ./Viewport */ "./node_modules/xterm/lib/Viewport.js");
var Clipboard_1 = __webpack_require__(/*! ./Clipboard */ "./node_modules/xterm/lib/Clipboard.js");
var EscapeSequences_1 = __webpack_require__(/*! ./common/data/EscapeSequences */ "./node_modules/xterm/lib/common/data/EscapeSequences.js");
var InputHandler_1 = __webpack_require__(/*! ./InputHandler */ "./node_modules/xterm/lib/InputHandler.js");
var Renderer_1 = __webpack_require__(/*! ./renderer/Renderer */ "./node_modules/xterm/lib/renderer/Renderer.js");
var Linkifier_1 = __webpack_require__(/*! ./Linkifier */ "./node_modules/xterm/lib/Linkifier.js");
var SelectionManager_1 = __webpack_require__(/*! ./SelectionManager */ "./node_modules/xterm/lib/SelectionManager.js");
var CharMeasure_1 = __webpack_require__(/*! ./CharMeasure */ "./node_modules/xterm/lib/CharMeasure.js");
var Browser = __webpack_require__(/*! ./common/Platform */ "./node_modules/xterm/lib/common/Platform.js");
var Lifecycle_1 = __webpack_require__(/*! ./ui/Lifecycle */ "./node_modules/xterm/lib/ui/Lifecycle.js");
var Strings = __webpack_require__(/*! ./Strings */ "./node_modules/xterm/lib/Strings.js");
var MouseHelper_1 = __webpack_require__(/*! ./MouseHelper */ "./node_modules/xterm/lib/MouseHelper.js");
var SoundManager_1 = __webpack_require__(/*! ./SoundManager */ "./node_modules/xterm/lib/SoundManager.js");
var MouseZoneManager_1 = __webpack_require__(/*! ./MouseZoneManager */ "./node_modules/xterm/lib/MouseZoneManager.js");
var AccessibilityManager_1 = __webpack_require__(/*! ./AccessibilityManager */ "./node_modules/xterm/lib/AccessibilityManager.js");
var ScreenDprMonitor_1 = __webpack_require__(/*! ./ui/ScreenDprMonitor */ "./node_modules/xterm/lib/ui/ScreenDprMonitor.js");
var CharAtlasCache_1 = __webpack_require__(/*! ./renderer/atlas/CharAtlasCache */ "./node_modules/xterm/lib/renderer/atlas/CharAtlasCache.js");
var DomRenderer_1 = __webpack_require__(/*! ./renderer/dom/DomRenderer */ "./node_modules/xterm/lib/renderer/dom/DomRenderer.js");
var Keyboard_1 = __webpack_require__(/*! ./core/input/Keyboard */ "./node_modules/xterm/lib/core/input/Keyboard.js");
var Clone_1 = __webpack_require__(/*! ./common/Clone */ "./node_modules/xterm/lib/common/Clone.js");
var EventEmitter2_1 = __webpack_require__(/*! ./common/EventEmitter2 */ "./node_modules/xterm/lib/common/EventEmitter2.js");
var BufferLine_1 = __webpack_require__(/*! ./core/buffer/BufferLine */ "./node_modules/xterm/lib/core/buffer/BufferLine.js");
var WindowsMode_1 = __webpack_require__(/*! ./WindowsMode */ "./node_modules/xterm/lib/WindowsMode.js");
var document = (typeof window !== 'undefined') ? window.document : null;
var WRITE_BUFFER_PAUSE_THRESHOLD = 5;
var WRITE_TIMEOUT_MS = 12;
var MINIMUM_COLS = 2;
var MINIMUM_ROWS = 1;
var CONSTRUCTOR_ONLY_OPTIONS = ['cols', 'rows'];
var DEFAULT_OPTIONS = {
    cols: 80,
    rows: 24,
    convertEol: false,
    termName: 'xterm',
    cursorBlink: false,
    cursorStyle: 'block',
    bellSound: SoundManager_1.DEFAULT_BELL_SOUND,
    bellStyle: 'none',
    drawBoldTextInBrightColors: true,
    enableBold: true,
    experimentalCharAtlas: 'static',
    fontFamily: 'courier-new, courier, monospace',
    fontSize: 15,
    fontWeight: 'normal',
    fontWeightBold: 'bold',
    lineHeight: 1.0,
    letterSpacing: 0,
    scrollback: 1000,
    screenKeys: false,
    screenReaderMode: false,
    debug: false,
    macOptionIsMeta: false,
    macOptionClickForcesSelection: false,
    cancelEvents: false,
    disableStdin: false,
    useFlowControl: false,
    allowTransparency: false,
    tabStopWidth: 8,
    theme: null,
    rightClickSelectsWord: Browser.isMac,
    rendererType: 'canvas',
    windowsMode: false
};
var Terminal = (function (_super) {
    __extends(Terminal, _super);
    function Terminal(options) {
        if (options === void 0) { options = {}; }
        var _this = _super.call(this) || this;
        _this.browser = Browser;
        _this._blankLine = null;
        _this._onCursorMove = new EventEmitter2_1.EventEmitter2();
        _this._onData = new EventEmitter2_1.EventEmitter2();
        _this._onKey = new EventEmitter2_1.EventEmitter2();
        _this._onLineFeed = new EventEmitter2_1.EventEmitter2();
        _this._onRender = new EventEmitter2_1.EventEmitter2();
        _this._onResize = new EventEmitter2_1.EventEmitter2();
        _this._onScroll = new EventEmitter2_1.EventEmitter2();
        _this._onSelectionChange = new EventEmitter2_1.EventEmitter2();
        _this._onTitleChange = new EventEmitter2_1.EventEmitter2();
        _this.options = Clone_1.clone(options);
        _this._setup();
        _this.onCursorMove(function () { return _this.emit('cursormove'); });
        _this.onData(function (e) { return _this.emit('data', e); });
        _this.onKey(function (e) { return _this.emit('key', e.key, e.domEvent); });
        _this.onLineFeed(function () { return _this.emit('linefeed'); });
        _this.onRender(function (e) { return _this.emit('refresh', e); });
        _this.onResize(function (e) { return _this.emit('resize', e); });
        _this.onSelectionChange(function () { return _this.emit('selection'); });
        _this.onScroll(function (e) { return _this.emit('scroll', e); });
        _this.onTitleChange(function (e) { return _this.emit('title', e); });
        return _this;
    }
    Object.defineProperty(Terminal.prototype, "onCursorMove", {
        get: function () { return this._onCursorMove.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "onData", {
        get: function () { return this._onData.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "onKey", {
        get: function () { return this._onKey.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "onLineFeed", {
        get: function () { return this._onLineFeed.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "onRender", {
        get: function () { return this._onRender.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "onResize", {
        get: function () { return this._onResize.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "onScroll", {
        get: function () { return this._onScroll.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "onSelectionChange", {
        get: function () { return this._onSelectionChange.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "onTitleChange", {
        get: function () { return this._onTitleChange.event; },
        enumerable: true,
        configurable: true
    });
    Terminal.prototype.dispose = function () {
        _super.prototype.dispose.call(this);
        if (this._windowsMode) {
            this._windowsMode.dispose();
            this._windowsMode = undefined;
        }
        this._customKeyEventHandler = null;
        CharAtlasCache_1.removeTerminalFromCache(this);
        this.handler = function () { };
        this.write = function () { };
        if (this.element && this.element.parentNode) {
            this.element.parentNode.removeChild(this.element);
        }
    };
    Terminal.prototype.destroy = function () {
        this.dispose();
    };
    Terminal.prototype._setup = function () {
        var _this = this;
        Object.keys(DEFAULT_OPTIONS).forEach(function (key) {
            if (_this.options[key] === null || _this.options[key] === undefined) {
                _this.options[key] = DEFAULT_OPTIONS[key];
            }
        });
        this._parent = document ? document.body : null;
        this.cols = Math.max(this.options.cols, MINIMUM_COLS);
        this.rows = Math.max(this.options.rows, MINIMUM_ROWS);
        if (this.options.handler) {
            this.onData(this.options.handler);
        }
        this.cursorState = 0;
        this.cursorHidden = false;
        this._customKeyEventHandler = null;
        this.applicationKeypad = false;
        this.applicationCursor = false;
        this.originMode = false;
        this.insertMode = false;
        this.wraparoundMode = true;
        this.bracketedPasteMode = false;
        this.charset = null;
        this.gcharset = null;
        this.glevel = 0;
        this.charsets = [null];
        this.curAttrData = BufferLine_1.DEFAULT_ATTR_DATA.clone();
        this._eraseAttrData = BufferLine_1.DEFAULT_ATTR_DATA.clone();
        this.params = [];
        this.currentParam = 0;
        this.writeBuffer = [];
        this._writeInProgress = false;
        this._xoffSentToCatchUp = false;
        this._userScrolling = false;
        this._inputHandler = new InputHandler_1.InputHandler(this);
        this._inputHandler.onCursorMove(function () { return _this._onCursorMove.fire(); });
        this._inputHandler.onLineFeed(function () { return _this._onLineFeed.fire(); });
        this.register(this._inputHandler);
        this.renderer = this.renderer || null;
        this.selectionManager = this.selectionManager || null;
        this.linkifier = this.linkifier || new Linkifier_1.Linkifier(this);
        this._mouseZoneManager = this._mouseZoneManager || null;
        this.soundManager = this.soundManager || new SoundManager_1.SoundManager(this);
        this.buffers = new BufferSet_1.BufferSet(this);
        if (this.selectionManager) {
            this.selectionManager.clearSelection();
            this.selectionManager.initBuffersListeners();
        }
        if (this.options.windowsMode) {
            this._windowsMode = WindowsMode_1.applyWindowsMode(this);
        }
    };
    Object.defineProperty(Terminal.prototype, "buffer", {
        get: function () {
            return this.buffers.active;
        },
        enumerable: true,
        configurable: true
    });
    Terminal.prototype.eraseAttrData = function () {
        this._eraseAttrData.bg &= ~(50331648 | 0xFFFFFF);
        this._eraseAttrData.bg |= this.curAttrData.bg & ~0xFC000000;
        return this._eraseAttrData;
    };
    Terminal.prototype.focus = function () {
        if (this.textarea) {
            this.textarea.focus({ preventScroll: true });
        }
    };
    Object.defineProperty(Terminal.prototype, "isFocused", {
        get: function () {
            return document.activeElement === this.textarea && document.hasFocus();
        },
        enumerable: true,
        configurable: true
    });
    Terminal.prototype.getOption = function (key) {
        if (!(key in DEFAULT_OPTIONS)) {
            throw new Error('No option with key "' + key + '"');
        }
        return this.options[key];
    };
    Terminal.prototype.setOption = function (key, value) {
        if (!(key in DEFAULT_OPTIONS)) {
            throw new Error('No option with key "' + key + '"');
        }
        if (CONSTRUCTOR_ONLY_OPTIONS.indexOf(key) !== -1) {
            console.error("Option \"" + key + "\" can only be set in the constructor");
        }
        if (this.options[key] === value) {
            return;
        }
        switch (key) {
            case 'bellStyle':
                if (!value) {
                    value = 'none';
                }
                break;
            case 'cursorStyle':
                if (!value) {
                    value = 'block';
                }
                break;
            case 'fontWeight':
                if (!value) {
                    value = 'normal';
                }
                break;
            case 'fontWeightBold':
                if (!value) {
                    value = 'bold';
                }
                break;
            case 'lineHeight':
                if (value < 1) {
                    console.warn(key + " cannot be less than 1, value: " + value);
                    return;
                }
            case 'rendererType':
                if (!value) {
                    value = 'canvas';
                }
                break;
            case 'tabStopWidth':
                if (value < 1) {
                    console.warn(key + " cannot be less than 1, value: " + value);
                    return;
                }
                break;
            case 'theme':
                if (this.renderer) {
                    this._setTheme(value);
                    return;
                }
                break;
            case 'scrollback':
                value = Math.min(value, Buffer_1.MAX_BUFFER_SIZE);
                if (value < 0) {
                    console.warn(key + " cannot be less than 0, value: " + value);
                    return;
                }
                if (this.options[key] !== value) {
                    var newBufferLength = this.rows + value;
                    if (this.buffer.lines.length > newBufferLength) {
                        var amountToTrim = this.buffer.lines.length - newBufferLength;
                        var needsRefresh = (this.buffer.ydisp - amountToTrim < 0);
                        this.buffer.lines.trimStart(amountToTrim);
                        this.buffer.ybase = Math.max(this.buffer.ybase - amountToTrim, 0);
                        this.buffer.ydisp = Math.max(this.buffer.ydisp - amountToTrim, 0);
                        if (needsRefresh) {
                            this.refresh(0, this.rows - 1);
                        }
                    }
                }
                break;
        }
        this.options[key] = value;
        switch (key) {
            case 'fontFamily':
            case 'fontSize':
                if (this.renderer) {
                    this.renderer.clear();
                    this.charMeasure.measure(this.options);
                }
                break;
            case 'drawBoldTextInBrightColors':
            case 'experimentalCharAtlas':
            case 'enableBold':
            case 'letterSpacing':
            case 'lineHeight':
            case 'fontWeight':
            case 'fontWeightBold':
                if (this.renderer) {
                    this.renderer.clear();
                    this.renderer.onResize(this.cols, this.rows);
                    this.refresh(0, this.rows - 1);
                }
                break;
            case 'rendererType':
                if (this.renderer) {
                    this.unregister(this.renderer);
                    this.renderer.dispose();
                    this.renderer = null;
                }
                this._setupRenderer();
                this.renderer.onCharSizeChanged();
                if (this._theme) {
                    this.renderer.setTheme(this._theme);
                }
                this.mouseHelper.setRenderer(this.renderer);
                break;
            case 'scrollback':
                this.buffers.resize(this.cols, this.rows);
                if (this.viewport) {
                    this.viewport.syncScrollArea();
                }
                break;
            case 'screenReaderMode':
                if (value) {
                    if (!this._accessibilityManager) {
                        this._accessibilityManager = new AccessibilityManager_1.AccessibilityManager(this);
                    }
                }
                else {
                    if (this._accessibilityManager) {
                        this._accessibilityManager.dispose();
                        this._accessibilityManager = null;
                    }
                }
                break;
            case 'tabStopWidth':
                this.buffers.setupTabStops();
                break;
            case 'windowsMode':
                if (value) {
                    if (!this._windowsMode) {
                        this._windowsMode = WindowsMode_1.applyWindowsMode(this);
                    }
                }
                else {
                    if (this._windowsMode) {
                        this._windowsMode.dispose();
                        this._windowsMode = undefined;
                    }
                }
                break;
        }
        if (this.renderer) {
            this.renderer.onOptionsChanged();
        }
    };
    Terminal.prototype._onTextAreaFocus = function (ev) {
        if (this.sendFocus) {
            this.handler(EscapeSequences_1.C0.ESC + '[I');
        }
        this.updateCursorStyle(ev);
        this.element.classList.add('focus');
        this.showCursor();
        this.emit('focus');
    };
    Terminal.prototype.blur = function () {
        return this.textarea.blur();
    };
    Terminal.prototype._onTextAreaBlur = function () {
        this.textarea.value = '';
        this.refresh(this.buffer.y, this.buffer.y);
        if (this.sendFocus) {
            this.handler(EscapeSequences_1.C0.ESC + '[O');
        }
        this.element.classList.remove('focus');
        this.emit('blur');
    };
    Terminal.prototype._initGlobal = function () {
        var _this = this;
        this._bindKeys();
        this.register(Lifecycle_1.addDisposableDomListener(this.element, 'copy', function (event) {
            if (!_this.hasSelection()) {
                return;
            }
            Clipboard_1.copyHandler(event, _this, _this.selectionManager);
        }));
        var pasteHandlerWrapper = function (event) { return Clipboard_1.pasteHandler(event, _this); };
        this.register(Lifecycle_1.addDisposableDomListener(this.textarea, 'paste', pasteHandlerWrapper));
        this.register(Lifecycle_1.addDisposableDomListener(this.element, 'paste', pasteHandlerWrapper));
        if (Browser.isFirefox) {
            this.register(Lifecycle_1.addDisposableDomListener(this.element, 'mousedown', function (event) {
                if (event.button === 2) {
                    Clipboard_1.rightClickHandler(event, _this, _this.selectionManager, _this.options.rightClickSelectsWord);
                }
            }));
        }
        else {
            this.register(Lifecycle_1.addDisposableDomListener(this.element, 'contextmenu', function (event) {
                Clipboard_1.rightClickHandler(event, _this, _this.selectionManager, _this.options.rightClickSelectsWord);
            }));
        }
        if (Browser.isLinux) {
            this.register(Lifecycle_1.addDisposableDomListener(this.element, 'auxclick', function (event) {
                if (event.button === 1) {
                    Clipboard_1.moveTextAreaUnderMouseCursor(event, _this);
                }
            }));
        }
    };
    Terminal.prototype._bindKeys = function () {
        var _this = this;
        var self = this;
        this.register(Lifecycle_1.addDisposableDomListener(this.element, 'keydown', function (ev) {
            if (document.activeElement !== this) {
                return;
            }
            self._keyDown(ev);
        }, true));
        this.register(Lifecycle_1.addDisposableDomListener(this.element, 'keypress', function (ev) {
            if (document.activeElement !== this) {
                return;
            }
            self._keyPress(ev);
        }, true));
        this.register(Lifecycle_1.addDisposableDomListener(this.element, 'keyup', function (ev) {
            if (!wasModifierKeyOnlyEvent(ev)) {
                _this.focus();
            }
            self._keyUp(ev);
        }, true));
        this.register(Lifecycle_1.addDisposableDomListener(this.textarea, 'keydown', function (ev) { return _this._keyDown(ev); }, true));
        this.register(Lifecycle_1.addDisposableDomListener(this.textarea, 'keypress', function (ev) { return _this._keyPress(ev); }, true));
        this.register(Lifecycle_1.addDisposableDomListener(this.textarea, 'compositionstart', function () { return _this._compositionHelper.compositionstart(); }));
        this.register(Lifecycle_1.addDisposableDomListener(this.textarea, 'compositionupdate', function (e) { return _this._compositionHelper.compositionupdate(e); }));
        this.register(Lifecycle_1.addDisposableDomListener(this.textarea, 'compositionend', function () { return _this._compositionHelper.compositionend(); }));
        this.register(this.onRender(function () { return _this._compositionHelper.updateCompositionElements(); }));
        this.register(this.onRender(function (e) { return _this._queueLinkification(e.start, e.end); }));
    };
    Terminal.prototype.open = function (parent) {
        var _this = this;
        this._parent = parent || this._parent;
        if (!this._parent) {
            throw new Error('Terminal requires a parent element.');
        }
        this._context = this._parent.ownerDocument.defaultView;
        this._document = this._parent.ownerDocument;
        this._screenDprMonitor = new ScreenDprMonitor_1.ScreenDprMonitor();
        this._screenDprMonitor.setListener(function () { return _this.emit('dprchange', window.devicePixelRatio); });
        this.register(this._screenDprMonitor);
        this.element = this._document.createElement('div');
        this.element.dir = 'ltr';
        this.element.classList.add('terminal');
        this.element.classList.add('xterm');
        this.element.setAttribute('tabindex', '0');
        this._parent.appendChild(this.element);
        var fragment = document.createDocumentFragment();
        this._viewportElement = document.createElement('div');
        this._viewportElement.classList.add('xterm-viewport');
        fragment.appendChild(this._viewportElement);
        this._viewportScrollArea = document.createElement('div');
        this._viewportScrollArea.classList.add('xterm-scroll-area');
        this._viewportElement.appendChild(this._viewportScrollArea);
        this.screenElement = document.createElement('div');
        this.screenElement.classList.add('xterm-screen');
        this._helperContainer = document.createElement('div');
        this._helperContainer.classList.add('xterm-helpers');
        this.screenElement.appendChild(this._helperContainer);
        fragment.appendChild(this.screenElement);
        this._mouseZoneManager = new MouseZoneManager_1.MouseZoneManager(this);
        this.register(this._mouseZoneManager);
        this.register(this.onScroll(function () { return _this._mouseZoneManager.clearAll(); }));
        this.linkifier.attachToDom(this._mouseZoneManager);
        this.textarea = document.createElement('textarea');
        this.textarea.classList.add('xterm-helper-textarea');
        this.textarea.setAttribute('aria-label', Strings.promptLabel);
        this.textarea.setAttribute('aria-multiline', 'false');
        this.textarea.setAttribute('autocorrect', 'off');
        this.textarea.setAttribute('autocapitalize', 'off');
        this.textarea.setAttribute('spellcheck', 'false');
        this.textarea.tabIndex = 0;
        this.register(Lifecycle_1.addDisposableDomListener(this.textarea, 'focus', function (ev) { return _this._onTextAreaFocus(ev); }));
        this.register(Lifecycle_1.addDisposableDomListener(this.textarea, 'blur', function () { return _this._onTextAreaBlur(); }));
        this._helperContainer.appendChild(this.textarea);
        this._compositionView = document.createElement('div');
        this._compositionView.classList.add('composition-view');
        this._compositionHelper = new CompositionHelper_1.CompositionHelper(this.textarea, this._compositionView, this);
        this._helperContainer.appendChild(this._compositionView);
        this.charMeasure = new CharMeasure_1.CharMeasure(document, this._helperContainer);
        this.element.appendChild(fragment);
        this._setupRenderer();
        this._theme = this.options.theme;
        this.options.theme = null;
        this.viewport = new Viewport_1.Viewport(this, this._viewportElement, this._viewportScrollArea, this.charMeasure);
        this.viewport.onThemeChanged(this.renderer.colorManager.colors);
        this.register(this.viewport);
        this.register(this.onCursorMove(function () { return _this.renderer.onCursorMove(); }));
        this.register(this.onResize(function () { return _this.renderer.onResize(_this.cols, _this.rows); }));
        this.register(this.addDisposableListener('blur', function () { return _this.renderer.onBlur(); }));
        this.register(this.addDisposableListener('focus', function () { return _this.renderer.onFocus(); }));
        this.register(this.addDisposableListener('dprchange', function () { return _this.renderer.onWindowResize(window.devicePixelRatio); }));
        this.register(Lifecycle_1.addDisposableDomListener(window, 'resize', function () { return _this.renderer.onWindowResize(window.devicePixelRatio); }));
        this.register(this.charMeasure.onCharSizeChanged(function () { return _this.renderer.onCharSizeChanged(); }));
        this.register(this.renderer.onCanvasResize(function () { return _this.viewport.syncScrollArea(); }));
        this.selectionManager = new SelectionManager_1.SelectionManager(this, this.charMeasure);
        this.register(this.selectionManager.onSelectionChange(function () { return _this._onSelectionChange.fire(); }));
        this.register(Lifecycle_1.addDisposableDomListener(this.element, 'mousedown', function (e) { return _this.selectionManager.onMouseDown(e); }));
        this.register(this.selectionManager.onRedrawRequest(function (e) { return _this.renderer.onSelectionChanged(e.start, e.end, e.columnSelectMode); }));
        this.register(this.selectionManager.onLinuxMouseSelection(function (text) {
            _this.textarea.value = text;
            _this.textarea.focus();
            _this.textarea.select();
        }));
        this.register(this.onScroll(function () {
            _this.viewport.syncScrollArea();
            _this.selectionManager.refresh();
        }));
        this.register(Lifecycle_1.addDisposableDomListener(this._viewportElement, 'scroll', function () { return _this.selectionManager.refresh(); }));
        this.mouseHelper = new MouseHelper_1.MouseHelper(this.renderer);
        this.element.classList.toggle('enable-mouse-events', this.mouseEvents);
        if (this.mouseEvents) {
            this.selectionManager.disable();
        }
        else {
            this.selectionManager.enable();
        }
        if (this.options.screenReaderMode) {
            this._accessibilityManager = new AccessibilityManager_1.AccessibilityManager(this);
        }
        this.charMeasure.measure(this.options);
        this.refresh(0, this.rows - 1);
        this._initGlobal();
        this.bindMouse();
    };
    Terminal.prototype._setupRenderer = function () {
        var _this = this;
        switch (this.options.rendererType) {
            case 'canvas':
                this.renderer = new Renderer_1.Renderer(this, this.options.theme);
                break;
            case 'dom':
                this.renderer = new DomRenderer_1.DomRenderer(this, this.options.theme);
                break;
            default: throw new Error("Unrecognized rendererType \"" + this.options.rendererType + "\"");
        }
        this.renderer.onRender(function (e) { return _this._onRender.fire(e); });
        this.register(this.renderer);
    };
    Terminal.prototype._setTheme = function (theme) {
        this._theme = theme;
        var colors = this.renderer.setTheme(theme);
        if (this.viewport) {
            this.viewport.onThemeChanged(colors);
        }
    };
    Terminal.prototype.bindMouse = function () {
        var _this = this;
        var el = this.element;
        var self = this;
        var pressed = 32;
        function sendButton(ev) {
            var button;
            var pos;
            button = getButton(ev);
            pos = self.mouseHelper.getRawByteCoords(ev, self.screenElement, self.charMeasure, self.cols, self.rows);
            if (!pos)
                return;
            sendEvent(button, pos);
            switch (ev.overrideType || ev.type) {
                case 'mousedown':
                    pressed = button;
                    break;
                case 'mouseup':
                    pressed = 32;
                    break;
                case 'wheel':
                    break;
            }
        }
        function sendMove(ev) {
            var button = pressed;
            var pos = self.mouseHelper.getRawByteCoords(ev, self.screenElement, self.charMeasure, self.cols, self.rows);
            if (!pos)
                return;
            button += 32;
            sendEvent(button, pos);
        }
        function encode(data, ch) {
            if (!self.utfMouse) {
                if (ch === 255) {
                    data.push(0);
                    return;
                }
                if (ch > 127)
                    ch = 127;
                data.push(ch);
            }
            else {
                if (ch > 2047) {
                    data.push(2047);
                    return;
                }
                data.push(ch);
            }
        }
        function sendEvent(button, pos) {
            if (self._vt300Mouse) {
                button &= 3;
                pos.x -= 32;
                pos.y -= 32;
                var data_1 = EscapeSequences_1.C0.ESC + '[24';
                if (button === 0)
                    data_1 += '1';
                else if (button === 1)
                    data_1 += '3';
                else if (button === 2)
                    data_1 += '5';
                else if (button === 3)
                    return;
                else
                    data_1 += '0';
                data_1 += '~[' + pos.x + ',' + pos.y + ']\r';
                self.handler(data_1);
                return;
            }
            if (self._decLocator) {
                button &= 3;
                pos.x -= 32;
                pos.y -= 32;
                if (button === 0)
                    button = 2;
                else if (button === 1)
                    button = 4;
                else if (button === 2)
                    button = 6;
                else if (button === 3)
                    button = 3;
                self.handler(EscapeSequences_1.C0.ESC + '['
                    + button
                    + ';'
                    + (button === 3 ? 4 : 0)
                    + ';'
                    + pos.y
                    + ';'
                    + pos.x
                    + ';'
                    + pos.page || 0
                    + '&w');
                return;
            }
            if (self.urxvtMouse) {
                pos.x -= 32;
                pos.y -= 32;
                pos.x++;
                pos.y++;
                self.handler(EscapeSequences_1.C0.ESC + '[' + button + ';' + pos.x + ';' + pos.y + 'M');
                return;
            }
            if (self.sgrMouse) {
                pos.x -= 32;
                pos.y -= 32;
                self.handler(EscapeSequences_1.C0.ESC + '[<'
                    + (((button & 3) === 3 ? button & ~3 : button) - 32)
                    + ';'
                    + pos.x
                    + ';'
                    + pos.y
                    + ((button & 3) === 3 ? 'm' : 'M'));
                return;
            }
            var data = [];
            encode(data, button);
            encode(data, pos.x);
            encode(data, pos.y);
            self.handler(EscapeSequences_1.C0.ESC + '[M' + String.fromCharCode.apply(String, data));
        }
        function getButton(ev) {
            var button;
            var shift;
            var meta;
            var ctrl;
            var mod;
            switch (ev.overrideType || ev.type) {
                case 'mousedown':
                    button = ev.button !== null && ev.button !== undefined
                        ? +ev.button
                        : ev.which !== null && ev.which !== undefined
                            ? ev.which - 1
                            : null;
                    if (Browser.isMSIE) {
                        button = button === 1 ? 0 : button === 4 ? 1 : button;
                    }
                    break;
                case 'mouseup':
                    button = 3;
                    break;
                case 'DOMMouseScroll':
                    button = ev.detail < 0
                        ? 64
                        : 65;
                    break;
                case 'wheel':
                    button = ev.deltaY < 0
                        ? 64
                        : 65;
                    break;
            }
            shift = ev.shiftKey ? 4 : 0;
            meta = ev.metaKey ? 8 : 0;
            ctrl = ev.ctrlKey ? 16 : 0;
            mod = shift | meta | ctrl;
            if (self.vt200Mouse) {
                mod &= ctrl;
            }
            else if (!self.normalMouse) {
                mod = 0;
            }
            button = (32 + (mod << 2)) + button;
            return button;
        }
        this.register(Lifecycle_1.addDisposableDomListener(el, 'mousedown', function (ev) {
            ev.preventDefault();
            _this.focus();
            if (!_this.mouseEvents || _this.selectionManager.shouldForceSelection(ev)) {
                return;
            }
            sendButton(ev);
            if (_this.vt200Mouse) {
                ev.overrideType = 'mouseup';
                sendButton(ev);
                return _this.cancel(ev);
            }
            var moveHandler;
            if (_this.normalMouse) {
                moveHandler = function (event) {
                    if (!_this.normalMouse) {
                        return;
                    }
                    sendMove(event);
                };
                _this._document.addEventListener('mousemove', moveHandler);
            }
            var handler = function (ev) {
                if (_this.normalMouse && !_this.x10Mouse) {
                    sendButton(ev);
                }
                if (moveHandler) {
                    _this._document.removeEventListener('mousemove', moveHandler);
                    moveHandler = null;
                }
                _this._document.removeEventListener('mouseup', handler);
                return _this.cancel(ev);
            };
            _this._document.addEventListener('mouseup', handler);
            return _this.cancel(ev);
        }));
        this.register(Lifecycle_1.addDisposableDomListener(el, 'wheel', function (ev) {
            if (!_this.mouseEvents) {
                if (!_this.buffer.hasScrollback) {
                    var amount = _this.viewport.getLinesScrolled(ev);
                    if (amount === 0) {
                        return;
                    }
                    var sequence = EscapeSequences_1.C0.ESC + (_this.applicationCursor ? 'O' : '[') + (ev.deltaY < 0 ? 'A' : 'B');
                    var data = '';
                    for (var i = 0; i < Math.abs(amount); i++) {
                        data += sequence;
                    }
                    _this.handler(data);
                }
                return;
            }
            if (_this.x10Mouse || _this._vt300Mouse || _this._decLocator)
                return;
            sendButton(ev);
            ev.preventDefault();
        }));
        this.register(Lifecycle_1.addDisposableDomListener(el, 'wheel', function (ev) {
            if (_this.mouseEvents)
                return;
            _this.viewport.onWheel(ev);
            return _this.cancel(ev);
        }));
        this.register(Lifecycle_1.addDisposableDomListener(el, 'touchstart', function (ev) {
            if (_this.mouseEvents)
                return;
            _this.viewport.onTouchStart(ev);
            return _this.cancel(ev);
        }));
        this.register(Lifecycle_1.addDisposableDomListener(el, 'touchmove', function (ev) {
            if (_this.mouseEvents)
                return;
            _this.viewport.onTouchMove(ev);
            return _this.cancel(ev);
        }));
    };
    Terminal.prototype.refresh = function (start, end) {
        if (this.renderer) {
            this.renderer.refreshRows(start, end);
        }
    };
    Terminal.prototype._queueLinkification = function (start, end) {
        if (this.linkifier) {
            this.linkifier.linkifyRows(start, end);
        }
    };
    Terminal.prototype.updateCursorStyle = function (ev) {
        if (this.selectionManager && this.selectionManager.shouldColumnSelect(ev)) {
            this.element.classList.add('column-select');
        }
        else {
            this.element.classList.remove('column-select');
        }
    };
    Terminal.prototype.showCursor = function () {
        if (!this.cursorState) {
            this.cursorState = 1;
            this.refresh(this.buffer.y, this.buffer.y);
        }
    };
    Terminal.prototype.scroll = function (isWrapped) {
        if (isWrapped === void 0) { isWrapped = false; }
        var newLine;
        newLine = this._blankLine;
        var eraseAttr = this.eraseAttrData();
        if (!newLine || newLine.length !== this.cols || newLine.getFg(0) !== eraseAttr.fg || newLine.getBg(0) !== eraseAttr.bg) {
            newLine = this.buffer.getBlankLine(eraseAttr, isWrapped);
            this._blankLine = newLine;
        }
        newLine.isWrapped = isWrapped;
        var topRow = this.buffer.ybase + this.buffer.scrollTop;
        var bottomRow = this.buffer.ybase + this.buffer.scrollBottom;
        if (this.buffer.scrollTop === 0) {
            var willBufferBeTrimmed = this.buffer.lines.isFull;
            if (bottomRow === this.buffer.lines.length - 1) {
                if (willBufferBeTrimmed) {
                    this.buffer.lines.recycle().copyFrom(newLine);
                }
                else {
                    this.buffer.lines.push(newLine.clone());
                }
            }
            else {
                this.buffer.lines.splice(bottomRow + 1, 0, newLine.clone());
            }
            if (!willBufferBeTrimmed) {
                this.buffer.ybase++;
                if (!this._userScrolling) {
                    this.buffer.ydisp++;
                }
            }
            else {
                if (this._userScrolling) {
                    this.buffer.ydisp = Math.max(this.buffer.ydisp - 1, 0);
                }
            }
        }
        else {
            var scrollRegionHeight = bottomRow - topRow + 1;
            this.buffer.lines.shiftElements(topRow + 1, scrollRegionHeight - 1, -1);
            this.buffer.lines.set(bottomRow, newLine.clone());
        }
        if (!this._userScrolling) {
            this.buffer.ydisp = this.buffer.ybase;
        }
        this.updateRange(this.buffer.scrollTop);
        this.updateRange(this.buffer.scrollBottom);
        this._onScroll.fire(this.buffer.ydisp);
    };
    Terminal.prototype.scrollLines = function (disp, suppressScrollEvent) {
        if (disp < 0) {
            if (this.buffer.ydisp === 0) {
                return;
            }
            this._userScrolling = true;
        }
        else if (disp + this.buffer.ydisp >= this.buffer.ybase) {
            this._userScrolling = false;
        }
        var oldYdisp = this.buffer.ydisp;
        this.buffer.ydisp = Math.max(Math.min(this.buffer.ydisp + disp, this.buffer.ybase), 0);
        if (oldYdisp === this.buffer.ydisp) {
            return;
        }
        if (!suppressScrollEvent) {
            this._onScroll.fire(this.buffer.ydisp);
        }
        this.refresh(0, this.rows - 1);
    };
    Terminal.prototype.scrollPages = function (pageCount) {
        this.scrollLines(pageCount * (this.rows - 1));
    };
    Terminal.prototype.scrollToTop = function () {
        this.scrollLines(-this.buffer.ydisp);
    };
    Terminal.prototype.scrollToBottom = function () {
        this.scrollLines(this.buffer.ybase - this.buffer.ydisp);
    };
    Terminal.prototype.scrollToLine = function (line) {
        var scrollAmount = line - this.buffer.ydisp;
        if (scrollAmount !== 0) {
            this.scrollLines(scrollAmount);
        }
    };
    Terminal.prototype.write = function (data) {
        var _this = this;
        if (this._isDisposed) {
            return;
        }
        if (!data) {
            return;
        }
        this.writeBuffer.push(data);
        if (this.options.useFlowControl && !this._xoffSentToCatchUp && this.writeBuffer.length >= WRITE_BUFFER_PAUSE_THRESHOLD) {
            this.handler(EscapeSequences_1.C0.DC3);
            this._xoffSentToCatchUp = true;
        }
        if (!this._writeInProgress && this.writeBuffer.length > 0) {
            this._writeInProgress = true;
            setTimeout(function () {
                _this._innerWrite();
            });
        }
    };
    Terminal.prototype._innerWrite = function (bufferOffset) {
        var _this = this;
        if (bufferOffset === void 0) { bufferOffset = 0; }
        if (this._isDisposed) {
            this.writeBuffer = [];
        }
        var startTime = Date.now();
        while (this.writeBuffer.length > bufferOffset) {
            var data = this.writeBuffer[bufferOffset];
            bufferOffset++;
            if (this._xoffSentToCatchUp && this.writeBuffer.length === bufferOffset) {
                this.handler(EscapeSequences_1.C0.DC1);
                this._xoffSentToCatchUp = false;
            }
            this._refreshStart = this.buffer.y;
            this._refreshEnd = this.buffer.y;
            this._inputHandler.parse(data);
            this.updateRange(this.buffer.y);
            this.refresh(this._refreshStart, this._refreshEnd);
            if (Date.now() - startTime >= WRITE_TIMEOUT_MS) {
                break;
            }
        }
        if (this.writeBuffer.length > bufferOffset) {
            setTimeout(function () { return _this._innerWrite(bufferOffset); }, 0);
        }
        else {
            this._writeInProgress = false;
            this.writeBuffer = [];
        }
    };
    Terminal.prototype.writeln = function (data) {
        this.write(data + '\r\n');
    };
    Terminal.prototype.attachCustomKeyEventHandler = function (customKeyEventHandler) {
        this._customKeyEventHandler = customKeyEventHandler;
    };
    Terminal.prototype.addCsiHandler = function (flag, callback) {
        return this._inputHandler.addCsiHandler(flag, callback);
    };
    Terminal.prototype.addOscHandler = function (ident, callback) {
        return this._inputHandler.addOscHandler(ident, callback);
    };
    Terminal.prototype.registerLinkMatcher = function (regex, handler, options) {
        var matcherId = this.linkifier.registerLinkMatcher(regex, handler, options);
        this.refresh(0, this.rows - 1);
        return matcherId;
    };
    Terminal.prototype.deregisterLinkMatcher = function (matcherId) {
        if (this.linkifier.deregisterLinkMatcher(matcherId)) {
            this.refresh(0, this.rows - 1);
        }
    };
    Terminal.prototype.registerCharacterJoiner = function (handler) {
        var joinerId = this.renderer.registerCharacterJoiner(handler);
        this.refresh(0, this.rows - 1);
        return joinerId;
    };
    Terminal.prototype.deregisterCharacterJoiner = function (joinerId) {
        if (this.renderer.deregisterCharacterJoiner(joinerId)) {
            this.refresh(0, this.rows - 1);
        }
    };
    Object.defineProperty(Terminal.prototype, "markers", {
        get: function () {
            return this.buffer.markers;
        },
        enumerable: true,
        configurable: true
    });
    Terminal.prototype.addMarker = function (cursorYOffset) {
        if (this.buffer !== this.buffers.normal) {
            return;
        }
        return this.buffer.addMarker(this.buffer.ybase + this.buffer.y + cursorYOffset);
    };
    Terminal.prototype.hasSelection = function () {
        return this.selectionManager ? this.selectionManager.hasSelection : false;
    };
    Terminal.prototype.select = function (column, row, length) {
        this.selectionManager.setSelection(column, row, length);
    };
    Terminal.prototype.getSelection = function () {
        return this.selectionManager ? this.selectionManager.selectionText : '';
    };
    Terminal.prototype.getSelectionPosition = function () {
        if (!this.selectionManager.hasSelection) {
            return undefined;
        }
        return {
            startColumn: this.selectionManager.selectionStart[0],
            startRow: this.selectionManager.selectionStart[1],
            endColumn: this.selectionManager.selectionEnd[0],
            endRow: this.selectionManager.selectionEnd[1]
        };
    };
    Terminal.prototype.clearSelection = function () {
        if (this.selectionManager) {
            this.selectionManager.clearSelection();
        }
    };
    Terminal.prototype.selectAll = function () {
        if (this.selectionManager) {
            this.selectionManager.selectAll();
        }
    };
    Terminal.prototype.selectLines = function (start, end) {
        if (this.selectionManager) {
            this.selectionManager.selectLines(start, end);
        }
    };
    Terminal.prototype._keyDown = function (event) {
        if (this._customKeyEventHandler && this._customKeyEventHandler(event) === false) {
            return false;
        }
        if (!this._compositionHelper.keydown(event)) {
            if (this.buffer.ybase !== this.buffer.ydisp) {
                this.scrollToBottom();
            }
            return false;
        }
        var result = Keyboard_1.evaluateKeyboardEvent(event, this.applicationCursor, this.browser.isMac, this.options.macOptionIsMeta);
        this.updateCursorStyle(event);
        if (result.type === 3 || result.type === 2) {
            var scrollCount = this.rows - 1;
            this.scrollLines(result.type === 2 ? -scrollCount : scrollCount);
            return this.cancel(event, true);
        }
        if (result.type === 1) {
            this.selectAll();
        }
        if (this._isThirdLevelShift(this.browser, event)) {
            return true;
        }
        if (result.cancel) {
            this.cancel(event, true);
        }
        if (!result.key) {
            return true;
        }
        this.emit('keydown', event);
        this._onKey.fire({ key: result.key, domEvent: event });
        this.showCursor();
        this.handler(result.key);
        return this.cancel(event, true);
    };
    Terminal.prototype._isThirdLevelShift = function (browser, ev) {
        var thirdLevelKey = (browser.isMac && !this.options.macOptionIsMeta && ev.altKey && !ev.ctrlKey && !ev.metaKey) ||
            (browser.isMSWindows && ev.altKey && ev.ctrlKey && !ev.metaKey);
        if (ev.type === 'keypress') {
            return thirdLevelKey;
        }
        return thirdLevelKey && (!ev.keyCode || ev.keyCode > 47);
    };
    Terminal.prototype.setgLevel = function (g) {
        this.glevel = g;
        this.charset = this.charsets[g];
    };
    Terminal.prototype.setgCharset = function (g, charset) {
        this.charsets[g] = charset;
        if (this.glevel === g) {
            this.charset = charset;
        }
    };
    Terminal.prototype._keyUp = function (ev) {
        this.updateCursorStyle(ev);
    };
    Terminal.prototype._keyPress = function (ev) {
        var key;
        if (this._customKeyEventHandler && this._customKeyEventHandler(ev) === false) {
            return false;
        }
        this.cancel(ev);
        if (ev.charCode) {
            key = ev.charCode;
        }
        else if (ev.which === null || ev.which === undefined) {
            key = ev.keyCode;
        }
        else if (ev.which !== 0 && ev.charCode !== 0) {
            key = ev.which;
        }
        else {
            return false;
        }
        if (!key || ((ev.altKey || ev.ctrlKey || ev.metaKey) && !this._isThirdLevelShift(this.browser, ev))) {
            return false;
        }
        key = String.fromCharCode(key);
        this.emit('keypress', key, ev);
        this._onKey.fire({ key: key, domEvent: ev });
        this.showCursor();
        this.handler(key);
        return true;
    };
    Terminal.prototype.bell = function () {
        var _this = this;
        this.emit('bell');
        if (this._soundBell()) {
            this.soundManager.playBellSound();
        }
        if (this._visualBell()) {
            this.element.classList.add('visual-bell-active');
            clearTimeout(this._visualBellTimer);
            this._visualBellTimer = window.setTimeout(function () {
                _this.element.classList.remove('visual-bell-active');
            }, 200);
        }
    };
    Terminal.prototype.log = function (text, data) {
        if (!this.options.debug)
            return;
        if (!this._context.console || !this._context.console.log)
            return;
        this._context.console.log(text, data);
    };
    Terminal.prototype.error = function (text, data) {
        if (!this.options.debug)
            return;
        if (!this._context.console || !this._context.console.error)
            return;
        this._context.console.error(text, data);
    };
    Terminal.prototype.resize = function (x, y) {
        if (isNaN(x) || isNaN(y)) {
            return;
        }
        if (x === this.cols && y === this.rows) {
            if (this.charMeasure && (!this.charMeasure.width || !this.charMeasure.height)) {
                this.charMeasure.measure(this.options);
            }
            return;
        }
        if (x < MINIMUM_COLS)
            x = MINIMUM_COLS;
        if (y < MINIMUM_ROWS)
            y = MINIMUM_ROWS;
        this.buffers.resize(x, y);
        this.cols = x;
        this.rows = y;
        this.buffers.setupTabStops(this.cols);
        if (this.charMeasure) {
            this.charMeasure.measure(this.options);
        }
        this.refresh(0, this.rows - 1);
        this._onResize.fire({ cols: x, rows: y });
    };
    Terminal.prototype.updateRange = function (y) {
        if (y < this._refreshStart)
            this._refreshStart = y;
        if (y > this._refreshEnd)
            this._refreshEnd = y;
    };
    Terminal.prototype.maxRange = function () {
        this._refreshStart = 0;
        this._refreshEnd = this.rows - 1;
    };
    Terminal.prototype.clear = function () {
        if (this.buffer.ybase === 0 && this.buffer.y === 0) {
            return;
        }
        this.buffer.lines.set(0, this.buffer.lines.get(this.buffer.ybase + this.buffer.y));
        this.buffer.lines.length = 1;
        this.buffer.ydisp = 0;
        this.buffer.ybase = 0;
        this.buffer.y = 0;
        for (var i = 1; i < this.rows; i++) {
            this.buffer.lines.push(this.buffer.getBlankLine(BufferLine_1.DEFAULT_ATTR_DATA));
        }
        this.refresh(0, this.rows - 1);
        this._onScroll.fire(this.buffer.ydisp);
    };
    Terminal.prototype.is = function (term) {
        return (this.options.termName + '').indexOf(term) === 0;
    };
    Terminal.prototype.handler = function (data) {
        if (this.options.disableStdin) {
            return;
        }
        if (this.selectionManager && this.selectionManager.hasSelection) {
            this.selectionManager.clearSelection();
        }
        if (this.buffer.ybase !== this.buffer.ydisp) {
            this.scrollToBottom();
        }
        this._onData.fire(data);
    };
    Terminal.prototype.handleTitle = function (title) {
        this._onTitleChange.fire(title);
    };
    Terminal.prototype.index = function () {
        this.buffer.y++;
        if (this.buffer.y > this.buffer.scrollBottom) {
            this.buffer.y--;
            this.scroll();
        }
        if (this.buffer.x >= this.cols) {
            this.buffer.x--;
        }
    };
    Terminal.prototype.reverseIndex = function () {
        if (this.buffer.y === this.buffer.scrollTop) {
            var scrollRegionHeight = this.buffer.scrollBottom - this.buffer.scrollTop;
            this.buffer.lines.shiftElements(this.buffer.y + this.buffer.ybase, scrollRegionHeight, 1);
            this.buffer.lines.set(this.buffer.y + this.buffer.ybase, this.buffer.getBlankLine(this.eraseAttrData()));
            this.updateRange(this.buffer.scrollTop);
            this.updateRange(this.buffer.scrollBottom);
        }
        else {
            this.buffer.y--;
        }
    };
    Terminal.prototype.reset = function () {
        this.options.rows = this.rows;
        this.options.cols = this.cols;
        var customKeyEventHandler = this._customKeyEventHandler;
        var inputHandler = this._inputHandler;
        var cursorState = this.cursorState;
        this._setup();
        this._customKeyEventHandler = customKeyEventHandler;
        this._inputHandler = inputHandler;
        this.cursorState = cursorState;
        this.refresh(0, this.rows - 1);
        if (this.viewport) {
            this.viewport.syncScrollArea();
        }
    };
    Terminal.prototype.tabSet = function () {
        this.buffer.tabs[this.buffer.x] = true;
    };
    Terminal.prototype.cancel = function (ev, force) {
        if (!this.options.cancelEvents && !force) {
            return;
        }
        ev.preventDefault();
        ev.stopPropagation();
        return false;
    };
    Terminal.prototype._visualBell = function () {
        return false;
    };
    Terminal.prototype._soundBell = function () {
        return this.options.bellStyle === 'sound';
    };
    return Terminal;
}(EventEmitter_1.EventEmitter));
exports.Terminal = Terminal;
function wasModifierKeyOnlyEvent(ev) {
    return ev.keyCode === 16 ||
        ev.keyCode === 17 ||
        ev.keyCode === 18;
}
//# sourceMappingURL=Terminal.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/Viewport.js":
/*!********************************************!*\
  !*** ./node_modules/xterm/lib/Viewport.js ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Lifecycle_1 = __webpack_require__(/*! ./common/Lifecycle */ "./node_modules/xterm/lib/common/Lifecycle.js");
var Lifecycle_2 = __webpack_require__(/*! ./ui/Lifecycle */ "./node_modules/xterm/lib/ui/Lifecycle.js");
var FALLBACK_SCROLL_BAR_WIDTH = 15;
var Viewport = (function (_super) {
    __extends(Viewport, _super);
    function Viewport(_terminal, _viewportElement, _scrollArea, _charMeasure) {
        var _this = _super.call(this) || this;
        _this._terminal = _terminal;
        _this._viewportElement = _viewportElement;
        _this._scrollArea = _scrollArea;
        _this._charMeasure = _charMeasure;
        _this.scrollBarWidth = 0;
        _this._currentRowHeight = 0;
        _this._lastRecordedBufferLength = 0;
        _this._lastRecordedViewportHeight = 0;
        _this._lastRecordedBufferHeight = 0;
        _this._lastScrollTop = 0;
        _this._wheelPartialScroll = 0;
        _this._refreshAnimationFrame = null;
        _this._ignoreNextScrollEvent = false;
        _this.scrollBarWidth = (_this._viewportElement.offsetWidth - _this._scrollArea.offsetWidth) || FALLBACK_SCROLL_BAR_WIDTH;
        _this.register(Lifecycle_2.addDisposableDomListener(_this._viewportElement, 'scroll', _this._onScroll.bind(_this)));
        setTimeout(function () { return _this.syncScrollArea(); }, 0);
        return _this;
    }
    Viewport.prototype.onThemeChanged = function (colors) {
        this._viewportElement.style.backgroundColor = colors.background.css;
    };
    Viewport.prototype._refresh = function () {
        var _this = this;
        if (this._refreshAnimationFrame === null) {
            this._refreshAnimationFrame = requestAnimationFrame(function () { return _this._innerRefresh(); });
        }
    };
    Viewport.prototype._innerRefresh = function () {
        if (this._charMeasure.height > 0) {
            this._currentRowHeight = this._terminal.renderer.dimensions.scaledCellHeight / window.devicePixelRatio;
            this._lastRecordedViewportHeight = this._viewportElement.offsetHeight;
            var newBufferHeight = Math.round(this._currentRowHeight * this._lastRecordedBufferLength) + (this._lastRecordedViewportHeight - this._terminal.renderer.dimensions.canvasHeight);
            if (this._lastRecordedBufferHeight !== newBufferHeight) {
                this._lastRecordedBufferHeight = newBufferHeight;
                this._scrollArea.style.height = this._lastRecordedBufferHeight + 'px';
            }
        }
        var scrollTop = this._terminal.buffer.ydisp * this._currentRowHeight;
        if (this._viewportElement.scrollTop !== scrollTop) {
            this._ignoreNextScrollEvent = true;
            this._viewportElement.scrollTop = scrollTop;
        }
        this._refreshAnimationFrame = null;
    };
    Viewport.prototype.syncScrollArea = function () {
        if (this._lastRecordedBufferLength !== this._terminal.buffer.lines.length) {
            this._lastRecordedBufferLength = this._terminal.buffer.lines.length;
            this._refresh();
            return;
        }
        if (this._lastRecordedViewportHeight !== this._terminal.renderer.dimensions.canvasHeight) {
            this._refresh();
            return;
        }
        var newScrollTop = this._terminal.buffer.ydisp * this._currentRowHeight;
        if (this._lastScrollTop !== newScrollTop) {
            this._refresh();
            return;
        }
        if (this._lastScrollTop !== this._viewportElement.scrollTop) {
            this._refresh();
            return;
        }
        if (this._terminal.renderer.dimensions.scaledCellHeight / window.devicePixelRatio !== this._currentRowHeight) {
            this._refresh();
            return;
        }
    };
    Viewport.prototype._onScroll = function (ev) {
        this._lastScrollTop = this._viewportElement.scrollTop;
        if (!this._viewportElement.offsetParent) {
            return;
        }
        if (this._ignoreNextScrollEvent) {
            this._ignoreNextScrollEvent = false;
            return;
        }
        var newRow = Math.round(this._lastScrollTop / this._currentRowHeight);
        var diff = newRow - this._terminal.buffer.ydisp;
        this._terminal.scrollLines(diff, true);
    };
    Viewport.prototype.onWheel = function (ev) {
        var amount = this._getPixelsScrolled(ev);
        if (amount === 0) {
            return;
        }
        this._viewportElement.scrollTop += amount;
        ev.preventDefault();
    };
    Viewport.prototype._getPixelsScrolled = function (ev) {
        if (ev.deltaY === 0) {
            return 0;
        }
        var amount = ev.deltaY;
        if (ev.deltaMode === WheelEvent.DOM_DELTA_LINE) {
            amount *= this._currentRowHeight;
        }
        else if (ev.deltaMode === WheelEvent.DOM_DELTA_PAGE) {
            amount *= this._currentRowHeight * this._terminal.rows;
        }
        return amount;
    };
    Viewport.prototype.getLinesScrolled = function (ev) {
        if (ev.deltaY === 0) {
            return 0;
        }
        var amount = ev.deltaY;
        if (ev.deltaMode === WheelEvent.DOM_DELTA_PIXEL) {
            amount /= this._currentRowHeight + 0.0;
            this._wheelPartialScroll += amount;
            amount = Math.floor(Math.abs(this._wheelPartialScroll)) * (this._wheelPartialScroll > 0 ? 1 : -1);
            this._wheelPartialScroll %= 1;
        }
        else if (ev.deltaMode === WheelEvent.DOM_DELTA_PAGE) {
            amount *= this._terminal.rows;
        }
        return amount;
    };
    Viewport.prototype.onTouchStart = function (ev) {
        this._lastTouchY = ev.touches[0].pageY;
    };
    Viewport.prototype.onTouchMove = function (ev) {
        var deltaY = this._lastTouchY - ev.touches[0].pageY;
        this._lastTouchY = ev.touches[0].pageY;
        if (deltaY === 0) {
            return;
        }
        this._viewportElement.scrollTop += deltaY;
        ev.preventDefault();
    };
    return Viewport;
}(Lifecycle_1.Disposable));
exports.Viewport = Viewport;
//# sourceMappingURL=Viewport.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/WindowsMode.js":
/*!***********************************************!*\
  !*** ./node_modules/xterm/lib/WindowsMode.js ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var BufferLine_1 = __webpack_require__(/*! ./core/buffer/BufferLine */ "./node_modules/xterm/lib/core/buffer/BufferLine.js");
function applyWindowsMode(terminal) {
    return terminal.onLineFeed(function () {
        var line = terminal.buffer.lines.get(terminal.buffer.ybase + terminal.buffer.y - 1);
        var lastChar = line.get(terminal.cols - 1);
        if (lastChar[BufferLine_1.CHAR_DATA_CODE_INDEX] !== BufferLine_1.NULL_CELL_CODE && lastChar[BufferLine_1.CHAR_DATA_CODE_INDEX] !== BufferLine_1.WHITESPACE_CELL_CODE) {
            var nextLine = terminal.buffer.lines.get(terminal.buffer.ybase + terminal.buffer.y);
            nextLine.isWrapped = true;
        }
    });
}
exports.applyWindowsMode = applyWindowsMode;
//# sourceMappingURL=WindowsMode.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/common/CircularList.js":
/*!*******************************************************!*\
  !*** ./node_modules/xterm/lib/common/CircularList.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var EventEmitter2_1 = __webpack_require__(/*! ./EventEmitter2 */ "./node_modules/xterm/lib/common/EventEmitter2.js");
var CircularList = (function () {
    function CircularList(_maxLength) {
        this._maxLength = _maxLength;
        this.onDeleteEmitter = new EventEmitter2_1.EventEmitter2();
        this.onInsertEmitter = new EventEmitter2_1.EventEmitter2();
        this.onTrimEmitter = new EventEmitter2_1.EventEmitter2();
        this._array = new Array(this._maxLength);
        this._startIndex = 0;
        this._length = 0;
    }
    Object.defineProperty(CircularList.prototype, "onDelete", {
        get: function () { return this.onDeleteEmitter.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CircularList.prototype, "onInsert", {
        get: function () { return this.onInsertEmitter.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CircularList.prototype, "onTrim", {
        get: function () { return this.onTrimEmitter.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CircularList.prototype, "maxLength", {
        get: function () {
            return this._maxLength;
        },
        set: function (newMaxLength) {
            if (this._maxLength === newMaxLength) {
                return;
            }
            var newArray = new Array(newMaxLength);
            for (var i = 0; i < Math.min(newMaxLength, this.length); i++) {
                newArray[i] = this._array[this._getCyclicIndex(i)];
            }
            this._array = newArray;
            this._maxLength = newMaxLength;
            this._startIndex = 0;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(CircularList.prototype, "length", {
        get: function () {
            return this._length;
        },
        set: function (newLength) {
            if (newLength > this._length) {
                for (var i = this._length; i < newLength; i++) {
                    this._array[i] = undefined;
                }
            }
            this._length = newLength;
        },
        enumerable: true,
        configurable: true
    });
    CircularList.prototype.get = function (index) {
        return this._array[this._getCyclicIndex(index)];
    };
    CircularList.prototype.set = function (index, value) {
        this._array[this._getCyclicIndex(index)] = value;
    };
    CircularList.prototype.push = function (value) {
        this._array[this._getCyclicIndex(this._length)] = value;
        if (this._length === this._maxLength) {
            this._startIndex = ++this._startIndex % this._maxLength;
            this.onTrimEmitter.fire(1);
        }
        else {
            this._length++;
        }
    };
    CircularList.prototype.recycle = function () {
        if (this._length !== this._maxLength) {
            throw new Error('Can only recycle when the buffer is full');
        }
        this._startIndex = ++this._startIndex % this._maxLength;
        this.onTrimEmitter.fire(1);
        return this._array[this._getCyclicIndex(this._length - 1)];
    };
    Object.defineProperty(CircularList.prototype, "isFull", {
        get: function () {
            return this._length === this._maxLength;
        },
        enumerable: true,
        configurable: true
    });
    CircularList.prototype.pop = function () {
        return this._array[this._getCyclicIndex(this._length-- - 1)];
    };
    CircularList.prototype.splice = function (start, deleteCount) {
        var items = [];
        for (var _i = 2; _i < arguments.length; _i++) {
            items[_i - 2] = arguments[_i];
        }
        if (deleteCount) {
            for (var i = start; i < this._length - deleteCount; i++) {
                this._array[this._getCyclicIndex(i)] = this._array[this._getCyclicIndex(i + deleteCount)];
            }
            this._length -= deleteCount;
        }
        for (var i = this._length - 1; i >= start; i--) {
            this._array[this._getCyclicIndex(i + items.length)] = this._array[this._getCyclicIndex(i)];
        }
        for (var i = 0; i < items.length; i++) {
            this._array[this._getCyclicIndex(start + i)] = items[i];
        }
        if (this._length + items.length > this._maxLength) {
            var countToTrim = (this._length + items.length) - this._maxLength;
            this._startIndex += countToTrim;
            this._length = this._maxLength;
            this.onTrimEmitter.fire(countToTrim);
        }
        else {
            this._length += items.length;
        }
    };
    CircularList.prototype.trimStart = function (count) {
        if (count > this._length) {
            count = this._length;
        }
        this._startIndex += count;
        this._length -= count;
        this.onTrimEmitter.fire(count);
    };
    CircularList.prototype.shiftElements = function (start, count, offset) {
        if (count <= 0) {
            return;
        }
        if (start < 0 || start >= this._length) {
            throw new Error('start argument out of range');
        }
        if (start + offset < 0) {
            throw new Error('Cannot shift elements in list beyond index 0');
        }
        if (offset > 0) {
            for (var i = count - 1; i >= 0; i--) {
                this.set(start + i + offset, this.get(start + i));
            }
            var expandListBy = (start + count + offset) - this._length;
            if (expandListBy > 0) {
                this._length += expandListBy;
                while (this._length > this._maxLength) {
                    this._length--;
                    this._startIndex++;
                    this.onTrimEmitter.fire(1);
                }
            }
        }
        else {
            for (var i = 0; i < count; i++) {
                this.set(start + i + offset, this.get(start + i));
            }
        }
    };
    CircularList.prototype._getCyclicIndex = function (index) {
        return (this._startIndex + index) % this._maxLength;
    };
    return CircularList;
}());
exports.CircularList = CircularList;
//# sourceMappingURL=CircularList.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/common/Clone.js":
/*!************************************************!*\
  !*** ./node_modules/xterm/lib/common/Clone.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
function clone(val, depth) {
    if (depth === void 0) { depth = 5; }
    if (typeof val !== 'object') {
        return val;
    }
    if (val === null) {
        return null;
    }
    var clonedObject = Array.isArray(val) ? [] : {};
    for (var key in val) {
        clonedObject[key] = depth <= 1 ? val[key] : clone(val[key], depth - 1);
    }
    return clonedObject;
}
exports.clone = clone;
//# sourceMappingURL=Clone.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/common/EventEmitter.js":
/*!*******************************************************!*\
  !*** ./node_modules/xterm/lib/common/EventEmitter.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Lifecycle_1 = __webpack_require__(/*! ./Lifecycle */ "./node_modules/xterm/lib/common/Lifecycle.js");
var EventEmitter = (function (_super) {
    __extends(EventEmitter, _super);
    function EventEmitter() {
        var _this = _super.call(this) || this;
        _this._events = _this._events || {};
        return _this;
    }
    EventEmitter.prototype.on = function (type, listener) {
        this._events[type] = this._events[type] || [];
        this._events[type].push(listener);
    };
    EventEmitter.prototype.addDisposableListener = function (type, handler) {
        var _this = this;
        this.on(type, handler);
        var disposed = false;
        return {
            dispose: function () {
                if (disposed) {
                    return;
                }
                _this.off(type, handler);
                disposed = true;
            }
        };
    };
    EventEmitter.prototype.off = function (type, listener) {
        if (!this._events[type]) {
            return;
        }
        var obj = this._events[type];
        var i = obj.length;
        while (i--) {
            if (obj[i] === listener) {
                obj.splice(i, 1);
                return;
            }
        }
    };
    EventEmitter.prototype.removeAllListeners = function (type) {
        if (this._events[type]) {
            delete this._events[type];
        }
    };
    EventEmitter.prototype.emit = function (type) {
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        if (!this._events[type]) {
            return;
        }
        var obj = this._events[type];
        for (var i = 0; i < obj.length; i++) {
            obj[i].apply(this, args);
        }
    };
    EventEmitter.prototype.emitMayRemoveListeners = function (type) {
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        if (!this._events[type]) {
            return;
        }
        var obj = this._events[type];
        var length = obj.length;
        for (var i = 0; i < obj.length; i++) {
            obj[i].apply(this, args);
            i -= length - obj.length;
            length = obj.length;
        }
    };
    EventEmitter.prototype.listeners = function (type) {
        return this._events[type] || [];
    };
    EventEmitter.prototype.dispose = function () {
        _super.prototype.dispose.call(this);
        this._events = {};
    };
    return EventEmitter;
}(Lifecycle_1.Disposable));
exports.EventEmitter = EventEmitter;
//# sourceMappingURL=EventEmitter.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/common/EventEmitter2.js":
/*!********************************************************!*\
  !*** ./node_modules/xterm/lib/common/EventEmitter2.js ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var EventEmitter2 = (function () {
    function EventEmitter2() {
        this._listeners = [];
    }
    Object.defineProperty(EventEmitter2.prototype, "event", {
        get: function () {
            var _this = this;
            if (!this._event) {
                this._event = function (listener) {
                    _this._listeners.push(listener);
                    var disposable = {
                        dispose: function () {
                            for (var i = 0; i < _this._listeners.length; i++) {
                                if (_this._listeners[i] === listener) {
                                    _this._listeners.splice(i, 1);
                                    return;
                                }
                            }
                        }
                    };
                    return disposable;
                };
            }
            return this._event;
        },
        enumerable: true,
        configurable: true
    });
    EventEmitter2.prototype.fire = function (data) {
        var queue = [];
        for (var i = 0; i < this._listeners.length; i++) {
            queue.push(this._listeners[i]);
        }
        for (var i = 0; i < queue.length; i++) {
            queue[i].call(undefined, data);
        }
    };
    return EventEmitter2;
}());
exports.EventEmitter2 = EventEmitter2;
//# sourceMappingURL=EventEmitter2.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/common/Lifecycle.js":
/*!****************************************************!*\
  !*** ./node_modules/xterm/lib/common/Lifecycle.js ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var Disposable = (function () {
    function Disposable() {
        this._disposables = [];
        this._isDisposed = false;
    }
    Disposable.prototype.dispose = function () {
        this._isDisposed = true;
        this._disposables.forEach(function (d) { return d.dispose(); });
        this._disposables.length = 0;
    };
    Disposable.prototype.register = function (d) {
        this._disposables.push(d);
    };
    Disposable.prototype.unregister = function (d) {
        var index = this._disposables.indexOf(d);
        if (index !== -1) {
            this._disposables.splice(index, 1);
        }
    };
    return Disposable;
}());
exports.Disposable = Disposable;
//# sourceMappingURL=Lifecycle.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/common/Platform.js":
/*!***************************************************!*\
  !*** ./node_modules/xterm/lib/common/Platform.js ***!
  \***************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var isNode = (typeof navigator === 'undefined') ? true : false;
var userAgent = (isNode) ? 'node' : navigator.userAgent;
var platform = (isNode) ? 'node' : navigator.platform;
exports.isFirefox = !!~userAgent.indexOf('Firefox');
exports.isSafari = /^((?!chrome|android).)*safari/i.test(userAgent);
exports.isMSIE = !!~userAgent.indexOf('MSIE') || !!~userAgent.indexOf('Trident');
exports.isMac = contains(['Macintosh', 'MacIntel', 'MacPPC', 'Mac68K'], platform);
exports.isIpad = platform === 'iPad';
exports.isIphone = platform === 'iPhone';
exports.isMSWindows = contains(['Windows', 'Win16', 'Win32', 'WinCE'], platform);
exports.isLinux = platform.indexOf('Linux') >= 0;
function contains(arr, el) {
    return arr.indexOf(el) >= 0;
}
//# sourceMappingURL=Platform.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/common/TypedArrayUtils.js":
/*!**********************************************************!*\
  !*** ./node_modules/xterm/lib/common/TypedArrayUtils.js ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
function fill(array, value, start, end) {
    if (array.fill) {
        return array.fill(value, start, end);
    }
    return fillFallback(array, value, start, end);
}
exports.fill = fill;
function fillFallback(array, value, start, end) {
    if (start === void 0) { start = 0; }
    if (end === void 0) { end = array.length; }
    if (start >= array.length) {
        return array;
    }
    start = (array.length + start) % array.length;
    if (end >= array.length) {
        end = array.length;
    }
    else {
        end = (array.length + end) % array.length;
    }
    for (var i = start; i < end; ++i) {
        array[i] = value;
    }
    return array;
}
exports.fillFallback = fillFallback;
function concat(a, b) {
    var result = new a.constructor(a.length + b.length);
    result.set(a);
    result.set(b, a.length);
    return result;
}
exports.concat = concat;
//# sourceMappingURL=TypedArrayUtils.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/common/Types.js":
/*!************************************************!*\
  !*** ./node_modules/xterm/lib/common/Types.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.DEFAULT_COLOR = 256;
//# sourceMappingURL=Types.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/common/data/EscapeSequences.js":
/*!***************************************************************!*\
  !*** ./node_modules/xterm/lib/common/data/EscapeSequences.js ***!
  \***************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var C0;
(function (C0) {
    C0.NUL = '\x00';
    C0.SOH = '\x01';
    C0.STX = '\x02';
    C0.ETX = '\x03';
    C0.EOT = '\x04';
    C0.ENQ = '\x05';
    C0.ACK = '\x06';
    C0.BEL = '\x07';
    C0.BS = '\x08';
    C0.HT = '\x09';
    C0.LF = '\x0a';
    C0.VT = '\x0b';
    C0.FF = '\x0c';
    C0.CR = '\x0d';
    C0.SO = '\x0e';
    C0.SI = '\x0f';
    C0.DLE = '\x10';
    C0.DC1 = '\x11';
    C0.DC2 = '\x12';
    C0.DC3 = '\x13';
    C0.DC4 = '\x14';
    C0.NAK = '\x15';
    C0.SYN = '\x16';
    C0.ETB = '\x17';
    C0.CAN = '\x18';
    C0.EM = '\x19';
    C0.SUB = '\x1a';
    C0.ESC = '\x1b';
    C0.FS = '\x1c';
    C0.GS = '\x1d';
    C0.RS = '\x1e';
    C0.US = '\x1f';
    C0.SP = '\x20';
    C0.DEL = '\x7f';
})(C0 = exports.C0 || (exports.C0 = {}));
var C1;
(function (C1) {
    C1.PAD = '\x80';
    C1.HOP = '\x81';
    C1.BPH = '\x82';
    C1.NBH = '\x83';
    C1.IND = '\x84';
    C1.NEL = '\x85';
    C1.SSA = '\x86';
    C1.ESA = '\x87';
    C1.HTS = '\x88';
    C1.HTJ = '\x89';
    C1.VTS = '\x8a';
    C1.PLD = '\x8b';
    C1.PLU = '\x8c';
    C1.RI = '\x8d';
    C1.SS2 = '\x8e';
    C1.SS3 = '\x8f';
    C1.DCS = '\x90';
    C1.PU1 = '\x91';
    C1.PU2 = '\x92';
    C1.STS = '\x93';
    C1.CCH = '\x94';
    C1.MW = '\x95';
    C1.SPA = '\x96';
    C1.EPA = '\x97';
    C1.SOS = '\x98';
    C1.SGCI = '\x99';
    C1.SCI = '\x9a';
    C1.CSI = '\x9b';
    C1.ST = '\x9c';
    C1.OSC = '\x9d';
    C1.PM = '\x9e';
    C1.APC = '\x9f';
})(C1 = exports.C1 || (exports.C1 = {}));
//# sourceMappingURL=EscapeSequences.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/core/buffer/BufferLine.js":
/*!**********************************************************!*\
  !*** ./node_modules/xterm/lib/core/buffer/BufferLine.js ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var TextDecoder_1 = __webpack_require__(/*! ../input/TextDecoder */ "./node_modules/xterm/lib/core/input/TextDecoder.js");
var Types_1 = __webpack_require__(/*! ../../common/Types */ "./node_modules/xterm/lib/common/Types.js");
exports.DEFAULT_ATTR = (0 << 18) | (Types_1.DEFAULT_COLOR << 9) | (256 << 0);
exports.CHAR_DATA_ATTR_INDEX = 0;
exports.CHAR_DATA_CHAR_INDEX = 1;
exports.CHAR_DATA_WIDTH_INDEX = 2;
exports.CHAR_DATA_CODE_INDEX = 3;
exports.NULL_CELL_CHAR = '';
exports.NULL_CELL_WIDTH = 1;
exports.NULL_CELL_CODE = 0;
exports.WHITESPACE_CELL_CHAR = ' ';
exports.WHITESPACE_CELL_WIDTH = 1;
exports.WHITESPACE_CELL_CODE = 32;
var CELL_SIZE = 3;
var AttributeData = (function () {
    function AttributeData() {
        this.fg = 0;
        this.bg = 0;
    }
    AttributeData.toColorRGB = function (value) {
        return [
            value >>> 16 & 255,
            value >>> 8 & 255,
            value & 255
        ];
    };
    AttributeData.fromColorRGB = function (value) {
        return (value[0] & 255) << 16 | (value[1] & 255) << 8 | value[2] & 255;
    };
    AttributeData.prototype.clone = function () {
        var newObj = new AttributeData();
        newObj.fg = this.fg;
        newObj.bg = this.bg;
        return newObj;
    };
    AttributeData.prototype.isInverse = function () { return this.fg & 67108864; };
    AttributeData.prototype.isBold = function () { return this.fg & 134217728; };
    AttributeData.prototype.isUnderline = function () { return this.fg & 268435456; };
    AttributeData.prototype.isBlink = function () { return this.fg & 536870912; };
    AttributeData.prototype.isInvisible = function () { return this.fg & 1073741824; };
    AttributeData.prototype.isItalic = function () { return this.bg & 67108864; };
    AttributeData.prototype.isDim = function () { return this.bg & 134217728; };
    AttributeData.prototype.getFgColorMode = function () { return this.fg & 50331648; };
    AttributeData.prototype.getBgColorMode = function () { return this.bg & 50331648; };
    AttributeData.prototype.isFgRGB = function () { return (this.fg & 50331648) === 50331648; };
    AttributeData.prototype.isBgRGB = function () { return (this.bg & 50331648) === 50331648; };
    AttributeData.prototype.isFgPalette = function () { return (this.fg & 50331648) === 16777216 || (this.fg & 50331648) === 33554432; };
    AttributeData.prototype.isBgPalette = function () { return (this.bg & 50331648) === 16777216 || (this.bg & 50331648) === 33554432; };
    AttributeData.prototype.isFgDefault = function () { return (this.fg & 50331648) === 0; };
    AttributeData.prototype.isBgDefault = function () { return (this.bg & 50331648) === 0; };
    AttributeData.prototype.getFgColor = function () {
        switch (this.fg & 50331648) {
            case 16777216:
            case 33554432: return this.fg & 255;
            case 50331648: return this.fg & 16777215;
            default: return -1;
        }
    };
    AttributeData.prototype.getBgColor = function () {
        switch (this.bg & 50331648) {
            case 16777216:
            case 33554432: return this.bg & 255;
            case 50331648: return this.bg & 16777215;
            default: return -1;
        }
    };
    return AttributeData;
}());
exports.AttributeData = AttributeData;
exports.DEFAULT_ATTR_DATA = new AttributeData();
var CellData = (function (_super) {
    __extends(CellData, _super);
    function CellData() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.content = 0;
        _this.fg = 0;
        _this.bg = 0;
        _this.combinedData = '';
        return _this;
    }
    CellData.fromCharData = function (value) {
        var obj = new CellData();
        obj.setFromCharData(value);
        return obj;
    };
    CellData.prototype.isCombined = function () {
        return this.content & 2097152;
    };
    CellData.prototype.getWidth = function () {
        return this.content >> 22;
    };
    CellData.prototype.getChars = function () {
        if (this.content & 2097152) {
            return this.combinedData;
        }
        if (this.content & 2097151) {
            return TextDecoder_1.stringFromCodePoint(this.content & 2097151);
        }
        return '';
    };
    CellData.prototype.getCode = function () {
        return (this.isCombined())
            ? this.combinedData.charCodeAt(this.combinedData.length - 1)
            : this.content & 2097151;
    };
    CellData.prototype.setFromCharData = function (value) {
        this.fg = value[exports.CHAR_DATA_ATTR_INDEX];
        this.bg = 0;
        var combined = false;
        if (value[exports.CHAR_DATA_CHAR_INDEX].length > 2) {
            combined = true;
        }
        else if (value[exports.CHAR_DATA_CHAR_INDEX].length === 2) {
            var code = value[exports.CHAR_DATA_CHAR_INDEX].charCodeAt(0);
            if (0xD800 <= code && code <= 0xDBFF) {
                var second = value[exports.CHAR_DATA_CHAR_INDEX].charCodeAt(1);
                if (0xDC00 <= second && second <= 0xDFFF) {
                    this.content = ((code - 0xD800) * 0x400 + second - 0xDC00 + 0x10000) | (value[exports.CHAR_DATA_WIDTH_INDEX] << 22);
                }
                else {
                    combined = true;
                }
            }
            else {
                combined = true;
            }
        }
        else {
            this.content = value[exports.CHAR_DATA_CHAR_INDEX].charCodeAt(0) | (value[exports.CHAR_DATA_WIDTH_INDEX] << 22);
        }
        if (combined) {
            this.combinedData = value[exports.CHAR_DATA_CHAR_INDEX];
            this.content = 2097152 | (value[exports.CHAR_DATA_WIDTH_INDEX] << 22);
        }
    };
    CellData.prototype.getAsCharData = function () {
        return [this.fg, this.getChars(), this.getWidth(), this.getCode()];
    };
    return CellData;
}(AttributeData));
exports.CellData = CellData;
var BufferLine = (function () {
    function BufferLine(cols, fillCellData, isWrapped) {
        if (isWrapped === void 0) { isWrapped = false; }
        this.isWrapped = isWrapped;
        this._combined = {};
        this._data = new Uint32Array(cols * CELL_SIZE);
        var cell = fillCellData || CellData.fromCharData([0, exports.NULL_CELL_CHAR, exports.NULL_CELL_WIDTH, exports.NULL_CELL_CODE]);
        for (var i = 0; i < cols; ++i) {
            this.setCell(i, cell);
        }
        this.length = cols;
    }
    BufferLine.prototype.get = function (index) {
        var content = this._data[index * CELL_SIZE + 0];
        var cp = content & 2097151;
        return [
            this._data[index * CELL_SIZE + 1],
            (content & 2097152)
                ? this._combined[index]
                : (cp) ? TextDecoder_1.stringFromCodePoint(cp) : '',
            content >> 22,
            (content & 2097152)
                ? this._combined[index].charCodeAt(this._combined[index].length - 1)
                : cp
        ];
    };
    BufferLine.prototype.set = function (index, value) {
        this._data[index * CELL_SIZE + 1] = value[exports.CHAR_DATA_ATTR_INDEX];
        if (value[exports.CHAR_DATA_CHAR_INDEX].length > 1) {
            this._combined[index] = value[1];
            this._data[index * CELL_SIZE + 0] = index | 2097152 | (value[exports.CHAR_DATA_WIDTH_INDEX] << 22);
        }
        else {
            this._data[index * CELL_SIZE + 0] = value[exports.CHAR_DATA_CHAR_INDEX].charCodeAt(0) | (value[exports.CHAR_DATA_WIDTH_INDEX] << 22);
        }
    };
    BufferLine.prototype.getWidth = function (index) {
        return this._data[index * CELL_SIZE + 0] >> 22;
    };
    BufferLine.prototype.hasWidth = function (index) {
        return this._data[index * CELL_SIZE + 0] & 12582912;
    };
    BufferLine.prototype.getFg = function (index) {
        return this._data[index * CELL_SIZE + 1];
    };
    BufferLine.prototype.getBg = function (index) {
        return this._data[index * CELL_SIZE + 2];
    };
    BufferLine.prototype.hasContent = function (index) {
        return this._data[index * CELL_SIZE + 0] & 4194303;
    };
    BufferLine.prototype.getCodePoint = function (index) {
        var content = this._data[index * CELL_SIZE + 0];
        if (content & 2097152) {
            return this._combined[index].charCodeAt(this._combined[index].length - 1);
        }
        return content & 2097151;
    };
    BufferLine.prototype.isCombined = function (index) {
        return this._data[index * CELL_SIZE + 0] & 2097152;
    };
    BufferLine.prototype.getString = function (index) {
        var content = this._data[index * CELL_SIZE + 0];
        if (content & 2097152) {
            return this._combined[index];
        }
        if (content & 2097151) {
            return TextDecoder_1.stringFromCodePoint(content & 2097151);
        }
        return '';
    };
    BufferLine.prototype.loadCell = function (index, cell) {
        var startIndex = index * CELL_SIZE;
        cell.content = this._data[startIndex + 0];
        cell.fg = this._data[startIndex + 1];
        cell.bg = this._data[startIndex + 2];
        if (cell.content & 2097152) {
            cell.combinedData = this._combined[index];
        }
        return cell;
    };
    BufferLine.prototype.setCell = function (index, cell) {
        if (cell.content & 2097152) {
            this._combined[index] = cell.combinedData;
        }
        this._data[index * CELL_SIZE + 0] = cell.content;
        this._data[index * CELL_SIZE + 1] = cell.fg;
        this._data[index * CELL_SIZE + 2] = cell.bg;
    };
    BufferLine.prototype.setCellFromCodePoint = function (index, codePoint, width, fg, bg) {
        this._data[index * CELL_SIZE + 0] = codePoint | (width << 22);
        this._data[index * CELL_SIZE + 1] = fg;
        this._data[index * CELL_SIZE + 2] = bg;
    };
    BufferLine.prototype.addCodepointToCell = function (index, codePoint) {
        var content = this._data[index * CELL_SIZE + 0];
        if (content & 2097152) {
            this._combined[index] += TextDecoder_1.stringFromCodePoint(codePoint);
        }
        else {
            if (content & 2097151) {
                this._combined[index] = TextDecoder_1.stringFromCodePoint(content & 2097151) + TextDecoder_1.stringFromCodePoint(codePoint);
                content &= ~2097151;
                content |= 2097152;
            }
            else {
                content = codePoint | (1 << 22);
            }
            this._data[index * CELL_SIZE + 0] = content;
        }
    };
    BufferLine.prototype.insertCells = function (pos, n, fillCellData) {
        pos %= this.length;
        if (n < this.length - pos) {
            var cell = new CellData();
            for (var i = this.length - pos - n - 1; i >= 0; --i) {
                this.setCell(pos + n + i, this.loadCell(pos + i, cell));
            }
            for (var i = 0; i < n; ++i) {
                this.setCell(pos + i, fillCellData);
            }
        }
        else {
            for (var i = pos; i < this.length; ++i) {
                this.setCell(i, fillCellData);
            }
        }
    };
    BufferLine.prototype.deleteCells = function (pos, n, fillCellData) {
        pos %= this.length;
        if (n < this.length - pos) {
            var cell = new CellData();
            for (var i = 0; i < this.length - pos - n; ++i) {
                this.setCell(pos + i, this.loadCell(pos + n + i, cell));
            }
            for (var i = this.length - n; i < this.length; ++i) {
                this.setCell(i, fillCellData);
            }
        }
        else {
            for (var i = pos; i < this.length; ++i) {
                this.setCell(i, fillCellData);
            }
        }
    };
    BufferLine.prototype.replaceCells = function (start, end, fillCellData) {
        while (start < end && start < this.length) {
            this.setCell(start++, fillCellData);
        }
    };
    BufferLine.prototype.resize = function (cols, fillCellData) {
        if (cols === this.length) {
            return;
        }
        if (cols > this.length) {
            var data = new Uint32Array(cols * CELL_SIZE);
            if (this.length) {
                if (cols * CELL_SIZE < this._data.length) {
                    data.set(this._data.subarray(0, cols * CELL_SIZE));
                }
                else {
                    data.set(this._data);
                }
            }
            this._data = data;
            for (var i = this.length; i < cols; ++i) {
                this.setCell(i, fillCellData);
            }
        }
        else {
            if (cols) {
                var data = new Uint32Array(cols * CELL_SIZE);
                data.set(this._data.subarray(0, cols * CELL_SIZE));
                this._data = data;
                var keys = Object.keys(this._combined);
                for (var i = 0; i < keys.length; i++) {
                    var key = parseInt(keys[i], 10);
                    if (key >= cols) {
                        delete this._combined[key];
                    }
                }
            }
            else {
                this._data = new Uint32Array(0);
                this._combined = {};
            }
        }
        this.length = cols;
    };
    BufferLine.prototype.fill = function (fillCellData) {
        this._combined = {};
        for (var i = 0; i < this.length; ++i) {
            this.setCell(i, fillCellData);
        }
    };
    BufferLine.prototype.copyFrom = function (line) {
        if (this.length !== line.length) {
            this._data = new Uint32Array(line._data);
        }
        else {
            this._data.set(line._data);
        }
        this.length = line.length;
        this._combined = {};
        for (var el in line._combined) {
            this._combined[el] = line._combined[el];
        }
        this.isWrapped = line.isWrapped;
    };
    BufferLine.prototype.clone = function () {
        var newLine = new BufferLine(0);
        newLine._data = new Uint32Array(this._data);
        newLine.length = this.length;
        for (var el in this._combined) {
            newLine._combined[el] = this._combined[el];
        }
        newLine.isWrapped = this.isWrapped;
        return newLine;
    };
    BufferLine.prototype.getTrimmedLength = function () {
        for (var i = this.length - 1; i >= 0; --i) {
            if ((this._data[i * CELL_SIZE + 0] & 4194303)) {
                return i + (this._data[i * CELL_SIZE + 0] >> 22);
            }
        }
        return 0;
    };
    BufferLine.prototype.copyCellsFrom = function (src, srcCol, destCol, length, applyInReverse) {
        var srcData = src._data;
        if (applyInReverse) {
            for (var cell = length - 1; cell >= 0; cell--) {
                for (var i = 0; i < CELL_SIZE; i++) {
                    this._data[(destCol + cell) * CELL_SIZE + i] = srcData[(srcCol + cell) * CELL_SIZE + i];
                }
            }
        }
        else {
            for (var cell = 0; cell < length; cell++) {
                for (var i = 0; i < CELL_SIZE; i++) {
                    this._data[(destCol + cell) * CELL_SIZE + i] = srcData[(srcCol + cell) * CELL_SIZE + i];
                }
            }
        }
        var srcCombinedKeys = Object.keys(src._combined);
        for (var i = 0; i < srcCombinedKeys.length; i++) {
            var key = parseInt(srcCombinedKeys[i], 10);
            if (key >= srcCol) {
                this._combined[key - srcCol + destCol] = src._combined[key];
            }
        }
    };
    BufferLine.prototype.translateToString = function (trimRight, startCol, endCol) {
        if (trimRight === void 0) { trimRight = false; }
        if (startCol === void 0) { startCol = 0; }
        if (endCol === void 0) { endCol = this.length; }
        if (trimRight) {
            endCol = Math.min(endCol, this.getTrimmedLength());
        }
        var result = '';
        while (startCol < endCol) {
            var content = this._data[startCol * CELL_SIZE + 0];
            var cp = content & 2097151;
            result += (content & 2097152) ? this._combined[startCol] : (cp) ? TextDecoder_1.stringFromCodePoint(cp) : exports.WHITESPACE_CELL_CHAR;
            startCol += (content >> 22) || 1;
        }
        return result;
    };
    return BufferLine;
}());
exports.BufferLine = BufferLine;
//# sourceMappingURL=BufferLine.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/core/data/Charsets.js":
/*!******************************************************!*\
  !*** ./node_modules/xterm/lib/core/data/Charsets.js ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.CHARSETS = {};
exports.DEFAULT_CHARSET = exports.CHARSETS['B'];
exports.CHARSETS['0'] = {
    '`': '\u25c6',
    'a': '\u2592',
    'b': '\u0009',
    'c': '\u000c',
    'd': '\u000d',
    'e': '\u000a',
    'f': '\u00b0',
    'g': '\u00b1',
    'h': '\u2424',
    'i': '\u000b',
    'j': '\u2518',
    'k': '\u2510',
    'l': '\u250c',
    'm': '\u2514',
    'n': '\u253c',
    'o': '\u23ba',
    'p': '\u23bb',
    'q': '\u2500',
    'r': '\u23bc',
    's': '\u23bd',
    't': '\u251c',
    'u': '\u2524',
    'v': '\u2534',
    'w': '\u252c',
    'x': '\u2502',
    'y': '\u2264',
    'z': '\u2265',
    '{': '\u03c0',
    '|': '\u2260',
    '}': '\u00a3',
    '~': '\u00b7'
};
exports.CHARSETS['A'] = {
    '#': '£'
};
exports.CHARSETS['B'] = null;
exports.CHARSETS['4'] = {
    '#': '£',
    '@': '¾',
    '[': 'ij',
    '\\': '½',
    ']': '|',
    '{': '¨',
    '|': 'f',
    '}': '¼',
    '~': '´'
};
exports.CHARSETS['C'] =
    exports.CHARSETS['5'] = {
        '[': 'Ä',
        '\\': 'Ö',
        ']': 'Å',
        '^': 'Ü',
        '`': 'é',
        '{': 'ä',
        '|': 'ö',
        '}': 'å',
        '~': 'ü'
    };
exports.CHARSETS['R'] = {
    '#': '£',
    '@': 'à',
    '[': '°',
    '\\': 'ç',
    ']': '§',
    '{': 'é',
    '|': 'ù',
    '}': 'è',
    '~': '¨'
};
exports.CHARSETS['Q'] = {
    '@': 'à',
    '[': 'â',
    '\\': 'ç',
    ']': 'ê',
    '^': 'î',
    '`': 'ô',
    '{': 'é',
    '|': 'ù',
    '}': 'è',
    '~': 'û'
};
exports.CHARSETS['K'] = {
    '@': '§',
    '[': 'Ä',
    '\\': 'Ö',
    ']': 'Ü',
    '{': 'ä',
    '|': 'ö',
    '}': 'ü',
    '~': 'ß'
};
exports.CHARSETS['Y'] = {
    '#': '£',
    '@': '§',
    '[': '°',
    '\\': 'ç',
    ']': 'é',
    '`': 'ù',
    '{': 'à',
    '|': 'ò',
    '}': 'è',
    '~': 'ì'
};
exports.CHARSETS['E'] =
    exports.CHARSETS['6'] = {
        '@': 'Ä',
        '[': 'Æ',
        '\\': 'Ø',
        ']': 'Å',
        '^': 'Ü',
        '`': 'ä',
        '{': 'æ',
        '|': 'ø',
        '}': 'å',
        '~': 'ü'
    };
exports.CHARSETS['Z'] = {
    '#': '£',
    '@': '§',
    '[': '¡',
    '\\': 'Ñ',
    ']': '¿',
    '{': '°',
    '|': 'ñ',
    '}': 'ç'
};
exports.CHARSETS['H'] =
    exports.CHARSETS['7'] = {
        '@': 'É',
        '[': 'Ä',
        '\\': 'Ö',
        ']': 'Å',
        '^': 'Ü',
        '`': 'é',
        '{': 'ä',
        '|': 'ö',
        '}': 'å',
        '~': 'ü'
    };
exports.CHARSETS['='] = {
    '#': 'ù',
    '@': 'à',
    '[': 'é',
    '\\': 'ç',
    ']': 'ê',
    '^': 'î',
    '_': 'è',
    '`': 'ô',
    '{': 'ä',
    '|': 'ö',
    '}': 'ü',
    '~': 'û'
};
//# sourceMappingURL=Charsets.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/core/input/Keyboard.js":
/*!*******************************************************!*\
  !*** ./node_modules/xterm/lib/core/input/Keyboard.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var EscapeSequences_1 = __webpack_require__(/*! ../../common/data/EscapeSequences */ "./node_modules/xterm/lib/common/data/EscapeSequences.js");
var KEYCODE_KEY_MAPPINGS = {
    48: ['0', ')'],
    49: ['1', '!'],
    50: ['2', '@'],
    51: ['3', '#'],
    52: ['4', '$'],
    53: ['5', '%'],
    54: ['6', '^'],
    55: ['7', '&'],
    56: ['8', '*'],
    57: ['9', '('],
    186: [';', ':'],
    187: ['=', '+'],
    188: [',', '<'],
    189: ['-', '_'],
    190: ['.', '>'],
    191: ['/', '?'],
    192: ['`', '~'],
    219: ['[', '{'],
    220: ['\\', '|'],
    221: [']', '}'],
    222: ['\'', '"']
};
function evaluateKeyboardEvent(ev, applicationCursorMode, isMac, macOptionIsMeta) {
    var result = {
        type: 0,
        cancel: false,
        key: undefined
    };
    var modifiers = (ev.shiftKey ? 1 : 0) | (ev.altKey ? 2 : 0) | (ev.ctrlKey ? 4 : 0) | (ev.metaKey ? 8 : 0);
    switch (ev.keyCode) {
        case 0:
            if (ev.key === 'UIKeyInputUpArrow') {
                if (applicationCursorMode) {
                    result.key = EscapeSequences_1.C0.ESC + 'OA';
                }
                else {
                    result.key = EscapeSequences_1.C0.ESC + '[A';
                }
            }
            else if (ev.key === 'UIKeyInputLeftArrow') {
                if (applicationCursorMode) {
                    result.key = EscapeSequences_1.C0.ESC + 'OD';
                }
                else {
                    result.key = EscapeSequences_1.C0.ESC + '[D';
                }
            }
            else if (ev.key === 'UIKeyInputRightArrow') {
                if (applicationCursorMode) {
                    result.key = EscapeSequences_1.C0.ESC + 'OC';
                }
                else {
                    result.key = EscapeSequences_1.C0.ESC + '[C';
                }
            }
            else if (ev.key === 'UIKeyInputDownArrow') {
                if (applicationCursorMode) {
                    result.key = EscapeSequences_1.C0.ESC + 'OB';
                }
                else {
                    result.key = EscapeSequences_1.C0.ESC + '[B';
                }
            }
            break;
        case 8:
            if (ev.shiftKey) {
                result.key = EscapeSequences_1.C0.BS;
                break;
            }
            else if (ev.altKey) {
                result.key = EscapeSequences_1.C0.ESC + EscapeSequences_1.C0.DEL;
                break;
            }
            result.key = EscapeSequences_1.C0.DEL;
            break;
        case 9:
            if (ev.shiftKey) {
                result.key = EscapeSequences_1.C0.ESC + '[Z';
                break;
            }
            result.key = EscapeSequences_1.C0.HT;
            result.cancel = true;
            break;
        case 13:
            result.key = EscapeSequences_1.C0.CR;
            result.cancel = true;
            break;
        case 27:
            result.key = EscapeSequences_1.C0.ESC;
            result.cancel = true;
            break;
        case 37:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[1;' + (modifiers + 1) + 'D';
                if (result.key === EscapeSequences_1.C0.ESC + '[1;3D') {
                    result.key = isMac ? EscapeSequences_1.C0.ESC + 'b' : EscapeSequences_1.C0.ESC + '[1;5D';
                }
            }
            else if (applicationCursorMode) {
                result.key = EscapeSequences_1.C0.ESC + 'OD';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[D';
            }
            break;
        case 39:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[1;' + (modifiers + 1) + 'C';
                if (result.key === EscapeSequences_1.C0.ESC + '[1;3C') {
                    result.key = isMac ? EscapeSequences_1.C0.ESC + 'f' : EscapeSequences_1.C0.ESC + '[1;5C';
                }
            }
            else if (applicationCursorMode) {
                result.key = EscapeSequences_1.C0.ESC + 'OC';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[C';
            }
            break;
        case 38:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[1;' + (modifiers + 1) + 'A';
                if (result.key === EscapeSequences_1.C0.ESC + '[1;3A') {
                    result.key = EscapeSequences_1.C0.ESC + '[1;5A';
                }
            }
            else if (applicationCursorMode) {
                result.key = EscapeSequences_1.C0.ESC + 'OA';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[A';
            }
            break;
        case 40:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[1;' + (modifiers + 1) + 'B';
                if (result.key === EscapeSequences_1.C0.ESC + '[1;3B') {
                    result.key = EscapeSequences_1.C0.ESC + '[1;5B';
                }
            }
            else if (applicationCursorMode) {
                result.key = EscapeSequences_1.C0.ESC + 'OB';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[B';
            }
            break;
        case 45:
            if (!ev.shiftKey && !ev.ctrlKey) {
                result.key = EscapeSequences_1.C0.ESC + '[2~';
            }
            break;
        case 46:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[3;' + (modifiers + 1) + '~';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[3~';
            }
            break;
        case 36:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[1;' + (modifiers + 1) + 'H';
            }
            else if (applicationCursorMode) {
                result.key = EscapeSequences_1.C0.ESC + 'OH';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[H';
            }
            break;
        case 35:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[1;' + (modifiers + 1) + 'F';
            }
            else if (applicationCursorMode) {
                result.key = EscapeSequences_1.C0.ESC + 'OF';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[F';
            }
            break;
        case 33:
            if (ev.shiftKey) {
                result.type = 2;
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[5~';
            }
            break;
        case 34:
            if (ev.shiftKey) {
                result.type = 3;
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[6~';
            }
            break;
        case 112:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[1;' + (modifiers + 1) + 'P';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + 'OP';
            }
            break;
        case 113:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[1;' + (modifiers + 1) + 'Q';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + 'OQ';
            }
            break;
        case 114:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[1;' + (modifiers + 1) + 'R';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + 'OR';
            }
            break;
        case 115:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[1;' + (modifiers + 1) + 'S';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + 'OS';
            }
            break;
        case 116:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[15;' + (modifiers + 1) + '~';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[15~';
            }
            break;
        case 117:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[17;' + (modifiers + 1) + '~';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[17~';
            }
            break;
        case 118:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[18;' + (modifiers + 1) + '~';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[18~';
            }
            break;
        case 119:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[19;' + (modifiers + 1) + '~';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[19~';
            }
            break;
        case 120:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[20;' + (modifiers + 1) + '~';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[20~';
            }
            break;
        case 121:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[21;' + (modifiers + 1) + '~';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[21~';
            }
            break;
        case 122:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[23;' + (modifiers + 1) + '~';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[23~';
            }
            break;
        case 123:
            if (modifiers) {
                result.key = EscapeSequences_1.C0.ESC + '[24;' + (modifiers + 1) + '~';
            }
            else {
                result.key = EscapeSequences_1.C0.ESC + '[24~';
            }
            break;
        default:
            if (ev.ctrlKey && !ev.shiftKey && !ev.altKey && !ev.metaKey) {
                if (ev.keyCode >= 65 && ev.keyCode <= 90) {
                    result.key = String.fromCharCode(ev.keyCode - 64);
                }
                else if (ev.keyCode === 32) {
                    result.key = String.fromCharCode(0);
                }
                else if (ev.keyCode >= 51 && ev.keyCode <= 55) {
                    result.key = String.fromCharCode(ev.keyCode - 51 + 27);
                }
                else if (ev.keyCode === 56) {
                    result.key = String.fromCharCode(127);
                }
                else if (ev.keyCode === 219) {
                    result.key = String.fromCharCode(27);
                }
                else if (ev.keyCode === 220) {
                    result.key = String.fromCharCode(28);
                }
                else if (ev.keyCode === 221) {
                    result.key = String.fromCharCode(29);
                }
            }
            else if ((!isMac || macOptionIsMeta) && ev.altKey && !ev.metaKey) {
                var keyMapping = KEYCODE_KEY_MAPPINGS[ev.keyCode];
                var key = keyMapping && keyMapping[!ev.shiftKey ? 0 : 1];
                if (key) {
                    result.key = EscapeSequences_1.C0.ESC + key;
                }
                else if (ev.keyCode >= 65 && ev.keyCode <= 90) {
                    var keyCode = ev.ctrlKey ? ev.keyCode - 64 : ev.keyCode + 32;
                    result.key = EscapeSequences_1.C0.ESC + String.fromCharCode(keyCode);
                }
            }
            else if (isMac && !ev.altKey && !ev.ctrlKey && ev.metaKey) {
                if (ev.keyCode === 65) {
                    result.type = 1;
                }
            }
            else if (ev.key && !ev.ctrlKey && !ev.altKey && !ev.metaKey && ev.keyCode >= 48 && ev.key.length === 1) {
                result.key = ev.key;
            }
            else if (ev.key && ev.ctrlKey) {
                if (ev.key === '_') {
                    result.key = EscapeSequences_1.C0.US;
                }
            }
            break;
    }
    return result;
}
exports.evaluateKeyboardEvent = evaluateKeyboardEvent;
//# sourceMappingURL=Keyboard.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/core/input/TextDecoder.js":
/*!**********************************************************!*\
  !*** ./node_modules/xterm/lib/core/input/TextDecoder.js ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var StringToUtf32 = (function () {
    function StringToUtf32() {
        this._interim = 0;
    }
    StringToUtf32.prototype.clear = function () {
        this._interim = 0;
    };
    StringToUtf32.prototype.decode = function (input, target) {
        var length = input.length;
        if (!length) {
            return 0;
        }
        var size = 0;
        var startPos = 0;
        if (this._interim) {
            var second = input.charCodeAt(startPos++);
            if (0xDC00 <= second && second <= 0xDFFF) {
                target[size++] = (this._interim - 0xD800) * 0x400 + second - 0xDC00 + 0x10000;
            }
            else {
                target[size++] = this._interim;
                target[size++] = second;
            }
            this._interim = 0;
        }
        for (var i = startPos; i < length; ++i) {
            var code = input.charCodeAt(i);
            if (0xD800 <= code && code <= 0xDBFF) {
                if (++i >= length) {
                    this._interim = code;
                    return size;
                }
                var second = input.charCodeAt(i);
                if (0xDC00 <= second && second <= 0xDFFF) {
                    target[size++] = (code - 0xD800) * 0x400 + second - 0xDC00 + 0x10000;
                }
                else {
                    target[size++] = code;
                    target[size++] = second;
                }
                continue;
            }
            target[size++] = code;
        }
        return size;
    };
    return StringToUtf32;
}());
exports.StringToUtf32 = StringToUtf32;
function stringFromCodePoint(codePoint) {
    if (codePoint > 0xFFFF) {
        codePoint -= 0x10000;
        return String.fromCharCode((codePoint >> 10) + 0xD800) + String.fromCharCode((codePoint % 0x400) + 0xDC00);
    }
    return String.fromCharCode(codePoint);
}
exports.stringFromCodePoint = stringFromCodePoint;
function utf32ToString(data, start, end) {
    if (start === void 0) { start = 0; }
    if (end === void 0) { end = data.length; }
    var result = '';
    for (var i = start; i < end; ++i) {
        var codepoint = data[i];
        if (codepoint > 0xFFFF) {
            codepoint -= 0x10000;
            result += String.fromCharCode((codepoint >> 10) + 0xD800) + String.fromCharCode((codepoint % 0x400) + 0xDC00);
        }
        else {
            result += String.fromCharCode(codepoint);
        }
    }
    return result;
}
exports.utf32ToString = utf32ToString;
//# sourceMappingURL=TextDecoder.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/handlers/AltClickHandler.js":
/*!************************************************************!*\
  !*** ./node_modules/xterm/lib/handlers/AltClickHandler.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var EscapeSequences_1 = __webpack_require__(/*! ../common/data/EscapeSequences */ "./node_modules/xterm/lib/common/data/EscapeSequences.js");
var AltClickHandler = (function () {
    function AltClickHandler(_mouseEvent, _terminal) {
        var _a;
        this._mouseEvent = _mouseEvent;
        this._terminal = _terminal;
        this._lines = this._terminal.buffer.lines;
        this._startCol = this._terminal.buffer.x;
        this._startRow = this._terminal.buffer.y;
        var coordinates = this._terminal.mouseHelper.getCoords(this._mouseEvent, this._terminal.element, this._terminal.charMeasure, this._terminal.cols, this._terminal.rows, false);
        if (coordinates) {
            _a = coordinates.map(function (coordinate) {
                return coordinate - 1;
            }), this._endCol = _a[0], this._endRow = _a[1];
        }
    }
    AltClickHandler.prototype.move = function () {
        if (this._mouseEvent.altKey && this._endCol !== undefined && this._endRow !== undefined) {
            this._terminal.handler(this._arrowSequences());
        }
    };
    AltClickHandler.prototype._arrowSequences = function () {
        if (!this._terminal.buffer.hasScrollback) {
            return this._resetStartingRow() + this._moveToRequestedRow() + this._moveToRequestedCol();
        }
        return this._moveHorizontallyOnly();
    };
    AltClickHandler.prototype._resetStartingRow = function () {
        if (this._moveToRequestedRow().length === 0) {
            return '';
        }
        return repeat(this._bufferLine(this._startCol, this._startRow, this._startCol, this._startRow - this._wrappedRowsForRow(this._startRow), false).length, this._sequence("D"));
    };
    AltClickHandler.prototype._moveToRequestedRow = function () {
        var startRow = this._startRow - this._wrappedRowsForRow(this._startRow);
        var endRow = this._endRow - this._wrappedRowsForRow(this._endRow);
        var rowsToMove = Math.abs(startRow - endRow) - this._wrappedRowsCount();
        return repeat(rowsToMove, this._sequence(this._verticalDirection()));
    };
    AltClickHandler.prototype._moveToRequestedCol = function () {
        var startRow;
        if (this._moveToRequestedRow().length > 0) {
            startRow = this._endRow - this._wrappedRowsForRow(this._endRow);
        }
        else {
            startRow = this._startRow;
        }
        var endRow = this._endRow;
        var direction = this._horizontalDirection();
        return repeat(this._bufferLine(this._startCol, startRow, this._endCol, endRow, direction === "C").length, this._sequence(direction));
    };
    AltClickHandler.prototype._moveHorizontallyOnly = function () {
        var direction = this._horizontalDirection();
        return repeat(Math.abs(this._startCol - this._endCol), this._sequence(direction));
    };
    AltClickHandler.prototype._wrappedRowsCount = function () {
        var wrappedRows = 0;
        var startRow = this._startRow - this._wrappedRowsForRow(this._startRow);
        var endRow = this._endRow - this._wrappedRowsForRow(this._endRow);
        for (var i = 0; i < Math.abs(startRow - endRow); i++) {
            var direction = this._verticalDirection() === "A" ? -1 : 1;
            if (this._lines.get(startRow + (direction * i)).isWrapped) {
                wrappedRows++;
            }
        }
        return wrappedRows;
    };
    AltClickHandler.prototype._wrappedRowsForRow = function (currentRow) {
        var rowCount = 0;
        var lineWraps = this._lines.get(currentRow).isWrapped;
        while (lineWraps && currentRow >= 0 && currentRow < this._terminal.rows) {
            rowCount++;
            currentRow--;
            lineWraps = this._lines.get(currentRow).isWrapped;
        }
        return rowCount;
    };
    AltClickHandler.prototype._horizontalDirection = function () {
        var startRow;
        if (this._moveToRequestedRow().length > 0) {
            startRow = this._endRow - this._wrappedRowsForRow(this._endRow);
        }
        else {
            startRow = this._startRow;
        }
        if ((this._startCol < this._endCol &&
            startRow <= this._endRow) ||
            (this._startCol >= this._endCol &&
                startRow < this._endRow)) {
            return "C";
        }
        return "D";
    };
    AltClickHandler.prototype._verticalDirection = function () {
        if (this._startRow > this._endRow) {
            return "A";
        }
        return "B";
    };
    AltClickHandler.prototype._bufferLine = function (startCol, startRow, endCol, endRow, forward) {
        var currentCol = startCol;
        var currentRow = startRow;
        var bufferStr = '';
        while (currentCol !== endCol || currentRow !== endRow) {
            currentCol += forward ? 1 : -1;
            if (forward && currentCol > this._terminal.cols - 1) {
                bufferStr += this._terminal.buffer.translateBufferLineToString(currentRow, false, startCol, currentCol);
                currentCol = 0;
                startCol = 0;
                currentRow++;
            }
            else if (!forward && currentCol < 0) {
                bufferStr += this._terminal.buffer.translateBufferLineToString(currentRow, false, 0, startCol + 1);
                currentCol = this._terminal.cols - 1;
                startCol = currentCol;
                currentRow--;
            }
        }
        return bufferStr + this._terminal.buffer.translateBufferLineToString(currentRow, false, startCol, currentCol);
    };
    AltClickHandler.prototype._sequence = function (direction) {
        var mod = this._terminal.applicationCursor ? 'O' : '[';
        return EscapeSequences_1.C0.ESC + mod + direction;
    };
    return AltClickHandler;
}());
exports.AltClickHandler = AltClickHandler;
function repeat(count, str) {
    count = Math.floor(count);
    var rpt = '';
    for (var i = 0; i < count; i++) {
        rpt += str;
    }
    return rpt;
}
//# sourceMappingURL=AltClickHandler.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/public/AddonManager.js":
/*!*******************************************************!*\
  !*** ./node_modules/xterm/lib/public/AddonManager.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var AddonManager = (function () {
    function AddonManager() {
        this._addons = [];
    }
    AddonManager.prototype.dispose = function () {
        for (var i = this._addons.length - 1; i >= 0; i--) {
            this._addons[i].instance.dispose();
        }
    };
    AddonManager.prototype.loadAddon = function (terminal, instance) {
        var _this = this;
        var loadedAddon = {
            instance: instance,
            dispose: instance.dispose,
            isDisposed: false
        };
        this._addons.push(loadedAddon);
        instance.dispose = function () { return _this._wrappedAddonDispose(loadedAddon); };
        instance.activate(terminal);
    };
    AddonManager.prototype._wrappedAddonDispose = function (loadedAddon) {
        if (loadedAddon.isDisposed) {
            return;
        }
        var index = -1;
        for (var i = 0; i < this._addons.length; i++) {
            if (this._addons[i] === loadedAddon) {
                index = i;
                break;
            }
        }
        if (index === -1) {
            throw new Error('Could not dispose an addon that has not been loaded');
        }
        loadedAddon.isDisposed = true;
        loadedAddon.dispose();
        this._addons.splice(index, 1);
    };
    return AddonManager;
}());
exports.AddonManager = AddonManager;
//# sourceMappingURL=AddonManager.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/public/Terminal.js":
/*!***************************************************!*\
  !*** ./node_modules/xterm/lib/public/Terminal.js ***!
  \***************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var Terminal_1 = __webpack_require__(/*! ../Terminal */ "./node_modules/xterm/lib/Terminal.js");
var Strings = __webpack_require__(/*! ../Strings */ "./node_modules/xterm/lib/Strings.js");
var AddonManager_1 = __webpack_require__(/*! ./AddonManager */ "./node_modules/xterm/lib/public/AddonManager.js");
var Terminal = (function () {
    function Terminal(options) {
        this._core = new Terminal_1.Terminal(options);
        this._addonManager = new AddonManager_1.AddonManager();
    }
    Object.defineProperty(Terminal.prototype, "onCursorMove", {
        get: function () { return this._core.onCursorMove; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "onLineFeed", {
        get: function () { return this._core.onLineFeed; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "onSelectionChange", {
        get: function () { return this._core.onSelectionChange; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "onData", {
        get: function () { return this._core.onData; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "onTitleChange", {
        get: function () { return this._core.onTitleChange; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "onScroll", {
        get: function () { return this._core.onScroll; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "onKey", {
        get: function () { return this._core.onKey; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "onRender", {
        get: function () { return this._core.onRender; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "onResize", {
        get: function () { return this._core.onResize; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "element", {
        get: function () { return this._core.element; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "textarea", {
        get: function () { return this._core.textarea; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "rows", {
        get: function () { return this._core.rows; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "cols", {
        get: function () { return this._core.cols; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "buffer", {
        get: function () { return new BufferApiView(this._core.buffer); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Terminal.prototype, "markers", {
        get: function () { return this._core.markers; },
        enumerable: true,
        configurable: true
    });
    Terminal.prototype.blur = function () {
        this._core.blur();
    };
    Terminal.prototype.focus = function () {
        this._core.focus();
    };
    Terminal.prototype.on = function (type, listener) {
        this._core.on(type, listener);
    };
    Terminal.prototype.off = function (type, listener) {
        this._core.off(type, listener);
    };
    Terminal.prototype.emit = function (type, data) {
        this._core.emit(type, data);
    };
    Terminal.prototype.addDisposableListener = function (type, handler) {
        return this._core.addDisposableListener(type, handler);
    };
    Terminal.prototype.resize = function (columns, rows) {
        this._core.resize(columns, rows);
    };
    Terminal.prototype.writeln = function (data) {
        this._core.writeln(data);
    };
    Terminal.prototype.open = function (parent) {
        this._core.open(parent);
    };
    Terminal.prototype.attachCustomKeyEventHandler = function (customKeyEventHandler) {
        this._core.attachCustomKeyEventHandler(customKeyEventHandler);
    };
    Terminal.prototype.addCsiHandler = function (flag, callback) {
        return this._core.addCsiHandler(flag, callback);
    };
    Terminal.prototype.addOscHandler = function (ident, callback) {
        return this._core.addOscHandler(ident, callback);
    };
    Terminal.prototype.registerLinkMatcher = function (regex, handler, options) {
        return this._core.registerLinkMatcher(regex, handler, options);
    };
    Terminal.prototype.deregisterLinkMatcher = function (matcherId) {
        this._core.deregisterLinkMatcher(matcherId);
    };
    Terminal.prototype.registerCharacterJoiner = function (handler) {
        return this._core.registerCharacterJoiner(handler);
    };
    Terminal.prototype.deregisterCharacterJoiner = function (joinerId) {
        this._core.deregisterCharacterJoiner(joinerId);
    };
    Terminal.prototype.addMarker = function (cursorYOffset) {
        return this._core.addMarker(cursorYOffset);
    };
    Terminal.prototype.hasSelection = function () {
        return this._core.hasSelection();
    };
    Terminal.prototype.select = function (column, row, length) {
        this._core.select(column, row, length);
    };
    Terminal.prototype.getSelection = function () {
        return this._core.getSelection();
    };
    Terminal.prototype.getSelectionPosition = function () {
        return this._core.getSelectionPosition();
    };
    Terminal.prototype.clearSelection = function () {
        this._core.clearSelection();
    };
    Terminal.prototype.selectAll = function () {
        this._core.selectAll();
    };
    Terminal.prototype.selectLines = function (start, end) {
        this._core.selectLines(start, end);
    };
    Terminal.prototype.dispose = function () {
        this._addonManager.dispose();
        this._core.dispose();
    };
    Terminal.prototype.destroy = function () {
        this._core.destroy();
    };
    Terminal.prototype.scrollLines = function (amount) {
        this._core.scrollLines(amount);
    };
    Terminal.prototype.scrollPages = function (pageCount) {
        this._core.scrollPages(pageCount);
    };
    Terminal.prototype.scrollToTop = function () {
        this._core.scrollToTop();
    };
    Terminal.prototype.scrollToBottom = function () {
        this._core.scrollToBottom();
    };
    Terminal.prototype.scrollToLine = function (line) {
        this._core.scrollToLine(line);
    };
    Terminal.prototype.clear = function () {
        this._core.clear();
    };
    Terminal.prototype.write = function (data) {
        this._core.write(data);
    };
    Terminal.prototype.getOption = function (key) {
        return this._core.getOption(key);
    };
    Terminal.prototype.setOption = function (key, value) {
        this._core.setOption(key, value);
    };
    Terminal.prototype.refresh = function (start, end) {
        this._core.refresh(start, end);
    };
    Terminal.prototype.reset = function () {
        this._core.reset();
    };
    Terminal.applyAddon = function (addon) {
        addon.apply(Terminal);
    };
    Terminal.prototype.loadAddon = function (addon) {
        return this._addonManager.loadAddon(this, addon);
    };
    Object.defineProperty(Terminal, "strings", {
        get: function () {
            return Strings;
        },
        enumerable: true,
        configurable: true
    });
    return Terminal;
}());
exports.Terminal = Terminal;
var BufferApiView = (function () {
    function BufferApiView(_buffer) {
        this._buffer = _buffer;
    }
    Object.defineProperty(BufferApiView.prototype, "cursorY", {
        get: function () { return this._buffer.y; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BufferApiView.prototype, "cursorX", {
        get: function () { return this._buffer.x; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BufferApiView.prototype, "viewportY", {
        get: function () { return this._buffer.ydisp; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BufferApiView.prototype, "baseY", {
        get: function () { return this._buffer.ybase; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BufferApiView.prototype, "length", {
        get: function () { return this._buffer.lines.length; },
        enumerable: true,
        configurable: true
    });
    BufferApiView.prototype.getLine = function (y) {
        var line = this._buffer.lines.get(y);
        if (!line) {
            return undefined;
        }
        return new BufferLineApiView(line);
    };
    return BufferApiView;
}());
var BufferLineApiView = (function () {
    function BufferLineApiView(_line) {
        this._line = _line;
    }
    Object.defineProperty(BufferLineApiView.prototype, "isWrapped", {
        get: function () { return this._line.isWrapped; },
        enumerable: true,
        configurable: true
    });
    BufferLineApiView.prototype.getCell = function (x) {
        if (x < 0 || x >= this._line.length) {
            return undefined;
        }
        return new BufferCellApiView(this._line, x);
    };
    BufferLineApiView.prototype.translateToString = function (trimRight, startColumn, endColumn) {
        return this._line.translateToString(trimRight, startColumn, endColumn);
    };
    return BufferLineApiView;
}());
var BufferCellApiView = (function () {
    function BufferCellApiView(_line, _x) {
        this._line = _line;
        this._x = _x;
    }
    Object.defineProperty(BufferCellApiView.prototype, "char", {
        get: function () { return this._line.getString(this._x); },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BufferCellApiView.prototype, "width", {
        get: function () { return this._line.getWidth(this._x); },
        enumerable: true,
        configurable: true
    });
    return BufferCellApiView;
}());
//# sourceMappingURL=Terminal.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/BaseRenderLayer.js":
/*!************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/BaseRenderLayer.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var Types_1 = __webpack_require__(/*! ../common/Types */ "./node_modules/xterm/lib/common/Types.js");
var Types_2 = __webpack_require__(/*! ./atlas/Types */ "./node_modules/xterm/lib/renderer/atlas/Types.js");
var CharAtlasCache_1 = __webpack_require__(/*! ./atlas/CharAtlasCache */ "./node_modules/xterm/lib/renderer/atlas/CharAtlasCache.js");
var BufferLine_1 = __webpack_require__(/*! ../core/buffer/BufferLine */ "./node_modules/xterm/lib/core/buffer/BufferLine.js");
var BaseRenderLayer = (function () {
    function BaseRenderLayer(_container, id, zIndex, _alpha, _colors) {
        this._container = _container;
        this._alpha = _alpha;
        this._colors = _colors;
        this._scaledCharWidth = 0;
        this._scaledCharHeight = 0;
        this._scaledCellWidth = 0;
        this._scaledCellHeight = 0;
        this._scaledCharLeft = 0;
        this._scaledCharTop = 0;
        this._currentGlyphIdentifier = {
            chars: '',
            code: 0,
            bg: 0,
            fg: 0,
            bold: false,
            dim: false,
            italic: false
        };
        this._canvas = document.createElement('canvas');
        this._canvas.classList.add("xterm-" + id + "-layer");
        this._canvas.style.zIndex = zIndex.toString();
        this._initCanvas();
        this._container.appendChild(this._canvas);
    }
    BaseRenderLayer.prototype.dispose = function () {
        this._container.removeChild(this._canvas);
        if (this._charAtlas) {
            this._charAtlas.dispose();
        }
    };
    BaseRenderLayer.prototype._initCanvas = function () {
        this._ctx = this._canvas.getContext('2d', { alpha: this._alpha });
        if (!this._alpha) {
            this.clearAll();
        }
    };
    BaseRenderLayer.prototype.onOptionsChanged = function (terminal) { };
    BaseRenderLayer.prototype.onBlur = function (terminal) { };
    BaseRenderLayer.prototype.onFocus = function (terminal) { };
    BaseRenderLayer.prototype.onCursorMove = function (terminal) { };
    BaseRenderLayer.prototype.onGridChanged = function (terminal, startRow, endRow) { };
    BaseRenderLayer.prototype.onSelectionChanged = function (terminal, start, end, columnSelectMode) {
        if (columnSelectMode === void 0) { columnSelectMode = false; }
    };
    BaseRenderLayer.prototype.onThemeChanged = function (terminal, colorSet) {
        this._refreshCharAtlas(terminal, colorSet);
    };
    BaseRenderLayer.prototype.setTransparency = function (terminal, alpha) {
        if (alpha === this._alpha) {
            return;
        }
        var oldCanvas = this._canvas;
        this._alpha = alpha;
        this._canvas = this._canvas.cloneNode();
        this._initCanvas();
        this._container.replaceChild(this._canvas, oldCanvas);
        this._refreshCharAtlas(terminal, this._colors);
        this.onGridChanged(terminal, 0, terminal.rows - 1);
    };
    BaseRenderLayer.prototype._refreshCharAtlas = function (terminal, colorSet) {
        if (this._scaledCharWidth <= 0 && this._scaledCharHeight <= 0) {
            return;
        }
        this._charAtlas = CharAtlasCache_1.acquireCharAtlas(terminal, colorSet, this._scaledCharWidth, this._scaledCharHeight);
        this._charAtlas.warmUp();
    };
    BaseRenderLayer.prototype.resize = function (terminal, dim) {
        this._scaledCellWidth = dim.scaledCellWidth;
        this._scaledCellHeight = dim.scaledCellHeight;
        this._scaledCharWidth = dim.scaledCharWidth;
        this._scaledCharHeight = dim.scaledCharHeight;
        this._scaledCharLeft = dim.scaledCharLeft;
        this._scaledCharTop = dim.scaledCharTop;
        this._canvas.width = dim.scaledCanvasWidth;
        this._canvas.height = dim.scaledCanvasHeight;
        this._canvas.style.width = dim.canvasWidth + "px";
        this._canvas.style.height = dim.canvasHeight + "px";
        if (!this._alpha) {
            this.clearAll();
        }
        this._refreshCharAtlas(terminal, this._colors);
    };
    BaseRenderLayer.prototype.fillCells = function (x, y, width, height) {
        this._ctx.fillRect(x * this._scaledCellWidth, y * this._scaledCellHeight, width * this._scaledCellWidth, height * this._scaledCellHeight);
    };
    BaseRenderLayer.prototype.fillBottomLineAtCells = function (x, y, width) {
        if (width === void 0) { width = 1; }
        this._ctx.fillRect(x * this._scaledCellWidth, (y + 1) * this._scaledCellHeight - window.devicePixelRatio - 1, width * this._scaledCellWidth, window.devicePixelRatio);
    };
    BaseRenderLayer.prototype.fillLeftLineAtCell = function (x, y) {
        this._ctx.fillRect(x * this._scaledCellWidth, y * this._scaledCellHeight, window.devicePixelRatio, this._scaledCellHeight);
    };
    BaseRenderLayer.prototype.strokeRectAtCell = function (x, y, width, height) {
        this._ctx.lineWidth = window.devicePixelRatio;
        this._ctx.strokeRect(x * this._scaledCellWidth + window.devicePixelRatio / 2, y * this._scaledCellHeight + (window.devicePixelRatio / 2), width * this._scaledCellWidth - window.devicePixelRatio, (height * this._scaledCellHeight) - window.devicePixelRatio);
    };
    BaseRenderLayer.prototype.clearAll = function () {
        if (this._alpha) {
            this._ctx.clearRect(0, 0, this._canvas.width, this._canvas.height);
        }
        else {
            this._ctx.fillStyle = this._colors.background.css;
            this._ctx.fillRect(0, 0, this._canvas.width, this._canvas.height);
        }
    };
    BaseRenderLayer.prototype.clearCells = function (x, y, width, height) {
        if (this._alpha) {
            this._ctx.clearRect(x * this._scaledCellWidth, y * this._scaledCellHeight, width * this._scaledCellWidth, height * this._scaledCellHeight);
        }
        else {
            this._ctx.fillStyle = this._colors.background.css;
            this._ctx.fillRect(x * this._scaledCellWidth, y * this._scaledCellHeight, width * this._scaledCellWidth, height * this._scaledCellHeight);
        }
    };
    BaseRenderLayer.prototype.fillCharTrueColor = function (terminal, cell, x, y) {
        this._ctx.font = this._getFont(terminal, false, false);
        this._ctx.textBaseline = 'middle';
        this._clipRow(terminal, y);
        this._ctx.fillText(cell.getChars(), x * this._scaledCellWidth + this._scaledCharLeft, y * this._scaledCellHeight + this._scaledCharTop + this._scaledCharHeight / 2);
    };
    BaseRenderLayer.prototype.drawChars = function (terminal, cell, x, y) {
        if (cell.isFgRGB() || cell.isBgRGB()) {
            this._drawUncachedChars(terminal, cell, x, y);
            return;
        }
        var fg;
        var bg;
        if (cell.isInverse()) {
            fg = (cell.isBgDefault()) ? Types_2.INVERTED_DEFAULT_COLOR : cell.getBgColor();
            bg = (cell.isFgDefault()) ? Types_2.INVERTED_DEFAULT_COLOR : cell.getFgColor();
        }
        else {
            bg = (cell.isBgDefault()) ? Types_1.DEFAULT_COLOR : cell.getBgColor();
            fg = (cell.isFgDefault()) ? Types_1.DEFAULT_COLOR : cell.getFgColor();
        }
        var drawInBrightColor = terminal.options.drawBoldTextInBrightColors && cell.isBold() && fg < 8 && fg !== Types_2.INVERTED_DEFAULT_COLOR;
        fg += drawInBrightColor ? 8 : 0;
        this._currentGlyphIdentifier.chars = cell.getChars() || BufferLine_1.WHITESPACE_CELL_CHAR;
        this._currentGlyphIdentifier.code = cell.getCode() || BufferLine_1.WHITESPACE_CELL_CODE;
        this._currentGlyphIdentifier.bg = bg;
        this._currentGlyphIdentifier.fg = fg;
        this._currentGlyphIdentifier.bold = cell.isBold() && terminal.options.enableBold;
        this._currentGlyphIdentifier.dim = !!cell.isDim();
        this._currentGlyphIdentifier.italic = !!cell.isItalic();
        var atlasDidDraw = this._charAtlas && this._charAtlas.draw(this._ctx, this._currentGlyphIdentifier, x * this._scaledCellWidth + this._scaledCharLeft, y * this._scaledCellHeight + this._scaledCharTop);
        if (!atlasDidDraw) {
            this._drawUncachedChars(terminal, cell, x, y);
        }
    };
    BaseRenderLayer.prototype._drawUncachedChars = function (terminal, cell, x, y) {
        this._ctx.save();
        this._ctx.font = this._getFont(terminal, cell.isBold() && terminal.options.enableBold, !!cell.isItalic());
        this._ctx.textBaseline = 'middle';
        if (cell.isInverse()) {
            if (cell.isBgDefault()) {
                this._ctx.fillStyle = this._colors.background.css;
            }
            else if (cell.isBgRGB()) {
                this._ctx.fillStyle = "rgb(" + BufferLine_1.AttributeData.toColorRGB(cell.getBgColor()).join(',') + ")";
            }
            else {
                this._ctx.fillStyle = this._colors.ansi[cell.getBgColor()].css;
            }
        }
        else {
            if (cell.isFgDefault()) {
                this._ctx.fillStyle = this._colors.foreground.css;
            }
            else if (cell.isFgRGB()) {
                this._ctx.fillStyle = "rgb(" + BufferLine_1.AttributeData.toColorRGB(cell.getFgColor()).join(',') + ")";
            }
            else {
                var fg = cell.getFgColor();
                if (terminal.options.drawBoldTextInBrightColors && cell.isBold() && fg < 8) {
                    fg += 8;
                }
                this._ctx.fillStyle = this._colors.ansi[fg].css;
            }
        }
        this._clipRow(terminal, y);
        if (cell.isDim()) {
            this._ctx.globalAlpha = Types_2.DIM_OPACITY;
        }
        this._ctx.fillText(cell.getChars(), x * this._scaledCellWidth + this._scaledCharLeft, y * this._scaledCellHeight + this._scaledCharTop + this._scaledCharHeight / 2);
        this._ctx.restore();
    };
    BaseRenderLayer.prototype._clipRow = function (terminal, y) {
        this._ctx.beginPath();
        this._ctx.rect(0, y * this._scaledCellHeight, terminal.cols * this._scaledCellWidth, this._scaledCellHeight);
        this._ctx.clip();
    };
    BaseRenderLayer.prototype._getFont = function (terminal, isBold, isItalic) {
        var fontWeight = isBold ? terminal.options.fontWeightBold : terminal.options.fontWeight;
        var fontStyle = isItalic ? 'italic' : '';
        return fontStyle + " " + fontWeight + " " + terminal.options.fontSize * window.devicePixelRatio + "px " + terminal.options.fontFamily;
    };
    return BaseRenderLayer;
}());
exports.BaseRenderLayer = BaseRenderLayer;
//# sourceMappingURL=BaseRenderLayer.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/CharacterJoinerRegistry.js":
/*!********************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/CharacterJoinerRegistry.js ***!
  \********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var BufferLine_1 = __webpack_require__(/*! ../core/buffer/BufferLine */ "./node_modules/xterm/lib/core/buffer/BufferLine.js");
var JoinedCellData = (function (_super) {
    __extends(JoinedCellData, _super);
    function JoinedCellData(firstCell, chars, width) {
        var _this = _super.call(this) || this;
        _this.content = 0;
        _this.combinedData = '';
        _this.fg = firstCell.fg;
        _this.bg = firstCell.bg;
        _this.combinedData = chars;
        _this._width = width;
        return _this;
    }
    JoinedCellData.prototype.isCombined = function () {
        return 2097152;
    };
    JoinedCellData.prototype.getWidth = function () {
        return this._width;
    };
    JoinedCellData.prototype.getChars = function () {
        return this.combinedData;
    };
    JoinedCellData.prototype.getCode = function () {
        return 0x1FFFFF;
    };
    JoinedCellData.prototype.setFromCharData = function (value) {
        throw new Error('not implemented');
    };
    JoinedCellData.prototype.getAsCharData = function () {
        return [this.fg, this.getChars(), this.getWidth(), this.getCode()];
    };
    return JoinedCellData;
}(BufferLine_1.AttributeData));
exports.JoinedCellData = JoinedCellData;
var CharacterJoinerRegistry = (function () {
    function CharacterJoinerRegistry(_terminal) {
        this._terminal = _terminal;
        this._characterJoiners = [];
        this._nextCharacterJoinerId = 0;
        this._workCell = new BufferLine_1.CellData();
    }
    CharacterJoinerRegistry.prototype.registerCharacterJoiner = function (handler) {
        var joiner = {
            id: this._nextCharacterJoinerId++,
            handler: handler
        };
        this._characterJoiners.push(joiner);
        return joiner.id;
    };
    CharacterJoinerRegistry.prototype.deregisterCharacterJoiner = function (joinerId) {
        for (var i = 0; i < this._characterJoiners.length; i++) {
            if (this._characterJoiners[i].id === joinerId) {
                this._characterJoiners.splice(i, 1);
                return true;
            }
        }
        return false;
    };
    CharacterJoinerRegistry.prototype.getJoinedCharacters = function (row) {
        if (this._characterJoiners.length === 0) {
            return [];
        }
        var line = this._terminal.buffer.lines.get(row);
        if (line.length === 0) {
            return [];
        }
        var ranges = [];
        var lineStr = line.translateToString(true);
        var rangeStartColumn = 0;
        var currentStringIndex = 0;
        var rangeStartStringIndex = 0;
        var rangeAttrFG = line.getFg(0);
        var rangeAttrBG = line.getBg(0);
        for (var x = 0; x < line.getTrimmedLength(); x++) {
            line.loadCell(x, this._workCell);
            if (this._workCell.getWidth() === 0) {
                continue;
            }
            if (this._workCell.fg !== rangeAttrFG || this._workCell.bg !== rangeAttrBG) {
                if (x - rangeStartColumn > 1) {
                    var joinedRanges = this._getJoinedRanges(lineStr, rangeStartStringIndex, currentStringIndex, line, rangeStartColumn);
                    for (var i = 0; i < joinedRanges.length; i++) {
                        ranges.push(joinedRanges[i]);
                    }
                }
                rangeStartColumn = x;
                rangeStartStringIndex = currentStringIndex;
                rangeAttrFG = this._workCell.fg;
                rangeAttrBG = this._workCell.bg;
            }
            currentStringIndex += this._workCell.getChars().length || BufferLine_1.WHITESPACE_CELL_CHAR.length;
        }
        if (this._terminal.cols - rangeStartColumn > 1) {
            var joinedRanges = this._getJoinedRanges(lineStr, rangeStartStringIndex, currentStringIndex, line, rangeStartColumn);
            for (var i = 0; i < joinedRanges.length; i++) {
                ranges.push(joinedRanges[i]);
            }
        }
        return ranges;
    };
    CharacterJoinerRegistry.prototype._getJoinedRanges = function (line, startIndex, endIndex, lineData, startCol) {
        var text = line.substring(startIndex, endIndex);
        var joinedRanges = this._characterJoiners[0].handler(text);
        for (var i = 1; i < this._characterJoiners.length; i++) {
            var joinerRanges = this._characterJoiners[i].handler(text);
            for (var j = 0; j < joinerRanges.length; j++) {
                CharacterJoinerRegistry._mergeRanges(joinedRanges, joinerRanges[j]);
            }
        }
        this._stringRangesToCellRanges(joinedRanges, lineData, startCol);
        return joinedRanges;
    };
    CharacterJoinerRegistry.prototype._stringRangesToCellRanges = function (ranges, line, startCol) {
        var currentRangeIndex = 0;
        var currentRangeStarted = false;
        var currentStringIndex = 0;
        var currentRange = ranges[currentRangeIndex];
        if (!currentRange) {
            return;
        }
        for (var x = startCol; x < this._terminal.cols; x++) {
            var width = line.getWidth(x);
            var length_1 = line.getString(x).length || BufferLine_1.WHITESPACE_CELL_CHAR.length;
            if (width === 0) {
                continue;
            }
            if (!currentRangeStarted && currentRange[0] <= currentStringIndex) {
                currentRange[0] = x;
                currentRangeStarted = true;
            }
            if (currentRange[1] <= currentStringIndex) {
                currentRange[1] = x;
                currentRange = ranges[++currentRangeIndex];
                if (!currentRange) {
                    break;
                }
                if (currentRange[0] <= currentStringIndex) {
                    currentRange[0] = x;
                    currentRangeStarted = true;
                }
                else {
                    currentRangeStarted = false;
                }
            }
            currentStringIndex += length_1;
        }
        if (currentRange) {
            currentRange[1] = this._terminal.cols;
        }
    };
    CharacterJoinerRegistry._mergeRanges = function (ranges, newRange) {
        var inRange = false;
        for (var i = 0; i < ranges.length; i++) {
            var range = ranges[i];
            if (!inRange) {
                if (newRange[1] <= range[0]) {
                    ranges.splice(i, 0, newRange);
                    return ranges;
                }
                if (newRange[1] <= range[1]) {
                    range[0] = Math.min(newRange[0], range[0]);
                    return ranges;
                }
                if (newRange[0] < range[1]) {
                    range[0] = Math.min(newRange[0], range[0]);
                    inRange = true;
                }
                continue;
            }
            else {
                if (newRange[1] <= range[0]) {
                    ranges[i - 1][1] = newRange[1];
                    return ranges;
                }
                if (newRange[1] <= range[1]) {
                    ranges[i - 1][1] = Math.max(newRange[1], range[1]);
                    ranges.splice(i, 1);
                    inRange = false;
                    return ranges;
                }
                ranges.splice(i, 1);
                i--;
            }
        }
        if (inRange) {
            ranges[ranges.length - 1][1] = newRange[1];
        }
        else {
            ranges.push(newRange);
        }
        return ranges;
    };
    return CharacterJoinerRegistry;
}());
exports.CharacterJoinerRegistry = CharacterJoinerRegistry;
//# sourceMappingURL=CharacterJoinerRegistry.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/ColorManager.js":
/*!*********************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/ColorManager.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var DEFAULT_FOREGROUND = fromHex('#ffffff');
var DEFAULT_BACKGROUND = fromHex('#000000');
var DEFAULT_CURSOR = fromHex('#ffffff');
var DEFAULT_CURSOR_ACCENT = fromHex('#000000');
var DEFAULT_SELECTION = {
    css: 'rgba(255, 255, 255, 0.3)',
    rgba: 0xFFFFFF77
};
exports.DEFAULT_ANSI_COLORS = (function () {
    var colors = [
        fromHex('#2e3436'),
        fromHex('#cc0000'),
        fromHex('#4e9a06'),
        fromHex('#c4a000'),
        fromHex('#3465a4'),
        fromHex('#75507b'),
        fromHex('#06989a'),
        fromHex('#d3d7cf'),
        fromHex('#555753'),
        fromHex('#ef2929'),
        fromHex('#8ae234'),
        fromHex('#fce94f'),
        fromHex('#729fcf'),
        fromHex('#ad7fa8'),
        fromHex('#34e2e2'),
        fromHex('#eeeeec')
    ];
    var v = [0x00, 0x5f, 0x87, 0xaf, 0xd7, 0xff];
    for (var i = 0; i < 216; i++) {
        var r = v[(i / 36) % 6 | 0];
        var g = v[(i / 6) % 6 | 0];
        var b = v[i % 6];
        colors.push({
            css: "#" + toPaddedHex(r) + toPaddedHex(g) + toPaddedHex(b),
            rgba: ((r << 24) | (g << 16) | (b << 8) | 0xFF) >>> 0
        });
    }
    for (var i = 0; i < 24; i++) {
        var c = 8 + i * 10;
        var ch = toPaddedHex(c);
        colors.push({
            css: "#" + ch + ch + ch,
            rgba: ((c << 24) | (c << 16) | (c << 8) | 0xFF) >>> 0
        });
    }
    return colors;
})();
function fromHex(css) {
    return {
        css: css,
        rgba: parseInt(css.slice(1), 16) << 8 | 0xFF
    };
}
function toPaddedHex(c) {
    var s = c.toString(16);
    return s.length < 2 ? '0' + s : s;
}
var ColorManager = (function () {
    function ColorManager(document, allowTransparency) {
        this.allowTransparency = allowTransparency;
        var canvas = document.createElement('canvas');
        canvas.width = 1;
        canvas.height = 1;
        this._ctx = canvas.getContext('2d');
        this._ctx.globalCompositeOperation = 'copy';
        this._litmusColor = this._ctx.createLinearGradient(0, 0, 1, 1);
        this.colors = {
            foreground: DEFAULT_FOREGROUND,
            background: DEFAULT_BACKGROUND,
            cursor: DEFAULT_CURSOR,
            cursorAccent: DEFAULT_CURSOR_ACCENT,
            selection: DEFAULT_SELECTION,
            ansi: exports.DEFAULT_ANSI_COLORS.slice()
        };
    }
    ColorManager.prototype.setTheme = function (theme) {
        this.colors.foreground = this._parseColor(theme.foreground, DEFAULT_FOREGROUND);
        this.colors.background = this._parseColor(theme.background, DEFAULT_BACKGROUND);
        this.colors.cursor = this._parseColor(theme.cursor, DEFAULT_CURSOR, true);
        this.colors.cursorAccent = this._parseColor(theme.cursorAccent, DEFAULT_CURSOR_ACCENT, true);
        this.colors.selection = this._parseColor(theme.selection, DEFAULT_SELECTION, true);
        this.colors.ansi[0] = this._parseColor(theme.black, exports.DEFAULT_ANSI_COLORS[0]);
        this.colors.ansi[1] = this._parseColor(theme.red, exports.DEFAULT_ANSI_COLORS[1]);
        this.colors.ansi[2] = this._parseColor(theme.green, exports.DEFAULT_ANSI_COLORS[2]);
        this.colors.ansi[3] = this._parseColor(theme.yellow, exports.DEFAULT_ANSI_COLORS[3]);
        this.colors.ansi[4] = this._parseColor(theme.blue, exports.DEFAULT_ANSI_COLORS[4]);
        this.colors.ansi[5] = this._parseColor(theme.magenta, exports.DEFAULT_ANSI_COLORS[5]);
        this.colors.ansi[6] = this._parseColor(theme.cyan, exports.DEFAULT_ANSI_COLORS[6]);
        this.colors.ansi[7] = this._parseColor(theme.white, exports.DEFAULT_ANSI_COLORS[7]);
        this.colors.ansi[8] = this._parseColor(theme.brightBlack, exports.DEFAULT_ANSI_COLORS[8]);
        this.colors.ansi[9] = this._parseColor(theme.brightRed, exports.DEFAULT_ANSI_COLORS[9]);
        this.colors.ansi[10] = this._parseColor(theme.brightGreen, exports.DEFAULT_ANSI_COLORS[10]);
        this.colors.ansi[11] = this._parseColor(theme.brightYellow, exports.DEFAULT_ANSI_COLORS[11]);
        this.colors.ansi[12] = this._parseColor(theme.brightBlue, exports.DEFAULT_ANSI_COLORS[12]);
        this.colors.ansi[13] = this._parseColor(theme.brightMagenta, exports.DEFAULT_ANSI_COLORS[13]);
        this.colors.ansi[14] = this._parseColor(theme.brightCyan, exports.DEFAULT_ANSI_COLORS[14]);
        this.colors.ansi[15] = this._parseColor(theme.brightWhite, exports.DEFAULT_ANSI_COLORS[15]);
    };
    ColorManager.prototype._parseColor = function (css, fallback, allowTransparency) {
        if (allowTransparency === void 0) { allowTransparency = this.allowTransparency; }
        if (!css) {
            return fallback;
        }
        this._ctx.fillStyle = this._litmusColor;
        this._ctx.fillStyle = css;
        if (typeof this._ctx.fillStyle !== 'string') {
            console.warn("Color: " + css + " is invalid using fallback " + fallback.css);
            return fallback;
        }
        this._ctx.fillRect(0, 0, 1, 1);
        var data = this._ctx.getImageData(0, 0, 1, 1).data;
        if (!allowTransparency && data[3] !== 0xFF) {
            console.warn("Color: " + css + " is using transparency, but allowTransparency is false. " +
                ("Using fallback " + fallback.css + "."));
            return fallback;
        }
        return {
            css: css,
            rgba: (data[0] << 24 | data[1] << 16 | data[2] << 8 | data[3]) >>> 0
        };
    };
    return ColorManager;
}());
exports.ColorManager = ColorManager;
//# sourceMappingURL=ColorManager.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/CursorRenderLayer.js":
/*!**************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/CursorRenderLayer.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var BaseRenderLayer_1 = __webpack_require__(/*! ./BaseRenderLayer */ "./node_modules/xterm/lib/renderer/BaseRenderLayer.js");
var BufferLine_1 = __webpack_require__(/*! ../core/buffer/BufferLine */ "./node_modules/xterm/lib/core/buffer/BufferLine.js");
var BLINK_INTERVAL = 600;
var CursorRenderLayer = (function (_super) {
    __extends(CursorRenderLayer, _super);
    function CursorRenderLayer(container, zIndex, colors) {
        var _this = _super.call(this, container, 'cursor', zIndex, true, colors) || this;
        _this._cell = new BufferLine_1.CellData();
        _this._state = {
            x: null,
            y: null,
            isFocused: null,
            style: null,
            width: null
        };
        _this._cursorRenderers = {
            'bar': _this._renderBarCursor.bind(_this),
            'block': _this._renderBlockCursor.bind(_this),
            'underline': _this._renderUnderlineCursor.bind(_this)
        };
        return _this;
    }
    CursorRenderLayer.prototype.resize = function (terminal, dim) {
        _super.prototype.resize.call(this, terminal, dim);
        this._state = {
            x: null,
            y: null,
            isFocused: null,
            style: null,
            width: null
        };
    };
    CursorRenderLayer.prototype.reset = function (terminal) {
        this._clearCursor();
        if (this._cursorBlinkStateManager) {
            this._cursorBlinkStateManager.dispose();
            this._cursorBlinkStateManager = null;
            this.onOptionsChanged(terminal);
        }
    };
    CursorRenderLayer.prototype.onBlur = function (terminal) {
        if (this._cursorBlinkStateManager) {
            this._cursorBlinkStateManager.pause();
        }
        terminal.refresh(terminal.buffer.y, terminal.buffer.y);
    };
    CursorRenderLayer.prototype.onFocus = function (terminal) {
        if (this._cursorBlinkStateManager) {
            this._cursorBlinkStateManager.resume(terminal);
        }
        else {
            terminal.refresh(terminal.buffer.y, terminal.buffer.y);
        }
    };
    CursorRenderLayer.prototype.onOptionsChanged = function (terminal) {
        var _this = this;
        if (terminal.options.cursorBlink) {
            if (!this._cursorBlinkStateManager) {
                this._cursorBlinkStateManager = new CursorBlinkStateManager(terminal, function () {
                    _this._render(terminal, true);
                });
            }
        }
        else {
            if (this._cursorBlinkStateManager) {
                this._cursorBlinkStateManager.dispose();
                this._cursorBlinkStateManager = null;
            }
            terminal.refresh(terminal.buffer.y, terminal.buffer.y);
        }
    };
    CursorRenderLayer.prototype.onCursorMove = function (terminal) {
        if (this._cursorBlinkStateManager) {
            this._cursorBlinkStateManager.restartBlinkAnimation(terminal);
        }
    };
    CursorRenderLayer.prototype.onGridChanged = function (terminal, startRow, endRow) {
        if (!this._cursorBlinkStateManager || this._cursorBlinkStateManager.isPaused) {
            this._render(terminal, false);
        }
        else {
            this._cursorBlinkStateManager.restartBlinkAnimation(terminal);
        }
    };
    CursorRenderLayer.prototype._render = function (terminal, triggeredByAnimationFrame) {
        if (!terminal.cursorState || terminal.cursorHidden) {
            this._clearCursor();
            return;
        }
        var cursorY = terminal.buffer.ybase + terminal.buffer.y;
        var viewportRelativeCursorY = cursorY - terminal.buffer.ydisp;
        if (viewportRelativeCursorY < 0 || viewportRelativeCursorY >= terminal.rows) {
            this._clearCursor();
            return;
        }
        terminal.buffer.lines.get(cursorY).loadCell(terminal.buffer.x, this._cell);
        if (this._cell.content === undefined) {
            return;
        }
        if (!terminal.isFocused) {
            this._clearCursor();
            this._ctx.save();
            this._ctx.fillStyle = this._colors.cursor.css;
            this._renderBlurCursor(terminal, terminal.buffer.x, viewportRelativeCursorY, this._cell);
            this._ctx.restore();
            this._state.x = terminal.buffer.x;
            this._state.y = viewportRelativeCursorY;
            this._state.isFocused = false;
            this._state.style = terminal.options.cursorStyle;
            this._state.width = this._cell.getWidth();
            return;
        }
        if (this._cursorBlinkStateManager && !this._cursorBlinkStateManager.isCursorVisible) {
            this._clearCursor();
            return;
        }
        if (this._state) {
            if (this._state.x === terminal.buffer.x &&
                this._state.y === viewportRelativeCursorY &&
                this._state.isFocused === terminal.isFocused &&
                this._state.style === terminal.options.cursorStyle &&
                this._state.width === this._cell.getWidth()) {
                return;
            }
            this._clearCursor();
        }
        this._ctx.save();
        this._cursorRenderers[terminal.options.cursorStyle || 'block'](terminal, terminal.buffer.x, viewportRelativeCursorY, this._cell);
        this._ctx.restore();
        this._state.x = terminal.buffer.x;
        this._state.y = viewportRelativeCursorY;
        this._state.isFocused = false;
        this._state.style = terminal.options.cursorStyle;
        this._state.width = this._cell.getWidth();
    };
    CursorRenderLayer.prototype._clearCursor = function () {
        if (this._state) {
            this.clearCells(this._state.x, this._state.y, this._state.width, 1);
            this._state = {
                x: null,
                y: null,
                isFocused: null,
                style: null,
                width: null
            };
        }
    };
    CursorRenderLayer.prototype._renderBarCursor = function (terminal, x, y, cell) {
        this._ctx.save();
        this._ctx.fillStyle = this._colors.cursor.css;
        this.fillLeftLineAtCell(x, y);
        this._ctx.restore();
    };
    CursorRenderLayer.prototype._renderBlockCursor = function (terminal, x, y, cell) {
        this._ctx.save();
        this._ctx.fillStyle = this._colors.cursor.css;
        this.fillCells(x, y, cell.getWidth(), 1);
        this._ctx.fillStyle = this._colors.cursorAccent.css;
        this.fillCharTrueColor(terminal, cell, x, y);
        this._ctx.restore();
    };
    CursorRenderLayer.prototype._renderUnderlineCursor = function (terminal, x, y, cell) {
        this._ctx.save();
        this._ctx.fillStyle = this._colors.cursor.css;
        this.fillBottomLineAtCells(x, y);
        this._ctx.restore();
    };
    CursorRenderLayer.prototype._renderBlurCursor = function (terminal, x, y, cell) {
        this._ctx.save();
        this._ctx.strokeStyle = this._colors.cursor.css;
        this.strokeRectAtCell(x, y, cell.getWidth(), 1);
        this._ctx.restore();
    };
    return CursorRenderLayer;
}(BaseRenderLayer_1.BaseRenderLayer));
exports.CursorRenderLayer = CursorRenderLayer;
var CursorBlinkStateManager = (function () {
    function CursorBlinkStateManager(terminal, _renderCallback) {
        this._renderCallback = _renderCallback;
        this.isCursorVisible = true;
        if (terminal.isFocused) {
            this._restartInterval();
        }
    }
    Object.defineProperty(CursorBlinkStateManager.prototype, "isPaused", {
        get: function () { return !(this._blinkStartTimeout || this._blinkInterval); },
        enumerable: true,
        configurable: true
    });
    CursorBlinkStateManager.prototype.dispose = function () {
        if (this._blinkInterval) {
            window.clearInterval(this._blinkInterval);
            this._blinkInterval = null;
        }
        if (this._blinkStartTimeout) {
            window.clearTimeout(this._blinkStartTimeout);
            this._blinkStartTimeout = null;
        }
        if (this._animationFrame) {
            window.cancelAnimationFrame(this._animationFrame);
            this._animationFrame = null;
        }
    };
    CursorBlinkStateManager.prototype.restartBlinkAnimation = function (terminal) {
        var _this = this;
        if (this.isPaused) {
            return;
        }
        this._animationTimeRestarted = Date.now();
        this.isCursorVisible = true;
        if (!this._animationFrame) {
            this._animationFrame = window.requestAnimationFrame(function () {
                _this._renderCallback();
                _this._animationFrame = null;
            });
        }
    };
    CursorBlinkStateManager.prototype._restartInterval = function (timeToStart) {
        var _this = this;
        if (timeToStart === void 0) { timeToStart = BLINK_INTERVAL; }
        if (this._blinkInterval) {
            window.clearInterval(this._blinkInterval);
        }
        this._blinkStartTimeout = setTimeout(function () {
            if (_this._animationTimeRestarted) {
                var time = BLINK_INTERVAL - (Date.now() - _this._animationTimeRestarted);
                _this._animationTimeRestarted = null;
                if (time > 0) {
                    _this._restartInterval(time);
                    return;
                }
            }
            _this.isCursorVisible = false;
            _this._animationFrame = window.requestAnimationFrame(function () {
                _this._renderCallback();
                _this._animationFrame = null;
            });
            _this._blinkInterval = setInterval(function () {
                if (_this._animationTimeRestarted) {
                    var time = BLINK_INTERVAL - (Date.now() - _this._animationTimeRestarted);
                    _this._animationTimeRestarted = null;
                    _this._restartInterval(time);
                    return;
                }
                _this.isCursorVisible = !_this.isCursorVisible;
                _this._animationFrame = window.requestAnimationFrame(function () {
                    _this._renderCallback();
                    _this._animationFrame = null;
                });
            }, BLINK_INTERVAL);
        }, timeToStart);
    };
    CursorBlinkStateManager.prototype.pause = function () {
        this.isCursorVisible = true;
        if (this._blinkInterval) {
            window.clearInterval(this._blinkInterval);
            this._blinkInterval = null;
        }
        if (this._blinkStartTimeout) {
            window.clearTimeout(this._blinkStartTimeout);
            this._blinkStartTimeout = null;
        }
        if (this._animationFrame) {
            window.cancelAnimationFrame(this._animationFrame);
            this._animationFrame = null;
        }
    };
    CursorBlinkStateManager.prototype.resume = function (terminal) {
        this._animationTimeRestarted = null;
        this._restartInterval();
        this.restartBlinkAnimation(terminal);
    };
    return CursorBlinkStateManager;
}());
//# sourceMappingURL=CursorRenderLayer.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/GridCache.js":
/*!******************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/GridCache.js ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var GridCache = (function () {
    function GridCache() {
        this.cache = [];
    }
    GridCache.prototype.resize = function (width, height) {
        for (var x = 0; x < width; x++) {
            if (this.cache.length <= x) {
                this.cache.push([]);
            }
            for (var y = this.cache[x].length; y < height; y++) {
                this.cache[x].push(null);
            }
            this.cache[x].length = height;
        }
        this.cache.length = width;
    };
    GridCache.prototype.clear = function () {
        for (var x = 0; x < this.cache.length; x++) {
            for (var y = 0; y < this.cache[x].length; y++) {
                this.cache[x][y] = null;
            }
        }
    };
    return GridCache;
}());
exports.GridCache = GridCache;
//# sourceMappingURL=GridCache.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/LinkRenderLayer.js":
/*!************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/LinkRenderLayer.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var BaseRenderLayer_1 = __webpack_require__(/*! ./BaseRenderLayer */ "./node_modules/xterm/lib/renderer/BaseRenderLayer.js");
var Types_1 = __webpack_require__(/*! ./atlas/Types */ "./node_modules/xterm/lib/renderer/atlas/Types.js");
var CharAtlasUtils_1 = __webpack_require__(/*! ./atlas/CharAtlasUtils */ "./node_modules/xterm/lib/renderer/atlas/CharAtlasUtils.js");
var LinkRenderLayer = (function (_super) {
    __extends(LinkRenderLayer, _super);
    function LinkRenderLayer(container, zIndex, colors, terminal) {
        var _this = _super.call(this, container, 'link', zIndex, true, colors) || this;
        _this._state = null;
        terminal.linkifier.onLinkHover(function (e) { return _this._onLinkHover(e); });
        terminal.linkifier.onLinkLeave(function (e) { return _this._onLinkLeave(e); });
        return _this;
    }
    LinkRenderLayer.prototype.resize = function (terminal, dim) {
        _super.prototype.resize.call(this, terminal, dim);
        this._state = null;
    };
    LinkRenderLayer.prototype.reset = function (terminal) {
        this._clearCurrentLink();
    };
    LinkRenderLayer.prototype._clearCurrentLink = function () {
        if (this._state) {
            this.clearCells(this._state.x1, this._state.y1, this._state.cols - this._state.x1, 1);
            var middleRowCount = this._state.y2 - this._state.y1 - 1;
            if (middleRowCount > 0) {
                this.clearCells(0, this._state.y1 + 1, this._state.cols, middleRowCount);
            }
            this.clearCells(0, this._state.y2, this._state.x2, 1);
            this._state = null;
        }
    };
    LinkRenderLayer.prototype._onLinkHover = function (e) {
        if (e.fg === Types_1.INVERTED_DEFAULT_COLOR) {
            this._ctx.fillStyle = this._colors.background.css;
        }
        else if (CharAtlasUtils_1.is256Color(e.fg)) {
            this._ctx.fillStyle = this._colors.ansi[e.fg].css;
        }
        else {
            this._ctx.fillStyle = this._colors.foreground.css;
        }
        if (e.y1 === e.y2) {
            this.fillBottomLineAtCells(e.x1, e.y1, e.x2 - e.x1);
        }
        else {
            this.fillBottomLineAtCells(e.x1, e.y1, e.cols - e.x1);
            for (var y = e.y1 + 1; y < e.y2; y++) {
                this.fillBottomLineAtCells(0, y, e.cols);
            }
            this.fillBottomLineAtCells(0, e.y2, e.x2);
        }
        this._state = e;
    };
    LinkRenderLayer.prototype._onLinkLeave = function (e) {
        this._clearCurrentLink();
    };
    return LinkRenderLayer;
}(BaseRenderLayer_1.BaseRenderLayer));
exports.LinkRenderLayer = LinkRenderLayer;
//# sourceMappingURL=LinkRenderLayer.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/Renderer.js":
/*!*****************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/Renderer.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var TextRenderLayer_1 = __webpack_require__(/*! ./TextRenderLayer */ "./node_modules/xterm/lib/renderer/TextRenderLayer.js");
var SelectionRenderLayer_1 = __webpack_require__(/*! ./SelectionRenderLayer */ "./node_modules/xterm/lib/renderer/SelectionRenderLayer.js");
var CursorRenderLayer_1 = __webpack_require__(/*! ./CursorRenderLayer */ "./node_modules/xterm/lib/renderer/CursorRenderLayer.js");
var ColorManager_1 = __webpack_require__(/*! ./ColorManager */ "./node_modules/xterm/lib/renderer/ColorManager.js");
var LinkRenderLayer_1 = __webpack_require__(/*! ./LinkRenderLayer */ "./node_modules/xterm/lib/renderer/LinkRenderLayer.js");
var RenderDebouncer_1 = __webpack_require__(/*! ../ui/RenderDebouncer */ "./node_modules/xterm/lib/ui/RenderDebouncer.js");
var ScreenDprMonitor_1 = __webpack_require__(/*! ../ui/ScreenDprMonitor */ "./node_modules/xterm/lib/ui/ScreenDprMonitor.js");
var CharacterJoinerRegistry_1 = __webpack_require__(/*! ../renderer/CharacterJoinerRegistry */ "./node_modules/xterm/lib/renderer/CharacterJoinerRegistry.js");
var EventEmitter2_1 = __webpack_require__(/*! ../common/EventEmitter2 */ "./node_modules/xterm/lib/common/EventEmitter2.js");
var Lifecycle_1 = __webpack_require__(/*! ../common/Lifecycle */ "./node_modules/xterm/lib/common/Lifecycle.js");
var Renderer = (function (_super) {
    __extends(Renderer, _super);
    function Renderer(_terminal, theme) {
        var _this = _super.call(this) || this;
        _this._terminal = _terminal;
        _this._isPaused = false;
        _this._needsFullRefresh = false;
        _this._onCanvasResize = new EventEmitter2_1.EventEmitter2();
        _this._onRender = new EventEmitter2_1.EventEmitter2();
        var allowTransparency = _this._terminal.options.allowTransparency;
        _this.colorManager = new ColorManager_1.ColorManager(document, allowTransparency);
        _this._characterJoinerRegistry = new CharacterJoinerRegistry_1.CharacterJoinerRegistry(_terminal);
        if (theme) {
            _this.colorManager.setTheme(theme);
        }
        _this._renderLayers = [
            new TextRenderLayer_1.TextRenderLayer(_this._terminal.screenElement, 0, _this.colorManager.colors, _this._characterJoinerRegistry, allowTransparency),
            new SelectionRenderLayer_1.SelectionRenderLayer(_this._terminal.screenElement, 1, _this.colorManager.colors),
            new LinkRenderLayer_1.LinkRenderLayer(_this._terminal.screenElement, 2, _this.colorManager.colors, _this._terminal),
            new CursorRenderLayer_1.CursorRenderLayer(_this._terminal.screenElement, 3, _this.colorManager.colors)
        ];
        _this.dimensions = {
            scaledCharWidth: null,
            scaledCharHeight: null,
            scaledCellWidth: null,
            scaledCellHeight: null,
            scaledCharLeft: null,
            scaledCharTop: null,
            scaledCanvasWidth: null,
            scaledCanvasHeight: null,
            canvasWidth: null,
            canvasHeight: null,
            actualCellWidth: null,
            actualCellHeight: null
        };
        _this._devicePixelRatio = window.devicePixelRatio;
        _this._updateDimensions();
        _this.onOptionsChanged();
        _this._renderDebouncer = new RenderDebouncer_1.RenderDebouncer(_this._renderRows.bind(_this));
        _this._screenDprMonitor = new ScreenDprMonitor_1.ScreenDprMonitor();
        _this._screenDprMonitor.setListener(function () { return _this.onWindowResize(window.devicePixelRatio); });
        _this.register(_this._screenDprMonitor);
        if ('IntersectionObserver' in window) {
            var observer_1 = new IntersectionObserver(function (e) { return _this.onIntersectionChange(e[e.length - 1]); }, { threshold: 0 });
            observer_1.observe(_this._terminal.element);
            _this.register({ dispose: function () { return observer_1.disconnect(); } });
        }
        return _this;
    }
    Object.defineProperty(Renderer.prototype, "onCanvasResize", {
        get: function () { return this._onCanvasResize.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(Renderer.prototype, "onRender", {
        get: function () { return this._onRender.event; },
        enumerable: true,
        configurable: true
    });
    Renderer.prototype.dispose = function () {
        _super.prototype.dispose.call(this);
        this._renderLayers.forEach(function (l) { return l.dispose(); });
    };
    Renderer.prototype.onIntersectionChange = function (entry) {
        this._isPaused = entry.intersectionRatio === 0;
        if (!this._isPaused && this._needsFullRefresh) {
            this._terminal.refresh(0, this._terminal.rows - 1);
            this._needsFullRefresh = false;
        }
    };
    Renderer.prototype.onWindowResize = function (devicePixelRatio) {
        if (this._devicePixelRatio !== devicePixelRatio) {
            this._devicePixelRatio = devicePixelRatio;
            this.onResize(this._terminal.cols, this._terminal.rows);
        }
    };
    Renderer.prototype.setTheme = function (theme) {
        var _this = this;
        this.colorManager.setTheme(theme);
        this._renderLayers.forEach(function (l) {
            l.onThemeChanged(_this._terminal, _this.colorManager.colors);
            l.reset(_this._terminal);
        });
        if (this._isPaused) {
            this._needsFullRefresh = true;
        }
        else {
            this._terminal.refresh(0, this._terminal.rows - 1);
        }
        return this.colorManager.colors;
    };
    Renderer.prototype.onResize = function (cols, rows) {
        var _this = this;
        this._updateDimensions();
        this._renderLayers.forEach(function (l) { return l.resize(_this._terminal, _this.dimensions); });
        if (this._isPaused) {
            this._needsFullRefresh = true;
        }
        else {
            this._terminal.refresh(0, this._terminal.rows - 1);
        }
        this._terminal.screenElement.style.width = this.dimensions.canvasWidth + "px";
        this._terminal.screenElement.style.height = this.dimensions.canvasHeight + "px";
        this._onCanvasResize.fire({
            width: this.dimensions.canvasWidth,
            height: this.dimensions.canvasHeight
        });
    };
    Renderer.prototype.onCharSizeChanged = function () {
        this.onResize(this._terminal.cols, this._terminal.rows);
    };
    Renderer.prototype.onBlur = function () {
        var _this = this;
        this._runOperation(function (l) { return l.onBlur(_this._terminal); });
    };
    Renderer.prototype.onFocus = function () {
        var _this = this;
        this._runOperation(function (l) { return l.onFocus(_this._terminal); });
    };
    Renderer.prototype.onSelectionChanged = function (start, end, columnSelectMode) {
        var _this = this;
        if (columnSelectMode === void 0) { columnSelectMode = false; }
        this._runOperation(function (l) { return l.onSelectionChanged(_this._terminal, start, end, columnSelectMode); });
    };
    Renderer.prototype.onCursorMove = function () {
        var _this = this;
        this._runOperation(function (l) { return l.onCursorMove(_this._terminal); });
    };
    Renderer.prototype.onOptionsChanged = function () {
        var _this = this;
        this.colorManager.allowTransparency = this._terminal.options.allowTransparency;
        this._runOperation(function (l) { return l.onOptionsChanged(_this._terminal); });
    };
    Renderer.prototype.clear = function () {
        var _this = this;
        this._runOperation(function (l) { return l.reset(_this._terminal); });
    };
    Renderer.prototype._runOperation = function (operation) {
        if (this._isPaused) {
            this._needsFullRefresh = true;
        }
        else {
            this._renderLayers.forEach(function (l) { return operation(l); });
        }
    };
    Renderer.prototype.refreshRows = function (start, end) {
        if (this._isPaused) {
            this._needsFullRefresh = true;
            return;
        }
        this._renderDebouncer.refresh(start, end, this._terminal.rows);
    };
    Renderer.prototype._renderRows = function (start, end) {
        var _this = this;
        this._renderLayers.forEach(function (l) { return l.onGridChanged(_this._terminal, start, end); });
        this._onRender.fire({ start: start, end: end });
    };
    Renderer.prototype._updateDimensions = function () {
        if (!this._terminal.charMeasure.width || !this._terminal.charMeasure.height) {
            return;
        }
        this.dimensions.scaledCharWidth = Math.floor(this._terminal.charMeasure.width * window.devicePixelRatio);
        this.dimensions.scaledCharHeight = Math.ceil(this._terminal.charMeasure.height * window.devicePixelRatio);
        this.dimensions.scaledCellHeight = Math.floor(this.dimensions.scaledCharHeight * this._terminal.options.lineHeight);
        this.dimensions.scaledCharTop = this._terminal.options.lineHeight === 1 ? 0 : Math.round((this.dimensions.scaledCellHeight - this.dimensions.scaledCharHeight) / 2);
        this.dimensions.scaledCellWidth = this.dimensions.scaledCharWidth + Math.round(this._terminal.options.letterSpacing);
        this.dimensions.scaledCharLeft = Math.floor(this._terminal.options.letterSpacing / 2);
        this.dimensions.scaledCanvasHeight = this._terminal.rows * this.dimensions.scaledCellHeight;
        this.dimensions.scaledCanvasWidth = this._terminal.cols * this.dimensions.scaledCellWidth;
        this.dimensions.canvasHeight = Math.round(this.dimensions.scaledCanvasHeight / window.devicePixelRatio);
        this.dimensions.canvasWidth = Math.round(this.dimensions.scaledCanvasWidth / window.devicePixelRatio);
        this.dimensions.actualCellHeight = this.dimensions.canvasHeight / this._terminal.rows;
        this.dimensions.actualCellWidth = this.dimensions.canvasWidth / this._terminal.cols;
    };
    Renderer.prototype.registerCharacterJoiner = function (handler) {
        return this._characterJoinerRegistry.registerCharacterJoiner(handler);
    };
    Renderer.prototype.deregisterCharacterJoiner = function (joinerId) {
        return this._characterJoinerRegistry.deregisterCharacterJoiner(joinerId);
    };
    return Renderer;
}(Lifecycle_1.Disposable));
exports.Renderer = Renderer;
//# sourceMappingURL=Renderer.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/SelectionRenderLayer.js":
/*!*****************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/SelectionRenderLayer.js ***!
  \*****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var BaseRenderLayer_1 = __webpack_require__(/*! ./BaseRenderLayer */ "./node_modules/xterm/lib/renderer/BaseRenderLayer.js");
var SelectionRenderLayer = (function (_super) {
    __extends(SelectionRenderLayer, _super);
    function SelectionRenderLayer(container, zIndex, colors) {
        var _this = _super.call(this, container, 'selection', zIndex, true, colors) || this;
        _this._clearState();
        return _this;
    }
    SelectionRenderLayer.prototype._clearState = function () {
        this._state = {
            start: null,
            end: null,
            columnSelectMode: null,
            ydisp: null
        };
    };
    SelectionRenderLayer.prototype.resize = function (terminal, dim) {
        _super.prototype.resize.call(this, terminal, dim);
        this._clearState();
    };
    SelectionRenderLayer.prototype.reset = function (terminal) {
        if (this._state.start && this._state.end) {
            this._clearState();
            this.clearAll();
        }
    };
    SelectionRenderLayer.prototype.onSelectionChanged = function (terminal, start, end, columnSelectMode) {
        if (!this._didStateChange(start, end, columnSelectMode, terminal.buffer.ydisp)) {
            return;
        }
        this.clearAll();
        if (!start || !end) {
            this._clearState();
            return;
        }
        var viewportStartRow = start[1] - terminal.buffer.ydisp;
        var viewportEndRow = end[1] - terminal.buffer.ydisp;
        var viewportCappedStartRow = Math.max(viewportStartRow, 0);
        var viewportCappedEndRow = Math.min(viewportEndRow, terminal.rows - 1);
        if (viewportCappedStartRow >= terminal.rows || viewportCappedEndRow < 0) {
            return;
        }
        this._ctx.fillStyle = this._colors.selection.css;
        if (columnSelectMode) {
            var startCol = start[0];
            var width = end[0] - startCol;
            var height = viewportCappedEndRow - viewportCappedStartRow + 1;
            this.fillCells(startCol, viewportCappedStartRow, width, height);
        }
        else {
            var startCol = viewportStartRow === viewportCappedStartRow ? start[0] : 0;
            var startRowEndCol = viewportCappedStartRow === viewportCappedEndRow ? end[0] : terminal.cols;
            this.fillCells(startCol, viewportCappedStartRow, startRowEndCol - startCol, 1);
            var middleRowsCount = Math.max(viewportCappedEndRow - viewportCappedStartRow - 1, 0);
            this.fillCells(0, viewportCappedStartRow + 1, terminal.cols, middleRowsCount);
            if (viewportCappedStartRow !== viewportCappedEndRow) {
                var endCol = viewportEndRow === viewportCappedEndRow ? end[0] : terminal.cols;
                this.fillCells(0, viewportCappedEndRow, endCol, 1);
            }
        }
        this._state.start = [start[0], start[1]];
        this._state.end = [end[0], end[1]];
        this._state.columnSelectMode = columnSelectMode;
        this._state.ydisp = terminal.buffer.ydisp;
    };
    SelectionRenderLayer.prototype._didStateChange = function (start, end, columnSelectMode, ydisp) {
        return !this._areCoordinatesEqual(start, this._state.start) ||
            !this._areCoordinatesEqual(end, this._state.end) ||
            columnSelectMode !== this._state.columnSelectMode ||
            ydisp !== this._state.ydisp;
    };
    SelectionRenderLayer.prototype._areCoordinatesEqual = function (coord1, coord2) {
        if (!coord1 || !coord2) {
            return false;
        }
        return coord1[0] === coord2[0] && coord1[1] === coord2[1];
    };
    return SelectionRenderLayer;
}(BaseRenderLayer_1.BaseRenderLayer));
exports.SelectionRenderLayer = SelectionRenderLayer;
//# sourceMappingURL=SelectionRenderLayer.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/TextRenderLayer.js":
/*!************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/TextRenderLayer.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var GridCache_1 = __webpack_require__(/*! ./GridCache */ "./node_modules/xterm/lib/renderer/GridCache.js");
var BaseRenderLayer_1 = __webpack_require__(/*! ./BaseRenderLayer */ "./node_modules/xterm/lib/renderer/BaseRenderLayer.js");
var BufferLine_1 = __webpack_require__(/*! ../core/buffer/BufferLine */ "./node_modules/xterm/lib/core/buffer/BufferLine.js");
var CharacterJoinerRegistry_1 = __webpack_require__(/*! ./CharacterJoinerRegistry */ "./node_modules/xterm/lib/renderer/CharacterJoinerRegistry.js");
var TextRenderLayer = (function (_super) {
    __extends(TextRenderLayer, _super);
    function TextRenderLayer(container, zIndex, colors, characterJoinerRegistry, alpha) {
        var _this = _super.call(this, container, 'text', zIndex, alpha, colors) || this;
        _this._characterOverlapCache = {};
        _this._workCell = new BufferLine_1.CellData();
        _this._state = new GridCache_1.GridCache();
        _this._characterJoinerRegistry = characterJoinerRegistry;
        return _this;
    }
    TextRenderLayer.prototype.resize = function (terminal, dim) {
        _super.prototype.resize.call(this, terminal, dim);
        var terminalFont = this._getFont(terminal, false, false);
        if (this._characterWidth !== dim.scaledCharWidth || this._characterFont !== terminalFont) {
            this._characterWidth = dim.scaledCharWidth;
            this._characterFont = terminalFont;
            this._characterOverlapCache = {};
        }
        this._state.clear();
        this._state.resize(terminal.cols, terminal.rows);
    };
    TextRenderLayer.prototype.reset = function (terminal) {
        this._state.clear();
        this.clearAll();
    };
    TextRenderLayer.prototype._forEachCell = function (terminal, firstRow, lastRow, joinerRegistry, callback) {
        for (var y = firstRow; y <= lastRow; y++) {
            var row = y + terminal.buffer.ydisp;
            var line = terminal.buffer.lines.get(row);
            var joinedRanges = joinerRegistry ? joinerRegistry.getJoinedCharacters(row) : [];
            for (var x = 0; x < terminal.cols; x++) {
                line.loadCell(x, this._workCell);
                var cell = this._workCell;
                var isJoined = false;
                var lastCharX = x;
                if (cell.getWidth() === 0) {
                    continue;
                }
                if (joinedRanges.length > 0 && x === joinedRanges[0][0]) {
                    isJoined = true;
                    var range = joinedRanges.shift();
                    cell = new CharacterJoinerRegistry_1.JoinedCellData(this._workCell, line.translateToString(true, range[0], range[1]), range[1] - range[0]);
                    lastCharX = range[1] - 1;
                }
                if (!isJoined && this._isOverlapping(cell)) {
                    if (lastCharX < line.length - 1 && line.getCodePoint(lastCharX + 1) === BufferLine_1.NULL_CELL_CODE) {
                        cell.content &= ~12582912;
                        cell.content |= 2 << 22;
                    }
                }
                callback(cell, x, y);
                x = lastCharX;
            }
        }
    };
    TextRenderLayer.prototype._drawBackground = function (terminal, firstRow, lastRow) {
        var _this = this;
        var ctx = this._ctx;
        var cols = terminal.cols;
        var startX = 0;
        var startY = 0;
        var prevFillStyle = null;
        ctx.save();
        this._forEachCell(terminal, firstRow, lastRow, null, function (cell, x, y) {
            var nextFillStyle = null;
            if (cell.isInverse()) {
                if (cell.isFgDefault()) {
                    nextFillStyle = _this._colors.foreground.css;
                }
                else if (cell.isFgRGB()) {
                    nextFillStyle = "rgb(" + BufferLine_1.AttributeData.toColorRGB(cell.getFgColor()).join(',') + ")";
                }
                else {
                    nextFillStyle = _this._colors.ansi[cell.getFgColor()].css;
                }
            }
            else if (cell.isBgRGB()) {
                nextFillStyle = "rgb(" + BufferLine_1.AttributeData.toColorRGB(cell.getBgColor()).join(',') + ")";
            }
            else if (cell.isBgPalette()) {
                nextFillStyle = _this._colors.ansi[cell.getBgColor()].css;
            }
            if (prevFillStyle === null) {
                startX = x;
                startY = y;
            }
            if (y !== startY) {
                ctx.fillStyle = prevFillStyle;
                _this.fillCells(startX, startY, cols - startX, 1);
                startX = x;
                startY = y;
            }
            else if (prevFillStyle !== nextFillStyle) {
                ctx.fillStyle = prevFillStyle;
                _this.fillCells(startX, startY, x - startX, 1);
                startX = x;
                startY = y;
            }
            prevFillStyle = nextFillStyle;
        });
        if (prevFillStyle !== null) {
            ctx.fillStyle = prevFillStyle;
            this.fillCells(startX, startY, cols - startX, 1);
        }
        ctx.restore();
    };
    TextRenderLayer.prototype._drawForeground = function (terminal, firstRow, lastRow) {
        var _this = this;
        this._forEachCell(terminal, firstRow, lastRow, this._characterJoinerRegistry, function (cell, x, y) {
            if (cell.isInvisible()) {
                return;
            }
            if (cell.isUnderline()) {
                _this._ctx.save();
                if (cell.isInverse()) {
                    if (cell.isBgDefault()) {
                        _this._ctx.fillStyle = _this._colors.background.css;
                    }
                    else if (cell.isBgRGB()) {
                        _this._ctx.fillStyle = "rgb(" + BufferLine_1.AttributeData.toColorRGB(cell.getBgColor()).join(',') + ")";
                    }
                    else {
                        _this._ctx.fillStyle = _this._colors.ansi[cell.getBgColor()].css;
                    }
                }
                else {
                    if (cell.isFgDefault()) {
                        _this._ctx.fillStyle = _this._colors.foreground.css;
                    }
                    else if (cell.isFgRGB()) {
                        _this._ctx.fillStyle = "rgb(" + BufferLine_1.AttributeData.toColorRGB(cell.getFgColor()).join(',') + ")";
                    }
                    else {
                        var fg = cell.getFgColor();
                        if (terminal.options.drawBoldTextInBrightColors && cell.isBold() && fg < 8) {
                            fg += 8;
                        }
                        _this._ctx.fillStyle = _this._colors.ansi[fg].css;
                    }
                }
                _this.fillBottomLineAtCells(x, y, cell.getWidth());
                _this._ctx.restore();
            }
            _this.drawChars(terminal, cell, x, y);
        });
    };
    TextRenderLayer.prototype.onGridChanged = function (terminal, firstRow, lastRow) {
        if (this._state.cache.length === 0) {
            return;
        }
        if (this._charAtlas) {
            this._charAtlas.beginFrame();
        }
        this.clearCells(0, firstRow, terminal.cols, lastRow - firstRow + 1);
        this._drawBackground(terminal, firstRow, lastRow);
        this._drawForeground(terminal, firstRow, lastRow);
    };
    TextRenderLayer.prototype.onOptionsChanged = function (terminal) {
        this.setTransparency(terminal, terminal.options.allowTransparency);
    };
    TextRenderLayer.prototype._isOverlapping = function (cell) {
        if (cell.getWidth() !== 1) {
            return false;
        }
        if (cell.getCode() < 256) {
            return false;
        }
        var chars = cell.getChars();
        if (this._characterOverlapCache.hasOwnProperty(chars)) {
            return this._characterOverlapCache[chars];
        }
        this._ctx.save();
        this._ctx.font = this._characterFont;
        var overlaps = Math.floor(this._ctx.measureText(chars).width) > this._characterWidth;
        this._ctx.restore();
        this._characterOverlapCache[chars] = overlaps;
        return overlaps;
    };
    return TextRenderLayer;
}(BaseRenderLayer_1.BaseRenderLayer));
exports.TextRenderLayer = TextRenderLayer;
//# sourceMappingURL=TextRenderLayer.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/atlas/BaseCharAtlas.js":
/*!****************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/atlas/BaseCharAtlas.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var BaseCharAtlas = (function () {
    function BaseCharAtlas() {
        this._didWarmUp = false;
    }
    BaseCharAtlas.prototype.dispose = function () { };
    BaseCharAtlas.prototype.warmUp = function () {
        if (!this._didWarmUp) {
            this._doWarmUp();
            this._didWarmUp = true;
        }
    };
    BaseCharAtlas.prototype._doWarmUp = function () { };
    BaseCharAtlas.prototype.beginFrame = function () { };
    return BaseCharAtlas;
}());
exports.default = BaseCharAtlas;
//# sourceMappingURL=BaseCharAtlas.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/atlas/CharAtlasCache.js":
/*!*****************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/atlas/CharAtlasCache.js ***!
  \*****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var CharAtlasUtils_1 = __webpack_require__(/*! ./CharAtlasUtils */ "./node_modules/xterm/lib/renderer/atlas/CharAtlasUtils.js");
var DynamicCharAtlas_1 = __webpack_require__(/*! ./DynamicCharAtlas */ "./node_modules/xterm/lib/renderer/atlas/DynamicCharAtlas.js");
var NoneCharAtlas_1 = __webpack_require__(/*! ./NoneCharAtlas */ "./node_modules/xterm/lib/renderer/atlas/NoneCharAtlas.js");
var StaticCharAtlas_1 = __webpack_require__(/*! ./StaticCharAtlas */ "./node_modules/xterm/lib/renderer/atlas/StaticCharAtlas.js");
var charAtlasImplementations = {
    'none': NoneCharAtlas_1.default,
    'static': StaticCharAtlas_1.default,
    'dynamic': DynamicCharAtlas_1.default
};
var charAtlasCache = [];
function acquireCharAtlas(terminal, colors, scaledCharWidth, scaledCharHeight) {
    var newConfig = CharAtlasUtils_1.generateConfig(scaledCharWidth, scaledCharHeight, terminal, colors);
    for (var i = 0; i < charAtlasCache.length; i++) {
        var entry = charAtlasCache[i];
        var ownedByIndex = entry.ownedBy.indexOf(terminal);
        if (ownedByIndex >= 0) {
            if (CharAtlasUtils_1.configEquals(entry.config, newConfig)) {
                return entry.atlas;
            }
            if (entry.ownedBy.length === 1) {
                entry.atlas.dispose();
                charAtlasCache.splice(i, 1);
            }
            else {
                entry.ownedBy.splice(ownedByIndex, 1);
            }
            break;
        }
    }
    for (var i = 0; i < charAtlasCache.length; i++) {
        var entry = charAtlasCache[i];
        if (CharAtlasUtils_1.configEquals(entry.config, newConfig)) {
            entry.ownedBy.push(terminal);
            return entry.atlas;
        }
    }
    var newEntry = {
        atlas: new charAtlasImplementations[terminal.options.experimentalCharAtlas](document, newConfig),
        config: newConfig,
        ownedBy: [terminal]
    };
    charAtlasCache.push(newEntry);
    return newEntry.atlas;
}
exports.acquireCharAtlas = acquireCharAtlas;
function removeTerminalFromCache(terminal) {
    for (var i = 0; i < charAtlasCache.length; i++) {
        var index = charAtlasCache[i].ownedBy.indexOf(terminal);
        if (index !== -1) {
            if (charAtlasCache[i].ownedBy.length === 1) {
                charAtlasCache[i].atlas.dispose();
                charAtlasCache.splice(i, 1);
            }
            else {
                charAtlasCache[i].ownedBy.splice(index, 1);
            }
            break;
        }
    }
}
exports.removeTerminalFromCache = removeTerminalFromCache;
//# sourceMappingURL=CharAtlasCache.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/atlas/CharAtlasGenerator.js":
/*!*********************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/atlas/CharAtlasGenerator.js ***!
  \*********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var Platform_1 = __webpack_require__(/*! ../../common/Platform */ "./node_modules/xterm/lib/common/Platform.js");
var Types_1 = __webpack_require__(/*! ./Types */ "./node_modules/xterm/lib/renderer/atlas/Types.js");
function generateStaticCharAtlasTexture(context, canvasFactory, config) {
    var cellWidth = config.scaledCharWidth + Types_1.CHAR_ATLAS_CELL_SPACING;
    var cellHeight = config.scaledCharHeight + Types_1.CHAR_ATLAS_CELL_SPACING;
    var canvas = canvasFactory(255 * cellWidth, (2 + 16 + 16) * cellHeight);
    var ctx = canvas.getContext('2d', { alpha: config.allowTransparency });
    ctx.fillStyle = config.colors.background.css;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.fillStyle = config.colors.foreground.css;
    ctx.font = getFont(config.fontWeight, config);
    ctx.textBaseline = 'middle';
    for (var i = 0; i < 256; i++) {
        ctx.save();
        ctx.beginPath();
        ctx.rect(i * cellWidth, 0, cellWidth, cellHeight);
        ctx.clip();
        ctx.fillText(String.fromCharCode(i), i * cellWidth, cellHeight / 2);
        ctx.restore();
    }
    ctx.save();
    ctx.font = getFont(config.fontWeightBold, config);
    for (var i = 0; i < 256; i++) {
        ctx.save();
        ctx.beginPath();
        ctx.rect(i * cellWidth, cellHeight, cellWidth, cellHeight);
        ctx.clip();
        ctx.fillText(String.fromCharCode(i), i * cellWidth, cellHeight * 1.5);
        ctx.restore();
    }
    ctx.restore();
    ctx.font = getFont(config.fontWeight, config);
    for (var colorIndex = 0; colorIndex < 16; colorIndex++) {
        var y = (colorIndex + 2) * cellHeight;
        for (var i = 0; i < 256; i++) {
            ctx.save();
            ctx.beginPath();
            ctx.rect(i * cellWidth, y, cellWidth, cellHeight);
            ctx.clip();
            ctx.fillStyle = config.colors.ansi[colorIndex].css;
            ctx.fillText(String.fromCharCode(i), i * cellWidth, y + cellHeight / 2);
            ctx.restore();
        }
    }
    ctx.font = getFont(config.fontWeightBold, config);
    for (var colorIndex = 0; colorIndex < 16; colorIndex++) {
        var y = (colorIndex + 2 + 16) * cellHeight;
        for (var i = 0; i < 256; i++) {
            ctx.save();
            ctx.beginPath();
            ctx.rect(i * cellWidth, y, cellWidth, cellHeight);
            ctx.clip();
            ctx.fillStyle = config.colors.ansi[colorIndex].css;
            ctx.fillText(String.fromCharCode(i), i * cellWidth, y + cellHeight / 2);
            ctx.restore();
        }
    }
    ctx.restore();
    if (!('createImageBitmap' in context) || Platform_1.isFirefox || Platform_1.isSafari) {
        return canvas;
    }
    var charAtlasImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    clearColor(charAtlasImageData, config.colors.background);
    return context.createImageBitmap(charAtlasImageData);
}
exports.generateStaticCharAtlasTexture = generateStaticCharAtlasTexture;
function clearColor(imageData, color) {
    var isEmpty = true;
    var r = color.rgba >>> 24;
    var g = color.rgba >>> 16 & 0xFF;
    var b = color.rgba >>> 8 & 0xFF;
    for (var offset = 0; offset < imageData.data.length; offset += 4) {
        if (imageData.data[offset] === r &&
            imageData.data[offset + 1] === g &&
            imageData.data[offset + 2] === b) {
            imageData.data[offset + 3] = 0;
        }
        else {
            isEmpty = false;
        }
    }
    return isEmpty;
}
exports.clearColor = clearColor;
function getFont(fontWeight, config) {
    return fontWeight + " " + config.fontSize * config.devicePixelRatio + "px " + config.fontFamily;
}
//# sourceMappingURL=CharAtlasGenerator.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/atlas/CharAtlasUtils.js":
/*!*****************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/atlas/CharAtlasUtils.js ***!
  \*****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var Types_1 = __webpack_require__(/*! ../../common/Types */ "./node_modules/xterm/lib/common/Types.js");
function generateConfig(scaledCharWidth, scaledCharHeight, terminal, colors) {
    var clonedColors = {
        foreground: colors.foreground,
        background: colors.background,
        cursor: null,
        cursorAccent: null,
        selection: null,
        ansi: colors.ansi.slice(0, 16)
    };
    return {
        type: terminal.options.experimentalCharAtlas,
        devicePixelRatio: window.devicePixelRatio,
        scaledCharWidth: scaledCharWidth,
        scaledCharHeight: scaledCharHeight,
        fontFamily: terminal.options.fontFamily,
        fontSize: terminal.options.fontSize,
        fontWeight: terminal.options.fontWeight,
        fontWeightBold: terminal.options.fontWeightBold,
        allowTransparency: terminal.options.allowTransparency,
        colors: clonedColors
    };
}
exports.generateConfig = generateConfig;
function configEquals(a, b) {
    for (var i = 0; i < a.colors.ansi.length; i++) {
        if (a.colors.ansi[i].rgba !== b.colors.ansi[i].rgba) {
            return false;
        }
    }
    return a.type === b.type &&
        a.devicePixelRatio === b.devicePixelRatio &&
        a.fontFamily === b.fontFamily &&
        a.fontSize === b.fontSize &&
        a.fontWeight === b.fontWeight &&
        a.fontWeightBold === b.fontWeightBold &&
        a.allowTransparency === b.allowTransparency &&
        a.scaledCharWidth === b.scaledCharWidth &&
        a.scaledCharHeight === b.scaledCharHeight &&
        a.colors.foreground === b.colors.foreground &&
        a.colors.background === b.colors.background;
}
exports.configEquals = configEquals;
function is256Color(colorCode) {
    return colorCode < Types_1.DEFAULT_COLOR;
}
exports.is256Color = is256Color;
//# sourceMappingURL=CharAtlasUtils.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/atlas/DynamicCharAtlas.js":
/*!*******************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/atlas/DynamicCharAtlas.js ***!
  \*******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Types_1 = __webpack_require__(/*! ./Types */ "./node_modules/xterm/lib/renderer/atlas/Types.js");
var BaseCharAtlas_1 = __webpack_require__(/*! ./BaseCharAtlas */ "./node_modules/xterm/lib/renderer/atlas/BaseCharAtlas.js");
var ColorManager_1 = __webpack_require__(/*! ../ColorManager */ "./node_modules/xterm/lib/renderer/ColorManager.js");
var CharAtlasGenerator_1 = __webpack_require__(/*! ./CharAtlasGenerator */ "./node_modules/xterm/lib/renderer/atlas/CharAtlasGenerator.js");
var LRUMap_1 = __webpack_require__(/*! ./LRUMap */ "./node_modules/xterm/lib/renderer/atlas/LRUMap.js");
var Platform_1 = __webpack_require__(/*! ../../common/Platform */ "./node_modules/xterm/lib/common/Platform.js");
var TEXTURE_WIDTH = 1024;
var TEXTURE_HEIGHT = 1024;
var TRANSPARENT_COLOR = {
    css: 'rgba(0, 0, 0, 0)',
    rgba: 0
};
var FRAME_CACHE_DRAW_LIMIT = 100;
var GLYPH_BITMAP_COMMIT_DELAY = 100;
function getGlyphCacheKey(glyph) {
    return glyph.code << 21 | glyph.bg << 12 | glyph.fg << 3 | (glyph.bold ? 0 : 4) + (glyph.dim ? 0 : 2) + (glyph.italic ? 0 : 1);
}
exports.getGlyphCacheKey = getGlyphCacheKey;
var DynamicCharAtlas = (function (_super) {
    __extends(DynamicCharAtlas, _super);
    function DynamicCharAtlas(document, _config) {
        var _this = _super.call(this) || this;
        _this._config = _config;
        _this._drawToCacheCount = 0;
        _this._glyphsWaitingOnBitmap = [];
        _this._bitmapCommitTimeout = null;
        _this._bitmap = null;
        _this._cacheCanvas = document.createElement('canvas');
        _this._cacheCanvas.width = TEXTURE_WIDTH;
        _this._cacheCanvas.height = TEXTURE_HEIGHT;
        _this._cacheCtx = _this._cacheCanvas.getContext('2d', { alpha: true });
        var tmpCanvas = document.createElement('canvas');
        tmpCanvas.width = _this._config.scaledCharWidth;
        tmpCanvas.height = _this._config.scaledCharHeight;
        _this._tmpCtx = tmpCanvas.getContext('2d', { alpha: _this._config.allowTransparency });
        _this._width = Math.floor(TEXTURE_WIDTH / _this._config.scaledCharWidth);
        _this._height = Math.floor(TEXTURE_HEIGHT / _this._config.scaledCharHeight);
        var capacity = _this._width * _this._height;
        _this._cacheMap = new LRUMap_1.default(capacity);
        _this._cacheMap.prealloc(capacity);
        return _this;
    }
    DynamicCharAtlas.prototype.dispose = function () {
        if (this._bitmapCommitTimeout !== null) {
            window.clearTimeout(this._bitmapCommitTimeout);
            this._bitmapCommitTimeout = null;
        }
    };
    DynamicCharAtlas.prototype.beginFrame = function () {
        this._drawToCacheCount = 0;
    };
    DynamicCharAtlas.prototype.draw = function (ctx, glyph, x, y) {
        if (glyph.code === 32) {
            return true;
        }
        if (!this._canCache(glyph)) {
            return false;
        }
        var glyphKey = getGlyphCacheKey(glyph);
        var cacheValue = this._cacheMap.get(glyphKey);
        if (cacheValue !== null && cacheValue !== undefined) {
            this._drawFromCache(ctx, cacheValue, x, y);
            return true;
        }
        else if (this._drawToCacheCount < FRAME_CACHE_DRAW_LIMIT) {
            var index = void 0;
            if (this._cacheMap.size < this._cacheMap.capacity) {
                index = this._cacheMap.size;
            }
            else {
                index = this._cacheMap.peek().index;
            }
            var cacheValue_1 = this._drawToCache(glyph, index);
            this._cacheMap.set(glyphKey, cacheValue_1);
            this._drawFromCache(ctx, cacheValue_1, x, y);
            return true;
        }
        return false;
    };
    DynamicCharAtlas.prototype._canCache = function (glyph) {
        return glyph.code < 256;
    };
    DynamicCharAtlas.prototype._toCoordinateX = function (index) {
        return (index % this._width) * this._config.scaledCharWidth;
    };
    DynamicCharAtlas.prototype._toCoordinateY = function (index) {
        return Math.floor(index / this._width) * this._config.scaledCharHeight;
    };
    DynamicCharAtlas.prototype._drawFromCache = function (ctx, cacheValue, x, y) {
        if (cacheValue.isEmpty) {
            return;
        }
        var cacheX = this._toCoordinateX(cacheValue.index);
        var cacheY = this._toCoordinateY(cacheValue.index);
        ctx.drawImage(cacheValue.inBitmap ? this._bitmap : this._cacheCanvas, cacheX, cacheY, this._config.scaledCharWidth, this._config.scaledCharHeight, x, y, this._config.scaledCharWidth, this._config.scaledCharHeight);
    };
    DynamicCharAtlas.prototype._getColorFromAnsiIndex = function (idx) {
        if (idx < this._config.colors.ansi.length) {
            return this._config.colors.ansi[idx];
        }
        return ColorManager_1.DEFAULT_ANSI_COLORS[idx];
    };
    DynamicCharAtlas.prototype._getBackgroundColor = function (glyph) {
        if (this._config.allowTransparency) {
            return TRANSPARENT_COLOR;
        }
        else if (glyph.bg === Types_1.INVERTED_DEFAULT_COLOR) {
            return this._config.colors.foreground;
        }
        else if (glyph.bg < 256) {
            return this._getColorFromAnsiIndex(glyph.bg);
        }
        return this._config.colors.background;
    };
    DynamicCharAtlas.prototype._getForegroundColor = function (glyph) {
        if (glyph.fg === Types_1.INVERTED_DEFAULT_COLOR) {
            return this._config.colors.background;
        }
        else if (glyph.fg < 256) {
            return this._getColorFromAnsiIndex(glyph.fg);
        }
        return this._config.colors.foreground;
    };
    DynamicCharAtlas.prototype._drawToCache = function (glyph, index) {
        this._drawToCacheCount++;
        this._tmpCtx.save();
        var backgroundColor = this._getBackgroundColor(glyph);
        this._tmpCtx.globalCompositeOperation = 'copy';
        this._tmpCtx.fillStyle = backgroundColor.css;
        this._tmpCtx.fillRect(0, 0, this._config.scaledCharWidth, this._config.scaledCharHeight);
        this._tmpCtx.globalCompositeOperation = 'source-over';
        var fontWeight = glyph.bold ? this._config.fontWeightBold : this._config.fontWeight;
        var fontStyle = glyph.italic ? 'italic' : '';
        this._tmpCtx.font =
            fontStyle + " " + fontWeight + " " + this._config.fontSize * this._config.devicePixelRatio + "px " + this._config.fontFamily;
        this._tmpCtx.textBaseline = 'middle';
        this._tmpCtx.fillStyle = this._getForegroundColor(glyph).css;
        if (glyph.dim) {
            this._tmpCtx.globalAlpha = Types_1.DIM_OPACITY;
        }
        this._tmpCtx.fillText(glyph.chars, 0, this._config.scaledCharHeight / 2);
        this._tmpCtx.restore();
        var imageData = this._tmpCtx.getImageData(0, 0, this._config.scaledCharWidth, this._config.scaledCharHeight);
        var isEmpty = false;
        if (!this._config.allowTransparency) {
            isEmpty = CharAtlasGenerator_1.clearColor(imageData, backgroundColor);
        }
        var x = this._toCoordinateX(index);
        var y = this._toCoordinateY(index);
        this._cacheCtx.putImageData(imageData, x, y);
        var cacheValue = {
            index: index,
            isEmpty: isEmpty,
            inBitmap: false
        };
        this._addGlyphToBitmap(cacheValue);
        return cacheValue;
    };
    DynamicCharAtlas.prototype._addGlyphToBitmap = function (cacheValue) {
        var _this = this;
        if (!('createImageBitmap' in window) || Platform_1.isFirefox || Platform_1.isSafari) {
            return;
        }
        this._glyphsWaitingOnBitmap.push(cacheValue);
        if (this._bitmapCommitTimeout !== null) {
            return;
        }
        this._bitmapCommitTimeout = window.setTimeout(function () { return _this._generateBitmap(); }, GLYPH_BITMAP_COMMIT_DELAY);
    };
    DynamicCharAtlas.prototype._generateBitmap = function () {
        var _this = this;
        var glyphsMovingToBitmap = this._glyphsWaitingOnBitmap;
        this._glyphsWaitingOnBitmap = [];
        window.createImageBitmap(this._cacheCanvas).then(function (bitmap) {
            _this._bitmap = bitmap;
            for (var i = 0; i < glyphsMovingToBitmap.length; i++) {
                var value = glyphsMovingToBitmap[i];
                value.inBitmap = true;
            }
        });
        this._bitmapCommitTimeout = null;
    };
    return DynamicCharAtlas;
}(BaseCharAtlas_1.default));
exports.default = DynamicCharAtlas;
//# sourceMappingURL=DynamicCharAtlas.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/atlas/LRUMap.js":
/*!*********************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/atlas/LRUMap.js ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var LRUMap = (function () {
    function LRUMap(capacity) {
        this.capacity = capacity;
        this._map = {};
        this._head = null;
        this._tail = null;
        this._nodePool = [];
        this.size = 0;
    }
    LRUMap.prototype._unlinkNode = function (node) {
        var prev = node.prev;
        var next = node.next;
        if (node === this._head) {
            this._head = next;
        }
        if (node === this._tail) {
            this._tail = prev;
        }
        if (prev !== null) {
            prev.next = next;
        }
        if (next !== null) {
            next.prev = prev;
        }
    };
    LRUMap.prototype._appendNode = function (node) {
        var tail = this._tail;
        if (tail !== null) {
            tail.next = node;
        }
        node.prev = tail;
        node.next = null;
        this._tail = node;
        if (this._head === null) {
            this._head = node;
        }
    };
    LRUMap.prototype.prealloc = function (count) {
        var nodePool = this._nodePool;
        for (var i = 0; i < count; i++) {
            nodePool.push({
                prev: null,
                next: null,
                key: null,
                value: null
            });
        }
    };
    LRUMap.prototype.get = function (key) {
        var node = this._map[key];
        if (node !== undefined) {
            this._unlinkNode(node);
            this._appendNode(node);
            return node.value;
        }
        return null;
    };
    LRUMap.prototype.peekValue = function (key) {
        var node = this._map[key];
        if (node !== undefined) {
            return node.value;
        }
        return null;
    };
    LRUMap.prototype.peek = function () {
        var head = this._head;
        return head === null ? null : head.value;
    };
    LRUMap.prototype.set = function (key, value) {
        var node = this._map[key];
        if (node !== undefined) {
            node = this._map[key];
            this._unlinkNode(node);
            node.value = value;
        }
        else if (this.size >= this.capacity) {
            node = this._head;
            this._unlinkNode(node);
            delete this._map[node.key];
            node.key = key;
            node.value = value;
            this._map[key] = node;
        }
        else {
            var nodePool = this._nodePool;
            if (nodePool.length > 0) {
                node = nodePool.pop();
                node.key = key;
                node.value = value;
            }
            else {
                node = {
                    prev: null,
                    next: null,
                    key: key,
                    value: value
                };
            }
            this._map[key] = node;
            this.size++;
        }
        this._appendNode(node);
    };
    return LRUMap;
}());
exports.default = LRUMap;
//# sourceMappingURL=LRUMap.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/atlas/NoneCharAtlas.js":
/*!****************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/atlas/NoneCharAtlas.js ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var BaseCharAtlas_1 = __webpack_require__(/*! ./BaseCharAtlas */ "./node_modules/xterm/lib/renderer/atlas/BaseCharAtlas.js");
var NoneCharAtlas = (function (_super) {
    __extends(NoneCharAtlas, _super);
    function NoneCharAtlas(document, config) {
        return _super.call(this) || this;
    }
    NoneCharAtlas.prototype.draw = function (ctx, glyph, x, y) {
        return false;
    };
    return NoneCharAtlas;
}(BaseCharAtlas_1.default));
exports.default = NoneCharAtlas;
//# sourceMappingURL=NoneCharAtlas.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/atlas/StaticCharAtlas.js":
/*!******************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/atlas/StaticCharAtlas.js ***!
  \******************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Types_1 = __webpack_require__(/*! ./Types */ "./node_modules/xterm/lib/renderer/atlas/Types.js");
var CharAtlasGenerator_1 = __webpack_require__(/*! ./CharAtlasGenerator */ "./node_modules/xterm/lib/renderer/atlas/CharAtlasGenerator.js");
var BaseCharAtlas_1 = __webpack_require__(/*! ./BaseCharAtlas */ "./node_modules/xterm/lib/renderer/atlas/BaseCharAtlas.js");
var CharAtlasUtils_1 = __webpack_require__(/*! ./CharAtlasUtils */ "./node_modules/xterm/lib/renderer/atlas/CharAtlasUtils.js");
var Types_2 = __webpack_require__(/*! ../../common/Types */ "./node_modules/xterm/lib/common/Types.js");
var StaticCharAtlas = (function (_super) {
    __extends(StaticCharAtlas, _super);
    function StaticCharAtlas(_document, _config) {
        var _this = _super.call(this) || this;
        _this._document = _document;
        _this._config = _config;
        _this._canvasFactory = function (width, height) {
            var canvas = _this._document.createElement('canvas');
            canvas.width = width;
            canvas.height = height;
            return canvas;
        };
        return _this;
    }
    StaticCharAtlas.prototype._doWarmUp = function () {
        var _this = this;
        var result = CharAtlasGenerator_1.generateStaticCharAtlasTexture(window, this._canvasFactory, this._config);
        if (result instanceof HTMLCanvasElement) {
            this._texture = result;
        }
        else {
            result.then(function (texture) {
                _this._texture = texture;
            });
        }
    };
    StaticCharAtlas.prototype._isCached = function (glyph, colorIndex) {
        var isAscii = glyph.code < 256;
        var isBasicColor = glyph.fg < 16;
        var isDefaultColor = glyph.fg === Types_2.DEFAULT_COLOR;
        var isDefaultBackground = glyph.bg === Types_2.DEFAULT_COLOR;
        return isAscii && (isBasicColor || isDefaultColor) && isDefaultBackground && !glyph.italic;
    };
    StaticCharAtlas.prototype.draw = function (ctx, glyph, x, y) {
        if (this._texture === null || this._texture === undefined) {
            return false;
        }
        var colorIndex = 0;
        if (CharAtlasUtils_1.is256Color(glyph.fg)) {
            colorIndex = 2 + glyph.fg + (glyph.bold ? 16 : 0);
        }
        else if (glyph.fg === Types_2.DEFAULT_COLOR) {
            if (glyph.bold) {
                colorIndex = 1;
            }
        }
        if (!this._isCached(glyph, colorIndex)) {
            return false;
        }
        ctx.save();
        var charAtlasCellWidth = this._config.scaledCharWidth + Types_1.CHAR_ATLAS_CELL_SPACING;
        var charAtlasCellHeight = this._config.scaledCharHeight + Types_1.CHAR_ATLAS_CELL_SPACING;
        if (glyph.dim) {
            ctx.globalAlpha = Types_1.DIM_OPACITY;
        }
        ctx.drawImage(this._texture, glyph.code * charAtlasCellWidth, colorIndex * charAtlasCellHeight, charAtlasCellWidth, this._config.scaledCharHeight, x, y, charAtlasCellWidth, this._config.scaledCharHeight);
        ctx.restore();
        return true;
    };
    return StaticCharAtlas;
}(BaseCharAtlas_1.default));
exports.default = StaticCharAtlas;
//# sourceMappingURL=StaticCharAtlas.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/atlas/Types.js":
/*!********************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/atlas/Types.js ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
exports.INVERTED_DEFAULT_COLOR = 257;
exports.DIM_OPACITY = 0.5;
exports.CHAR_ATLAS_CELL_SPACING = 1;
//# sourceMappingURL=Types.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/dom/DomRenderer.js":
/*!************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/dom/DomRenderer.js ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var ColorManager_1 = __webpack_require__(/*! ../ColorManager */ "./node_modules/xterm/lib/renderer/ColorManager.js");
var RenderDebouncer_1 = __webpack_require__(/*! ../../ui/RenderDebouncer */ "./node_modules/xterm/lib/ui/RenderDebouncer.js");
var DomRendererRowFactory_1 = __webpack_require__(/*! ./DomRendererRowFactory */ "./node_modules/xterm/lib/renderer/dom/DomRendererRowFactory.js");
var Types_1 = __webpack_require__(/*! ../atlas/Types */ "./node_modules/xterm/lib/renderer/atlas/Types.js");
var EventEmitter2_1 = __webpack_require__(/*! ../../common/EventEmitter2 */ "./node_modules/xterm/lib/common/EventEmitter2.js");
var Lifecycle_1 = __webpack_require__(/*! ../../common/Lifecycle */ "./node_modules/xterm/lib/common/Lifecycle.js");
var TERMINAL_CLASS_PREFIX = 'xterm-dom-renderer-owner-';
var ROW_CONTAINER_CLASS = 'xterm-rows';
var FG_CLASS_PREFIX = 'xterm-fg-';
var BG_CLASS_PREFIX = 'xterm-bg-';
var FOCUS_CLASS = 'xterm-focus';
var SELECTION_CLASS = 'xterm-selection';
var nextTerminalId = 1;
var DomRenderer = (function (_super) {
    __extends(DomRenderer, _super);
    function DomRenderer(_terminal, theme) {
        var _this = _super.call(this) || this;
        _this._terminal = _terminal;
        _this._terminalClass = nextTerminalId++;
        _this._rowElements = [];
        _this._onCanvasResize = new EventEmitter2_1.EventEmitter2();
        _this._onRender = new EventEmitter2_1.EventEmitter2();
        var allowTransparency = _this._terminal.options.allowTransparency;
        _this.colorManager = new ColorManager_1.ColorManager(document, allowTransparency);
        _this.setTheme(theme);
        _this._rowContainer = document.createElement('div');
        _this._rowContainer.classList.add(ROW_CONTAINER_CLASS);
        _this._rowContainer.style.lineHeight = 'normal';
        _this._rowContainer.setAttribute('aria-hidden', 'true');
        _this._refreshRowElements(_this._terminal.cols, _this._terminal.rows);
        _this._selectionContainer = document.createElement('div');
        _this._selectionContainer.classList.add(SELECTION_CLASS);
        _this._selectionContainer.setAttribute('aria-hidden', 'true');
        _this.dimensions = {
            scaledCharWidth: null,
            scaledCharHeight: null,
            scaledCellWidth: null,
            scaledCellHeight: null,
            scaledCharLeft: null,
            scaledCharTop: null,
            scaledCanvasWidth: null,
            scaledCanvasHeight: null,
            canvasWidth: null,
            canvasHeight: null,
            actualCellWidth: null,
            actualCellHeight: null
        };
        _this._updateDimensions();
        _this._renderDebouncer = new RenderDebouncer_1.RenderDebouncer(_this._renderRows.bind(_this));
        _this._rowFactory = new DomRendererRowFactory_1.DomRendererRowFactory(_terminal.options, document);
        _this._terminal.element.classList.add(TERMINAL_CLASS_PREFIX + _this._terminalClass);
        _this._terminal.screenElement.appendChild(_this._rowContainer);
        _this._terminal.screenElement.appendChild(_this._selectionContainer);
        _this._terminal.linkifier.onLinkHover(function (e) { return _this._onLinkHover(e); });
        _this._terminal.linkifier.onLinkLeave(function (e) { return _this._onLinkLeave(e); });
        return _this;
    }
    Object.defineProperty(DomRenderer.prototype, "onCanvasResize", {
        get: function () { return this._onCanvasResize.event; },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(DomRenderer.prototype, "onRender", {
        get: function () { return this._onRender.event; },
        enumerable: true,
        configurable: true
    });
    DomRenderer.prototype.dispose = function () {
        this._terminal.element.classList.remove(TERMINAL_CLASS_PREFIX + this._terminalClass);
        this._terminal.screenElement.removeChild(this._rowContainer);
        this._terminal.screenElement.removeChild(this._selectionContainer);
        this._terminal.screenElement.removeChild(this._themeStyleElement);
        this._terminal.screenElement.removeChild(this._dimensionsStyleElement);
        _super.prototype.dispose.call(this);
    };
    DomRenderer.prototype._updateDimensions = function () {
        var _this = this;
        this.dimensions.scaledCharWidth = this._terminal.charMeasure.width * window.devicePixelRatio;
        this.dimensions.scaledCharHeight = Math.ceil(this._terminal.charMeasure.height * window.devicePixelRatio);
        this.dimensions.scaledCellWidth = this.dimensions.scaledCharWidth + Math.round(this._terminal.options.letterSpacing);
        this.dimensions.scaledCellHeight = Math.floor(this.dimensions.scaledCharHeight * this._terminal.options.lineHeight);
        this.dimensions.scaledCharLeft = 0;
        this.dimensions.scaledCharTop = 0;
        this.dimensions.scaledCanvasWidth = this.dimensions.scaledCellWidth * this._terminal.cols;
        this.dimensions.scaledCanvasHeight = this.dimensions.scaledCellHeight * this._terminal.rows;
        this.dimensions.canvasWidth = Math.round(this.dimensions.scaledCanvasWidth / window.devicePixelRatio);
        this.dimensions.canvasHeight = Math.round(this.dimensions.scaledCanvasHeight / window.devicePixelRatio);
        this.dimensions.actualCellWidth = this.dimensions.canvasWidth / this._terminal.cols;
        this.dimensions.actualCellHeight = this.dimensions.canvasHeight / this._terminal.rows;
        this._rowElements.forEach(function (element) {
            element.style.width = _this.dimensions.canvasWidth + "px";
            element.style.height = _this.dimensions.actualCellHeight + "px";
            element.style.lineHeight = _this.dimensions.actualCellHeight + "px";
            element.style.overflow = 'hidden';
        });
        if (!this._dimensionsStyleElement) {
            this._dimensionsStyleElement = document.createElement('style');
            this._terminal.screenElement.appendChild(this._dimensionsStyleElement);
        }
        var styles = this._terminalSelector + " ." + ROW_CONTAINER_CLASS + " span {" +
            " display: inline-block;" +
            " height: 100%;" +
            " vertical-align: top;" +
            (" width: " + this.dimensions.actualCellWidth + "px") +
            "}";
        this._dimensionsStyleElement.innerHTML = styles;
        this._selectionContainer.style.height = this._terminal._viewportElement.style.height;
        this._terminal.screenElement.style.width = this.dimensions.canvasWidth + "px";
        this._terminal.screenElement.style.height = this.dimensions.canvasHeight + "px";
    };
    DomRenderer.prototype.setTheme = function (theme) {
        var _this = this;
        if (theme) {
            this.colorManager.setTheme(theme);
        }
        if (!this._themeStyleElement) {
            this._themeStyleElement = document.createElement('style');
            this._terminal.screenElement.appendChild(this._themeStyleElement);
        }
        var styles = this._terminalSelector + " ." + ROW_CONTAINER_CLASS + " {" +
            (" color: " + this.colorManager.colors.foreground.css + ";") +
            (" background-color: " + this.colorManager.colors.background.css + ";") +
            (" font-family: " + this._terminal.options.fontFamily + ";") +
            (" font-size: " + this._terminal.options.fontSize + "px;") +
            "}";
        styles +=
            this._terminalSelector + " span:not(." + DomRendererRowFactory_1.BOLD_CLASS + ") {" +
                (" font-weight: " + this._terminal.options.fontWeight + ";") +
                "}" +
                (this._terminalSelector + " span." + DomRendererRowFactory_1.BOLD_CLASS + " {") +
                (" font-weight: " + this._terminal.options.fontWeightBold + ";") +
                "}" +
                (this._terminalSelector + " span." + DomRendererRowFactory_1.ITALIC_CLASS + " {") +
                " font-style: italic;" +
                "}";
        styles +=
            "@keyframes blink {" +
                " 0% { opacity: 1.0; }" +
                " 50% { opacity: 0.0; }" +
                " 100% { opacity: 1.0; }" +
                "}";
        styles +=
            this._terminalSelector + " ." + ROW_CONTAINER_CLASS + ":not(." + FOCUS_CLASS + ") ." + DomRendererRowFactory_1.CURSOR_CLASS + " {" +
                (" outline: 1px solid " + this.colorManager.colors.cursor.css + ";") +
                " outline-offset: -1px;" +
                "}" +
                (this._terminalSelector + " ." + ROW_CONTAINER_CLASS + "." + FOCUS_CLASS + " ." + DomRendererRowFactory_1.CURSOR_CLASS + "." + DomRendererRowFactory_1.CURSOR_BLINK_CLASS + " {") +
                " animation: blink 1s step-end infinite;" +
                "}" +
                (this._terminalSelector + " ." + ROW_CONTAINER_CLASS + "." + FOCUS_CLASS + " ." + DomRendererRowFactory_1.CURSOR_CLASS + "." + DomRendererRowFactory_1.CURSOR_STYLE_BLOCK_CLASS + " {") +
                (" background-color: " + this.colorManager.colors.cursor.css + ";") +
                (" color: " + this.colorManager.colors.cursorAccent.css + ";") +
                "}" +
                (this._terminalSelector + " ." + ROW_CONTAINER_CLASS + "." + FOCUS_CLASS + " ." + DomRendererRowFactory_1.CURSOR_CLASS + "." + DomRendererRowFactory_1.CURSOR_STYLE_BAR_CLASS + " {") +
                (" box-shadow: 1px 0 0 " + this.colorManager.colors.cursor.css + " inset;") +
                "}" +
                (this._terminalSelector + " ." + ROW_CONTAINER_CLASS + "." + FOCUS_CLASS + " ." + DomRendererRowFactory_1.CURSOR_CLASS + "." + DomRendererRowFactory_1.CURSOR_STYLE_UNDERLINE_CLASS + " {") +
                (" box-shadow: 0 -1px 0 " + this.colorManager.colors.cursor.css + " inset;") +
                "}";
        styles +=
            this._terminalSelector + " ." + SELECTION_CLASS + " {" +
                " position: absolute;" +
                " top: 0;" +
                " left: 0;" +
                " z-index: 1;" +
                " pointer-events: none;" +
                "}" +
                (this._terminalSelector + " ." + SELECTION_CLASS + " div {") +
                " position: absolute;" +
                (" background-color: " + this.colorManager.colors.selection.css + ";") +
                "}";
        this.colorManager.colors.ansi.forEach(function (c, i) {
            styles +=
                _this._terminalSelector + " ." + FG_CLASS_PREFIX + i + " { color: " + c.css + "; }" +
                    (_this._terminalSelector + " ." + BG_CLASS_PREFIX + i + " { background-color: " + c.css + "; }");
        });
        styles +=
            this._terminalSelector + " ." + FG_CLASS_PREFIX + Types_1.INVERTED_DEFAULT_COLOR + " { color: " + this.colorManager.colors.background.css + "; }" +
                (this._terminalSelector + " ." + BG_CLASS_PREFIX + Types_1.INVERTED_DEFAULT_COLOR + " { background-color: " + this.colorManager.colors.foreground.css + "; }");
        this._themeStyleElement.innerHTML = styles;
        return this.colorManager.colors;
    };
    DomRenderer.prototype.onWindowResize = function (devicePixelRatio) {
        this._updateDimensions();
    };
    DomRenderer.prototype._refreshRowElements = function (cols, rows) {
        for (var i = this._rowElements.length; i <= rows; i++) {
            var row = document.createElement('div');
            this._rowContainer.appendChild(row);
            this._rowElements.push(row);
        }
        while (this._rowElements.length > rows) {
            this._rowContainer.removeChild(this._rowElements.pop());
        }
    };
    DomRenderer.prototype.onResize = function (cols, rows) {
        this._refreshRowElements(cols, rows);
        this._updateDimensions();
        this._onCanvasResize.fire({
            width: this.dimensions.canvasWidth,
            height: this.dimensions.canvasHeight
        });
    };
    DomRenderer.prototype.onCharSizeChanged = function () {
        this._updateDimensions();
    };
    DomRenderer.prototype.onBlur = function () {
        this._rowContainer.classList.remove(FOCUS_CLASS);
    };
    DomRenderer.prototype.onFocus = function () {
        this._rowContainer.classList.add(FOCUS_CLASS);
    };
    DomRenderer.prototype.onSelectionChanged = function (start, end, columnSelectMode) {
        while (this._selectionContainer.children.length) {
            this._selectionContainer.removeChild(this._selectionContainer.children[0]);
        }
        if (!start || !end) {
            return;
        }
        var viewportStartRow = start[1] - this._terminal.buffer.ydisp;
        var viewportEndRow = end[1] - this._terminal.buffer.ydisp;
        var viewportCappedStartRow = Math.max(viewportStartRow, 0);
        var viewportCappedEndRow = Math.min(viewportEndRow, this._terminal.rows - 1);
        if (viewportCappedStartRow >= this._terminal.rows || viewportCappedEndRow < 0) {
            return;
        }
        var documentFragment = document.createDocumentFragment();
        if (columnSelectMode) {
            documentFragment.appendChild(this._createSelectionElement(viewportCappedStartRow, start[0], end[0], viewportCappedEndRow - viewportCappedStartRow + 1));
        }
        else {
            var startCol = viewportStartRow === viewportCappedStartRow ? start[0] : 0;
            var endCol = viewportCappedStartRow === viewportCappedEndRow ? end[0] : this._terminal.cols;
            documentFragment.appendChild(this._createSelectionElement(viewportCappedStartRow, startCol, endCol));
            var middleRowsCount = viewportCappedEndRow - viewportCappedStartRow - 1;
            documentFragment.appendChild(this._createSelectionElement(viewportCappedStartRow + 1, 0, this._terminal.cols, middleRowsCount));
            if (viewportCappedStartRow !== viewportCappedEndRow) {
                var endCol_1 = viewportEndRow === viewportCappedEndRow ? end[0] : this._terminal.cols;
                documentFragment.appendChild(this._createSelectionElement(viewportCappedEndRow, 0, endCol_1));
            }
        }
        this._selectionContainer.appendChild(documentFragment);
    };
    DomRenderer.prototype._createSelectionElement = function (row, colStart, colEnd, rowCount) {
        if (rowCount === void 0) { rowCount = 1; }
        var element = document.createElement('div');
        element.style.height = rowCount * this.dimensions.actualCellHeight + "px";
        element.style.top = row * this.dimensions.actualCellHeight + "px";
        element.style.left = colStart * this.dimensions.actualCellWidth + "px";
        element.style.width = this.dimensions.actualCellWidth * (colEnd - colStart) + "px";
        return element;
    };
    DomRenderer.prototype.onCursorMove = function () {
    };
    DomRenderer.prototype.onOptionsChanged = function () {
        this._updateDimensions();
        this.setTheme(undefined);
        this._terminal.refresh(0, this._terminal.rows - 1);
    };
    DomRenderer.prototype.clear = function () {
        this._rowElements.forEach(function (e) { return e.innerHTML = ''; });
    };
    DomRenderer.prototype.refreshRows = function (start, end) {
        this._renderDebouncer.refresh(start, end, this._terminal.rows);
    };
    DomRenderer.prototype._renderRows = function (start, end) {
        var terminal = this._terminal;
        var cursorAbsoluteY = terminal.buffer.ybase + terminal.buffer.y;
        var cursorX = this._terminal.buffer.x;
        var cursorBlink = this._terminal.options.cursorBlink;
        for (var y = start; y <= end; y++) {
            var rowElement = this._rowElements[y];
            rowElement.innerHTML = '';
            var row = y + terminal.buffer.ydisp;
            var lineData = terminal.buffer.lines.get(row);
            var cursorStyle = terminal.options.cursorStyle;
            rowElement.appendChild(this._rowFactory.createRow(lineData, row === cursorAbsoluteY, cursorStyle, cursorX, cursorBlink, this.dimensions.actualCellWidth, terminal.cols));
        }
        this._onRender.fire({ start: start, end: end });
    };
    Object.defineProperty(DomRenderer.prototype, "_terminalSelector", {
        get: function () {
            return "." + TERMINAL_CLASS_PREFIX + this._terminalClass;
        },
        enumerable: true,
        configurable: true
    });
    DomRenderer.prototype.registerCharacterJoiner = function (handler) { return -1; };
    DomRenderer.prototype.deregisterCharacterJoiner = function (joinerId) { return false; };
    DomRenderer.prototype._onLinkHover = function (e) {
        this._setCellUnderline(e.x1, e.x2, e.y1, e.y2, e.cols, true);
    };
    DomRenderer.prototype._onLinkLeave = function (e) {
        this._setCellUnderline(e.x1, e.x2, e.y1, e.y2, e.cols, false);
    };
    DomRenderer.prototype._setCellUnderline = function (x, x2, y, y2, cols, enabled) {
        while (x !== x2 || y !== y2) {
            var row = this._rowElements[y];
            if (!row) {
                return;
            }
            var span = row.children[x];
            if (span) {
                span.style.textDecoration = enabled ? 'underline' : 'none';
            }
            if (++x >= cols) {
                x = 0;
                y++;
            }
        }
    };
    return DomRenderer;
}(Lifecycle_1.Disposable));
exports.DomRenderer = DomRenderer;
//# sourceMappingURL=DomRenderer.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/renderer/dom/DomRendererRowFactory.js":
/*!**********************************************************************!*\
  !*** ./node_modules/xterm/lib/renderer/dom/DomRendererRowFactory.js ***!
  \**********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var Types_1 = __webpack_require__(/*! ../atlas/Types */ "./node_modules/xterm/lib/renderer/atlas/Types.js");
var BufferLine_1 = __webpack_require__(/*! ../../core/buffer/BufferLine */ "./node_modules/xterm/lib/core/buffer/BufferLine.js");
exports.BOLD_CLASS = 'xterm-bold';
exports.DIM_CLASS = 'xterm-dim';
exports.ITALIC_CLASS = 'xterm-italic';
exports.UNDERLINE_CLASS = 'xterm-underline';
exports.CURSOR_CLASS = 'xterm-cursor';
exports.CURSOR_BLINK_CLASS = 'xterm-cursor-blink';
exports.CURSOR_STYLE_BLOCK_CLASS = 'xterm-cursor-block';
exports.CURSOR_STYLE_BAR_CLASS = 'xterm-cursor-bar';
exports.CURSOR_STYLE_UNDERLINE_CLASS = 'xterm-cursor-underline';
var DomRendererRowFactory = (function () {
    function DomRendererRowFactory(_terminalOptions, _document) {
        this._terminalOptions = _terminalOptions;
        this._document = _document;
        this._workCell = new BufferLine_1.CellData();
    }
    DomRendererRowFactory.prototype.createRow = function (lineData, isCursorRow, cursorStyle, cursorX, cursorBlink, cellWidth, cols) {
        var fragment = this._document.createDocumentFragment();
        var lineLength = 0;
        for (var x = Math.min(lineData.length, cols) - 1; x >= 0; x--) {
            if (lineData.loadCell(x, this._workCell).getCode() !== BufferLine_1.NULL_CELL_CODE || (isCursorRow && x === cursorX)) {
                lineLength = x + 1;
                break;
            }
        }
        for (var x = 0; x < lineLength; x++) {
            lineData.loadCell(x, this._workCell);
            var width = this._workCell.getWidth();
            if (width === 0) {
                continue;
            }
            var charElement = this._document.createElement('span');
            if (width > 1) {
                charElement.style.width = cellWidth * width + "px";
            }
            if (isCursorRow && x === cursorX) {
                charElement.classList.add(exports.CURSOR_CLASS);
                if (cursorBlink) {
                    charElement.classList.add(exports.CURSOR_BLINK_CLASS);
                }
                switch (cursorStyle) {
                    case 'bar':
                        charElement.classList.add(exports.CURSOR_STYLE_BAR_CLASS);
                        break;
                    case 'underline':
                        charElement.classList.add(exports.CURSOR_STYLE_UNDERLINE_CLASS);
                        break;
                    default:
                        charElement.classList.add(exports.CURSOR_STYLE_BLOCK_CLASS);
                        break;
                }
            }
            if (this._workCell.isBold() && this._terminalOptions.enableBold) {
                charElement.classList.add(exports.BOLD_CLASS);
            }
            if (this._workCell.isItalic()) {
                charElement.classList.add(exports.ITALIC_CLASS);
            }
            if (this._workCell.isDim()) {
                charElement.classList.add(exports.DIM_CLASS);
            }
            if (this._workCell.isUnderline()) {
                charElement.classList.add(exports.UNDERLINE_CLASS);
            }
            charElement.textContent = this._workCell.getChars() || BufferLine_1.WHITESPACE_CELL_CHAR;
            var swapColor = this._workCell.isInverse();
            if (this._workCell.isFgRGB()) {
                var style = charElement.getAttribute('style') || '';
                style += (swapColor ? 'background-' : '') + "color:rgb(" + (BufferLine_1.AttributeData.toColorRGB(this._workCell.getFgColor())).join(',') + ");";
                charElement.setAttribute('style', style);
            }
            else if (this._workCell.isFgPalette()) {
                var fg = this._workCell.getFgColor();
                if (this._workCell.isBold() && fg < 8 && !swapColor &&
                    this._terminalOptions.enableBold && this._terminalOptions.drawBoldTextInBrightColors) {
                    fg += 8;
                }
                charElement.classList.add("xterm-" + (swapColor ? 'b' : 'f') + "g-" + fg);
            }
            else if (swapColor) {
                charElement.classList.add("xterm-bg-" + Types_1.INVERTED_DEFAULT_COLOR);
            }
            if (this._workCell.isBgRGB()) {
                var style = charElement.getAttribute('style') || '';
                style += (swapColor ? '' : 'background-') + "color:rgb(" + (BufferLine_1.AttributeData.toColorRGB(this._workCell.getBgColor())).join(',') + ");";
                charElement.setAttribute('style', style);
            }
            else if (this._workCell.isBgPalette()) {
                charElement.classList.add("xterm-" + (swapColor ? 'f' : 'b') + "g-" + this._workCell.getBgColor());
            }
            else if (swapColor) {
                charElement.classList.add("xterm-fg-" + Types_1.INVERTED_DEFAULT_COLOR);
            }
            fragment.appendChild(charElement);
        }
        return fragment;
    };
    return DomRendererRowFactory;
}());
exports.DomRendererRowFactory = DomRendererRowFactory;
//# sourceMappingURL=DomRendererRowFactory.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/ui/Lifecycle.js":
/*!************************************************!*\
  !*** ./node_modules/xterm/lib/ui/Lifecycle.js ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
function addDisposableDomListener(node, type, handler, useCapture) {
    node.addEventListener(type, handler, useCapture);
    return {
        dispose: function () {
            if (!handler) {
                return;
            }
            node.removeEventListener(type, handler, useCapture);
        }
    };
}
exports.addDisposableDomListener = addDisposableDomListener;
//# sourceMappingURL=Lifecycle.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/ui/RenderDebouncer.js":
/*!******************************************************!*\
  !*** ./node_modules/xterm/lib/ui/RenderDebouncer.js ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var RenderDebouncer = (function () {
    function RenderDebouncer(_renderCallback) {
        this._renderCallback = _renderCallback;
    }
    RenderDebouncer.prototype.dispose = function () {
        if (this._animationFrame) {
            window.cancelAnimationFrame(this._animationFrame);
            this._animationFrame = undefined;
        }
    };
    RenderDebouncer.prototype.refresh = function (rowStart, rowEnd, rowCount) {
        var _this = this;
        this._rowCount = rowCount;
        rowStart = rowStart !== undefined ? rowStart : 0;
        rowEnd = rowEnd !== undefined ? rowEnd : this._rowCount - 1;
        this._rowStart = this._rowStart !== undefined ? Math.min(this._rowStart, rowStart) : rowStart;
        this._rowEnd = this._rowEnd !== undefined ? Math.max(this._rowEnd, rowEnd) : rowEnd;
        if (this._animationFrame) {
            return;
        }
        this._animationFrame = window.requestAnimationFrame(function () { return _this._innerRefresh(); });
    };
    RenderDebouncer.prototype._innerRefresh = function () {
        if (this._rowStart === undefined || this._rowEnd === undefined || this._rowCount === undefined) {
            return;
        }
        this._rowStart = Math.max(this._rowStart, 0);
        this._rowEnd = Math.min(this._rowEnd, this._rowCount - 1);
        this._renderCallback(this._rowStart, this._rowEnd);
        this._rowStart = undefined;
        this._rowEnd = undefined;
        this._animationFrame = undefined;
    };
    return RenderDebouncer;
}());
exports.RenderDebouncer = RenderDebouncer;
//# sourceMappingURL=RenderDebouncer.js.map

/***/ }),

/***/ "./node_modules/xterm/lib/ui/ScreenDprMonitor.js":
/*!*******************************************************!*\
  !*** ./node_modules/xterm/lib/ui/ScreenDprMonitor.js ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
var Lifecycle_1 = __webpack_require__(/*! ../common/Lifecycle */ "./node_modules/xterm/lib/common/Lifecycle.js");
var ScreenDprMonitor = (function (_super) {
    __extends(ScreenDprMonitor, _super);
    function ScreenDprMonitor() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this._currentDevicePixelRatio = window.devicePixelRatio;
        return _this;
    }
    ScreenDprMonitor.prototype.setListener = function (listener) {
        var _this = this;
        if (this._listener) {
            this.clearListener();
        }
        this._listener = listener;
        this._outerListener = function () {
            if (!_this._listener) {
                return;
            }
            _this._listener(window.devicePixelRatio, _this._currentDevicePixelRatio);
            _this._updateDpr();
        };
        this._updateDpr();
    };
    ScreenDprMonitor.prototype.dispose = function () {
        _super.prototype.dispose.call(this);
        this.clearListener();
    };
    ScreenDprMonitor.prototype._updateDpr = function () {
        if (!this._resolutionMediaMatchList || !this._outerListener) {
            return;
        }
        this._resolutionMediaMatchList.removeListener(this._outerListener);
        this._currentDevicePixelRatio = window.devicePixelRatio;
        this._resolutionMediaMatchList = window.matchMedia("screen and (resolution: " + window.devicePixelRatio + "dppx)");
        this._resolutionMediaMatchList.addListener(this._outerListener);
    };
    ScreenDprMonitor.prototype.clearListener = function () {
        if (!this._resolutionMediaMatchList || !this._listener || !this._outerListener) {
            return;
        }
        this._resolutionMediaMatchList.removeListener(this._outerListener);
        this._resolutionMediaMatchList = undefined;
        this._listener = undefined;
        this._outerListener = undefined;
    };
    return ScreenDprMonitor;
}(Lifecycle_1.Disposable));
exports.ScreenDprMonitor = ScreenDprMonitor;
//# sourceMappingURL=ScreenDprMonitor.js.map

/***/ }),

/***/ "./test/client.ts":
/*!************************!*\
  !*** ./test/client.ts ***!
  \************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var xterm_1 = __webpack_require__(/*! xterm */ "./node_modules/xterm/lib/public/Terminal.js");
var __1 = __webpack_require__(/*! .. */ "./lib/AttachAddon.js");
window.Terminal = xterm_1.Terminal;
window.AttachAddon = __1.AttachAddon;


/***/ })

/******/ });
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL0F0dGFjaEFkZG9uLnRzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvQWNjZXNzaWJpbGl0eU1hbmFnZXIuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9CdWZmZXIuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9CdWZmZXJSZWZsb3cuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9CdWZmZXJTZXQuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9DaGFyTWVhc3VyZS5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL0NoYXJXaWR0aC5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL0NsaXBib2FyZC5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL0NvbXBvc2l0aW9uSGVscGVyLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvRXNjYXBlU2VxdWVuY2VQYXJzZXIuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9JbnB1dEhhbmRsZXIuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9MaW5raWZpZXIuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9Nb3VzZUhlbHBlci5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL01vdXNlWm9uZU1hbmFnZXIuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9TZWxlY3Rpb25NYW5hZ2VyLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvU2VsZWN0aW9uTW9kZWwuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9Tb3VuZE1hbmFnZXIuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9TdHJpbmdzLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvVGVybWluYWwuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9WaWV3cG9ydC5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL1dpbmRvd3NNb2RlLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvY29tbW9uL0NpcmN1bGFyTGlzdC5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL2NvbW1vbi9DbG9uZS5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL2NvbW1vbi9FdmVudEVtaXR0ZXIuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9jb21tb24vRXZlbnRFbWl0dGVyMi5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL2NvbW1vbi9MaWZlY3ljbGUuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9jb21tb24vUGxhdGZvcm0uanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9jb21tb24vVHlwZWRBcnJheVV0aWxzLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvY29tbW9uL1R5cGVzLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvY29tbW9uL2RhdGEvRXNjYXBlU2VxdWVuY2VzLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvY29yZS9idWZmZXIvQnVmZmVyTGluZS5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL2NvcmUvZGF0YS9DaGFyc2V0cy5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL2NvcmUvaW5wdXQvS2V5Ym9hcmQuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9jb3JlL2lucHV0L1RleHREZWNvZGVyLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvaGFuZGxlcnMvQWx0Q2xpY2tIYW5kbGVyLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvcHVibGljL0FkZG9uTWFuYWdlci5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3B1YmxpYy9UZXJtaW5hbC5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3JlbmRlcmVyL0Jhc2VSZW5kZXJMYXllci5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3JlbmRlcmVyL0NoYXJhY3RlckpvaW5lclJlZ2lzdHJ5LmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvcmVuZGVyZXIvQ29sb3JNYW5hZ2VyLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvcmVuZGVyZXIvQ3Vyc29yUmVuZGVyTGF5ZXIuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9yZW5kZXJlci9HcmlkQ2FjaGUuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9yZW5kZXJlci9MaW5rUmVuZGVyTGF5ZXIuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9yZW5kZXJlci9SZW5kZXJlci5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3JlbmRlcmVyL1NlbGVjdGlvblJlbmRlckxheWVyLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvcmVuZGVyZXIvVGV4dFJlbmRlckxheWVyLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvcmVuZGVyZXIvYXRsYXMvQmFzZUNoYXJBdGxhcy5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3JlbmRlcmVyL2F0bGFzL0NoYXJBdGxhc0NhY2hlLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvcmVuZGVyZXIvYXRsYXMvQ2hhckF0bGFzR2VuZXJhdG9yLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvcmVuZGVyZXIvYXRsYXMvQ2hhckF0bGFzVXRpbHMuanMiLCJ3ZWJwYWNrOi8vLy4vbm9kZV9tb2R1bGVzL3h0ZXJtL2xpYi9yZW5kZXJlci9hdGxhcy9EeW5hbWljQ2hhckF0bGFzLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvcmVuZGVyZXIvYXRsYXMvTFJVTWFwLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvcmVuZGVyZXIvYXRsYXMvTm9uZUNoYXJBdGxhcy5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3JlbmRlcmVyL2F0bGFzL1N0YXRpY0NoYXJBdGxhcy5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3JlbmRlcmVyL2F0bGFzL1R5cGVzLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvcmVuZGVyZXIvZG9tL0RvbVJlbmRlcmVyLmpzIiwid2VicGFjazovLy8uL25vZGVfbW9kdWxlcy94dGVybS9saWIvcmVuZGVyZXIvZG9tL0RvbVJlbmRlcmVyUm93RmFjdG9yeS5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3VpL0xpZmVjeWNsZS5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3VpL1JlbmRlckRlYm91bmNlci5qcyIsIndlYnBhY2s6Ly8vLi9ub2RlX21vZHVsZXMveHRlcm0vbGliL3VpL1NjcmVlbkRwck1vbml0b3IuanMiLCJ3ZWJwYWNrOi8vLy4vdGVzdC9jbGllbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOzs7QUFHQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0Esa0RBQTBDLGdDQUFnQztBQUMxRTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBLGdFQUF3RCxrQkFBa0I7QUFDMUU7QUFDQSx5REFBaUQsY0FBYztBQUMvRDs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaURBQXlDLGlDQUFpQztBQUMxRSx3SEFBZ0gsbUJBQW1CLEVBQUU7QUFDckk7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBMkIsMEJBQTBCLEVBQUU7QUFDdkQseUNBQWlDLGVBQWU7QUFDaEQ7QUFDQTtBQUNBOztBQUVBO0FBQ0EsOERBQXNELCtEQUErRDs7QUFFckg7QUFDQTs7O0FBR0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7O0FDdERBO0lBTUUscUJBQVksTUFBaUIsRUFBRSxPQUF3QjtRQUYvQyxpQkFBWSxHQUFrQixFQUFFLENBQUM7UUFHdkMsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLENBQUM7UUFFdEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxVQUFVLEdBQUcsYUFBYSxDQUFDO1FBQ3hDLElBQUksQ0FBQyxjQUFjLEdBQUcsQ0FBQyxPQUFPLElBQUksT0FBTyxDQUFDLGFBQWEsS0FBSyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7UUFDbEYsSUFBSSxDQUFDLEtB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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsdUJBQXVCO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0MsYUFBYTtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3Q0FBd0MsYUFBYTtBQUNyRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsdUJBQXVCO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FB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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EscUM7Ozs7Ozs7Ozs7OztBQzdJYTtBQUNiLDhDQUE4QyxjQUFjO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQzs7Ozs7Ozs7Ozs7O0FDOUVhO0FBQ2IsOENBQThDLGNBQWM7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUM7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsYUFBYTtBQUNiO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixZQUFZO0FBQ25DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUJBQXlCO0FBQ3pCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsUUFBUTtBQUNsQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDZCQUE2QixXQUFXO0FBQ3hDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsbUJBQW1CO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLHlCQUF5QjtBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1RUFBdUU7QUFDdkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1RUFBdUUsSUFBSTtBQUMzRTtBQUNBO0FBQ0Esd0VBQXdFLEdBQUc7QUFDM0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdFQUF3RSxNQUFNO0FBQzlFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixtQkFBbUI7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLG1CQUFtQjtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixPQUFPO0FBQzlCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2RUFBNkU7QUFDN0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDhFQUE4RTtBQUM5RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlFQUFpRSw0QkFBNEIsRUFBRTtBQUMvRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDRFQUE0RSw4QkFBOEIsRUFBRTtBQUM1RztBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsZ0JBQWdCO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGlEQUFpRCxnQ0FBZ0M7QUFDakYsaURBQWlELGdDQUFnQztBQUNqRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGdCQUFnQjtBQUNoQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSw0Qzs7Ozs7Ozs7Ozs7O0FDbmtCYTtBQUNiLDhDQUE4QyxjQUFjO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLDBDOzs7Ozs7Ozs7Ozs7QUM5RWE7QUFDYiw4Q0FBOEMsY0FBYztBQUM1RCw2Q0FBNkM7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Es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QUNBO0FBQ0E7QUFDQTtBQUNBLGlDQUFpQyxzQkFBc0I7QUFDdkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EseUVBQXlFLGNBQWM7QUFDdkY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQSx3QkFBd0I7QUFDeEI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsc0JBQXNCO0FBQ3pEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsbUJBQW1CO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHNDQUFzQyxrQkFBa0I7QUFDeEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esb0NBQW9DLHdDQUF3QyxFQUFFO0FBQzlFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLG1DQUFtQztBQUM3RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIseUJBQXlCO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLG1CQUFtQjtBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLGVBQWU7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG9DOzs7Ozs7Ozs7Ozs7QUMzeUNhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsY0FBYyxnQkFBZ0Isc0NBQXNDLGlCQUFpQixFQUFFO0FBQ3ZGLDZCQUE2Qix1REFBdUQ7QUFDcEY7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsc0JBQXNCO0FBQzdDO0FBQ0E7QUFDQSxDQUFDO0FBQ0QsOENBQThDLGNBQWM7QUFDNUQsa0JBQWtCLG1CQUFPLENBQUMsd0VBQW9CO0FBQzlDLGtCQUFrQixtQkFBTyxDQUFDLGdFQUFnQjtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsZ0NBQWdDLCtCQUErQixFQUFFO0FBQ2pFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2RUFBNkUsOEJBQThCLEVBQUU7QUFDN0c7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxvQzs7Ozs7Ozs7Ozs7O0FDM0phO0FBQ2IsOENBQThDLGNBQWM7QUFDNUQsbUJBQW1CLG1CQUFPLENBQUMsb0ZBQTBCO0FBQ3JEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLHVDOzs7Ozs7Ozs7Ozs7QUNkYTtBQUNiLDhDQUE4QyxjQUFjO0FBQzVELHNCQUFzQixtQkFBTyxDQUFDLHlFQUFpQjtBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMEJBQTBCLG1DQUFtQyxFQUFFO0FBQy9EO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSwwQkFBMEIsbUNBQW1DLEVBQUU7QUFDL0Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLDBCQUEwQixpQ0FBaUMsRUFBRTtBQUM3RDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLHlDQUF5QztBQUNwRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSwwQ0FBMEMsZUFBZTtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsdUJBQXVCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBLCtCQUErQixnQ0FBZ0M7QUFDL0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQSxzQ0FBc0MsWUFBWTtBQUNsRDtBQUNBO0FBQ0EsdUJBQXVCLGtCQUFrQjtBQUN6QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1DQUFtQyxRQUFRO0FBQzNDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLFdBQVc7QUFDdEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLHdDOzs7Ozs7Ozs7Ozs7QUN2S2E7QUFDYiw4Q0FBOEMsY0FBYztBQUM1RDtBQUNBLDJCQUEyQixXQUFXO0FBQ3RDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUM7Ozs7Ozs7Ozs7OztBQ2pCYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGNBQWMsZ0JBQWdCLHNDQUFzQyxpQkFBaUIsRUFBRTtBQUN2Riw2QkFBNkIsdURBQXVEO0FBQ3BGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLHNCQUFzQjtBQUM3QztBQUNBO0FBQ0EsQ0FBQztBQUNELDhDQUE4QyxjQUFjO0FBQzVELGtCQUFrQixtQkFBTyxDQUFDLGlFQUFhO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qix1QkFBdUI7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLGdCQUFnQjtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLHVCQUF1QjtBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixnQkFBZ0I7QUFDdkM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSx3Qzs7Ozs7Ozs7Ozs7O0FDbEdhO0FBQ2IsOENBQThDLGNBQWM7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkNBQTJDLDZCQUE2QjtBQUN4RTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLHVCQUF1Qiw0QkFBNEI7QUFDbkQ7QUFDQTtBQUNBLHVCQUF1QixrQkFBa0I7QUFDekM7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSx5Qzs7Ozs7Ozs7Ozs7O0FDMUNhO0FBQ2IsOENBQThDLGNBQWM7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0Qsb0JBQW9CLEVBQUU7QUFDdEU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EscUM7Ozs7Ozs7Ozs7OztBQ3hCYTtBQUNiLDhDQUE4QyxjQUFjO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxvQzs7Ozs7Ozs7Ozs7O0FDaEJhO0FBQ2IsOENBQThDLGNBQWM7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDJCQUEyQixXQUFXO0FBQ3RDLHlCQUF5QixvQkFBb0I7QUFDN0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsU0FBUztBQUNoQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQzs7Ozs7Ozs7Ozs7O0FDbkNhO0FBQ2IsOENBQThDLGNBQWM7QUFDNUQ7QUFDQSxpQzs7Ozs7Ozs7Ozs7O0FDSGE7QUFDYiw4Q0FBOEMsY0FBYztBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDLHFDQUFxQztBQUN0QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUMscUNBQXFDO0FBQ3RDLDJDOzs7Ozs7Ozs7Ozs7QUMxRWE7QUFDYjtBQUNBO0FBQ0E7QUFDQSxjQUFjLGdCQUFnQixzQ0FBc0MsaUJBQWlCLEVBQUU7QUFDdkYsNkJBQTZCLHVEQUF1RDtBQUNwRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixzQkFBc0I7QUFDN0M7QUFDQTtBQUNBLENBQUM7QUFDRCw4Q0FBOEMsY0FBYztBQUM1RCxvQkFBb0IsbUJBQU8sQ0FBQyxnRkFBc0I7QUFDbEQsY0FBYyxtQkFBTyxDQUFDLG9FQUFvQjtBQUMxQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxREFBcUQsMkJBQTJCO0FBQ2hGLGtEQUFrRCw0QkFBNEI7QUFDOUUsdURBQXVELDRCQUE0QjtBQUNuRixtREFBbUQsNEJBQTRCO0FBQy9FLHVEQUF1RCw2QkFBNkI7QUFDcEYsb0RBQW9ELDJCQUEyQjtBQUMvRSxpREFBaUQsNEJBQTRCO0FBQzdFLDBEQUEwRCwyQkFBMkI7QUFDckYsMERBQTBELDJCQUEyQjtBQUNyRixtREFBbUQsMENBQTBDO0FBQzdGLG1EQUFtRCwwQ0FBMEM7QUFDN0YsdURBQXVELCtFQUErRTtBQUN0SSx1REFBdUQsK0VBQStFO0FBQ3RJLHVEQUF1RCxtQ0FBbUM7QUFDMUYsdURBQXVELG1DQUFtQztBQUMxRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsbUNBQW1DLG1CQUFtQjtBQUN0RDtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixVQUFVO0FBQ2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtREFBbUQsUUFBUTtBQUMzRDtBQUNBO0FBQ0EsMkJBQTJCLE9BQU87QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIsaUJBQWlCO0FBQzlDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsMkJBQTJCO0FBQ3REO0FBQ0E7QUFDQSx5Q0FBeUMsaUJBQWlCO0FBQzFEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkJBQTZCLGlCQUFpQjtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsVUFBVTtBQUMvQztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrQkFBK0IsaUJBQWlCO0FBQ2hEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixpQkFBaUI7QUFDeEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxxQ0FBcUMsUUFBUTtBQUM3QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1Q0FBdUMsV0FBVztBQUNsRCwrQkFBK0IsZUFBZTtBQUM5QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEJBQThCLGVBQWU7QUFDN0MsK0JBQStCLGVBQWU7QUFDOUM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1Qiw0QkFBNEI7QUFDbkQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQ0FBbUMsbUJBQW1CO0FBQ3RELGtDQUFrQyxjQUFjO0FBQ2hELGdDQUFnQyxzQkFBc0I7QUFDdEQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxzQzs7Ozs7Ozs7Ozs7O0FDMWFhO0FBQ2IsOENBQThDLGNBQWM7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxVQUFVO0FBQ1Y7QUFDQSxVQUFVO0FBQ1Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU07QUFDTjtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWO0FBQ0EsVUFBVTtBQUNWO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQUFNO0FBQ047QUFDQSxNQUFNO0FBQ047QUFDQTtBQUNBLG9DOzs7Ozs7Ozs7Ozs7QUMvSmE7QUFDYiw4Q0FBOEMsY0FBYztBQUM1RCx3QkFBd0IsbUJBQU8sQ0FBQyxrR0FBbUM7QUFDbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFlBQVk7QUFDWjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxpQkFBaUI7QUFDakI7QUFDQSxpQkFBaUI7QUFDakI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0REFBNEQ7QUFDNUQsa0VBQWtFO0FBQ2xFLHlHQUF5RztBQUN6RztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTREO0FBQzVELGtFQUFrRTtBQUNsRSx5R0FBeUc7QUFDekc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDREQUE0RDtBQUM1RCxrRUFBa0U7QUFDbEUsZ0VBQWdFO0FBQ2hFO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw0REFBNEQ7QUFDNUQsa0VBQWtFO0FBQ2xFLGdFQUFnRTtBQUNoRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDREQUE0RDtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDREQUE0RDtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLDREQUE0RDtBQUM1RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTREO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTREO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTREO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTREO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZEO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZEO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZEO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZEO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZEO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZEO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZEO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNkRBQTZEO0FBQzdEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtB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O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsdUJBQXVCLEVBQUU7QUFDbkQ7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLDBCQUEwQix1QkFBdUIsRUFBRTtBQUNuRDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0EsMEJBQTBCLDJCQUEyQixFQUFFO0FBQ3ZEO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQSwwQkFBMEIsMkJBQTJCLEVBQUU7QUFDdkQ7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLDBCQUEwQixrQ0FBa0MsRUFBRTtBQUM5RDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSxtRDs7Ozs7Ozs7Ozs7O0FDbE5hO0FBQ2IsOENBQThDLGNBQWM7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtQkFBbUIsU0FBUztBQUM1QjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTO0FBQ1Q7QUFDQSxtQkFBbUIsUUFBUTtBQUMzQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQ0FBMkMsNENBQTRDO0FBQ3ZGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0Esd0M7Ozs7Ozs7Ozs7OztBQzlIYTtBQUNi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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsMkM7Ozs7Ozs7Ozs7OztBQ3hNYTtBQUNiLDhDQUE4QyxjQUFjO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsbURBQW1EO0FBQ25EO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFEQUFxRDtBQUNyRCxzREFBc0Q7QUFDdEQ7QUFDQSxDQUFDO0FBQ0Q7QUFDQSx5Qzs7Ozs7Ozs7Ozs7O0FDbEJhO0FBQ2IsOENB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QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0RBQStELGNBQWM7QUFDN0U7QUFDQTtBQUNBO0FBQ0Esb0RBQW9ELHlDQUF5QztBQUM3RjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxtRUFBbUUsZ0NBQWdDLEVBQUU7QUFDckc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwyQkFBMkIsaUNBQWlDO0FBQzVEO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSw0Qzs7Ozs7Ozs7Ozs7O0FDeE1hO0FBQ2IsOENBQThDLGNBQWM7QUFDNUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLFdBQVc7QUFDbEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGFBQWE7QUFDYjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLGtDOzs7Ozs7Ozs7Ozs7QUM1R2E7QUFDYjtBQUNBO0FBQ0E7QUFDQSxjQUFjLGdCQUFnQixzQ0FBc0MsaUJBQWlCLEVBQUU7QUFDdkYsNkJBQTZCLHVEQUF1RDtBQUNwRjtBQUNBO0FBQ0E7QUFDQTtBQUNBLHVCQUF1QixzQkFBc0I7QUFDN0M7QUFDQTtBQUNBLENBQUM7QUFDRCw4Q0FBOEMsY0FBYztBQUM1RCxzQkFBc0IsbUJBQU8sQ0FBQyxpRkFBaUI7QUFDL0M7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EseUM7Ozs7Ozs7Ozs7OztBQzNCYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGNBQWMsZ0JBQWdCLHNDQUFzQyxpQkFBaUIsRUFBRTtBQUN2Riw2QkFBNkIsdURBQXVEO0FBQ3BGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLHNCQUFzQjtBQUM3QztBQUNBO0FBQ0EsQ0FBQztBQUNELDhDQUE4QyxjQUFjO0FBQzVELGNBQWMsbUJBQU8sQ0FBQyxpRUFBUztBQUMvQiwyQkFBMkIsbUJBQU8sQ0FBQywyRkFBc0I7QUFDekQsc0JBQXNCLG1CQUFPLENBQUMsaUZBQWlCO0FBQy9DLHVCQUF1QixtQkFBTyxDQUFDLG1GQUFrQjtBQUNqRCxjQUFjLG1CQUFPLENBQUMsb0VBQW9CO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsMkM7Ozs7Ozs7Ozs7OztBQ2xGYTtBQUNiLDhDQUE4QyxjQUFjO0FBQzVEO0FBQ0E7QUFDQTtBQUNBLGlDOzs7Ozs7Ozs7Ozs7QUNMYTtBQUNiO0FBQ0E7QUFDQTtBQUNBLGNBQWMsZ0JBQWdCLHNDQUFzQyxpQkFBaUIsRUFBRTtBQUN2Riw2QkFBNkIsdURBQXVEO0FBQ3BGO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLHNCQUFzQjtBQUM3QztBQUNBO0FBQ0EsQ0FBQztBQUNELDhDQUE4QyxjQUFjO0FBQzVELHFCQUFxQixtQkFBTyxDQUFDLDBFQUFpQjtBQUM5Qyx3QkFBd0IsbUJBQU8sQ0FBQyxnRkFBMEI7QUFDMUQsOEJBQThCLG1CQUFPLENBQUMsK0ZBQXlCO0FBQy9ELGNBQWMsbUJBQU8sQ0FBQyx3RUFBZ0I7QUFDdEMsc0JBQXNCLG1CQUFPLENBQUMsb0ZBQTRCO0FBQzFELGtCQUFrQixtQkFBTyxDQUFDLDRFQUF3QjtBQUNsRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsNERBQTRELDhCQUE4QixFQUFFO0FBQzVGLDREQUE0RCw4QkFBOEIsRUFBRTtBQUM1RjtBQUNBO0FBQ0E7QUFDQSwwQkFBMEIsbUNBQW1DLEVBQUU7QUFDL0Q7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBLDBCQUEwQiw2QkFBNkIsRUFBRTtBQUN6RDtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1GQUFtRjtBQUNuRixvQ0FBb0M7QUFDcEMsMkJBQTJCO0FBQzNCLGtDQUFrQztBQUNsQztBQUNBLGNBQWM7QUFDZDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOEVBQThFO0FBQzlFLHNFQUFzRTtBQUN0RSxpRkFBaUY7QUFDakYsc0VBQXNFO0FBQ3RFLG9FQUFvRTtBQUNwRSxjQUFjO0FBQ2Q7QUFDQSw4RkFBOEY7QUFDOUYsMEVBQTBFO0FBQzFFLGtCQUFrQjtBQUNsQiw2RkFBNkY7QUFDN0YsOEVBQThFO0FBQzlFLGtCQUFrQjtBQUNsQiwrRkFBK0Y7QUFDL0YscUNBQXFDO0FBQ3JDLGtCQUFrQjtBQUNsQjtBQUNBLCtCQUErQjtBQUMvQixzQkFBc0IsY0FBYyxFQUFFO0FBQ3RDLHVCQUF1QixjQUFjLEVBQUU7QUFDdkMsd0JBQXdCLGNBQWMsRUFBRTtBQUN4QyxrQkFBa0I7QUFDbEI7QUFDQSw2SUFBNkk7QUFDN0ksa0ZBQWtGO0FBQ2xGLHVDQUF1QztBQUN2QyxrQkFBa0I7QUFDbEIsK0xBQStMO0FBQy9MLHdEQUF3RDtBQUN4RCxrQkFBa0I7QUFDbEIscU1BQXFNO0FBQ3JNLGlGQUFpRjtBQUNqRiw0RUFBNEU7QUFDNUUsa0JBQWtCO0FBQ2xCLG1NQUFtTTtBQUNuTSx5RkFBeUY7QUFDekYsa0JBQWtCO0FBQ2xCLHlNQUF5TTtBQUN6TSwwRkFBMEY7QUFDMUYsa0JBQWtCO0FBQ2xCO0FBQ0EsaUVBQWlFO0FBQ2pFLHFDQUFxQztBQUNyQyx5QkFBeUI7QUFDekIsMEJBQTBCO0FBQzFCLDZCQUE2QjtBQUM3Qix1Q0FBdUM7QUFDdkMsa0JBQWtCO0FBQ2xCLDBFQUEwRTtBQUMxRSxxQ0FBcUM7QUFDckMsb0ZBQW9GO0FBQ3BGLGtCQUFrQjtBQUNsQjtBQUNBO0FBQ0EsMEVBQTBFLHNCQUFzQixFQUFFO0FBQ2xHLCtFQUErRSxpQ0FBaUMsRUFBRTtBQUNsSCxTQUFTO0FBQ1Q7QUFDQSxrR0FBa0csd0RBQXdELEVBQUU7QUFDNUosdUdBQXVHLG1FQUFtRSxFQUFFO0FBQzVLO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsOENBQThDLFdBQVc7QUFDekQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVM7QUFDVDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxrQ0FBa0MsY0FBYztBQUNoRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxnREFBZ0QseUJBQXlCLEVBQUU7QUFDM0U7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsMkJBQTJCLFVBQVU7QUFDckM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSw2QkFBNkIseUJBQXlCO0FBQ3REO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBUztBQUNUO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsd0VBQXdFLFdBQVc7QUFDbkYsMkVBQTJFLGNBQWM7QUFDekY7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLHVDOzs7Ozs7Ozs7Ozs7QUN6VWE7QUFDYiw4Q0FBOEMsY0FBYztBQUM1RCxjQUFjLG1CQUFPLENBQUMsd0VBQWdCO0FBQ3RDLG1CQUFtQixtQkFBTyxDQUFDLHdGQUE4QjtBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5REFBeUQsUUFBUTtBQUNqRTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsdUJBQXVCLGdCQUFnQjtBQUN2QztBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSwrSkFBK0o7QUFDL0o7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0pBQStKO0FBQy9KO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0FBQztBQUNEO0FBQ0EsaUQ7Ozs7Ozs7Ozs7OztBQ3ZHYTtBQUNiLDhDQUE4QyxjQUFjO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLHFDOzs7Ozs7Ozs7Ozs7QUNkYTtBQUNiLDhDQUE4QyxjQUFjO0FBQzVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSx5RUFBeUUsOEJBQThCLEVBQUU7QUFDekc7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDO0FBQ0Q7QUFDQSwyQzs7Ozs7Ozs7Ozs7O0FDdENhO0FBQ2I7QUFDQTtBQUNBO0FBQ0EsY0FBYyxnQkFBZ0Isc0NBQXNDLGlCQUFpQixFQUFFO0FBQ3ZGLDZCQUE2Qix1REFBdUQ7QUFDcEY7QUFDQTtBQUNBO0FBQ0E7QUFDQSx1QkFBdUIsc0JBQXNCO0FBQzdDO0FBQ0E7QUFDQSxDQUFDO0FBQ0QsOENBQThDLGNBQWM7QUFDNUQsa0JBQWtCLG1CQUFPLENBQUMseUVBQXFCO0FBQy9DO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENBQUM7QUFDRDtBQUNBLDRDOzs7Ozs7Ozs7Ozs7OztBQzFEQSw4RkFBaUM7QUFDakMsZ0VBQWlDO0FBRTNCLE1BQU8sQ0FBQyxRQUFRLEdBQUcsZ0JBQVEsQ0FBQztBQUM1QixNQUFPLENBQUMsV0FBVyxHQUFHLGVBQVcsQ0FBQyIsImZpbGUiOiJjbGllbnQtYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IFwiLi90ZXN0L2NsaWVudC50c1wiKTtcbiIsIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE0LCAyMDE5IFRoZSB4dGVybS5qcyBhdXRob3JzLiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICogQGxpY2Vuc2UgTUlUXG4gKlxuICogSW1wbGVtZW50cyB0aGUgYXR0YWNoIG1ldGhvZCwgdGhhdCBhdHRhY2hlcyB0aGUgdGVybWluYWwgdG8gYSBXZWJTb2NrZXQgc3RyZWFtLlxuICovXG5cbmltcG9ydCB7IFRlcm1pbmFsLCBJRGlzcG9zYWJsZSB9IGZyb20gJ3h0ZXJtJztcblxuXG5pbnRlcmZhY2UgSUF0dGFjaE9wdGlvbnMge1xuICBiaWRpcmVjdGlvbmFsPzogYm9vbGVhbjtcbiAgaW5wdXRVdGY4PzogYm9vbGVhbjtcbn1cblxuXG4vLyBUT0RPOiBUaGlzIGlzIHRlbXBvcmFyeSwgbGluayB0byB4dGVybSB3aGVuIHRoZSBuZXcgdmVyc2lvbiBpcyBwdWJsaXNoZWRcbmV4cG9ydCBpbnRlcmZhY2UgSVRlcm1pbmFsQWRkb24ge1xuICBhY3RpdmF0ZSh0ZXJtaW5hbDogVGVybWluYWwpOiB2b2lkO1xuICBkaXNwb3NlKCk6IHZvaWQ7XG59XG5cbi8vIFRPRE86IFRvIGJlIHJlbW92ZWQgb25jZSBVVEY4IFBSIGlzIGluIHh0ZXJtLmpzIHBhY2thZ2UuXG5pbnRlcmZhY2UgSU5ld1Rlcm1pbmFsIGV4dGVuZHMgVGVybWluYWwge1xuICB3cml0ZVV0ZjgoZGF0YTogVWludDhBcnJheSk6IHZvaWQ7XG59XG5cblxuZXhwb3J0IGNsYXNzIEF0dGFjaEFkZG9uIGltcGxlbWVudHMgSVRlcm1pbmFsQWRkb24ge1xuICBwcml2YXRlIF9zb2NrZXQ6IFdlYlNvY2tldDtcbiAgcHJpdmF0ZSBfYmlkaXJlY3Rpb25hbDogYm9vbGVhbjtcbiAgcHJpdmF0ZSBfdXRmODogYm9vbGVhbjtcbiAgcHJpdmF0ZSBfZGlzcG9zYWJsZXM6IElEaXNwb3NhYmxlW10gPSBbXTtcblxuICBjb25zdHJ1Y3Rvcihzb2NrZXQ6IFdlYlNvY2tldCwgb3B0aW9ucz86IElBdHRhY2hPcHRpb25zKSB7XG4gICAgdGhpcy5fc29ja2V0ID0gc29ja2V0O1xuICAgIC8vIGFsd2F5cyBzZXQgYmluYXJ5IHR5cGUgdG8gYXJyYXlidWZmZXIsIHdlIGRvIG5vdCBoYW5kbGUgYmxvYnNcbiAgICB0aGlzLl9zb2NrZXQuYmluYXJ5VHlwZSA9ICdhcnJheWJ1ZmZlcic7XG4gICAgdGhpcy5fYmlkaXJlY3Rpb25hbCA9IChvcHRpb25zICYmIG9wdGlvbnMuYmlkaXJlY3Rpb25hbCA9PT0gZmFsc2UpID8gZmFsc2UgOiB0cnVlO1xuICAgIHRoaXMuX3V0ZjggPSAhIShvcHRpb25zICYmIG9wdGlvbnMuaW5wdXRVdGY4KTtcbiAgfVxuXG4gIHB1YmxpYyBhY3RpdmF0ZSh0ZXJtaW5hbDogVGVybWluYWwpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5fdXRmOCkge1xuICAgICAgdGhpcy5fZGlzcG9zYWJsZXMucHVzaChhZGRTb2NrZXRMaXN0ZW5lcih0aGlzLl9zb2NrZXQsICdtZXNzYWdlJyxcbiAgICAgICAgKGV2OiBNZXNzYWdlRXZlbnQgfCBFdmVudCB8IENsb3NlRXZlbnQpID0+ICh0ZXJtaW5hbCBhcyBJTmV3VGVybWluYWwpLndyaXRlVXRmOChuZXcgVWludDhBcnJheSgoZXYgYXMgYW55KS5kYXRhIGFzIEFycmF5QnVmZmVyKSkpKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fZGlzcG9zYWJsZXMucHVzaChhZGRTb2NrZXRMaXN0ZW5lcih0aGlzLl9zb2NrZXQsICdtZXNzYWdlJyxcbiAgICAgICAgKGV2OiBNZXNzYWdlRXZlbnQgfCBFdmVudCB8IENsb3NlRXZlbnQpID0+ICh0ZXJtaW5hbCBhcyBJTmV3VGVybWluYWwpLndyaXRlKChldiBhcyBhbnkpLmRhdGEgYXMgc3RyaW5nKSkpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLl9iaWRpcmVjdGlvbmFsKSB7XG4gICAgICB0aGlzLl9kaXNwb3NhYmxlcy5wdXNoKHRlcm1pbmFsLmFkZERpc3Bvc2FibGVMaXN0ZW5lcignZGF0YScsIGRhdGEgPT4gdGhpcy5fc2VuZERhdGEoZGF0YSkpKTtcbiAgICB9XG5cbiAgICB0aGlzLl9kaXNwb3NhYmxlcy5wdXNoKGFkZFNvY2tldExpc3RlbmVyKHRoaXMuX3NvY2tldCwgJ2Nsb3NlJywgKCkgPT4gdGhpcy5kaXNwb3NlKCkpKTtcbiAgICB0aGlzLl9kaXNwb3NhYmxlcy5wdXNoKGFkZFNvY2tldExpc3RlbmVyKHRoaXMuX3NvY2tldCwgJ2Vycm9yJywgKCkgPT4gdGhpcy5kaXNwb3NlKCkpKTtcbiAgfVxuXG4gIHB1YmxpYyBkaXNwb3NlKCk6IHZvaWQge1xuICAgIHRoaXMuX2Rpc3Bvc2FibGVzLmZvckVhY2goZCA9PiBkLmRpc3Bvc2UoKSk7XG4gIH1cblxuICBwcml2YXRlIF9zZW5kRGF0YShkYXRhOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAvLyBUT0RPOiBkbyBzb21ldGhpbmcgYmV0dGVyIHRoYW4ganVzdCBzd2FsbG93aW5nXG4gICAgLy8gdGhlIGRhdGEgaWYgdGhlIHNvY2tldCBpcyBub3QgaW4gYSB3b3JraW5nIGNvbmRpdGlvblxuICAgIGlmICh0aGlzLl9zb2NrZXQucmVhZHlTdGF0ZSAhPT0gMSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLl9zb2NrZXQuc2VuZChkYXRhKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhZGRTb2NrZXRMaXN0ZW5lcihzb2NrZXQ6IFdlYlNvY2tldCwgdHlwZTogc3RyaW5nLCBoYW5kbGVyOiAodGhpczogV2ViU29ja2V0LCBldjogTWVzc2FnZUV2ZW50IHwgRXZlbnQgfCBDbG9zZUV2ZW50KSA9PiBhbnkpOiBJRGlzcG9zYWJsZSB7XG4gIHNvY2tldC5hZGRFdmVudExpc3RlbmVyKHR5cGUsIGhhbmRsZXIpO1xuICByZXR1cm4ge1xuICAgIGRpc3Bvc2U6ICgpID0+IHtcbiAgICAgIGlmICghaGFuZGxlcikge1xuICAgICAgICAvLyBBbHJlYWR5IGRpc3Bvc2VkXG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHNvY2tldC5yZW1vdmVFdmVudExpc3RlbmVyKHR5cGUsIGhhbmRsZXIpO1xuICAgIH1cbiAgfTtcbn1cbiIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgU3RyaW5ncyA9IHJlcXVpcmUoXCIuL1N0cmluZ3NcIik7XG52YXIgUGxhdGZvcm1fMSA9IHJlcXVpcmUoXCIuL2NvbW1vbi9QbGF0Zm9ybVwiKTtcbnZhciBSZW5kZXJEZWJvdW5jZXJfMSA9IHJlcXVpcmUoXCIuL3VpL1JlbmRlckRlYm91bmNlclwiKTtcbnZhciBMaWZlY3ljbGVfMSA9IHJlcXVpcmUoXCIuL3VpL0xpZmVjeWNsZVwiKTtcbnZhciBMaWZlY3ljbGVfMiA9IHJlcXVpcmUoXCIuL2NvbW1vbi9MaWZlY3ljbGVcIik7XG52YXIgTUFYX1JPV1NfVE9fUkVBRCA9IDIwO1xudmFyIEFjY2Vzc2liaWxpdHlNYW5hZ2VyID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoQWNjZXNzaWJpbGl0eU1hbmFnZXIsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gQWNjZXNzaWJpbGl0eU1hbmFnZXIoX3Rlcm1pbmFsKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlci5jYWxsKHRoaXMpIHx8IHRoaXM7XG4gICAgICAgIF90aGlzLl90ZXJtaW5hbCA9IF90ZXJtaW5hbDtcbiAgICAgICAgX3RoaXMuX2xpdmVSZWdpb25MaW5lQ291bnQgPSAwO1xuICAgICAgICBfdGhpcy5fY2hhcnNUb0NvbnN1bWUgPSBbXTtcbiAgICAgICAgX3RoaXMuX2FjY2Vzc2liaWxpdHlUcmVlUm9vdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBfdGhpcy5fYWNjZXNzaWJpbGl0eVRyZWVSb290LmNsYXNzTGlzdC5hZGQoJ3h0ZXJtLWFjY2Vzc2liaWxpdHknKTtcbiAgICAgICAgX3RoaXMuX3Jvd0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBfdGhpcy5fcm93Q29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ3h0ZXJtLWFjY2Vzc2liaWxpdHktdHJlZScpO1xuICAgICAgICBfdGhpcy5fcm93RWxlbWVudHMgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBfdGhpcy5fdGVybWluYWwucm93czsgaSsrKSB7XG4gICAgICAgICAgICBfdGhpcy5fcm93RWxlbWVudHNbaV0gPSBfdGhpcy5fY3JlYXRlQWNjZXNzaWJpbGl0eVRyZWVOb2RlKCk7XG4gICAgICAgICAgICBfdGhpcy5fcm93Q29udGFpbmVyLmFwcGVuZENoaWxkKF90aGlzLl9yb3dFbGVtZW50c1tpXSk7XG4gICAgICAgIH1cbiAgICAgICAgX3RoaXMuX3RvcEJvdW5kYXJ5Rm9jdXNMaXN0ZW5lciA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBfdGhpcy5fb25Cb3VuZGFyeUZvY3VzKGUsIDApOyB9O1xuICAgICAgICBfdGhpcy5fYm90dG9tQm91bmRhcnlGb2N1c0xpc3RlbmVyID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLl9vbkJvdW5kYXJ5Rm9jdXMoZSwgMSk7IH07XG4gICAgICAgIF90aGlzLl9yb3dFbGVtZW50c1swXS5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIF90aGlzLl90b3BCb3VuZGFyeUZvY3VzTGlzdGVuZXIpO1xuICAgICAgICBfdGhpcy5fcm93RWxlbWVudHNbX3RoaXMuX3Jvd0VsZW1lbnRzLmxlbmd0aCAtIDFdLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgX3RoaXMuX2JvdHRvbUJvdW5kYXJ5Rm9jdXNMaXN0ZW5lcik7XG4gICAgICAgIF90aGlzLl9yZWZyZXNoUm93c0RpbWVuc2lvbnMoKTtcbiAgICAgICAgX3RoaXMuX2FjY2Vzc2liaWxpdHlUcmVlUm9vdC5hcHBlbmRDaGlsZChfdGhpcy5fcm93Q29udGFpbmVyKTtcbiAgICAgICAgX3RoaXMuX3JlbmRlclJvd3NEZWJvdW5jZXIgPSBuZXcgUmVuZGVyRGVib3VuY2VyXzEuUmVuZGVyRGVib3VuY2VyKF90aGlzLl9yZW5kZXJSb3dzLmJpbmQoX3RoaXMpKTtcbiAgICAgICAgX3RoaXMuX3JlZnJlc2hSb3dzKCk7XG4gICAgICAgIF90aGlzLl9saXZlUmVnaW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIF90aGlzLl9saXZlUmVnaW9uLmNsYXNzTGlzdC5hZGQoJ2xpdmUtcmVnaW9uJyk7XG4gICAgICAgIF90aGlzLl9saXZlUmVnaW9uLnNldEF0dHJpYnV0ZSgnYXJpYS1saXZlJywgJ2Fzc2VydGl2ZScpO1xuICAgICAgICBfdGhpcy5fYWNjZXNzaWJpbGl0eVRyZWVSb290LmFwcGVuZENoaWxkKF90aGlzLl9saXZlUmVnaW9uKTtcbiAgICAgICAgX3RoaXMuX3Rlcm1pbmFsLmVsZW1lbnQuaW5zZXJ0QWRqYWNlbnRFbGVtZW50KCdhZnRlcmJlZ2luJywgX3RoaXMuX2FjY2Vzc2liaWxpdHlUcmVlUm9vdCk7XG4gICAgICAgIF90aGlzLnJlZ2lzdGVyKF90aGlzLl9yZW5kZXJSb3dzRGVib3VuY2VyKTtcbiAgICAgICAgX3RoaXMucmVnaXN0ZXIoX3RoaXMuX3Rlcm1pbmFsLm9uUmVzaXplKGZ1bmN0aW9uIChlKSB7IHJldHVybiBfdGhpcy5fb25SZXNpemUoZS5yb3dzKTsgfSkpO1xuICAgICAgICBfdGhpcy5yZWdpc3RlcihfdGhpcy5fdGVybWluYWwub25SZW5kZXIoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLl9yZWZyZXNoUm93cyhlLnN0YXJ0LCBlLmVuZCk7IH0pKTtcbiAgICAgICAgX3RoaXMucmVnaXN0ZXIoX3RoaXMuX3Rlcm1pbmFsLm9uU2Nyb2xsKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9yZWZyZXNoUm93cygpOyB9KSk7XG4gICAgICAgIF90aGlzLnJlZ2lzdGVyKF90aGlzLl90ZXJtaW5hbC5hZGREaXNwb3NhYmxlTGlzdGVuZXIoJ2ExMXkuY2hhcicsIGZ1bmN0aW9uIChjaGFyKSB7IHJldHVybiBfdGhpcy5fb25DaGFyKGNoYXIpOyB9KSk7XG4gICAgICAgIF90aGlzLnJlZ2lzdGVyKF90aGlzLl90ZXJtaW5hbC5vbkxpbmVGZWVkKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9vbkNoYXIoJ1xcbicpOyB9KSk7XG4gICAgICAgIF90aGlzLnJlZ2lzdGVyKF90aGlzLl90ZXJtaW5hbC5hZGREaXNwb3NhYmxlTGlzdGVuZXIoJ2ExMXkudGFiJywgZnVuY3Rpb24gKHNwYWNlQ291bnQpIHsgcmV0dXJuIF90aGlzLl9vblRhYihzcGFjZUNvdW50KTsgfSkpO1xuICAgICAgICBfdGhpcy5yZWdpc3RlcihfdGhpcy5fdGVybWluYWwub25LZXkoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLl9vbktleShlLmtleSk7IH0pKTtcbiAgICAgICAgX3RoaXMucmVnaXN0ZXIoX3RoaXMuX3Rlcm1pbmFsLmFkZERpc3Bvc2FibGVMaXN0ZW5lcignYmx1cicsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9jbGVhckxpdmVSZWdpb24oKTsgfSkpO1xuICAgICAgICBfdGhpcy5yZWdpc3RlcihfdGhpcy5fdGVybWluYWwuYWRkRGlzcG9zYWJsZUxpc3RlbmVyKCdkcHJjaGFuZ2UnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5fcmVmcmVzaFJvd3NEaW1lbnNpb25zKCk7IH0pKTtcbiAgICAgICAgX3RoaXMucmVnaXN0ZXIoX3RoaXMuX3Rlcm1pbmFsLnJlbmRlcmVyLm9uQ2FudmFzUmVzaXplKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9yZWZyZXNoUm93c0RpbWVuc2lvbnMoKTsgfSkpO1xuICAgICAgICBfdGhpcy5yZWdpc3RlcihMaWZlY3ljbGVfMS5hZGREaXNwb3NhYmxlRG9tTGlzdGVuZXIod2luZG93LCAncmVzaXplJywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX3JlZnJlc2hSb3dzRGltZW5zaW9ucygpOyB9KSk7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgQWNjZXNzaWJpbGl0eU1hbmFnZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuZGlzcG9zZS5jYWxsKHRoaXMpO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5lbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMuX2FjY2Vzc2liaWxpdHlUcmVlUm9vdCk7XG4gICAgICAgIHRoaXMuX3Jvd0VsZW1lbnRzLmxlbmd0aCA9IDA7XG4gICAgfTtcbiAgICBBY2Nlc3NpYmlsaXR5TWFuYWdlci5wcm90b3R5cGUuX29uQm91bmRhcnlGb2N1cyA9IGZ1bmN0aW9uIChlLCBwb3NpdGlvbikge1xuICAgICAgICB2YXIgYm91bmRhcnlFbGVtZW50ID0gZS50YXJnZXQ7XG4gICAgICAgIHZhciBiZWZvcmVCb3VuZGFyeUVsZW1lbnQgPSB0aGlzLl9yb3dFbGVtZW50c1twb3NpdGlvbiA9PT0gMCA/IDEgOiB0aGlzLl9yb3dFbGVtZW50cy5sZW5ndGggLSAyXTtcbiAgICAgICAgdmFyIHBvc0luU2V0ID0gYm91bmRhcnlFbGVtZW50LmdldEF0dHJpYnV0ZSgnYXJpYS1wb3NpbnNldCcpO1xuICAgICAgICB2YXIgbGFzdFJvd1BvcyA9IHBvc2l0aW9uID09PSAwID8gJzEnIDogXCJcIiArIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5saW5lcy5sZW5ndGg7XG4gICAgICAgIGlmIChwb3NJblNldCA9PT0gbGFzdFJvd1Bvcykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlLnJlbGF0ZWRUYXJnZXQgIT09IGJlZm9yZUJvdW5kYXJ5RWxlbWVudCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciB0b3BCb3VuZGFyeUVsZW1lbnQ7XG4gICAgICAgIHZhciBib3R0b21Cb3VuZGFyeUVsZW1lbnQ7XG4gICAgICAgIGlmIChwb3NpdGlvbiA9PT0gMCkge1xuICAgICAgICAgICAgdG9wQm91bmRhcnlFbGVtZW50ID0gYm91bmRhcnlFbGVtZW50O1xuICAgICAgICAgICAgYm90dG9tQm91bmRhcnlFbGVtZW50ID0gdGhpcy5fcm93RWxlbWVudHMucG9wKCk7XG4gICAgICAgICAgICB0aGlzLl9yb3dDb250YWluZXIucmVtb3ZlQ2hpbGQoYm90dG9tQm91bmRhcnlFbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRvcEJvdW5kYXJ5RWxlbWVudCA9IHRoaXMuX3Jvd0VsZW1lbnRzLnNoaWZ0KCk7XG4gICAgICAgICAgICBib3R0b21Cb3VuZGFyeUVsZW1lbnQgPSBib3VuZGFyeUVsZW1lbnQ7XG4gICAgICAgICAgICB0aGlzLl9yb3dDb250YWluZXIucmVtb3ZlQ2hpbGQodG9wQm91bmRhcnlFbGVtZW50KTtcbiAgICAgICAgfVxuICAgICAgICB0b3BCb3VuZGFyeUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLl90b3BCb3VuZGFyeUZvY3VzTGlzdGVuZXIpO1xuICAgICAgICBib3R0b21Cb3VuZGFyeUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLl9ib3R0b21Cb3VuZGFyeUZvY3VzTGlzdGVuZXIpO1xuICAgICAgICBpZiAocG9zaXRpb24gPT09IDApIHtcbiAgICAgICAgICAgIHZhciBuZXdFbGVtZW50ID0gdGhpcy5fY3JlYXRlQWNjZXNzaWJpbGl0eVRyZWVOb2RlKCk7XG4gICAgICAgICAgICB0aGlzLl9yb3dFbGVtZW50cy51bnNoaWZ0KG5ld0VsZW1lbnQpO1xuICAgICAgICAgICAgdGhpcy5fcm93Q29udGFpbmVyLmluc2VydEFkamFjZW50RWxlbWVudCgnYWZ0ZXJiZWdpbicsIG5ld0VsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdmFyIG5ld0VsZW1lbnQgPSB0aGlzLl9jcmVhdGVBY2Nlc3NpYmlsaXR5VHJlZU5vZGUoKTtcbiAgICAgICAgICAgIHRoaXMuX3Jvd0VsZW1lbnRzLnB1c2gobmV3RWxlbWVudCk7XG4gICAgICAgICAgICB0aGlzLl9yb3dDb250YWluZXIuYXBwZW5kQ2hpbGQobmV3RWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fcm93RWxlbWVudHNbMF0uYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCB0aGlzLl90b3BCb3VuZGFyeUZvY3VzTGlzdGVuZXIpO1xuICAgICAgICB0aGlzLl9yb3dFbGVtZW50c1t0aGlzLl9yb3dFbGVtZW50cy5sZW5ndGggLSAxXS5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMuX2JvdHRvbUJvdW5kYXJ5Rm9jdXNMaXN0ZW5lcik7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNjcm9sbExpbmVzKHBvc2l0aW9uID09PSAwID8gLTEgOiAxKTtcbiAgICAgICAgdGhpcy5fcm93RWxlbWVudHNbcG9zaXRpb24gPT09IDAgPyAxIDogdGhpcy5fcm93RWxlbWVudHMubGVuZ3RoIC0gMl0uZm9jdXMoKTtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbigpO1xuICAgIH07XG4gICAgQWNjZXNzaWJpbGl0eU1hbmFnZXIucHJvdG90eXBlLl9vblJlc2l6ZSA9IGZ1bmN0aW9uIChyb3dzKSB7XG4gICAgICAgIHRoaXMuX3Jvd0VsZW1lbnRzW3RoaXMuX3Jvd0VsZW1lbnRzLmxlbmd0aCAtIDFdLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5fYm90dG9tQm91bmRhcnlGb2N1c0xpc3RlbmVyKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMuX3Jvd0NvbnRhaW5lci5jaGlsZHJlbi5sZW5ndGg7IGkgPCB0aGlzLl90ZXJtaW5hbC5yb3dzOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMuX3Jvd0VsZW1lbnRzW2ldID0gdGhpcy5fY3JlYXRlQWNjZXNzaWJpbGl0eVRyZWVOb2RlKCk7XG4gICAgICAgICAgICB0aGlzLl9yb3dDb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5fcm93RWxlbWVudHNbaV0pO1xuICAgICAgICB9XG4gICAgICAgIHdoaWxlICh0aGlzLl9yb3dFbGVtZW50cy5sZW5ndGggPiByb3dzKSB7XG4gICAgICAgICAgICB0aGlzLl9yb3dDb250YWluZXIucmVtb3ZlQ2hpbGQodGhpcy5fcm93RWxlbWVudHMucG9wKCkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Jvd0VsZW1lbnRzW3RoaXMuX3Jvd0VsZW1lbnRzLmxlbmd0aCAtIDFdLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5fYm90dG9tQm91bmRhcnlGb2N1c0xpc3RlbmVyKTtcbiAgICAgICAgdGhpcy5fcmVmcmVzaFJvd3NEaW1lbnNpb25zKCk7XG4gICAgfTtcbiAgICBBY2Nlc3NpYmlsaXR5TWFuYWdlci5wcm90b3R5cGUuX2NyZWF0ZUFjY2Vzc2liaWxpdHlUcmVlTm9kZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnbGlzdGl0ZW0nKTtcbiAgICAgICAgZWxlbWVudC50YWJJbmRleCA9IC0xO1xuICAgICAgICB0aGlzLl9yZWZyZXNoUm93RGltZW5zaW9ucyhlbGVtZW50KTtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgfTtcbiAgICBBY2Nlc3NpYmlsaXR5TWFuYWdlci5wcm90b3R5cGUuX29uVGFiID0gZnVuY3Rpb24gKHNwYWNlQ291bnQpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGFjZUNvdW50OyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMuX29uQ2hhcignICcpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBBY2Nlc3NpYmlsaXR5TWFuYWdlci5wcm90b3R5cGUuX29uQ2hhciA9IGZ1bmN0aW9uIChjaGFyKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICh0aGlzLl9saXZlUmVnaW9uTGluZUNvdW50IDwgTUFYX1JPV1NfVE9fUkVBRCArIDEpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9jaGFyc1RvQ29uc3VtZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNoaWZ0ZWRDaGFyID0gdGhpcy5fY2hhcnNUb0NvbnN1bWUuc2hpZnQoKTtcbiAgICAgICAgICAgICAgICBpZiAoc2hpZnRlZENoYXIgIT09IGNoYXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYW5ub3VuY2VDaGFyYWN0ZXIoY2hhcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fYW5ub3VuY2VDaGFyYWN0ZXIoY2hhcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY2hhciA9PT0gJ1xcbicpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9saXZlUmVnaW9uTGluZUNvdW50Kys7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2xpdmVSZWdpb25MaW5lQ291bnQgPT09IE1BWF9ST1dTX1RPX1JFQUQgKyAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2xpdmVSZWdpb24udGV4dENvbnRlbnQgKz0gU3RyaW5ncy50b29NdWNoT3V0cHV0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChQbGF0Zm9ybV8xLmlzTWFjKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2xpdmVSZWdpb24udGV4dENvbnRlbnQgJiYgdGhpcy5fbGl2ZVJlZ2lvbi50ZXh0Q29udGVudC5sZW5ndGggPiAwICYmICF0aGlzLl9saXZlUmVnaW9uLnBhcmVudE5vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5fYWNjZXNzaWJpbGl0eVRyZWVSb290LmFwcGVuZENoaWxkKF90aGlzLl9saXZlUmVnaW9uKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBBY2Nlc3NpYmlsaXR5TWFuYWdlci5wcm90b3R5cGUuX2NsZWFyTGl2ZVJlZ2lvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fbGl2ZVJlZ2lvbi50ZXh0Q29udGVudCA9ICcnO1xuICAgICAgICB0aGlzLl9saXZlUmVnaW9uTGluZUNvdW50ID0gMDtcbiAgICAgICAgaWYgKFBsYXRmb3JtXzEuaXNNYWMpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9saXZlUmVnaW9uLnBhcmVudE5vZGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9hY2Nlc3NpYmlsaXR5VHJlZVJvb3QucmVtb3ZlQ2hpbGQodGhpcy5fbGl2ZVJlZ2lvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEFjY2Vzc2liaWxpdHlNYW5hZ2VyLnByb3RvdHlwZS5fb25LZXkgPSBmdW5jdGlvbiAoa2V5Q2hhcikge1xuICAgICAgICB0aGlzLl9jbGVhckxpdmVSZWdpb24oKTtcbiAgICAgICAgdGhpcy5fY2hhcnNUb0NvbnN1bWUucHVzaChrZXlDaGFyKTtcbiAgICB9O1xuICAgIEFjY2Vzc2liaWxpdHlNYW5hZ2VyLnByb3RvdHlwZS5fcmVmcmVzaFJvd3MgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkge1xuICAgICAgICB0aGlzLl9yZW5kZXJSb3dzRGVib3VuY2VyLnJlZnJlc2goc3RhcnQsIGVuZCwgdGhpcy5fdGVybWluYWwucm93cyk7XG4gICAgfTtcbiAgICBBY2Nlc3NpYmlsaXR5TWFuYWdlci5wcm90b3R5cGUuX3JlbmRlclJvd3MgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkge1xuICAgICAgICB2YXIgYnVmZmVyID0gdGhpcy5fdGVybWluYWwuYnVmZmVyO1xuICAgICAgICB2YXIgc2V0U2l6ZSA9IGJ1ZmZlci5saW5lcy5sZW5ndGgudG9TdHJpbmcoKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDw9IGVuZDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgbGluZURhdGEgPSBidWZmZXIudHJhbnNsYXRlQnVmZmVyTGluZVRvU3RyaW5nKGJ1ZmZlci55ZGlzcCArIGksIHRydWUpO1xuICAgICAgICAgICAgdmFyIHBvc0luU2V0ID0gKGJ1ZmZlci55ZGlzcCArIGkgKyAxKS50b1N0cmluZygpO1xuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLl9yb3dFbGVtZW50c1tpXTtcbiAgICAgICAgICAgIGVsZW1lbnQudGV4dENvbnRlbnQgPSBsaW5lRGF0YS5sZW5ndGggPT09IDAgPyBTdHJpbmdzLmJsYW5rTGluZSA6IGxpbmVEYXRhO1xuICAgICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtcG9zaW5zZXQnLCBwb3NJblNldCk7XG4gICAgICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnYXJpYS1zZXRzaXplJywgc2V0U2l6ZSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEFjY2Vzc2liaWxpdHlNYW5hZ2VyLnByb3RvdHlwZS5fcmVmcmVzaFJvd3NEaW1lbnNpb25zID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuX3Rlcm1pbmFsLnJlbmRlcmVyLmRpbWVuc2lvbnMuYWN0dWFsQ2VsbEhlaWdodCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9yb3dFbGVtZW50cy5sZW5ndGggIT09IHRoaXMuX3Rlcm1pbmFsLnJvd3MpIHtcbiAgICAgICAgICAgIHRoaXMuX29uUmVzaXplKHRoaXMuX3Rlcm1pbmFsLnJvd3MpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5fdGVybWluYWwucm93czsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLl9yZWZyZXNoUm93RGltZW5zaW9ucyh0aGlzLl9yb3dFbGVtZW50c1tpXSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEFjY2Vzc2liaWxpdHlNYW5hZ2VyLnByb3RvdHlwZS5fcmVmcmVzaFJvd0RpbWVuc2lvbnMgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xuICAgICAgICBlbGVtZW50LnN0eWxlLmhlaWdodCA9IHRoaXMuX3Rlcm1pbmFsLnJlbmRlcmVyLmRpbWVuc2lvbnMuYWN0dWFsQ2VsbEhlaWdodCArIFwicHhcIjtcbiAgICB9O1xuICAgIEFjY2Vzc2liaWxpdHlNYW5hZ2VyLnByb3RvdHlwZS5fYW5ub3VuY2VDaGFyYWN0ZXIgPSBmdW5jdGlvbiAoY2hhcikge1xuICAgICAgICBpZiAoY2hhciA9PT0gJyAnKSB7XG4gICAgICAgICAgICB0aGlzLl9saXZlUmVnaW9uLmlubmVySFRNTCArPSAnJm5ic3A7JztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX2xpdmVSZWdpb24udGV4dENvbnRlbnQgKz0gY2hhcjtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIEFjY2Vzc2liaWxpdHlNYW5hZ2VyO1xufShMaWZlY3ljbGVfMi5EaXNwb3NhYmxlKSk7XG5leHBvcnRzLkFjY2Vzc2liaWxpdHlNYW5hZ2VyID0gQWNjZXNzaWJpbGl0eU1hbmFnZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1BY2Nlc3NpYmlsaXR5TWFuYWdlci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIENpcmN1bGFyTGlzdF8xID0gcmVxdWlyZShcIi4vY29tbW9uL0NpcmN1bGFyTGlzdFwiKTtcbnZhciBCdWZmZXJMaW5lXzEgPSByZXF1aXJlKFwiLi9jb3JlL2J1ZmZlci9CdWZmZXJMaW5lXCIpO1xudmFyIEJ1ZmZlclJlZmxvd18xID0gcmVxdWlyZShcIi4vQnVmZmVyUmVmbG93XCIpO1xudmFyIEV2ZW50RW1pdHRlcjJfMSA9IHJlcXVpcmUoXCIuL2NvbW1vbi9FdmVudEVtaXR0ZXIyXCIpO1xudmFyIExpZmVjeWNsZV8xID0gcmVxdWlyZShcIi4vY29tbW9uL0xpZmVjeWNsZVwiKTtcbmV4cG9ydHMuTUFYX0JVRkZFUl9TSVpFID0gNDI5NDk2NzI5NTtcbnZhciBCdWZmZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEJ1ZmZlcihfdGVybWluYWwsIF9oYXNTY3JvbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsID0gX3Rlcm1pbmFsO1xuICAgICAgICB0aGlzLl9oYXNTY3JvbGxiYWNrID0gX2hhc1Njcm9sbGJhY2s7XG4gICAgICAgIHRoaXMuc2F2ZWRDdXJBdHRyRGF0YSA9IEJ1ZmZlckxpbmVfMS5ERUZBVUxUX0FUVFJfREFUQS5jbG9uZSgpO1xuICAgICAgICB0aGlzLm1hcmtlcnMgPSBbXTtcbiAgICAgICAgdGhpcy5fbnVsbENlbGwgPSBCdWZmZXJMaW5lXzEuQ2VsbERhdGEuZnJvbUNoYXJEYXRhKFswLCBCdWZmZXJMaW5lXzEuTlVMTF9DRUxMX0NIQVIsIEJ1ZmZlckxpbmVfMS5OVUxMX0NFTExfV0lEVEgsIEJ1ZmZlckxpbmVfMS5OVUxMX0NFTExfQ09ERV0pO1xuICAgICAgICB0aGlzLl93aGl0ZXNwYWNlQ2VsbCA9IEJ1ZmZlckxpbmVfMS5DZWxsRGF0YS5mcm9tQ2hhckRhdGEoWzAsIEJ1ZmZlckxpbmVfMS5XSElURVNQQUNFX0NFTExfQ0hBUiwgQnVmZmVyTGluZV8xLldISVRFU1BBQ0VfQ0VMTF9XSURUSCwgQnVmZmVyTGluZV8xLldISVRFU1BBQ0VfQ0VMTF9DT0RFXSk7XG4gICAgICAgIHRoaXMuX2NvbHMgPSB0aGlzLl90ZXJtaW5hbC5jb2xzO1xuICAgICAgICB0aGlzLl9yb3dzID0gdGhpcy5fdGVybWluYWwucm93cztcbiAgICAgICAgdGhpcy5jbGVhcigpO1xuICAgIH1cbiAgICBCdWZmZXIucHJvdG90eXBlLmdldE51bGxDZWxsID0gZnVuY3Rpb24gKGF0dHIpIHtcbiAgICAgICAgaWYgKGF0dHIpIHtcbiAgICAgICAgICAgIHRoaXMuX251bGxDZWxsLmZnID0gYXR0ci5mZztcbiAgICAgICAgICAgIHRoaXMuX251bGxDZWxsLmJnID0gYXR0ci5iZztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX251bGxDZWxsLmZnID0gMDtcbiAgICAgICAgICAgIHRoaXMuX251bGxDZWxsLmJnID0gMDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fbnVsbENlbGw7XG4gICAgfTtcbiAgICBCdWZmZXIucHJvdG90eXBlLmdldFdoaXRlc3BhY2VDZWxsID0gZnVuY3Rpb24gKGF0dHIpIHtcbiAgICAgICAgaWYgKGF0dHIpIHtcbiAgICAgICAgICAgIHRoaXMuX3doaXRlc3BhY2VDZWxsLmZnID0gYXR0ci5mZztcbiAgICAgICAgICAgIHRoaXMuX3doaXRlc3BhY2VDZWxsLmJnID0gYXR0ci5iZztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3doaXRlc3BhY2VDZWxsLmZnID0gMDtcbiAgICAgICAgICAgIHRoaXMuX3doaXRlc3BhY2VDZWxsLmJnID0gMDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fd2hpdGVzcGFjZUNlbGw7XG4gICAgfTtcbiAgICBCdWZmZXIucHJvdG90eXBlLmdldEJsYW5rTGluZSA9IGZ1bmN0aW9uIChhdHRyLCBpc1dyYXBwZWQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBCdWZmZXJMaW5lXzEuQnVmZmVyTGluZSh0aGlzLl90ZXJtaW5hbC5jb2xzLCB0aGlzLmdldE51bGxDZWxsKGF0dHIpLCBpc1dyYXBwZWQpO1xuICAgIH07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEJ1ZmZlci5wcm90b3R5cGUsIFwiaGFzU2Nyb2xsYmFja1wiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hhc1Njcm9sbGJhY2sgJiYgdGhpcy5saW5lcy5tYXhMZW5ndGggPiB0aGlzLl9yb3dzO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQnVmZmVyLnByb3RvdHlwZSwgXCJpc0N1cnNvckluVmlld3BvcnRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBhYnNvbHV0ZVkgPSB0aGlzLnliYXNlICsgdGhpcy55O1xuICAgICAgICAgICAgdmFyIHJlbGF0aXZlWSA9IGFic29sdXRlWSAtIHRoaXMueWRpc3A7XG4gICAgICAgICAgICByZXR1cm4gKHJlbGF0aXZlWSA+PSAwICYmIHJlbGF0aXZlWSA8IHRoaXMuX3Jvd3MpO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBCdWZmZXIucHJvdG90eXBlLl9nZXRDb3JyZWN0QnVmZmVyTGVuZ3RoID0gZnVuY3Rpb24gKHJvd3MpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9oYXNTY3JvbGxiYWNrKSB7XG4gICAgICAgICAgICByZXR1cm4gcm93cztcbiAgICAgICAgfVxuICAgICAgICB2YXIgY29ycmVjdEJ1ZmZlckxlbmd0aCA9IHJvd3MgKyB0aGlzLl90ZXJtaW5hbC5vcHRpb25zLnNjcm9sbGJhY2s7XG4gICAgICAgIHJldHVybiBjb3JyZWN0QnVmZmVyTGVuZ3RoID4gZXhwb3J0cy5NQVhfQlVGRkVSX1NJWkUgPyBleHBvcnRzLk1BWF9CVUZGRVJfU0laRSA6IGNvcnJlY3RCdWZmZXJMZW5ndGg7XG4gICAgfTtcbiAgICBCdWZmZXIucHJvdG90eXBlLmZpbGxWaWV3cG9ydFJvd3MgPSBmdW5jdGlvbiAoZmlsbEF0dHIpIHtcbiAgICAgICAgaWYgKHRoaXMubGluZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBpZiAoZmlsbEF0dHIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIGZpbGxBdHRyID0gQnVmZmVyTGluZV8xLkRFRkFVTFRfQVRUUl9EQVRBO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGkgPSB0aGlzLl9yb3dzO1xuICAgICAgICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICAgICAgICAgIHRoaXMubGluZXMucHVzaCh0aGlzLmdldEJsYW5rTGluZShmaWxsQXR0cikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBCdWZmZXIucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnlkaXNwID0gMDtcbiAgICAgICAgdGhpcy55YmFzZSA9IDA7XG4gICAgICAgIHRoaXMueSA9IDA7XG4gICAgICAgIHRoaXMueCA9IDA7XG4gICAgICAgIHRoaXMubGluZXMgPSBuZXcgQ2lyY3VsYXJMaXN0XzEuQ2lyY3VsYXJMaXN0KHRoaXMuX2dldENvcnJlY3RCdWZmZXJMZW5ndGgodGhpcy5fcm93cykpO1xuICAgICAgICB0aGlzLnNjcm9sbFRvcCA9IDA7XG4gICAgICAgIHRoaXMuc2Nyb2xsQm90dG9tID0gdGhpcy5fcm93cyAtIDE7XG4gICAgICAgIHRoaXMuc2V0dXBUYWJTdG9wcygpO1xuICAgIH07XG4gICAgQnVmZmVyLnByb3RvdHlwZS5yZXNpemUgPSBmdW5jdGlvbiAobmV3Q29scywgbmV3Um93cykge1xuICAgICAgICB2YXIgbnVsbENlbGwgPSB0aGlzLmdldE51bGxDZWxsKEJ1ZmZlckxpbmVfMS5ERUZBVUxUX0FUVFJfREFUQSk7XG4gICAgICAgIHZhciBuZXdNYXhMZW5ndGggPSB0aGlzLl9nZXRDb3JyZWN0QnVmZmVyTGVuZ3RoKG5ld1Jvd3MpO1xuICAgICAgICBpZiAobmV3TWF4TGVuZ3RoID4gdGhpcy5saW5lcy5tYXhMZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMubGluZXMubWF4TGVuZ3RoID0gbmV3TWF4TGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmxpbmVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9jb2xzIDwgbmV3Q29scykge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5saW5lcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxpbmVzLmdldChpKS5yZXNpemUobmV3Q29scywgbnVsbENlbGwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBhZGRUb1kgPSAwO1xuICAgICAgICAgICAgaWYgKHRoaXMuX3Jvd3MgPCBuZXdSb3dzKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgeSA9IHRoaXMuX3Jvd3M7IHkgPCBuZXdSb3dzOyB5KyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMubGluZXMubGVuZ3RoIDwgbmV3Um93cyArIHRoaXMueWJhc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnliYXNlID4gMCAmJiB0aGlzLmxpbmVzLmxlbmd0aCA8PSB0aGlzLnliYXNlICsgdGhpcy55ICsgYWRkVG9ZICsgMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMueWJhc2UtLTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRUb1krKztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy55ZGlzcCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy55ZGlzcC0tO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGluZXMucHVzaChuZXcgQnVmZmVyTGluZV8xLkJ1ZmZlckxpbmUobmV3Q29scywgbnVsbENlbGwpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIHkgPSB0aGlzLl9yb3dzOyB5ID4gbmV3Um93czsgeS0tKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmxpbmVzLmxlbmd0aCA+IG5ld1Jvd3MgKyB0aGlzLnliYXNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5saW5lcy5sZW5ndGggPiB0aGlzLnliYXNlICsgdGhpcy55ICsgMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGluZXMucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnliYXNlKys7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy55ZGlzcCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG5ld01heExlbmd0aCA8IHRoaXMubGluZXMubWF4TGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFtb3VudFRvVHJpbSA9IHRoaXMubGluZXMubGVuZ3RoIC0gbmV3TWF4TGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmIChhbW91bnRUb1RyaW0gPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGluZXMudHJpbVN0YXJ0KGFtb3VudFRvVHJpbSk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMueWJhc2UgPSBNYXRoLm1heCh0aGlzLnliYXNlIC0gYW1vdW50VG9UcmltLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy55ZGlzcCA9IE1hdGgubWF4KHRoaXMueWRpc3AgLSBhbW91bnRUb1RyaW0sIDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmxpbmVzLm1heExlbmd0aCA9IG5ld01heExlbmd0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMueCA9IE1hdGgubWluKHRoaXMueCwgbmV3Q29scyAtIDEpO1xuICAgICAgICAgICAgdGhpcy55ID0gTWF0aC5taW4odGhpcy55LCBuZXdSb3dzIC0gMSk7XG4gICAgICAgICAgICBpZiAoYWRkVG9ZKSB7XG4gICAgICAgICAgICAgICAgdGhpcy55ICs9IGFkZFRvWTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuc2F2ZWRZID0gTWF0aC5taW4odGhpcy5zYXZlZFksIG5ld1Jvd3MgLSAxKTtcbiAgICAgICAgICAgIHRoaXMuc2F2ZWRYID0gTWF0aC5taW4odGhpcy5zYXZlZFgsIG5ld0NvbHMgLSAxKTtcbiAgICAgICAgICAgIHRoaXMuc2Nyb2xsVG9wID0gMDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNjcm9sbEJvdHRvbSA9IG5ld1Jvd3MgLSAxO1xuICAgICAgICBpZiAodGhpcy5faXNSZWZsb3dFbmFibGVkKSB7XG4gICAgICAgICAgICB0aGlzLl9yZWZsb3cobmV3Q29scywgbmV3Um93cyk7XG4gICAgICAgICAgICBpZiAodGhpcy5fY29scyA+IG5ld0NvbHMpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGluZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5saW5lcy5nZXQoaSkucmVzaXplKG5ld0NvbHMsIG51bGxDZWxsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fY29scyA9IG5ld0NvbHM7XG4gICAgICAgIHRoaXMuX3Jvd3MgPSBuZXdSb3dzO1xuICAgIH07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEJ1ZmZlci5wcm90b3R5cGUsIFwiX2lzUmVmbG93RW5hYmxlZFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2hhc1Njcm9sbGJhY2sgJiYgIXRoaXMuX3Rlcm1pbmFsLm9wdGlvbnMud2luZG93c01vZGU7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIEJ1ZmZlci5wcm90b3R5cGUuX3JlZmxvdyA9IGZ1bmN0aW9uIChuZXdDb2xzLCBuZXdSb3dzKSB7XG4gICAgICAgIGlmICh0aGlzLl9jb2xzID09PSBuZXdDb2xzKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5ld0NvbHMgPiB0aGlzLl9jb2xzKSB7XG4gICAgICAgICAgICB0aGlzLl9yZWZsb3dMYXJnZXIobmV3Q29scywgbmV3Um93cyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9yZWZsb3dTbWFsbGVyKG5ld0NvbHMsIG5ld1Jvd3MpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBCdWZmZXIucHJvdG90eXBlLl9yZWZsb3dMYXJnZXIgPSBmdW5jdGlvbiAobmV3Q29scywgbmV3Um93cykge1xuICAgICAgICB2YXIgdG9SZW1vdmUgPSBCdWZmZXJSZWZsb3dfMS5yZWZsb3dMYXJnZXJHZXRMaW5lc1RvUmVtb3ZlKHRoaXMubGluZXMsIHRoaXMuX2NvbHMsIG5ld0NvbHMsIHRoaXMueWJhc2UgKyB0aGlzLnksIHRoaXMuZ2V0TnVsbENlbGwoQnVmZmVyTGluZV8xLkRFRkFVTFRfQVRUUl9EQVRBKSk7XG4gICAgICAgIGlmICh0b1JlbW92ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB2YXIgbmV3TGF5b3V0UmVzdWx0ID0gQnVmZmVyUmVmbG93XzEucmVmbG93TGFyZ2VyQ3JlYXRlTmV3TGF5b3V0KHRoaXMubGluZXMsIHRvUmVtb3ZlKTtcbiAgICAgICAgICAgIEJ1ZmZlclJlZmxvd18xLnJlZmxvd0xhcmdlckFwcGx5TmV3TGF5b3V0KHRoaXMubGluZXMsIG5ld0xheW91dFJlc3VsdC5sYXlvdXQpO1xuICAgICAgICAgICAgdGhpcy5fcmVmbG93TGFyZ2VyQWRqdXN0Vmlld3BvcnQobmV3Q29scywgbmV3Um93cywgbmV3TGF5b3V0UmVzdWx0LmNvdW50UmVtb3ZlZCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEJ1ZmZlci5wcm90b3R5cGUuX3JlZmxvd0xhcmdlckFkanVzdFZpZXdwb3J0ID0gZnVuY3Rpb24gKG5ld0NvbHMsIG5ld1Jvd3MsIGNvdW50UmVtb3ZlZCkge1xuICAgICAgICB2YXIgbnVsbENlbGwgPSB0aGlzLmdldE51bGxDZWxsKEJ1ZmZlckxpbmVfMS5ERUZBVUxUX0FUVFJfREFUQSk7XG4gICAgICAgIHZhciB2aWV3cG9ydEFkanVzdG1lbnRzID0gY291bnRSZW1vdmVkO1xuICAgICAgICB3aGlsZSAodmlld3BvcnRBZGp1c3RtZW50cy0tID4gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMueWJhc2UgPT09IDApIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy55ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnktLTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubGluZXMubGVuZ3RoIDwgbmV3Um93cykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxpbmVzLnB1c2gobmV3IEJ1ZmZlckxpbmVfMS5CdWZmZXJMaW5lKG5ld0NvbHMsIG51bGxDZWxsKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMueWRpc3AgPT09IHRoaXMueWJhc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy55ZGlzcC0tO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnliYXNlLS07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEJ1ZmZlci5wcm90b3R5cGUuX3JlZmxvd1NtYWxsZXIgPSBmdW5jdGlvbiAobmV3Q29scywgbmV3Um93cykge1xuICAgICAgICB2YXIgbnVsbENlbGwgPSB0aGlzLmdldE51bGxDZWxsKEJ1ZmZlckxpbmVfMS5ERUZBVUxUX0FUVFJfREFUQSk7XG4gICAgICAgIHZhciB0b0luc2VydCA9IFtdO1xuICAgICAgICB2YXIgY291bnRUb0luc2VydCA9IDA7XG4gICAgICAgIGZvciAodmFyIHkgPSB0aGlzLmxpbmVzLmxlbmd0aCAtIDE7IHkgPj0gMDsgeS0tKSB7XG4gICAgICAgICAgICB2YXIgbmV4dExpbmUgPSB0aGlzLmxpbmVzLmdldCh5KTtcbiAgICAgICAgICAgIGlmICghbmV4dExpbmUuaXNXcmFwcGVkICYmIG5leHRMaW5lLmdldFRyaW1tZWRMZW5ndGgoKSA8PSBuZXdDb2xzKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgd3JhcHBlZExpbmVzID0gW25leHRMaW5lXTtcbiAgICAgICAgICAgIHdoaWxlIChuZXh0TGluZS5pc1dyYXBwZWQgJiYgeSA+IDApIHtcbiAgICAgICAgICAgICAgICBuZXh0TGluZSA9IHRoaXMubGluZXMuZ2V0KC0teSk7XG4gICAgICAgICAgICAgICAgd3JhcHBlZExpbmVzLnVuc2hpZnQobmV4dExpbmUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGFic29sdXRlWSA9IHRoaXMueWJhc2UgKyB0aGlzLnk7XG4gICAgICAgICAgICBpZiAoYWJzb2x1dGVZID49IHkgJiYgYWJzb2x1dGVZIDwgeSArIHdyYXBwZWRMaW5lcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBsYXN0TGluZUxlbmd0aCA9IHdyYXBwZWRMaW5lc1t3cmFwcGVkTGluZXMubGVuZ3RoIC0gMV0uZ2V0VHJpbW1lZExlbmd0aCgpO1xuICAgICAgICAgICAgdmFyIGRlc3RMaW5lTGVuZ3RocyA9IEJ1ZmZlclJlZmxvd18xLnJlZmxvd1NtYWxsZXJHZXROZXdMaW5lTGVuZ3Rocyh3cmFwcGVkTGluZXMsIHRoaXMuX2NvbHMsIG5ld0NvbHMpO1xuICAgICAgICAgICAgdmFyIGxpbmVzVG9BZGQgPSBkZXN0TGluZUxlbmd0aHMubGVuZ3RoIC0gd3JhcHBlZExpbmVzLmxlbmd0aDtcbiAgICAgICAgICAgIHZhciB0cmltbWVkTGluZXMgPSB2b2lkIDA7XG4gICAgICAgICAgICBpZiAodGhpcy55YmFzZSA9PT0gMCAmJiB0aGlzLnkgIT09IHRoaXMubGluZXMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgIHRyaW1tZWRMaW5lcyA9IE1hdGgubWF4KDAsIHRoaXMueSAtIHRoaXMubGluZXMubWF4TGVuZ3RoICsgbGluZXNUb0FkZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0cmltbWVkTGluZXMgPSBNYXRoLm1heCgwLCB0aGlzLmxpbmVzLmxlbmd0aCAtIHRoaXMubGluZXMubWF4TGVuZ3RoICsgbGluZXNUb0FkZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgbmV3TGluZXMgPSBbXTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZXNUb0FkZDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5ld0xpbmUgPSB0aGlzLmdldEJsYW5rTGluZShCdWZmZXJMaW5lXzEuREVGQVVMVF9BVFRSX0RBVEEsIHRydWUpO1xuICAgICAgICAgICAgICAgIG5ld0xpbmVzLnB1c2gobmV3TGluZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobmV3TGluZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHRvSW5zZXJ0LnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzdGFydDogeSArIHdyYXBwZWRMaW5lcy5sZW5ndGggKyBjb3VudFRvSW5zZXJ0LFxuICAgICAgICAgICAgICAgICAgICBuZXdMaW5lczogbmV3TGluZXNcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb3VudFRvSW5zZXJ0ICs9IG5ld0xpbmVzLmxlbmd0aDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHdyYXBwZWRMaW5lcy5wdXNoLmFwcGx5KHdyYXBwZWRMaW5lcywgbmV3TGluZXMpO1xuICAgICAgICAgICAgdmFyIGRlc3RMaW5lSW5kZXggPSBkZXN0TGluZUxlbmd0aHMubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgIHZhciBkZXN0Q29sID0gZGVzdExpbmVMZW5ndGhzW2Rlc3RMaW5lSW5kZXhdO1xuICAgICAgICAgICAgaWYgKGRlc3RDb2wgPT09IDApIHtcbiAgICAgICAgICAgICAgICBkZXN0TGluZUluZGV4LS07XG4gICAgICAgICAgICAgICAgZGVzdENvbCA9IGRlc3RMaW5lTGVuZ3Roc1tkZXN0TGluZUluZGV4XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBzcmNMaW5lSW5kZXggPSB3cmFwcGVkTGluZXMubGVuZ3RoIC0gbGluZXNUb0FkZCAtIDE7XG4gICAgICAgICAgICB2YXIgc3JjQ29sID0gbGFzdExpbmVMZW5ndGg7XG4gICAgICAgICAgICB3aGlsZSAoc3JjTGluZUluZGV4ID49IDApIHtcbiAgICAgICAgICAgICAgICB2YXIgY2VsbHNUb0NvcHkgPSBNYXRoLm1pbihzcmNDb2wsIGRlc3RDb2wpO1xuICAgICAgICAgICAgICAgIHdyYXBwZWRMaW5lc1tkZXN0TGluZUluZGV4XS5jb3B5Q2VsbHNGcm9tKHdyYXBwZWRMaW5lc1tzcmNMaW5lSW5kZXhdLCBzcmNDb2wgLSBjZWxsc1RvQ29weSwgZGVzdENvbCAtIGNlbGxzVG9Db3B5LCBjZWxsc1RvQ29weSwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgZGVzdENvbCAtPSBjZWxsc1RvQ29weTtcbiAgICAgICAgICAgICAgICBpZiAoZGVzdENvbCA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBkZXN0TGluZUluZGV4LS07XG4gICAgICAgICAgICAgICAgICAgIGRlc3RDb2wgPSBkZXN0TGluZUxlbmd0aHNbZGVzdExpbmVJbmRleF07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHNyY0NvbCAtPSBjZWxsc1RvQ29weTtcbiAgICAgICAgICAgICAgICBpZiAoc3JjQ29sID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHNyY0xpbmVJbmRleC0tO1xuICAgICAgICAgICAgICAgICAgICB2YXIgd3JhcHBlZExpbmVzSW5kZXggPSBNYXRoLm1heChzcmNMaW5lSW5kZXgsIDApO1xuICAgICAgICAgICAgICAgICAgICBzcmNDb2wgPSBCdWZmZXJSZWZsb3dfMS5nZXRXcmFwcGVkTGluZVRyaW1tZWRMZW5ndGgod3JhcHBlZExpbmVzLCB3cmFwcGVkTGluZXNJbmRleCwgdGhpcy5fY29scyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB3cmFwcGVkTGluZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoZGVzdExpbmVMZW5ndGhzW2ldIDwgbmV3Q29scykge1xuICAgICAgICAgICAgICAgICAgICB3cmFwcGVkTGluZXNbaV0uc2V0Q2VsbChkZXN0TGluZUxlbmd0aHNbaV0sIG51bGxDZWxsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgdmlld3BvcnRBZGp1c3RtZW50cyA9IGxpbmVzVG9BZGQgLSB0cmltbWVkTGluZXM7XG4gICAgICAgICAgICB3aGlsZSAodmlld3BvcnRBZGp1c3RtZW50cy0tID4gMCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnliYXNlID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnkgPCBuZXdSb3dzIC0gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy55Kys7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmxpbmVzLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy55YmFzZSsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy55ZGlzcCsrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy55YmFzZSA8IE1hdGgubWluKHRoaXMubGluZXMubWF4TGVuZ3RoLCB0aGlzLmxpbmVzLmxlbmd0aCArIGNvdW50VG9JbnNlcnQpIC0gbmV3Um93cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMueWJhc2UgPT09IHRoaXMueWRpc3ApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnlkaXNwKys7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnliYXNlKys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRvSW5zZXJ0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHZhciBpbnNlcnRFdmVudHMgPSBbXTtcbiAgICAgICAgICAgIHZhciBvcmlnaW5hbExpbmVzID0gW107XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGluZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBvcmlnaW5hbExpbmVzLnB1c2godGhpcy5saW5lcy5nZXQoaSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIG9yaWdpbmFsTGluZXNMZW5ndGggPSB0aGlzLmxpbmVzLmxlbmd0aDtcbiAgICAgICAgICAgIHZhciBvcmlnaW5hbExpbmVJbmRleCA9IG9yaWdpbmFsTGluZXNMZW5ndGggLSAxO1xuICAgICAgICAgICAgdmFyIG5leHRUb0luc2VydEluZGV4ID0gMDtcbiAgICAgICAgICAgIHZhciBuZXh0VG9JbnNlcnQgPSB0b0luc2VydFtuZXh0VG9JbnNlcnRJbmRleF07XG4gICAgICAgICAgICB0aGlzLmxpbmVzLmxlbmd0aCA9IE1hdGgubWluKHRoaXMubGluZXMubWF4TGVuZ3RoLCB0aGlzLmxpbmVzLmxlbmd0aCArIGNvdW50VG9JbnNlcnQpO1xuICAgICAgICAgICAgdmFyIGNvdW50SW5zZXJ0ZWRTb0ZhciA9IDA7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gTWF0aC5taW4odGhpcy5saW5lcy5tYXhMZW5ndGggLSAxLCBvcmlnaW5hbExpbmVzTGVuZ3RoICsgY291bnRUb0luc2VydCAtIDEpOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgICAgIGlmIChuZXh0VG9JbnNlcnQgJiYgbmV4dFRvSW5zZXJ0LnN0YXJ0ID4gb3JpZ2luYWxMaW5lSW5kZXggKyBjb3VudEluc2VydGVkU29GYXIpIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgbmV4dEkgPSBuZXh0VG9JbnNlcnQubmV3TGluZXMubGVuZ3RoIC0gMTsgbmV4dEkgPj0gMDsgbmV4dEktLSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5saW5lcy5zZXQoaS0tLCBuZXh0VG9JbnNlcnQubmV3TGluZXNbbmV4dEldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpKys7XG4gICAgICAgICAgICAgICAgICAgIGluc2VydEV2ZW50cy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4OiBvcmlnaW5hbExpbmVJbmRleCArIDEsXG4gICAgICAgICAgICAgICAgICAgICAgICBhbW91bnQ6IG5leHRUb0luc2VydC5uZXdMaW5lcy5sZW5ndGhcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGNvdW50SW5zZXJ0ZWRTb0ZhciArPSBuZXh0VG9JbnNlcnQubmV3TGluZXMubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICBuZXh0VG9JbnNlcnQgPSB0b0luc2VydFsrK25leHRUb0luc2VydEluZGV4XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGluZXMuc2V0KGksIG9yaWdpbmFsTGluZXNbb3JpZ2luYWxMaW5lSW5kZXgtLV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBpbnNlcnRDb3VudEVtaXR0ZWQgPSAwO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IGluc2VydEV2ZW50cy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgICAgIGluc2VydEV2ZW50c1tpXS5pbmRleCArPSBpbnNlcnRDb3VudEVtaXR0ZWQ7XG4gICAgICAgICAgICAgICAgdGhpcy5saW5lcy5vbkluc2VydEVtaXR0ZXIuZmlyZShpbnNlcnRFdmVudHNbaV0pO1xuICAgICAgICAgICAgICAgIGluc2VydENvdW50RW1pdHRlZCArPSBpbnNlcnRFdmVudHNbaV0uYW1vdW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGFtb3VudFRvVHJpbSA9IE1hdGgubWF4KDAsIG9yaWdpbmFsTGluZXNMZW5ndGggKyBjb3VudFRvSW5zZXJ0IC0gdGhpcy5saW5lcy5tYXhMZW5ndGgpO1xuICAgICAgICAgICAgaWYgKGFtb3VudFRvVHJpbSA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxpbmVzLm9uVHJpbUVtaXR0ZXIuZmlyZShhbW91bnRUb1RyaW0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBCdWZmZXIucHJvdG90eXBlLnN0cmluZ0luZGV4VG9CdWZmZXJJbmRleCA9IGZ1bmN0aW9uIChsaW5lSW5kZXgsIHN0cmluZ0luZGV4LCB0cmltUmlnaHQpIHtcbiAgICAgICAgaWYgKHRyaW1SaWdodCA9PT0gdm9pZCAwKSB7IHRyaW1SaWdodCA9IGZhbHNlOyB9XG4gICAgICAgIHdoaWxlIChzdHJpbmdJbmRleCkge1xuICAgICAgICAgICAgdmFyIGxpbmUgPSB0aGlzLmxpbmVzLmdldChsaW5lSW5kZXgpO1xuICAgICAgICAgICAgaWYgKCFsaW5lKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFstMSwgLTFdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGxlbmd0aF8xID0gKHRyaW1SaWdodCkgPyBsaW5lLmdldFRyaW1tZWRMZW5ndGgoKSA6IGxpbmUubGVuZ3RoO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGhfMTsgKytpKSB7XG4gICAgICAgICAgICAgICAgaWYgKGxpbmUuZ2V0KGkpW0J1ZmZlckxpbmVfMS5DSEFSX0RBVEFfV0lEVEhfSU5ERVhdKSB7XG4gICAgICAgICAgICAgICAgICAgIHN0cmluZ0luZGV4IC09IGxpbmUuZ2V0KGkpW0J1ZmZlckxpbmVfMS5DSEFSX0RBVEFfQ0hBUl9JTkRFWF0ubGVuZ3RoIHx8IDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChzdHJpbmdJbmRleCA8IDApIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtsaW5lSW5kZXgsIGldO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxpbmVJbmRleCsrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBbbGluZUluZGV4LCAwXTtcbiAgICB9O1xuICAgIEJ1ZmZlci5wcm90b3R5cGUudHJhbnNsYXRlQnVmZmVyTGluZVRvU3RyaW5nID0gZnVuY3Rpb24gKGxpbmVJbmRleCwgdHJpbVJpZ2h0LCBzdGFydENvbCwgZW5kQ29sKSB7XG4gICAgICAgIGlmIChzdGFydENvbCA9PT0gdm9pZCAwKSB7IHN0YXJ0Q29sID0gMDsgfVxuICAgICAgICB2YXIgbGluZSA9IHRoaXMubGluZXMuZ2V0KGxpbmVJbmRleCk7XG4gICAgICAgIGlmICghbGluZSkge1xuICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBsaW5lLnRyYW5zbGF0ZVRvU3RyaW5nKHRyaW1SaWdodCwgc3RhcnRDb2wsIGVuZENvbCk7XG4gICAgfTtcbiAgICBCdWZmZXIucHJvdG90eXBlLmdldFdyYXBwZWRSYW5nZUZvckxpbmUgPSBmdW5jdGlvbiAoeSkge1xuICAgICAgICB2YXIgZmlyc3QgPSB5O1xuICAgICAgICB2YXIgbGFzdCA9IHk7XG4gICAgICAgIHdoaWxlIChmaXJzdCA+IDAgJiYgdGhpcy5saW5lcy5nZXQoZmlyc3QpLmlzV3JhcHBlZCkge1xuICAgICAgICAgICAgZmlyc3QtLTtcbiAgICAgICAgfVxuICAgICAgICB3aGlsZSAobGFzdCArIDEgPCB0aGlzLmxpbmVzLmxlbmd0aCAmJiB0aGlzLmxpbmVzLmdldChsYXN0ICsgMSkuaXNXcmFwcGVkKSB7XG4gICAgICAgICAgICBsYXN0Kys7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgZmlyc3Q6IGZpcnN0LCBsYXN0OiBsYXN0IH07XG4gICAgfTtcbiAgICBCdWZmZXIucHJvdG90eXBlLnNldHVwVGFiU3RvcHMgPSBmdW5jdGlvbiAoaSkge1xuICAgICAgICBpZiAoaSAhPT0gbnVsbCAmJiBpICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGlmICghdGhpcy50YWJzW2ldKSB7XG4gICAgICAgICAgICAgICAgaSA9IHRoaXMucHJldlN0b3AoaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRhYnMgPSB7fTtcbiAgICAgICAgICAgIGkgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoOyBpIDwgdGhpcy5fY29sczsgaSArPSB0aGlzLl90ZXJtaW5hbC5vcHRpb25zLnRhYlN0b3BXaWR0aCkge1xuICAgICAgICAgICAgdGhpcy50YWJzW2ldID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQnVmZmVyLnByb3RvdHlwZS5wcmV2U3RvcCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIGlmICh4ID09PSBudWxsIHx8IHggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgeCA9IHRoaXMueDtcbiAgICAgICAgfVxuICAgICAgICB3aGlsZSAoIXRoaXMudGFic1stLXhdICYmIHggPiAwKVxuICAgICAgICAgICAgO1xuICAgICAgICByZXR1cm4geCA+PSB0aGlzLl9jb2xzID8gdGhpcy5fY29scyAtIDEgOiB4IDwgMCA/IDAgOiB4O1xuICAgIH07XG4gICAgQnVmZmVyLnByb3RvdHlwZS5uZXh0U3RvcCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIGlmICh4ID09PSBudWxsIHx8IHggPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgeCA9IHRoaXMueDtcbiAgICAgICAgfVxuICAgICAgICB3aGlsZSAoIXRoaXMudGFic1srK3hdICYmIHggPCB0aGlzLl9jb2xzKVxuICAgICAgICAgICAgO1xuICAgICAgICByZXR1cm4geCA+PSB0aGlzLl9jb2xzID8gdGhpcy5fY29scyAtIDEgOiB4IDwgMCA/IDAgOiB4O1xuICAgIH07XG4gICAgQnVmZmVyLnByb3RvdHlwZS5hZGRNYXJrZXIgPSBmdW5jdGlvbiAoeSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgbWFya2VyID0gbmV3IE1hcmtlcih5KTtcbiAgICAgICAgdGhpcy5tYXJrZXJzLnB1c2gobWFya2VyKTtcbiAgICAgICAgbWFya2VyLnJlZ2lzdGVyKHRoaXMubGluZXMub25UcmltKGZ1bmN0aW9uIChhbW91bnQpIHtcbiAgICAgICAgICAgIG1hcmtlci5saW5lIC09IGFtb3VudDtcbiAgICAgICAgICAgIGlmIChtYXJrZXIubGluZSA8IDApIHtcbiAgICAgICAgICAgICAgICBtYXJrZXIuZGlzcG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSk7XG4gICAgICAgIG1hcmtlci5yZWdpc3Rlcih0aGlzLmxpbmVzLm9uSW5zZXJ0KGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgaWYgKG1hcmtlci5saW5lID49IGV2ZW50LmluZGV4KSB7XG4gICAgICAgICAgICAgICAgbWFya2VyLmxpbmUgKz0gZXZlbnQuYW1vdW50O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSk7XG4gICAgICAgIG1hcmtlci5yZWdpc3Rlcih0aGlzLmxpbmVzLm9uRGVsZXRlKGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgaWYgKG1hcmtlci5saW5lID49IGV2ZW50LmluZGV4ICYmIG1hcmtlci5saW5lIDwgZXZlbnQuaW5kZXggKyBldmVudC5hbW91bnQpIHtcbiAgICAgICAgICAgICAgICBtYXJrZXIuZGlzcG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG1hcmtlci5saW5lID4gZXZlbnQuaW5kZXgpIHtcbiAgICAgICAgICAgICAgICBtYXJrZXIubGluZSAtPSBldmVudC5hbW91bnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgICAgICAgbWFya2VyLnJlZ2lzdGVyKG1hcmtlci5vbkRpc3Bvc2UoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX3JlbW92ZU1hcmtlcihtYXJrZXIpOyB9KSk7XG4gICAgICAgIHJldHVybiBtYXJrZXI7XG4gICAgfTtcbiAgICBCdWZmZXIucHJvdG90eXBlLl9yZW1vdmVNYXJrZXIgPSBmdW5jdGlvbiAobWFya2VyKSB7XG4gICAgICAgIHRoaXMubWFya2Vycy5zcGxpY2UodGhpcy5tYXJrZXJzLmluZGV4T2YobWFya2VyKSwgMSk7XG4gICAgfTtcbiAgICBCdWZmZXIucHJvdG90eXBlLml0ZXJhdG9yID0gZnVuY3Rpb24gKHRyaW1SaWdodCwgc3RhcnRJbmRleCwgZW5kSW5kZXgsIHN0YXJ0T3ZlcnNjYW4sIGVuZE92ZXJzY2FuKSB7XG4gICAgICAgIHJldHVybiBuZXcgQnVmZmVyU3RyaW5nSXRlcmF0b3IodGhpcywgdHJpbVJpZ2h0LCBzdGFydEluZGV4LCBlbmRJbmRleCwgc3RhcnRPdmVyc2NhbiwgZW5kT3ZlcnNjYW4pO1xuICAgIH07XG4gICAgcmV0dXJuIEJ1ZmZlcjtcbn0oKSk7XG5leHBvcnRzLkJ1ZmZlciA9IEJ1ZmZlcjtcbnZhciBNYXJrZXIgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhNYXJrZXIsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gTWFya2VyKGxpbmUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMubGluZSA9IGxpbmU7XG4gICAgICAgIF90aGlzLl9pZCA9IE1hcmtlci5fbmV4dElkKys7XG4gICAgICAgIF90aGlzLmlzRGlzcG9zZWQgPSBmYWxzZTtcbiAgICAgICAgX3RoaXMuX29uRGlzcG9zZSA9IG5ldyBFdmVudEVtaXR0ZXIyXzEuRXZlbnRFbWl0dGVyMigpO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShNYXJrZXIucHJvdG90eXBlLCBcImlkXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9pZDsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KE1hcmtlci5wcm90b3R5cGUsIFwib25EaXNwb3NlXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9vbkRpc3Bvc2UuZXZlbnQ7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE1hcmtlci5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNEaXNwb3NlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaXNEaXNwb3NlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuX29uRGlzcG9zZS5maXJlKCk7XG4gICAgfTtcbiAgICBNYXJrZXIuX25leHRJZCA9IDE7XG4gICAgcmV0dXJuIE1hcmtlcjtcbn0oTGlmZWN5Y2xlXzEuRGlzcG9zYWJsZSkpO1xuZXhwb3J0cy5NYXJrZXIgPSBNYXJrZXI7XG52YXIgQnVmZmVyU3RyaW5nSXRlcmF0b3IgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEJ1ZmZlclN0cmluZ0l0ZXJhdG9yKF9idWZmZXIsIF90cmltUmlnaHQsIF9zdGFydEluZGV4LCBfZW5kSW5kZXgsIF9zdGFydE92ZXJzY2FuLCBfZW5kT3ZlcnNjYW4pIHtcbiAgICAgICAgaWYgKF9zdGFydEluZGV4ID09PSB2b2lkIDApIHsgX3N0YXJ0SW5kZXggPSAwOyB9XG4gICAgICAgIGlmIChfZW5kSW5kZXggPT09IHZvaWQgMCkgeyBfZW5kSW5kZXggPSBfYnVmZmVyLmxpbmVzLmxlbmd0aDsgfVxuICAgICAgICBpZiAoX3N0YXJ0T3ZlcnNjYW4gPT09IHZvaWQgMCkgeyBfc3RhcnRPdmVyc2NhbiA9IDA7IH1cbiAgICAgICAgaWYgKF9lbmRPdmVyc2NhbiA9PT0gdm9pZCAwKSB7IF9lbmRPdmVyc2NhbiA9IDA7IH1cbiAgICAgICAgdGhpcy5fYnVmZmVyID0gX2J1ZmZlcjtcbiAgICAgICAgdGhpcy5fdHJpbVJpZ2h0ID0gX3RyaW1SaWdodDtcbiAgICAgICAgdGhpcy5fc3RhcnRJbmRleCA9IF9zdGFydEluZGV4O1xuICAgICAgICB0aGlzLl9lbmRJbmRleCA9IF9lbmRJbmRleDtcbiAgICAgICAgdGhpcy5fc3RhcnRPdmVyc2NhbiA9IF9zdGFydE92ZXJzY2FuO1xuICAgICAgICB0aGlzLl9lbmRPdmVyc2NhbiA9IF9lbmRPdmVyc2NhbjtcbiAgICAgICAgaWYgKHRoaXMuX3N0YXJ0SW5kZXggPCAwKSB7XG4gICAgICAgICAgICB0aGlzLl9zdGFydEluZGV4ID0gMDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fZW5kSW5kZXggPiB0aGlzLl9idWZmZXIubGluZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLl9lbmRJbmRleCA9IHRoaXMuX2J1ZmZlci5saW5lcy5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fY3VycmVudCA9IHRoaXMuX3N0YXJ0SW5kZXg7XG4gICAgfVxuICAgIEJ1ZmZlclN0cmluZ0l0ZXJhdG9yLnByb3RvdHlwZS5oYXNOZXh0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudCA8IHRoaXMuX2VuZEluZGV4O1xuICAgIH07XG4gICAgQnVmZmVyU3RyaW5nSXRlcmF0b3IucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciByYW5nZSA9IHRoaXMuX2J1ZmZlci5nZXRXcmFwcGVkUmFuZ2VGb3JMaW5lKHRoaXMuX2N1cnJlbnQpO1xuICAgICAgICBpZiAocmFuZ2UuZmlyc3QgPCB0aGlzLl9zdGFydEluZGV4IC0gdGhpcy5fc3RhcnRPdmVyc2Nhbikge1xuICAgICAgICAgICAgcmFuZ2UuZmlyc3QgPSB0aGlzLl9zdGFydEluZGV4IC0gdGhpcy5fc3RhcnRPdmVyc2NhbjtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmFuZ2UubGFzdCA+IHRoaXMuX2VuZEluZGV4ICsgdGhpcy5fZW5kT3ZlcnNjYW4pIHtcbiAgICAgICAgICAgIHJhbmdlLmxhc3QgPSB0aGlzLl9lbmRJbmRleCArIHRoaXMuX2VuZE92ZXJzY2FuO1xuICAgICAgICB9XG4gICAgICAgIHJhbmdlLmZpcnN0ID0gTWF0aC5tYXgocmFuZ2UuZmlyc3QsIDApO1xuICAgICAgICByYW5nZS5sYXN0ID0gTWF0aC5taW4ocmFuZ2UubGFzdCwgdGhpcy5fYnVmZmVyLmxpbmVzLmxlbmd0aCk7XG4gICAgICAgIHZhciByZXN1bHQgPSAnJztcbiAgICAgICAgZm9yICh2YXIgaSA9IHJhbmdlLmZpcnN0OyBpIDw9IHJhbmdlLmxhc3Q7ICsraSkge1xuICAgICAgICAgICAgcmVzdWx0ICs9IHRoaXMuX2J1ZmZlci50cmFuc2xhdGVCdWZmZXJMaW5lVG9TdHJpbmcoaSwgdGhpcy5fdHJpbVJpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9jdXJyZW50ID0gcmFuZ2UubGFzdCArIDE7XG4gICAgICAgIHJldHVybiB7IHJhbmdlOiByYW5nZSwgY29udGVudDogcmVzdWx0IH07XG4gICAgfTtcbiAgICByZXR1cm4gQnVmZmVyU3RyaW5nSXRlcmF0b3I7XG59KCkpO1xuZXhwb3J0cy5CdWZmZXJTdHJpbmdJdGVyYXRvciA9IEJ1ZmZlclN0cmluZ0l0ZXJhdG9yO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9QnVmZmVyLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZnVuY3Rpb24gcmVmbG93TGFyZ2VyR2V0TGluZXNUb1JlbW92ZShsaW5lcywgb2xkQ29scywgbmV3Q29scywgYnVmZmVyQWJzb2x1dGVZLCBudWxsQ2VsbCkge1xuICAgIHZhciB0b1JlbW92ZSA9IFtdO1xuICAgIGZvciAodmFyIHkgPSAwOyB5IDwgbGluZXMubGVuZ3RoIC0gMTsgeSsrKSB7XG4gICAgICAgIHZhciBpID0geTtcbiAgICAgICAgdmFyIG5leHRMaW5lID0gbGluZXMuZ2V0KCsraSk7XG4gICAgICAgIGlmICghbmV4dExpbmUuaXNXcmFwcGVkKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgd3JhcHBlZExpbmVzID0gW2xpbmVzLmdldCh5KV07XG4gICAgICAgIHdoaWxlIChpIDwgbGluZXMubGVuZ3RoICYmIG5leHRMaW5lLmlzV3JhcHBlZCkge1xuICAgICAgICAgICAgd3JhcHBlZExpbmVzLnB1c2gobmV4dExpbmUpO1xuICAgICAgICAgICAgbmV4dExpbmUgPSBsaW5lcy5nZXQoKytpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYnVmZmVyQWJzb2x1dGVZID49IHkgJiYgYnVmZmVyQWJzb2x1dGVZIDwgaSkge1xuICAgICAgICAgICAgeSArPSB3cmFwcGVkTGluZXMubGVuZ3RoIC0gMTtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIHZhciBkZXN0TGluZUluZGV4ID0gMDtcbiAgICAgICAgdmFyIGRlc3RDb2wgPSBnZXRXcmFwcGVkTGluZVRyaW1tZWRMZW5ndGgod3JhcHBlZExpbmVzLCBkZXN0TGluZUluZGV4LCBvbGRDb2xzKTtcbiAgICAgICAgdmFyIHNyY0xpbmVJbmRleCA9IDE7XG4gICAgICAgIHZhciBzcmNDb2wgPSAwO1xuICAgICAgICB3aGlsZSAoc3JjTGluZUluZGV4IDwgd3JhcHBlZExpbmVzLmxlbmd0aCkge1xuICAgICAgICAgICAgdmFyIHNyY1RyaW1tZWRUaW5lTGVuZ3RoID0gZ2V0V3JhcHBlZExpbmVUcmltbWVkTGVuZ3RoKHdyYXBwZWRMaW5lcywgc3JjTGluZUluZGV4LCBvbGRDb2xzKTtcbiAgICAgICAgICAgIHZhciBzcmNSZW1haW5pbmdDZWxscyA9IHNyY1RyaW1tZWRUaW5lTGVuZ3RoIC0gc3JjQ29sO1xuICAgICAgICAgICAgdmFyIGRlc3RSZW1haW5pbmdDZWxscyA9IG5ld0NvbHMgLSBkZXN0Q29sO1xuICAgICAgICAgICAgdmFyIGNlbGxzVG9Db3B5ID0gTWF0aC5taW4oc3JjUmVtYWluaW5nQ2VsbHMsIGRlc3RSZW1haW5pbmdDZWxscyk7XG4gICAgICAgICAgICB3cmFwcGVkTGluZXNbZGVzdExpbmVJbmRleF0uY29weUNlbGxzRnJvbSh3cmFwcGVkTGluZXNbc3JjTGluZUluZGV4XSwgc3JjQ29sLCBkZXN0Q29sLCBjZWxsc1RvQ29weSwgZmFsc2UpO1xuICAgICAgICAgICAgZGVzdENvbCArPSBjZWxsc1RvQ29weTtcbiAgICAgICAgICAgIGlmIChkZXN0Q29sID09PSBuZXdDb2xzKSB7XG4gICAgICAgICAgICAgICAgZGVzdExpbmVJbmRleCsrO1xuICAgICAgICAgICAgICAgIGRlc3RDb2wgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3JjQ29sICs9IGNlbGxzVG9Db3B5O1xuICAgICAgICAgICAgaWYgKHNyY0NvbCA9PT0gc3JjVHJpbW1lZFRpbmVMZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBzcmNMaW5lSW5kZXgrKztcbiAgICAgICAgICAgICAgICBzcmNDb2wgPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGRlc3RDb2wgPT09IDAgJiYgZGVzdExpbmVJbmRleCAhPT0gMCkge1xuICAgICAgICAgICAgICAgIGlmICh3cmFwcGVkTGluZXNbZGVzdExpbmVJbmRleCAtIDFdLmdldFdpZHRoKG5ld0NvbHMgLSAxKSA9PT0gMikge1xuICAgICAgICAgICAgICAgICAgICB3cmFwcGVkTGluZXNbZGVzdExpbmVJbmRleF0uY29weUNlbGxzRnJvbSh3cmFwcGVkTGluZXNbZGVzdExpbmVJbmRleCAtIDFdLCBuZXdDb2xzIC0gMSwgZGVzdENvbCsrLCAxLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgIHdyYXBwZWRMaW5lc1tkZXN0TGluZUluZGV4IC0gMV0uc2V0Q2VsbChuZXdDb2xzIC0gMSwgbnVsbENlbGwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB3cmFwcGVkTGluZXNbZGVzdExpbmVJbmRleF0ucmVwbGFjZUNlbGxzKGRlc3RDb2wsIG5ld0NvbHMsIG51bGxDZWxsKTtcbiAgICAgICAgdmFyIGNvdW50VG9SZW1vdmUgPSAwO1xuICAgICAgICBmb3IgKHZhciBpXzEgPSB3cmFwcGVkTGluZXMubGVuZ3RoIC0gMTsgaV8xID4gMDsgaV8xLS0pIHtcbiAgICAgICAgICAgIGlmIChpXzEgPiBkZXN0TGluZUluZGV4IHx8IHdyYXBwZWRMaW5lc1tpXzFdLmdldFRyaW1tZWRMZW5ndGgoKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGNvdW50VG9SZW1vdmUrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChjb3VudFRvUmVtb3ZlID4gMCkge1xuICAgICAgICAgICAgdG9SZW1vdmUucHVzaCh5ICsgd3JhcHBlZExpbmVzLmxlbmd0aCAtIGNvdW50VG9SZW1vdmUpO1xuICAgICAgICAgICAgdG9SZW1vdmUucHVzaChjb3VudFRvUmVtb3ZlKTtcbiAgICAgICAgfVxuICAgICAgICB5ICs9IHdyYXBwZWRMaW5lcy5sZW5ndGggLSAxO1xuICAgIH1cbiAgICByZXR1cm4gdG9SZW1vdmU7XG59XG5leHBvcnRzLnJlZmxvd0xhcmdlckdldExpbmVzVG9SZW1vdmUgPSByZWZsb3dMYXJnZXJHZXRMaW5lc1RvUmVtb3ZlO1xuZnVuY3Rpb24gcmVmbG93TGFyZ2VyQ3JlYXRlTmV3TGF5b3V0KGxpbmVzLCB0b1JlbW92ZSkge1xuICAgIHZhciBsYXlvdXQgPSBbXTtcbiAgICB2YXIgbmV4dFRvUmVtb3ZlSW5kZXggPSAwO1xuICAgIHZhciBuZXh0VG9SZW1vdmVTdGFydCA9IHRvUmVtb3ZlW25leHRUb1JlbW92ZUluZGV4XTtcbiAgICB2YXIgY291bnRSZW1vdmVkU29GYXIgPSAwO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKG5leHRUb1JlbW92ZVN0YXJ0ID09PSBpKSB7XG4gICAgICAgICAgICB2YXIgY291bnRUb1JlbW92ZSA9IHRvUmVtb3ZlWysrbmV4dFRvUmVtb3ZlSW5kZXhdO1xuICAgICAgICAgICAgbGluZXMub25EZWxldGVFbWl0dGVyLmZpcmUoe1xuICAgICAgICAgICAgICAgIGluZGV4OiBpIC0gY291bnRSZW1vdmVkU29GYXIsXG4gICAgICAgICAgICAgICAgYW1vdW50OiBjb3VudFRvUmVtb3ZlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGkgKz0gY291bnRUb1JlbW92ZSAtIDE7XG4gICAgICAgICAgICBjb3VudFJlbW92ZWRTb0ZhciArPSBjb3VudFRvUmVtb3ZlO1xuICAgICAgICAgICAgbmV4dFRvUmVtb3ZlU3RhcnQgPSB0b1JlbW92ZVsrK25leHRUb1JlbW92ZUluZGV4XTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGxheW91dC5wdXNoKGkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIGxheW91dDogbGF5b3V0LFxuICAgICAgICBjb3VudFJlbW92ZWQ6IGNvdW50UmVtb3ZlZFNvRmFyXG4gICAgfTtcbn1cbmV4cG9ydHMucmVmbG93TGFyZ2VyQ3JlYXRlTmV3TGF5b3V0ID0gcmVmbG93TGFyZ2VyQ3JlYXRlTmV3TGF5b3V0O1xuZnVuY3Rpb24gcmVmbG93TGFyZ2VyQXBwbHlOZXdMYXlvdXQobGluZXMsIG5ld0xheW91dCkge1xuICAgIHZhciBuZXdMYXlvdXRMaW5lcyA9IFtdO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbmV3TGF5b3V0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIG5ld0xheW91dExpbmVzLnB1c2gobGluZXMuZ2V0KG5ld0xheW91dFtpXSkpO1xuICAgIH1cbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG5ld0xheW91dExpbmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGxpbmVzLnNldChpLCBuZXdMYXlvdXRMaW5lc1tpXSk7XG4gICAgfVxuICAgIGxpbmVzLmxlbmd0aCA9IG5ld0xheW91dC5sZW5ndGg7XG59XG5leHBvcnRzLnJlZmxvd0xhcmdlckFwcGx5TmV3TGF5b3V0ID0gcmVmbG93TGFyZ2VyQXBwbHlOZXdMYXlvdXQ7XG5mdW5jdGlvbiByZWZsb3dTbWFsbGVyR2V0TmV3TGluZUxlbmd0aHMod3JhcHBlZExpbmVzLCBvbGRDb2xzLCBuZXdDb2xzKSB7XG4gICAgdmFyIG5ld0xpbmVMZW5ndGhzID0gW107XG4gICAgdmFyIGNlbGxzTmVlZGVkID0gd3JhcHBlZExpbmVzLm1hcChmdW5jdGlvbiAobCwgaSkgeyByZXR1cm4gZ2V0V3JhcHBlZExpbmVUcmltbWVkTGVuZ3RoKHdyYXBwZWRMaW5lcywgaSwgb2xkQ29scyk7IH0pLnJlZHVjZShmdW5jdGlvbiAocCwgYykgeyByZXR1cm4gcCArIGM7IH0pO1xuICAgIHZhciBzcmNDb2wgPSAwO1xuICAgIHZhciBzcmNMaW5lID0gMDtcbiAgICB2YXIgY2VsbHNBdmFpbGFibGUgPSAwO1xuICAgIHdoaWxlIChjZWxsc0F2YWlsYWJsZSA8IGNlbGxzTmVlZGVkKSB7XG4gICAgICAgIGlmIChjZWxsc05lZWRlZCAtIGNlbGxzQXZhaWxhYmxlIDwgbmV3Q29scykge1xuICAgICAgICAgICAgbmV3TGluZUxlbmd0aHMucHVzaChjZWxsc05lZWRlZCAtIGNlbGxzQXZhaWxhYmxlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHNyY0NvbCArPSBuZXdDb2xzO1xuICAgICAgICB2YXIgb2xkVHJpbW1lZExlbmd0aCA9IGdldFdyYXBwZWRMaW5lVHJpbW1lZExlbmd0aCh3cmFwcGVkTGluZXMsIHNyY0xpbmUsIG9sZENvbHMpO1xuICAgICAgICBpZiAoc3JjQ29sID4gb2xkVHJpbW1lZExlbmd0aCkge1xuICAgICAgICAgICAgc3JjQ29sIC09IG9sZFRyaW1tZWRMZW5ndGg7XG4gICAgICAgICAgICBzcmNMaW5lKys7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGVuZHNXaXRoV2lkZSA9IHdyYXBwZWRMaW5lc1tzcmNMaW5lXS5nZXRXaWR0aChzcmNDb2wgLSAxKSA9PT0gMjtcbiAgICAgICAgaWYgKGVuZHNXaXRoV2lkZSkge1xuICAgICAgICAgICAgc3JjQ29sLS07XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGxpbmVMZW5ndGggPSBlbmRzV2l0aFdpZGUgPyBuZXdDb2xzIC0gMSA6IG5ld0NvbHM7XG4gICAgICAgIG5ld0xpbmVMZW5ndGhzLnB1c2gobGluZUxlbmd0aCk7XG4gICAgICAgIGNlbGxzQXZhaWxhYmxlICs9IGxpbmVMZW5ndGg7XG4gICAgfVxuICAgIHJldHVybiBuZXdMaW5lTGVuZ3Rocztcbn1cbmV4cG9ydHMucmVmbG93U21hbGxlckdldE5ld0xpbmVMZW5ndGhzID0gcmVmbG93U21hbGxlckdldE5ld0xpbmVMZW5ndGhzO1xuZnVuY3Rpb24gZ2V0V3JhcHBlZExpbmVUcmltbWVkTGVuZ3RoKGxpbmVzLCBpLCBjb2xzKSB7XG4gICAgaWYgKGkgPT09IGxpbmVzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgcmV0dXJuIGxpbmVzW2ldLmdldFRyaW1tZWRMZW5ndGgoKTtcbiAgICB9XG4gICAgdmFyIGVuZHNJbk51bGwgPSAhKGxpbmVzW2ldLmhhc0NvbnRlbnQoY29scyAtIDEpKSAmJiBsaW5lc1tpXS5nZXRXaWR0aChjb2xzIC0gMSkgPT09IDE7XG4gICAgdmFyIGZvbGxvd2luZ0xpbmVTdGFydHNXaXRoV2lkZSA9IGxpbmVzW2kgKyAxXS5nZXRXaWR0aCgwKSA9PT0gMjtcbiAgICBpZiAoZW5kc0luTnVsbCAmJiBmb2xsb3dpbmdMaW5lU3RhcnRzV2l0aFdpZGUpIHtcbiAgICAgICAgcmV0dXJuIGNvbHMgLSAxO1xuICAgIH1cbiAgICByZXR1cm4gY29scztcbn1cbmV4cG9ydHMuZ2V0V3JhcHBlZExpbmVUcmltbWVkTGVuZ3RoID0gZ2V0V3JhcHBlZExpbmVUcmltbWVkTGVuZ3RoO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9QnVmZmVyUmVmbG93LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIEJ1ZmZlcl8xID0gcmVxdWlyZShcIi4vQnVmZmVyXCIpO1xudmFyIEV2ZW50RW1pdHRlcjJfMSA9IHJlcXVpcmUoXCIuL2NvbW1vbi9FdmVudEVtaXR0ZXIyXCIpO1xudmFyIEJ1ZmZlclNldCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQnVmZmVyU2V0KF90ZXJtaW5hbCkge1xuICAgICAgICB0aGlzLl90ZXJtaW5hbCA9IF90ZXJtaW5hbDtcbiAgICAgICAgdGhpcy5fb25CdWZmZXJBY3RpdmF0ZSA9IG5ldyBFdmVudEVtaXR0ZXIyXzEuRXZlbnRFbWl0dGVyMigpO1xuICAgICAgICB0aGlzLl9ub3JtYWwgPSBuZXcgQnVmZmVyXzEuQnVmZmVyKHRoaXMuX3Rlcm1pbmFsLCB0cnVlKTtcbiAgICAgICAgdGhpcy5fbm9ybWFsLmZpbGxWaWV3cG9ydFJvd3MoKTtcbiAgICAgICAgdGhpcy5fYWx0ID0gbmV3IEJ1ZmZlcl8xLkJ1ZmZlcih0aGlzLl90ZXJtaW5hbCwgZmFsc2UpO1xuICAgICAgICB0aGlzLl9hY3RpdmVCdWZmZXIgPSB0aGlzLl9ub3JtYWw7XG4gICAgICAgIHRoaXMuc2V0dXBUYWJTdG9wcygpO1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQnVmZmVyU2V0LnByb3RvdHlwZSwgXCJvbkJ1ZmZlckFjdGl2YXRlXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9vbkJ1ZmZlckFjdGl2YXRlLmV2ZW50OyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQnVmZmVyU2V0LnByb3RvdHlwZSwgXCJhbHRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hbHQ7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShCdWZmZXJTZXQucHJvdG90eXBlLCBcImFjdGl2ZVwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2FjdGl2ZUJ1ZmZlcjtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEJ1ZmZlclNldC5wcm90b3R5cGUsIFwibm9ybWFsXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbm9ybWFsO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBCdWZmZXJTZXQucHJvdG90eXBlLmFjdGl2YXRlTm9ybWFsQnVmZmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fYWN0aXZlQnVmZmVyID09PSB0aGlzLl9ub3JtYWwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9ub3JtYWwueCA9IHRoaXMuX2FsdC54O1xuICAgICAgICB0aGlzLl9ub3JtYWwueSA9IHRoaXMuX2FsdC55O1xuICAgICAgICB0aGlzLl9hbHQuY2xlYXIoKTtcbiAgICAgICAgdGhpcy5fYWN0aXZlQnVmZmVyID0gdGhpcy5fbm9ybWFsO1xuICAgICAgICB0aGlzLl9vbkJ1ZmZlckFjdGl2YXRlLmZpcmUoe1xuICAgICAgICAgICAgYWN0aXZlQnVmZmVyOiB0aGlzLl9ub3JtYWwsXG4gICAgICAgICAgICBpbmFjdGl2ZUJ1ZmZlcjogdGhpcy5fYWx0XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgQnVmZmVyU2V0LnByb3RvdHlwZS5hY3RpdmF0ZUFsdEJ1ZmZlciA9IGZ1bmN0aW9uIChmaWxsQXR0cikge1xuICAgICAgICBpZiAodGhpcy5fYWN0aXZlQnVmZmVyID09PSB0aGlzLl9hbHQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9hbHQuZmlsbFZpZXdwb3J0Um93cyhmaWxsQXR0cik7XG4gICAgICAgIHRoaXMuX2FsdC54ID0gdGhpcy5fbm9ybWFsLng7XG4gICAgICAgIHRoaXMuX2FsdC55ID0gdGhpcy5fbm9ybWFsLnk7XG4gICAgICAgIHRoaXMuX2FjdGl2ZUJ1ZmZlciA9IHRoaXMuX2FsdDtcbiAgICAgICAgdGhpcy5fb25CdWZmZXJBY3RpdmF0ZS5maXJlKHtcbiAgICAgICAgICAgIGFjdGl2ZUJ1ZmZlcjogdGhpcy5fYWx0LFxuICAgICAgICAgICAgaW5hY3RpdmVCdWZmZXI6IHRoaXMuX25vcm1hbFxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIEJ1ZmZlclNldC5wcm90b3R5cGUucmVzaXplID0gZnVuY3Rpb24gKG5ld0NvbHMsIG5ld1Jvd3MpIHtcbiAgICAgICAgdGhpcy5fbm9ybWFsLnJlc2l6ZShuZXdDb2xzLCBuZXdSb3dzKTtcbiAgICAgICAgdGhpcy5fYWx0LnJlc2l6ZShuZXdDb2xzLCBuZXdSb3dzKTtcbiAgICB9O1xuICAgIEJ1ZmZlclNldC5wcm90b3R5cGUuc2V0dXBUYWJTdG9wcyA9IGZ1bmN0aW9uIChpKSB7XG4gICAgICAgIHRoaXMuX25vcm1hbC5zZXR1cFRhYlN0b3BzKGkpO1xuICAgICAgICB0aGlzLl9hbHQuc2V0dXBUYWJTdG9wcyhpKTtcbiAgICB9O1xuICAgIHJldHVybiBCdWZmZXJTZXQ7XG59KCkpO1xuZXhwb3J0cy5CdWZmZXJTZXQgPSBCdWZmZXJTZXQ7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1CdWZmZXJTZXQuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgRXZlbnRFbWl0dGVyMl8xID0gcmVxdWlyZShcIi4vY29tbW9uL0V2ZW50RW1pdHRlcjJcIik7XG52YXIgQ2hhck1lYXN1cmUgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIENoYXJNZWFzdXJlKGRvY3VtZW50LCBwYXJlbnRFbGVtZW50KSB7XG4gICAgICAgIHRoaXMuX29uQ2hhclNpemVDaGFuZ2VkID0gbmV3IEV2ZW50RW1pdHRlcjJfMS5FdmVudEVtaXR0ZXIyKCk7XG4gICAgICAgIHRoaXMuX2RvY3VtZW50ID0gZG9jdW1lbnQ7XG4gICAgICAgIHRoaXMuX3BhcmVudEVsZW1lbnQgPSBwYXJlbnRFbGVtZW50O1xuICAgICAgICB0aGlzLl9tZWFzdXJlRWxlbWVudCA9IHRoaXMuX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgICAgdGhpcy5fbWVhc3VyZUVsZW1lbnQuY2xhc3NMaXN0LmFkZCgneHRlcm0tY2hhci1tZWFzdXJlLWVsZW1lbnQnKTtcbiAgICAgICAgdGhpcy5fbWVhc3VyZUVsZW1lbnQudGV4dENvbnRlbnQgPSAnVyc7XG4gICAgICAgIHRoaXMuX21lYXN1cmVFbGVtZW50LnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAndHJ1ZScpO1xuICAgICAgICB0aGlzLl9wYXJlbnRFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuX21lYXN1cmVFbGVtZW50KTtcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENoYXJNZWFzdXJlLnByb3RvdHlwZSwgXCJvbkNoYXJTaXplQ2hhbmdlZFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fb25DaGFyU2l6ZUNoYW5nZWQuZXZlbnQ7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDaGFyTWVhc3VyZS5wcm90b3R5cGUsIFwid2lkdGhcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl93aWR0aDtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENoYXJNZWFzdXJlLnByb3RvdHlwZSwgXCJoZWlnaHRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9oZWlnaHQ7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIENoYXJNZWFzdXJlLnByb3RvdHlwZS5tZWFzdXJlID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5fbWVhc3VyZUVsZW1lbnQuc3R5bGUuZm9udEZhbWlseSA9IG9wdGlvbnMuZm9udEZhbWlseTtcbiAgICAgICAgdGhpcy5fbWVhc3VyZUVsZW1lbnQuc3R5bGUuZm9udFNpemUgPSBvcHRpb25zLmZvbnRTaXplICsgXCJweFwiO1xuICAgICAgICB2YXIgZ2VvbWV0cnkgPSB0aGlzLl9tZWFzdXJlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgaWYgKGdlb21ldHJ5LndpZHRoID09PSAwIHx8IGdlb21ldHJ5LmhlaWdodCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBhZGp1c3RlZEhlaWdodCA9IE1hdGguY2VpbChnZW9tZXRyeS5oZWlnaHQpO1xuICAgICAgICBpZiAodGhpcy5fd2lkdGggIT09IGdlb21ldHJ5LndpZHRoIHx8IHRoaXMuX2hlaWdodCAhPT0gYWRqdXN0ZWRIZWlnaHQpIHtcbiAgICAgICAgICAgIHRoaXMuX3dpZHRoID0gZ2VvbWV0cnkud2lkdGg7XG4gICAgICAgICAgICB0aGlzLl9oZWlnaHQgPSBhZGp1c3RlZEhlaWdodDtcbiAgICAgICAgICAgIHRoaXMuX29uQ2hhclNpemVDaGFuZ2VkLmZpcmUoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIENoYXJNZWFzdXJlO1xufSgpKTtcbmV4cG9ydHMuQ2hhck1lYXN1cmUgPSBDaGFyTWVhc3VyZTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUNoYXJNZWFzdXJlLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIFR5cGVkQXJyYXlVdGlsc18xID0gcmVxdWlyZShcIi4vY29tbW9uL1R5cGVkQXJyYXlVdGlsc1wiKTtcbmV4cG9ydHMud2N3aWR0aCA9IChmdW5jdGlvbiAob3B0cykge1xuICAgIHZhciBDT01CSU5JTkdfQk1QID0gW1xuICAgICAgICBbMHgwMzAwLCAweDAzNkZdLCBbMHgwNDgzLCAweDA0ODZdLCBbMHgwNDg4LCAweDA0ODldLFxuICAgICAgICBbMHgwNTkxLCAweDA1QkRdLCBbMHgwNUJGLCAweDA1QkZdLCBbMHgwNUMxLCAweDA1QzJdLFxuICAgICAgICBbMHgwNUM0LCAweDA1QzVdLCBbMHgwNUM3LCAweDA1QzddLCBbMHgwNjAwLCAweDA2MDNdLFxuICAgICAgICBbMHgwNjEwLCAweDA2MTVdLCBbMHgwNjRCLCAweDA2NUVdLCBbMHgwNjcwLCAweDA2NzBdLFxuICAgICAgICBbMHgwNkQ2LCAweDA2RTRdLCBbMHgwNkU3LCAweDA2RThdLCBbMHgwNkVBLCAweDA2RURdLFxuICAgICAgICBbMHgwNzBGLCAweDA3MEZdLCBbMHgwNzExLCAweDA3MTFdLCBbMHgwNzMwLCAweDA3NEFdLFxuICAgICAgICBbMHgwN0E2LCAweDA3QjBdLCBbMHgwN0VCLCAweDA3RjNdLCBbMHgwOTAxLCAweDA5MDJdLFxuICAgICAgICBbMHgwOTNDLCAweDA5M0NdLCBbMHgwOTQxLCAweDA5NDhdLCBbMHgwOTRELCAweDA5NERdLFxuICAgICAgICBbMHgwOTUxLCAweDA5NTRdLCBbMHgwOTYyLCAweDA5NjNdLCBbMHgwOTgxLCAweDA5ODFdLFxuICAgICAgICBbMHgwOUJDLCAweDA5QkNdLCBbMHgwOUMxLCAweDA5QzRdLCBbMHgwOUNELCAweDA5Q0RdLFxuICAgICAgICBbMHgwOUUyLCAweDA5RTNdLCBbMHgwQTAxLCAweDBBMDJdLCBbMHgwQTNDLCAweDBBM0NdLFxuICAgICAgICBbMHgwQTQxLCAweDBBNDJdLCBbMHgwQTQ3LCAweDBBNDhdLCBbMHgwQTRCLCAweDBBNERdLFxuICAgICAgICBbMHgwQTcwLCAweDBBNzFdLCBbMHgwQTgxLCAweDBBODJdLCBbMHgwQUJDLCAweDBBQkNdLFxuICAgICAgICBbMHgwQUMxLCAweDBBQzVdLCBbMHgwQUM3LCAweDBBQzhdLCBbMHgwQUNELCAweDBBQ0RdLFxuICAgICAgICBbMHgwQUUyLCAweDBBRTNdLCBbMHgwQjAxLCAweDBCMDFdLCBbMHgwQjNDLCAweDBCM0NdLFxuICAgICAgICBbMHgwQjNGLCAweDBCM0ZdLCBbMHgwQjQxLCAweDBCNDNdLCBbMHgwQjRELCAweDBCNERdLFxuICAgICAgICBbMHgwQjU2LCAweDBCNTZdLCBbMHgwQjgyLCAweDBCODJdLCBbMHgwQkMwLCAweDBCQzBdLFxuICAgICAgICBbMHgwQkNELCAweDBCQ0RdLCBbMHgwQzNFLCAweDBDNDBdLCBbMHgwQzQ2LCAweDBDNDhdLFxuICAgICAgICBbMHgwQzRBLCAweDBDNERdLCBbMHgwQzU1LCAweDBDNTZdLCBbMHgwQ0JDLCAweDBDQkNdLFxuICAgICAgICBbMHgwQ0JGLCAweDBDQkZdLCBbMHgwQ0M2LCAweDBDQzZdLCBbMHgwQ0NDLCAweDBDQ0RdLFxuICAgICAgICBbMHgwQ0UyLCAweDBDRTNdLCBbMHgwRDQxLCAweDBENDNdLCBbMHgwRDRELCAweDBENERdLFxuICAgICAgICBbMHgwRENBLCAweDBEQ0FdLCBbMHgwREQyLCAweDBERDRdLCBbMHgwREQ2LCAweDBERDZdLFxuICAgICAgICBbMHgwRTMxLCAweDBFMzFdLCBbMHgwRTM0LCAweDBFM0FdLCBbMHgwRTQ3LCAweDBFNEVdLFxuICAgICAgICBbMHgwRUIxLCAweDBFQjFdLCBbMHgwRUI0LCAweDBFQjldLCBbMHgwRUJCLCAweDBFQkNdLFxuICAgICAgICBbMHgwRUM4LCAweDBFQ0RdLCBbMHgwRjE4LCAweDBGMTldLCBbMHgwRjM1LCAweDBGMzVdLFxuICAgICAgICBbMHgwRjM3LCAweDBGMzddLCBbMHgwRjM5LCAweDBGMzldLCBbMHgwRjcxLCAweDBGN0VdLFxuICAgICAgICBbMHgwRjgwLCAweDBGODRdLCBbMHgwRjg2LCAweDBGODddLCBbMHgwRjkwLCAweDBGOTddLFxuICAgICAgICBbMHgwRjk5LCAweDBGQkNdLCBbMHgwRkM2LCAweDBGQzZdLCBbMHgxMDJELCAweDEwMzBdLFxuICAgICAgICBbMHgxMDMyLCAweDEwMzJdLCBbMHgxMDM2LCAweDEwMzddLCBbMHgxMDM5LCAweDEwMzldLFxuICAgICAgICBbMHgxMDU4LCAweDEwNTldLCBbMHgxMTYwLCAweDExRkZdLCBbMHgxMzVGLCAweDEzNUZdLFxuICAgICAgICBbMHgxNzEyLCAweDE3MTRdLCBbMHgxNzMyLCAweDE3MzRdLCBbMHgxNzUyLCAweDE3NTNdLFxuICAgICAgICBbMHgxNzcyLCAweDE3NzNdLCBbMHgxN0I0LCAweDE3QjVdLCBbMHgxN0I3LCAweDE3QkRdLFxuICAgICAgICBbMHgxN0M2LCAweDE3QzZdLCBbMHgxN0M5LCAweDE3RDNdLCBbMHgxN0RELCAweDE3RERdLFxuICAgICAgICBbMHgxODBCLCAweDE4MERdLCBbMHgxOEE5LCAweDE4QTldLCBbMHgxOTIwLCAweDE5MjJdLFxuICAgICAgICBbMHgxOTI3LCAweDE5MjhdLCBbMHgxOTMyLCAweDE5MzJdLCBbMHgxOTM5LCAweDE5M0JdLFxuICAgICAgICBbMHgxQTE3LCAweDFBMThdLCBbMHgxQjAwLCAweDFCMDNdLCBbMHgxQjM0LCAweDFCMzRdLFxuICAgICAgICBbMHgxQjM2LCAweDFCM0FdLCBbMHgxQjNDLCAweDFCM0NdLCBbMHgxQjQyLCAweDFCNDJdLFxuICAgICAgICBbMHgxQjZCLCAweDFCNzNdLCBbMHgxREMwLCAweDFEQ0FdLCBbMHgxREZFLCAweDFERkZdLFxuICAgICAgICBbMHgyMDBCLCAweDIwMEZdLCBbMHgyMDJBLCAweDIwMkVdLCBbMHgyMDYwLCAweDIwNjNdLFxuICAgICAgICBbMHgyMDZBLCAweDIwNkZdLCBbMHgyMEQwLCAweDIwRUZdLCBbMHgzMDJBLCAweDMwMkZdLFxuICAgICAgICBbMHgzMDk5LCAweDMwOUFdLCBbMHhBODA2LCAweEE4MDZdLCBbMHhBODBCLCAweEE4MEJdLFxuICAgICAgICBbMHhBODI1LCAweEE4MjZdLCBbMHhGQjFFLCAweEZCMUVdLCBbMHhGRTAwLCAweEZFMEZdLFxuICAgICAgICBbMHhGRTIwLCAweEZFMjNdLCBbMHhGRUZGLCAweEZFRkZdLCBbMHhGRkY5LCAweEZGRkJdXG4gICAgXTtcbiAgICB2YXIgQ09NQklOSU5HX0hJR0ggPSBbXG4gICAgICAgIFsweDEwQTAxLCAweDEwQTAzXSwgWzB4MTBBMDUsIDB4MTBBMDZdLCBbMHgxMEEwQywgMHgxMEEwRl0sXG4gICAgICAgIFsweDEwQTM4LCAweDEwQTNBXSwgWzB4MTBBM0YsIDB4MTBBM0ZdLCBbMHgxRDE2NywgMHgxRDE2OV0sXG4gICAgICAgIFsweDFEMTczLCAweDFEMTgyXSwgWzB4MUQxODUsIDB4MUQxOEJdLCBbMHgxRDFBQSwgMHgxRDFBRF0sXG4gICAgICAgIFsweDFEMjQyLCAweDFEMjQ0XSwgWzB4RTAwMDEsIDB4RTAwMDFdLCBbMHhFMDAyMCwgMHhFMDA3Rl0sXG4gICAgICAgIFsweEUwMTAwLCAweEUwMUVGXVxuICAgIF07XG4gICAgZnVuY3Rpb24gYmlzZWFyY2godWNzLCBkYXRhKSB7XG4gICAgICAgIHZhciBtaW4gPSAwO1xuICAgICAgICB2YXIgbWF4ID0gZGF0YS5sZW5ndGggLSAxO1xuICAgICAgICB2YXIgbWlkO1xuICAgICAgICBpZiAodWNzIDwgZGF0YVswXVswXSB8fCB1Y3MgPiBkYXRhW21heF1bMV0pIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB3aGlsZSAobWF4ID49IG1pbikge1xuICAgICAgICAgICAgbWlkID0gKG1pbiArIG1heCkgPj4gMTtcbiAgICAgICAgICAgIGlmICh1Y3MgPiBkYXRhW21pZF1bMV0pIHtcbiAgICAgICAgICAgICAgICBtaW4gPSBtaWQgKyAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodWNzIDwgZGF0YVttaWRdWzBdKSB7XG4gICAgICAgICAgICAgICAgbWF4ID0gbWlkIC0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZnVuY3Rpb24gd2N3aWR0aEhpZ2godWNzKSB7XG4gICAgICAgIGlmIChiaXNlYXJjaCh1Y3MsIENPTUJJTklOR19ISUdIKSkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCh1Y3MgPj0gMHgyMDAwMCAmJiB1Y3MgPD0gMHgyZmZmZCkgfHwgKHVjcyA+PSAweDMwMDAwICYmIHVjcyA8PSAweDNmZmZkKSkge1xuICAgICAgICAgICAgcmV0dXJuIDI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDE7XG4gICAgfVxuICAgIHZhciBjb250cm9sID0gb3B0cy5jb250cm9sIHwgMDtcbiAgICB2YXIgdGFibGUgPSBuZXcgVWludDhBcnJheSg2NTUzNik7XG4gICAgVHlwZWRBcnJheVV0aWxzXzEuZmlsbCh0YWJsZSwgMSk7XG4gICAgdGFibGVbMF0gPSBvcHRzLm51bDtcbiAgICBUeXBlZEFycmF5VXRpbHNfMS5maWxsKHRhYmxlLCBvcHRzLmNvbnRyb2wsIDEsIDMyKTtcbiAgICBUeXBlZEFycmF5VXRpbHNfMS5maWxsKHRhYmxlLCBvcHRzLmNvbnRyb2wsIDB4N2YsIDB4YTApO1xuICAgIFR5cGVkQXJyYXlVdGlsc18xLmZpbGwodGFibGUsIDIsIDB4MTEwMCwgMHgxMTYwKTtcbiAgICB0YWJsZVsweDIzMjldID0gMjtcbiAgICB0YWJsZVsweDIzMmFdID0gMjtcbiAgICBUeXBlZEFycmF5VXRpbHNfMS5maWxsKHRhYmxlLCAyLCAweDJlODAsIDB4YTRkMCk7XG4gICAgdGFibGVbMHgzMDNmXSA9IDE7XG4gICAgVHlwZWRBcnJheVV0aWxzXzEuZmlsbCh0YWJsZSwgMiwgMHhhYzAwLCAweGQ3YTQpO1xuICAgIFR5cGVkQXJyYXlVdGlsc18xLmZpbGwodGFibGUsIDIsIDB4ZjkwMCwgMHhmYjAwKTtcbiAgICBUeXBlZEFycmF5VXRpbHNfMS5maWxsKHRhYmxlLCAyLCAweGZlMTAsIDB4ZmUxYSk7XG4gICAgVHlwZWRBcnJheVV0aWxzXzEuZmlsbCh0YWJsZSwgMiwgMHhmZTMwLCAweGZlNzApO1xuICAgIFR5cGVkQXJyYXlVdGlsc18xLmZpbGwodGFibGUsIDIsIDB4ZmYwMCwgMHhmZjYxKTtcbiAgICBUeXBlZEFycmF5VXRpbHNfMS5maWxsKHRhYmxlLCAyLCAweGZmZTAsIDB4ZmZlNyk7XG4gICAgZm9yICh2YXIgciA9IDA7IHIgPCBDT01CSU5JTkdfQk1QLmxlbmd0aDsgKytyKSB7XG4gICAgICAgIFR5cGVkQXJyYXlVdGlsc18xLmZpbGwodGFibGUsIDAsIENPTUJJTklOR19CTVBbcl1bMF0sIENPTUJJTklOR19CTVBbcl1bMV0gKyAxKTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChudW0pIHtcbiAgICAgICAgaWYgKG51bSA8IDMyKSB7XG4gICAgICAgICAgICByZXR1cm4gY29udHJvbCB8IDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG51bSA8IDEyNykge1xuICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG51bSA8IDY1NTM2KSB7XG4gICAgICAgICAgICByZXR1cm4gdGFibGVbbnVtXTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gd2N3aWR0aEhpZ2gobnVtKTtcbiAgICB9O1xufSkoeyBudWw6IDAsIGNvbnRyb2w6IDAgfSk7XG5mdW5jdGlvbiBnZXRTdHJpbmdDZWxsV2lkdGgocykge1xuICAgIHZhciByZXN1bHQgPSAwO1xuICAgIHZhciBsZW5ndGggPSBzLmxlbmd0aDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgICAgIHZhciBjb2RlID0gcy5jaGFyQ29kZUF0KGkpO1xuICAgICAgICBpZiAoMHhEODAwIDw9IGNvZGUgJiYgY29kZSA8PSAweERCRkYpIHtcbiAgICAgICAgICAgIGlmICgrK2kgPj0gbGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdCArIGV4cG9ydHMud2N3aWR0aChjb2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBzZWNvbmQgPSBzLmNoYXJDb2RlQXQoaSk7XG4gICAgICAgICAgICBpZiAoMHhEQzAwIDw9IHNlY29uZCAmJiBzZWNvbmQgPD0gMHhERkZGKSB7XG4gICAgICAgICAgICAgICAgY29kZSA9IChjb2RlIC0gMHhEODAwKSAqIDB4NDAwICsgc2Vjb25kIC0gMHhEQzAwICsgMHgxMDAwMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdCArPSBleHBvcnRzLndjd2lkdGgoc2Vjb25kKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXN1bHQgKz0gZXhwb3J0cy53Y3dpZHRoKGNvZGUpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xufVxuZXhwb3J0cy5nZXRTdHJpbmdDZWxsV2lkdGggPSBnZXRTdHJpbmdDZWxsV2lkdGg7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1DaGFyV2lkdGguanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5mdW5jdGlvbiBwcmVwYXJlVGV4dEZvclRlcm1pbmFsKHRleHQpIHtcbiAgICByZXR1cm4gdGV4dC5yZXBsYWNlKC9cXHI/XFxuL2csICdcXHInKTtcbn1cbmV4cG9ydHMucHJlcGFyZVRleHRGb3JUZXJtaW5hbCA9IHByZXBhcmVUZXh0Rm9yVGVybWluYWw7XG5mdW5jdGlvbiBicmFja2V0VGV4dEZvclBhc3RlKHRleHQsIGJyYWNrZXRlZFBhc3RlTW9kZSkge1xuICAgIGlmIChicmFja2V0ZWRQYXN0ZU1vZGUpIHtcbiAgICAgICAgcmV0dXJuICdcXHgxYlsyMDB+JyArIHRleHQgKyAnXFx4MWJbMjAxfic7XG4gICAgfVxuICAgIHJldHVybiB0ZXh0O1xufVxuZXhwb3J0cy5icmFja2V0VGV4dEZvclBhc3RlID0gYnJhY2tldFRleHRGb3JQYXN0ZTtcbmZ1bmN0aW9uIGNvcHlIYW5kbGVyKGV2LCB0ZXJtLCBzZWxlY3Rpb25NYW5hZ2VyKSB7XG4gICAgaWYgKHRlcm0uYnJvd3Nlci5pc01TSUUpIHtcbiAgICAgICAgd2luZG93LmNsaXBib2FyZERhdGEuc2V0RGF0YSgnVGV4dCcsIHNlbGVjdGlvbk1hbmFnZXIuc2VsZWN0aW9uVGV4dCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBldi5jbGlwYm9hcmREYXRhLnNldERhdGEoJ3RleHQvcGxhaW4nLCBzZWxlY3Rpb25NYW5hZ2VyLnNlbGVjdGlvblRleHQpO1xuICAgIH1cbiAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xufVxuZXhwb3J0cy5jb3B5SGFuZGxlciA9IGNvcHlIYW5kbGVyO1xuZnVuY3Rpb24gcGFzdGVIYW5kbGVyKGV2LCB0ZXJtKSB7XG4gICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgdmFyIHRleHQ7XG4gICAgdmFyIGRpc3BhdGNoUGFzdGUgPSBmdW5jdGlvbiAodGV4dCkge1xuICAgICAgICB0ZXh0ID0gcHJlcGFyZVRleHRGb3JUZXJtaW5hbCh0ZXh0KTtcbiAgICAgICAgdGV4dCA9IGJyYWNrZXRUZXh0Rm9yUGFzdGUodGV4dCwgdGVybS5icmFja2V0ZWRQYXN0ZU1vZGUpO1xuICAgICAgICB0ZXJtLmhhbmRsZXIodGV4dCk7XG4gICAgICAgIHRlcm0udGV4dGFyZWEudmFsdWUgPSAnJztcbiAgICAgICAgdGVybS5lbWl0KCdwYXN0ZScsIHRleHQpO1xuICAgICAgICB0ZXJtLmNhbmNlbChldik7XG4gICAgfTtcbiAgICBpZiAodGVybS5icm93c2VyLmlzTVNJRSkge1xuICAgICAgICBpZiAod2luZG93LmNsaXBib2FyZERhdGEpIHtcbiAgICAgICAgICAgIHRleHQgPSB3aW5kb3cuY2xpcGJvYXJkRGF0YS5nZXREYXRhKCdUZXh0Jyk7XG4gICAgICAgICAgICBkaXNwYXRjaFBhc3RlKHRleHQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAoZXYuY2xpcGJvYXJkRGF0YSkge1xuICAgICAgICAgICAgdGV4dCA9IGV2LmNsaXBib2FyZERhdGEuZ2V0RGF0YSgndGV4dC9wbGFpbicpO1xuICAgICAgICAgICAgZGlzcGF0Y2hQYXN0ZSh0ZXh0KTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMucGFzdGVIYW5kbGVyID0gcGFzdGVIYW5kbGVyO1xuZnVuY3Rpb24gbW92ZVRleHRBcmVhVW5kZXJNb3VzZUN1cnNvcihldiwgdGVybSkge1xuICAgIHZhciBwb3MgPSB0ZXJtLnNjcmVlbkVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgdmFyIGxlZnQgPSBldi5jbGllbnRYIC0gcG9zLmxlZnQgLSAxMDtcbiAgICB2YXIgdG9wID0gZXYuY2xpZW50WSAtIHBvcy50b3AgLSAxMDtcbiAgICB0ZXJtLnRleHRhcmVhLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcbiAgICB0ZXJtLnRleHRhcmVhLnN0eWxlLndpZHRoID0gJzIwcHgnO1xuICAgIHRlcm0udGV4dGFyZWEuc3R5bGUuaGVpZ2h0ID0gJzIwcHgnO1xuICAgIHRlcm0udGV4dGFyZWEuc3R5bGUubGVmdCA9IGxlZnQgKyBcInB4XCI7XG4gICAgdGVybS50ZXh0YXJlYS5zdHlsZS50b3AgPSB0b3AgKyBcInB4XCI7XG4gICAgdGVybS50ZXh0YXJlYS5zdHlsZS56SW5kZXggPSAnMTAwMCc7XG4gICAgdGVybS50ZXh0YXJlYS5mb2N1cygpO1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICB0ZXJtLnRleHRhcmVhLnN0eWxlLnBvc2l0aW9uID0gbnVsbDtcbiAgICAgICAgdGVybS50ZXh0YXJlYS5zdHlsZS53aWR0aCA9IG51bGw7XG4gICAgICAgIHRlcm0udGV4dGFyZWEuc3R5bGUuaGVpZ2h0ID0gbnVsbDtcbiAgICAgICAgdGVybS50ZXh0YXJlYS5zdHlsZS5sZWZ0ID0gbnVsbDtcbiAgICAgICAgdGVybS50ZXh0YXJlYS5zdHlsZS50b3AgPSBudWxsO1xuICAgICAgICB0ZXJtLnRleHRhcmVhLnN0eWxlLnpJbmRleCA9IG51bGw7XG4gICAgfSwgMjAwKTtcbn1cbmV4cG9ydHMubW92ZVRleHRBcmVhVW5kZXJNb3VzZUN1cnNvciA9IG1vdmVUZXh0QXJlYVVuZGVyTW91c2VDdXJzb3I7XG5mdW5jdGlvbiByaWdodENsaWNrSGFuZGxlcihldiwgdGVybSwgc2VsZWN0aW9uTWFuYWdlciwgc2hvdWxkU2VsZWN0V29yZCkge1xuICAgIG1vdmVUZXh0QXJlYVVuZGVyTW91c2VDdXJzb3IoZXYsIHRlcm0pO1xuICAgIGlmIChzaG91bGRTZWxlY3RXb3JkICYmICFzZWxlY3Rpb25NYW5hZ2VyLmlzQ2xpY2tJblNlbGVjdGlvbihldikpIHtcbiAgICAgICAgc2VsZWN0aW9uTWFuYWdlci5zZWxlY3RXb3JkQXRDdXJzb3IoZXYpO1xuICAgIH1cbiAgICB0ZXJtLnRleHRhcmVhLnZhbHVlID0gc2VsZWN0aW9uTWFuYWdlci5zZWxlY3Rpb25UZXh0O1xuICAgIHRlcm0udGV4dGFyZWEuc2VsZWN0KCk7XG59XG5leHBvcnRzLnJpZ2h0Q2xpY2tIYW5kbGVyID0gcmlnaHRDbGlja0hhbmRsZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1DbGlwYm9hcmQuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgQ29tcG9zaXRpb25IZWxwZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIENvbXBvc2l0aW9uSGVscGVyKF90ZXh0YXJlYSwgX2NvbXBvc2l0aW9uVmlldywgX3Rlcm1pbmFsKSB7XG4gICAgICAgIHRoaXMuX3RleHRhcmVhID0gX3RleHRhcmVhO1xuICAgICAgICB0aGlzLl9jb21wb3NpdGlvblZpZXcgPSBfY29tcG9zaXRpb25WaWV3O1xuICAgICAgICB0aGlzLl90ZXJtaW5hbCA9IF90ZXJtaW5hbDtcbiAgICAgICAgdGhpcy5faXNDb21wb3NpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5faXNTZW5kaW5nQ29tcG9zaXRpb24gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fY29tcG9zaXRpb25Qb3NpdGlvbiA9IHsgc3RhcnQ6IG51bGwsIGVuZDogbnVsbCB9O1xuICAgIH1cbiAgICBDb21wb3NpdGlvbkhlbHBlci5wcm90b3R5cGUuY29tcG9zaXRpb25zdGFydCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5faXNDb21wb3NpbmcgPSB0cnVlO1xuICAgICAgICB0aGlzLl9jb21wb3NpdGlvblBvc2l0aW9uLnN0YXJ0ID0gdGhpcy5fdGV4dGFyZWEudmFsdWUubGVuZ3RoO1xuICAgICAgICB0aGlzLl9jb21wb3NpdGlvblZpZXcudGV4dENvbnRlbnQgPSAnJztcbiAgICAgICAgdGhpcy5fY29tcG9zaXRpb25WaWV3LmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgIH07XG4gICAgQ29tcG9zaXRpb25IZWxwZXIucHJvdG90eXBlLmNvbXBvc2l0aW9udXBkYXRlID0gZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuX2NvbXBvc2l0aW9uVmlldy50ZXh0Q29udGVudCA9IGV2LmRhdGE7XG4gICAgICAgIHRoaXMudXBkYXRlQ29tcG9zaXRpb25FbGVtZW50cygpO1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF90aGlzLl9jb21wb3NpdGlvblBvc2l0aW9uLmVuZCA9IF90aGlzLl90ZXh0YXJlYS52YWx1ZS5sZW5ndGg7XG4gICAgICAgIH0sIDApO1xuICAgIH07XG4gICAgQ29tcG9zaXRpb25IZWxwZXIucHJvdG90eXBlLmNvbXBvc2l0aW9uZW5kID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9maW5hbGl6ZUNvbXBvc2l0aW9uKHRydWUpO1xuICAgIH07XG4gICAgQ29tcG9zaXRpb25IZWxwZXIucHJvdG90eXBlLmtleWRvd24gPSBmdW5jdGlvbiAoZXYpIHtcbiAgICAgICAgaWYgKHRoaXMuX2lzQ29tcG9zaW5nIHx8IHRoaXMuX2lzU2VuZGluZ0NvbXBvc2l0aW9uKSB7XG4gICAgICAgICAgICBpZiAoZXYua2V5Q29kZSA9PT0gMjI5KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZXYua2V5Q29kZSA9PT0gMTYgfHwgZXYua2V5Q29kZSA9PT0gMTcgfHwgZXYua2V5Q29kZSA9PT0gMTgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9maW5hbGl6ZUNvbXBvc2l0aW9uKGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZXYua2V5Q29kZSA9PT0gMjI5KSB7XG4gICAgICAgICAgICB0aGlzLl9oYW5kbGVBbnlUZXh0YXJlYUNoYW5nZXMoKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuICAgIENvbXBvc2l0aW9uSGVscGVyLnByb3RvdHlwZS5fZmluYWxpemVDb21wb3NpdGlvbiA9IGZ1bmN0aW9uICh3YWl0Rm9yUHJvcGFnYXRpb24pIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5fY29tcG9zaXRpb25WaWV3LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICAgICAgICB0aGlzLl9pc0NvbXBvc2luZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9jbGVhclRleHRhcmVhUG9zaXRpb24oKTtcbiAgICAgICAgaWYgKCF3YWl0Rm9yUHJvcGFnYXRpb24pIHtcbiAgICAgICAgICAgIHRoaXMuX2lzU2VuZGluZ0NvbXBvc2l0aW9uID0gZmFsc2U7XG4gICAgICAgICAgICB2YXIgaW5wdXQgPSB0aGlzLl90ZXh0YXJlYS52YWx1ZS5zdWJzdHJpbmcodGhpcy5fY29tcG9zaXRpb25Qb3NpdGlvbi5zdGFydCwgdGhpcy5fY29tcG9zaXRpb25Qb3NpdGlvbi5lbmQpO1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuaGFuZGxlcihpbnB1dCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgY3VycmVudENvbXBvc2l0aW9uUG9zaXRpb25fMSA9IHtcbiAgICAgICAgICAgICAgICBzdGFydDogdGhpcy5fY29tcG9zaXRpb25Qb3NpdGlvbi5zdGFydCxcbiAgICAgICAgICAgICAgICBlbmQ6IHRoaXMuX2NvbXBvc2l0aW9uUG9zaXRpb24uZW5kXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5faXNTZW5kaW5nQ29tcG9zaXRpb24gPSB0cnVlO1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLl9pc1NlbmRpbmdDb21wb3NpdGlvbikge1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5faXNTZW5kaW5nQ29tcG9zaXRpb24gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlucHV0ID0gdm9pZCAwO1xuICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuX2lzQ29tcG9zaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dCA9IF90aGlzLl90ZXh0YXJlYS52YWx1ZS5zdWJzdHJpbmcoY3VycmVudENvbXBvc2l0aW9uUG9zaXRpb25fMS5zdGFydCwgY3VycmVudENvbXBvc2l0aW9uUG9zaXRpb25fMS5lbmQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQgPSBfdGhpcy5fdGV4dGFyZWEudmFsdWUuc3Vic3RyaW5nKGN1cnJlbnRDb21wb3NpdGlvblBvc2l0aW9uXzEuc3RhcnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLl90ZXJtaW5hbC5oYW5kbGVyKGlucHV0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQ29tcG9zaXRpb25IZWxwZXIucHJvdG90eXBlLl9oYW5kbGVBbnlUZXh0YXJlYUNoYW5nZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMuX3RleHRhcmVhLnZhbHVlO1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghX3RoaXMuX2lzQ29tcG9zaW5nKSB7XG4gICAgICAgICAgICAgICAgdmFyIG5ld1ZhbHVlID0gX3RoaXMuX3RleHRhcmVhLnZhbHVlO1xuICAgICAgICAgICAgICAgIHZhciBkaWZmID0gbmV3VmFsdWUucmVwbGFjZShvbGRWYWx1ZSwgJycpO1xuICAgICAgICAgICAgICAgIGlmIChkaWZmLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX3Rlcm1pbmFsLmhhbmRsZXIoZGlmZik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LCAwKTtcbiAgICB9O1xuICAgIENvbXBvc2l0aW9uSGVscGVyLnByb3RvdHlwZS51cGRhdGVDb21wb3NpdGlvbkVsZW1lbnRzID0gZnVuY3Rpb24gKGRvbnRSZWN1cnNlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICghdGhpcy5faXNDb21wb3NpbmcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuYnVmZmVyLmlzQ3Vyc29ySW5WaWV3cG9ydCkge1xuICAgICAgICAgICAgdmFyIGNlbGxIZWlnaHQgPSBNYXRoLmNlaWwodGhpcy5fdGVybWluYWwuY2hhck1lYXN1cmUuaGVpZ2h0ICogdGhpcy5fdGVybWluYWwub3B0aW9ucy5saW5lSGVpZ2h0KTtcbiAgICAgICAgICAgIHZhciBjdXJzb3JUb3AgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXIueSAqIGNlbGxIZWlnaHQ7XG4gICAgICAgICAgICB2YXIgY3Vyc29yTGVmdCA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ICogdGhpcy5fdGVybWluYWwuY2hhck1lYXN1cmUud2lkdGg7XG4gICAgICAgICAgICB0aGlzLl9jb21wb3NpdGlvblZpZXcuc3R5bGUubGVmdCA9IGN1cnNvckxlZnQgKyAncHgnO1xuICAgICAgICAgICAgdGhpcy5fY29tcG9zaXRpb25WaWV3LnN0eWxlLnRvcCA9IGN1cnNvclRvcCArICdweCc7XG4gICAgICAgICAgICB0aGlzLl9jb21wb3NpdGlvblZpZXcuc3R5bGUuaGVpZ2h0ID0gY2VsbEhlaWdodCArICdweCc7XG4gICAgICAgICAgICB0aGlzLl9jb21wb3NpdGlvblZpZXcuc3R5bGUubGluZUhlaWdodCA9IGNlbGxIZWlnaHQgKyAncHgnO1xuICAgICAgICAgICAgdGhpcy5fY29tcG9zaXRpb25WaWV3LnN0eWxlLmZvbnRGYW1pbHkgPSB0aGlzLl90ZXJtaW5hbC5vcHRpb25zLmZvbnRGYW1pbHk7XG4gICAgICAgICAgICB0aGlzLl9jb21wb3NpdGlvblZpZXcuc3R5bGUuZm9udFNpemUgPSB0aGlzLl90ZXJtaW5hbC5vcHRpb25zLmZvbnRTaXplICsgJ3B4JztcbiAgICAgICAgICAgIHZhciBjb21wb3NpdGlvblZpZXdCb3VuZHMgPSB0aGlzLl9jb21wb3NpdGlvblZpZXcuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICAgICAgICB0aGlzLl90ZXh0YXJlYS5zdHlsZS5sZWZ0ID0gY3Vyc29yTGVmdCArICdweCc7XG4gICAgICAgICAgICB0aGlzLl90ZXh0YXJlYS5zdHlsZS50b3AgPSBjdXJzb3JUb3AgKyAncHgnO1xuICAgICAgICAgICAgdGhpcy5fdGV4dGFyZWEuc3R5bGUud2lkdGggPSBjb21wb3NpdGlvblZpZXdCb3VuZHMud2lkdGggKyAncHgnO1xuICAgICAgICAgICAgdGhpcy5fdGV4dGFyZWEuc3R5bGUuaGVpZ2h0ID0gY29tcG9zaXRpb25WaWV3Qm91bmRzLmhlaWdodCArICdweCc7XG4gICAgICAgICAgICB0aGlzLl90ZXh0YXJlYS5zdHlsZS5saW5lSGVpZ2h0ID0gY29tcG9zaXRpb25WaWV3Qm91bmRzLmhlaWdodCArICdweCc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFkb250UmVjdXJzZSkge1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy51cGRhdGVDb21wb3NpdGlvbkVsZW1lbnRzKHRydWUpOyB9LCAwKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQ29tcG9zaXRpb25IZWxwZXIucHJvdG90eXBlLl9jbGVhclRleHRhcmVhUG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3RleHRhcmVhLnN0eWxlLmxlZnQgPSAnJztcbiAgICAgICAgdGhpcy5fdGV4dGFyZWEuc3R5bGUudG9wID0gJyc7XG4gICAgfTtcbiAgICByZXR1cm4gQ29tcG9zaXRpb25IZWxwZXI7XG59KCkpO1xuZXhwb3J0cy5Db21wb3NpdGlvbkhlbHBlciA9IENvbXBvc2l0aW9uSGVscGVyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Q29tcG9zaXRpb25IZWxwZXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBMaWZlY3ljbGVfMSA9IHJlcXVpcmUoXCIuL2NvbW1vbi9MaWZlY3ljbGVcIik7XG52YXIgVGV4dERlY29kZXJfMSA9IHJlcXVpcmUoXCIuL2NvcmUvaW5wdXQvVGV4dERlY29kZXJcIik7XG5mdW5jdGlvbiByKGxvdywgaGlnaCkge1xuICAgIHZhciBjID0gaGlnaCAtIGxvdztcbiAgICB2YXIgYXJyID0gbmV3IEFycmF5KGMpO1xuICAgIHdoaWxlIChjLS0pIHtcbiAgICAgICAgYXJyW2NdID0gLS1oaWdoO1xuICAgIH1cbiAgICByZXR1cm4gYXJyO1xufVxudmFyIFRyYW5zaXRpb25UYWJsZSA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gVHJhbnNpdGlvblRhYmxlKGxlbmd0aCkge1xuICAgICAgICB0aGlzLnRhYmxlID0gKHR5cGVvZiBVaW50OEFycmF5ID09PSAndW5kZWZpbmVkJylcbiAgICAgICAgICAgID8gbmV3IEFycmF5KGxlbmd0aClcbiAgICAgICAgICAgIDogbmV3IFVpbnQ4QXJyYXkobGVuZ3RoKTtcbiAgICB9XG4gICAgVHJhbnNpdGlvblRhYmxlLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiAoY29kZSwgc3RhdGUsIGFjdGlvbiwgbmV4dCkge1xuICAgICAgICB0aGlzLnRhYmxlW3N0YXRlIDw8IDggfCBjb2RlXSA9ICgoYWN0aW9uIHwgMCkgPDwgNCkgfCAoKG5leHQgPT09IHVuZGVmaW5lZCkgPyBzdGF0ZSA6IG5leHQpO1xuICAgIH07XG4gICAgVHJhbnNpdGlvblRhYmxlLnByb3RvdHlwZS5hZGRNYW55ID0gZnVuY3Rpb24gKGNvZGVzLCBzdGF0ZSwgYWN0aW9uLCBuZXh0KSB7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY29kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMuYWRkKGNvZGVzW2ldLCBzdGF0ZSwgYWN0aW9uLCBuZXh0KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIFRyYW5zaXRpb25UYWJsZTtcbn0oKSk7XG5leHBvcnRzLlRyYW5zaXRpb25UYWJsZSA9IFRyYW5zaXRpb25UYWJsZTtcbnZhciBQUklOVEFCTEVTID0gcigweDIwLCAweDdmKTtcbnZhciBFWEVDVVRBQkxFUyA9IHIoMHgwMCwgMHgxOCk7XG5FWEVDVVRBQkxFUy5wdXNoKDB4MTkpO1xuRVhFQ1VUQUJMRVMucHVzaC5hcHBseShFWEVDVVRBQkxFUywgcigweDFjLCAweDIwKSk7XG52YXIgTk9OX0FTQ0lJX1BSSU5UQUJMRSA9IDB4QTA7XG5leHBvcnRzLlZUNTAwX1RSQU5TSVRJT05fVEFCTEUgPSAoZnVuY3Rpb24gKCkge1xuICAgIHZhciB0YWJsZSA9IG5ldyBUcmFuc2l0aW9uVGFibGUoNDA5NSk7XG4gICAgdmFyIHN0YXRlcyA9IHIoMCwgMTMgKyAxKTtcbiAgICB2YXIgc3RhdGU7XG4gICAgZm9yIChzdGF0ZSBpbiBzdGF0ZXMpIHtcbiAgICAgICAgZm9yICh2YXIgY29kZSA9IDA7IGNvZGUgPD0gTk9OX0FTQ0lJX1BSSU5UQUJMRTsgKytjb2RlKSB7XG4gICAgICAgICAgICB0YWJsZS5hZGQoY29kZSwgc3RhdGUsIDEsIDApO1xuICAgICAgICB9XG4gICAgfVxuICAgIHRhYmxlLmFkZE1hbnkoUFJJTlRBQkxFUywgMCwgMiwgMCk7XG4gICAgZm9yIChzdGF0ZSBpbiBzdGF0ZXMpIHtcbiAgICAgICAgdGFibGUuYWRkTWFueShbMHgxOCwgMHgxYSwgMHg5OSwgMHg5YV0sIHN0YXRlLCAzLCAwKTtcbiAgICAgICAgdGFibGUuYWRkTWFueShyKDB4ODAsIDB4OTApLCBzdGF0ZSwgMywgMCk7XG4gICAgICAgIHRhYmxlLmFkZE1hbnkocigweDkwLCAweDk4KSwgc3RhdGUsIDMsIDApO1xuICAgICAgICB0YWJsZS5hZGQoMHg5Yywgc3RhdGUsIDAsIDApO1xuICAgICAgICB0YWJsZS5hZGQoMHgxYiwgc3RhdGUsIDExLCAxKTtcbiAgICAgICAgdGFibGUuYWRkKDB4OWQsIHN0YXRlLCA0LCA4KTtcbiAgICAgICAgdGFibGUuYWRkTWFueShbMHg5OCwgMHg5ZSwgMHg5Zl0sIHN0YXRlLCAwLCA3KTtcbiAgICAgICAgdGFibGUuYWRkKDB4OWIsIHN0YXRlLCAxMSwgMyk7XG4gICAgICAgIHRhYmxlLmFkZCgweDkwLCBzdGF0ZSwgMTEsIDkpO1xuICAgIH1cbiAgICB0YWJsZS5hZGRNYW55KEVYRUNVVEFCTEVTLCAwLCAzLCAwKTtcbiAgICB0YWJsZS5hZGRNYW55KEVYRUNVVEFCTEVTLCAxLCAzLCAxKTtcbiAgICB0YWJsZS5hZGQoMHg3ZiwgMSwgMCwgMSk7XG4gICAgdGFibGUuYWRkTWFueShFWEVDVVRBQkxFUywgOCwgMCwgOCk7XG4gICAgdGFibGUuYWRkTWFueShFWEVDVVRBQkxFUywgMywgMywgMyk7XG4gICAgdGFibGUuYWRkKDB4N2YsIDMsIDAsIDMpO1xuICAgIHRhYmxlLmFkZE1hbnkoRVhFQ1VUQUJMRVMsIDQsIDMsIDQpO1xuICAgIHRhYmxlLmFkZCgweDdmLCA0LCAwLCA0KTtcbiAgICB0YWJsZS5hZGRNYW55KEVYRUNVVEFCTEVTLCA2LCAzLCA2KTtcbiAgICB0YWJsZS5hZGRNYW55KEVYRUNVVEFCTEVTLCA1LCAzLCA1KTtcbiAgICB0YWJsZS5hZGQoMHg3ZiwgNSwgMCwgNSk7XG4gICAgdGFibGUuYWRkTWFueShFWEVDVVRBQkxFUywgMiwgMywgMik7XG4gICAgdGFibGUuYWRkKDB4N2YsIDIsIDAsIDIpO1xuICAgIHRhYmxlLmFkZCgweDVkLCAxLCA0LCA4KTtcbiAgICB0YWJsZS5hZGRNYW55KFBSSU5UQUJMRVMsIDgsIDUsIDgpO1xuICAgIHRhYmxlLmFkZCgweDdmLCA4LCA1LCA4KTtcbiAgICB0YWJsZS5hZGRNYW55KFsweDljLCAweDFiLCAweDE4LCAweDFhLCAweDA3XSwgOCwgNiwgMCk7XG4gICAgdGFibGUuYWRkTWFueShyKDB4MWMsIDB4MjApLCA4LCAwLCA4KTtcbiAgICB0YWJsZS5hZGRNYW55KFsweDU4LCAweDVlLCAweDVmXSwgMSwgMCwgNyk7XG4gICAgdGFibGUuYWRkTWFueShQUklOVEFCTEVTLCA3LCAwLCA3KTtcbiAgICB0YWJsZS5hZGRNYW55KEVYRUNVVEFCTEVTLCA3LCAwLCA3KTtcbiAgICB0YWJsZS5hZGQoMHg5YywgNywgMCwgMCk7XG4gICAgdGFibGUuYWRkKDB4N2YsIDcsIDAsIDcpO1xuICAgIHRhYmxlLmFkZCgweDViLCAxLCAxMSwgMyk7XG4gICAgdGFibGUuYWRkTWFueShyKDB4NDAsIDB4N2YpLCAzLCA3LCAwKTtcbiAgICB0YWJsZS5hZGRNYW55KHIoMHgzMCwgMHgzYSksIDMsIDgsIDQpO1xuICAgIHRhYmxlLmFkZCgweDNiLCAzLCA4LCA0KTtcbiAgICB0YWJsZS5hZGRNYW55KFsweDNjLCAweDNkLCAweDNlLCAweDNmXSwgMywgOSwgNCk7XG4gICAgdGFibGUuYWRkTWFueShyKDB4MzAsIDB4M2EpLCA0LCA4LCA0KTtcbiAgICB0YWJsZS5hZGQoMHgzYiwgNCwgOCwgNCk7XG4gICAgdGFibGUuYWRkTWFueShyKDB4NDAsIDB4N2YpLCA0LCA3LCAwKTtcbiAgICB0YWJsZS5hZGRNYW55KFsweDNhLCAweDNjLCAweDNkLCAweDNlLCAweDNmXSwgNCwgMCwgNik7XG4gICAgdGFibGUuYWRkTWFueShyKDB4MjAsIDB4NDApLCA2LCAwLCA2KTtcbiAgICB0YWJsZS5hZGQoMHg3ZiwgNiwgMCwgNik7XG4gICAgdGFibGUuYWRkTWFueShyKDB4NDAsIDB4N2YpLCA2LCAwLCAwKTtcbiAgICB0YWJsZS5hZGQoMHgzYSwgMywgMCwgNik7XG4gICAgdGFibGUuYWRkTWFueShyKDB4MjAsIDB4MzApLCAzLCA5LCA1KTtcbiAgICB0YWJsZS5hZGRNYW55KHIoMHgyMCwgMHgzMCksIDUsIDksIDUpO1xuICAgIHRhYmxlLmFkZE1hbnkocigweDMwLCAweDQwKSwgNSwgMCwgNik7XG4gICAgdGFibGUuYWRkTWFueShyKDB4NDAsIDB4N2YpLCA1LCA3LCAwKTtcbiAgICB0YWJsZS5hZGRNYW55KHIoMHgyMCwgMHgzMCksIDQsIDksIDUpO1xuICAgIHRhYmxlLmFkZE1hbnkocigweDIwLCAweDMwKSwgMSwgOSwgMik7XG4gICAgdGFibGUuYWRkTWFueShyKDB4MjAsIDB4MzApLCAyLCA5LCAyKTtcbiAgICB0YWJsZS5hZGRNYW55KHIoMHgzMCwgMHg3ZiksIDIsIDEwLCAwKTtcbiAgICB0YWJsZS5hZGRNYW55KHIoMHgzMCwgMHg1MCksIDEsIDEwLCAwKTtcbiAgICB0YWJsZS5hZGRNYW55KHIoMHg1MSwgMHg1OCksIDEsIDEwLCAwKTtcbiAgICB0YWJsZS5hZGRNYW55KFsweDU5LCAweDVhLCAweDVjXSwgMSwgMTAsIDApO1xuICAgIHRhYmxlLmFkZE1hbnkocigweDYwLCAweDdmKSwgMSwgMTAsIDApO1xuICAgIHRhYmxlLmFkZCgweDUwLCAxLCAxMSwgOSk7XG4gICAgdGFibGUuYWRkTWFueShFWEVDVVRBQkxFUywgOSwgMCwgOSk7XG4gICAgdGFibGUuYWRkKDB4N2YsIDksIDAsIDkpO1xuICAgIHRhYmxlLmFkZE1hbnkocigweDFjLCAweDIwKSwgOSwgMCwgOSk7XG4gICAgdGFibGUuYWRkTWFueShyKDB4MjAsIDB4MzApLCA5LCA5LCAxMik7XG4gICAgdGFibGUuYWRkKDB4M2EsIDksIDAsIDExKTtcbiAgICB0YWJsZS5hZGRNYW55KHIoMHgzMCwgMHgzYSksIDksIDgsIDEwKTtcbiAgICB0YWJsZS5hZGQoMHgzYiwgOSwgOCwgMTApO1xuICAgIHRhYmxlLmFkZE1hbnkoWzB4M2MsIDB4M2QsIDB4M2UsIDB4M2ZdLCA5LCA5LCAxMCk7XG4gICAgdGFibGUuYWRkTWFueShFWEVDVVRBQkxFUywgMTEsIDAsIDExKTtcbiAgICB0YWJsZS5hZGRNYW55KHIoMHgyMCwgMHg4MCksIDExLCAwLCAxMSk7XG4gICAgdGFibGUuYWRkTWFueShyKDB4MWMsIDB4MjApLCAxMSwgMCwgMTEpO1xuICAgIHRhYmxlLmFkZE1hbnkoRVhFQ1VUQUJMRVMsIDEwLCAwLCAxMCk7XG4gICAgdGFibGUuYWRkKDB4N2YsIDEwLCAwLCAxMCk7XG4gICAgdGFibGUuYWRkTWFueShyKDB4MWMsIDB4MjApLCAxMCwgMCwgMTApO1xuICAgIHRhYmxlLmFkZE1hbnkocigweDMwLCAweDNhKSwgMTAsIDgsIDEwKTtcbiAgICB0YWJsZS5hZGQoMHgzYiwgMTAsIDgsIDEwKTtcbiAgICB0YWJsZS5hZGRNYW55KFsweDNhLCAweDNjLCAweDNkLCAweDNlLCAweDNmXSwgMTAsIDAsIDExKTtcbiAgICB0YWJsZS5hZGRNYW55KHIoMHgyMCwgMHgzMCksIDEwLCA5LCAxMik7XG4gICAgdGFibGUuYWRkTWFueShFWEVDVVRBQkxFUywgMTIsIDAsIDEyKTtcbiAgICB0YWJsZS5hZGQoMHg3ZiwgMTIsIDAsIDEyKTtcbiAgICB0YWJsZS5hZGRNYW55KHIoMHgxYywgMHgyMCksIDEyLCAwLCAxMik7XG4gICAgdGFibGUuYWRkTWFueShyKDB4MjAsIDB4MzApLCAxMiwgOSwgMTIpO1xuICAgIHRhYmxlLmFkZE1hbnkocigweDMwLCAweDQwKSwgMTIsIDAsIDExKTtcbiAgICB0YWJsZS5hZGRNYW55KHIoMHg0MCwgMHg3ZiksIDEyLCAxMiwgMTMpO1xuICAgIHRhYmxlLmFkZE1hbnkocigweDQwLCAweDdmKSwgMTAsIDEyLCAxMyk7XG4gICAgdGFibGUuYWRkTWFueShyKDB4NDAsIDB4N2YpLCA5LCAxMiwgMTMpO1xuICAgIHRhYmxlLmFkZE1hbnkoRVhFQ1VUQUJMRVMsIDEzLCAxMywgMTMpO1xuICAgIHRhYmxlLmFkZE1hbnkoUFJJTlRBQkxFUywgMTMsIDEzLCAxMyk7XG4gICAgdGFibGUuYWRkKDB4N2YsIDEzLCAwLCAxMyk7XG4gICAgdGFibGUuYWRkTWFueShbMHgxYiwgMHg5Y10sIDEzLCAxNCwgMCk7XG4gICAgdGFibGUuYWRkKE5PTl9BU0NJSV9QUklOVEFCTEUsIDgsIDUsIDgpO1xuICAgIHJldHVybiB0YWJsZTtcbn0pKCk7XG52YXIgRGNzRHVtbXkgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIERjc0R1bW15KCkge1xuICAgIH1cbiAgICBEY3NEdW1teS5wcm90b3R5cGUuaG9vayA9IGZ1bmN0aW9uIChjb2xsZWN0LCBwYXJhbXMsIGZsYWcpIHsgfTtcbiAgICBEY3NEdW1teS5wcm90b3R5cGUucHV0ID0gZnVuY3Rpb24gKGRhdGEsIHN0YXJ0LCBlbmQpIHsgfTtcbiAgICBEY3NEdW1teS5wcm90b3R5cGUudW5ob29rID0gZnVuY3Rpb24gKCkgeyB9O1xuICAgIHJldHVybiBEY3NEdW1teTtcbn0oKSk7XG52YXIgRXNjYXBlU2VxdWVuY2VQYXJzZXIgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhFc2NhcGVTZXF1ZW5jZVBhcnNlciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBFc2NhcGVTZXF1ZW5jZVBhcnNlcihUUkFOU0lUSU9OUykge1xuICAgICAgICBpZiAoVFJBTlNJVElPTlMgPT09IHZvaWQgMCkgeyBUUkFOU0lUSU9OUyA9IGV4cG9ydHMuVlQ1MDBfVFJBTlNJVElPTl9UQUJMRTsgfVxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5UUkFOU0lUSU9OUyA9IFRSQU5TSVRJT05TO1xuICAgICAgICBfdGhpcy5pbml0aWFsU3RhdGUgPSAwO1xuICAgICAgICBfdGhpcy5jdXJyZW50U3RhdGUgPSBfdGhpcy5pbml0aWFsU3RhdGU7XG4gICAgICAgIF90aGlzLl9vc2MgPSAnJztcbiAgICAgICAgX3RoaXMuX3BhcmFtcyA9IFswXTtcbiAgICAgICAgX3RoaXMuX2NvbGxlY3QgPSAnJztcbiAgICAgICAgX3RoaXMuX3ByaW50SGFuZGxlckZiID0gZnVuY3Rpb24gKGRhdGEsIHN0YXJ0LCBlbmQpIHsgfTtcbiAgICAgICAgX3RoaXMuX2V4ZWN1dGVIYW5kbGVyRmIgPSBmdW5jdGlvbiAoY29kZSkgeyB9O1xuICAgICAgICBfdGhpcy5fY3NpSGFuZGxlckZiID0gZnVuY3Rpb24gKGNvbGxlY3QsIHBhcmFtcywgZmxhZykgeyB9O1xuICAgICAgICBfdGhpcy5fZXNjSGFuZGxlckZiID0gZnVuY3Rpb24gKGNvbGxlY3QsIGZsYWcpIHsgfTtcbiAgICAgICAgX3RoaXMuX29zY0hhbmRsZXJGYiA9IGZ1bmN0aW9uIChpZGVudGlmaWVyLCBkYXRhKSB7IH07XG4gICAgICAgIF90aGlzLl9kY3NIYW5kbGVyRmIgPSBuZXcgRGNzRHVtbXkoKTtcbiAgICAgICAgX3RoaXMuX2Vycm9ySGFuZGxlckZiID0gZnVuY3Rpb24gKHN0YXRlKSB7IHJldHVybiBzdGF0ZTsgfTtcbiAgICAgICAgX3RoaXMuX3ByaW50SGFuZGxlciA9IF90aGlzLl9wcmludEhhbmRsZXJGYjtcbiAgICAgICAgX3RoaXMuX2V4ZWN1dGVIYW5kbGVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICAgIF90aGlzLl9jc2lIYW5kbGVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICAgIF90aGlzLl9lc2NIYW5kbGVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICAgIF90aGlzLl9vc2NIYW5kbGVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICAgIF90aGlzLl9kY3NIYW5kbGVycyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gICAgICAgIF90aGlzLl9hY3RpdmVEY3NIYW5kbGVyID0gbnVsbDtcbiAgICAgICAgX3RoaXMuX2Vycm9ySGFuZGxlciA9IF90aGlzLl9lcnJvckhhbmRsZXJGYjtcbiAgICAgICAgX3RoaXMuc2V0RXNjSGFuZGxlcignXFxcXCcsIGZ1bmN0aW9uICgpIHsgfSk7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgRXNjYXBlU2VxdWVuY2VQYXJzZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3ByaW50SGFuZGxlckZiID0gbnVsbDtcbiAgICAgICAgdGhpcy5fZXhlY3V0ZUhhbmRsZXJGYiA9IG51bGw7XG4gICAgICAgIHRoaXMuX2NzaUhhbmRsZXJGYiA9IG51bGw7XG4gICAgICAgIHRoaXMuX2VzY0hhbmRsZXJGYiA9IG51bGw7XG4gICAgICAgIHRoaXMuX29zY0hhbmRsZXJGYiA9IG51bGw7XG4gICAgICAgIHRoaXMuX2Rjc0hhbmRsZXJGYiA9IG51bGw7XG4gICAgICAgIHRoaXMuX2Vycm9ySGFuZGxlckZiID0gbnVsbDtcbiAgICAgICAgdGhpcy5fcHJpbnRIYW5kbGVyID0gbnVsbDtcbiAgICAgICAgdGhpcy5fZXhlY3V0ZUhhbmRsZXJzID0gbnVsbDtcbiAgICAgICAgdGhpcy5fZXNjSGFuZGxlcnMgPSBudWxsO1xuICAgICAgICB0aGlzLl9jc2lIYW5kbGVycyA9IG51bGw7XG4gICAgICAgIHRoaXMuX29zY0hhbmRsZXJzID0gbnVsbDtcbiAgICAgICAgdGhpcy5fZGNzSGFuZGxlcnMgPSBudWxsO1xuICAgICAgICB0aGlzLl9hY3RpdmVEY3NIYW5kbGVyID0gbnVsbDtcbiAgICAgICAgdGhpcy5fZXJyb3JIYW5kbGVyID0gbnVsbDtcbiAgICB9O1xuICAgIEVzY2FwZVNlcXVlbmNlUGFyc2VyLnByb3RvdHlwZS5zZXRQcmludEhhbmRsZXIgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5fcHJpbnRIYW5kbGVyID0gY2FsbGJhY2s7XG4gICAgfTtcbiAgICBFc2NhcGVTZXF1ZW5jZVBhcnNlci5wcm90b3R5cGUuY2xlYXJQcmludEhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3ByaW50SGFuZGxlciA9IHRoaXMuX3ByaW50SGFuZGxlckZiO1xuICAgIH07XG4gICAgRXNjYXBlU2VxdWVuY2VQYXJzZXIucHJvdG90eXBlLnNldEV4ZWN1dGVIYW5kbGVyID0gZnVuY3Rpb24gKGZsYWcsIGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX2V4ZWN1dGVIYW5kbGVyc1tmbGFnLmNoYXJDb2RlQXQoMCldID0gY2FsbGJhY2s7XG4gICAgfTtcbiAgICBFc2NhcGVTZXF1ZW5jZVBhcnNlci5wcm90b3R5cGUuY2xlYXJFeGVjdXRlSGFuZGxlciA9IGZ1bmN0aW9uIChmbGFnKSB7XG4gICAgICAgIGlmICh0aGlzLl9leGVjdXRlSGFuZGxlcnNbZmxhZy5jaGFyQ29kZUF0KDApXSlcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9leGVjdXRlSGFuZGxlcnNbZmxhZy5jaGFyQ29kZUF0KDApXTtcbiAgICB9O1xuICAgIEVzY2FwZVNlcXVlbmNlUGFyc2VyLnByb3RvdHlwZS5zZXRFeGVjdXRlSGFuZGxlckZhbGxiYWNrID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX2V4ZWN1dGVIYW5kbGVyRmIgPSBjYWxsYmFjaztcbiAgICB9O1xuICAgIEVzY2FwZVNlcXVlbmNlUGFyc2VyLnByb3RvdHlwZS5hZGRDc2lIYW5kbGVyID0gZnVuY3Rpb24gKGZsYWcsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBpbmRleCA9IGZsYWcuY2hhckNvZGVBdCgwKTtcbiAgICAgICAgaWYgKHRoaXMuX2NzaUhhbmRsZXJzW2luZGV4XSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLl9jc2lIYW5kbGVyc1tpbmRleF0gPSBbXTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgaGFuZGxlckxpc3QgPSB0aGlzLl9jc2lIYW5kbGVyc1tpbmRleF07XG4gICAgICAgIGhhbmRsZXJMaXN0LnB1c2goY2FsbGJhY2spO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgZGlzcG9zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBoYW5kbGVySW5kZXggPSBoYW5kbGVyTGlzdC5pbmRleE9mKGNhbGxiYWNrKTtcbiAgICAgICAgICAgICAgICBpZiAoaGFuZGxlckluZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyTGlzdC5zcGxpY2UoaGFuZGxlckluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfTtcbiAgICBFc2NhcGVTZXF1ZW5jZVBhcnNlci5wcm90b3R5cGUuc2V0Q3NpSGFuZGxlciA9IGZ1bmN0aW9uIChmbGFnLCBjYWxsYmFjaykge1xuICAgICAgICB0aGlzLl9jc2lIYW5kbGVyc1tmbGFnLmNoYXJDb2RlQXQoMCldID0gW2NhbGxiYWNrXTtcbiAgICB9O1xuICAgIEVzY2FwZVNlcXVlbmNlUGFyc2VyLnByb3RvdHlwZS5jbGVhckNzaUhhbmRsZXIgPSBmdW5jdGlvbiAoZmxhZykge1xuICAgICAgICBpZiAodGhpcy5fY3NpSGFuZGxlcnNbZmxhZy5jaGFyQ29kZUF0KDApXSlcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9jc2lIYW5kbGVyc1tmbGFnLmNoYXJDb2RlQXQoMCldO1xuICAgIH07XG4gICAgRXNjYXBlU2VxdWVuY2VQYXJzZXIucHJvdG90eXBlLnNldENzaUhhbmRsZXJGYWxsYmFjayA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICB0aGlzLl9jc2lIYW5kbGVyRmIgPSBjYWxsYmFjaztcbiAgICB9O1xuICAgIEVzY2FwZVNlcXVlbmNlUGFyc2VyLnByb3RvdHlwZS5zZXRFc2NIYW5kbGVyID0gZnVuY3Rpb24gKGNvbGxlY3RBbmRGbGFnLCBjYWxsYmFjaykge1xuICAgICAgICB0aGlzLl9lc2NIYW5kbGVyc1tjb2xsZWN0QW5kRmxhZ10gPSBjYWxsYmFjaztcbiAgICB9O1xuICAgIEVzY2FwZVNlcXVlbmNlUGFyc2VyLnByb3RvdHlwZS5jbGVhckVzY0hhbmRsZXIgPSBmdW5jdGlvbiAoY29sbGVjdEFuZEZsYWcpIHtcbiAgICAgICAgaWYgKHRoaXMuX2VzY0hhbmRsZXJzW2NvbGxlY3RBbmRGbGFnXSlcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9lc2NIYW5kbGVyc1tjb2xsZWN0QW5kRmxhZ107XG4gICAgfTtcbiAgICBFc2NhcGVTZXF1ZW5jZVBhcnNlci5wcm90b3R5cGUuc2V0RXNjSGFuZGxlckZhbGxiYWNrID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX2VzY0hhbmRsZXJGYiA9IGNhbGxiYWNrO1xuICAgIH07XG4gICAgRXNjYXBlU2VxdWVuY2VQYXJzZXIucHJvdG90eXBlLmFkZE9zY0hhbmRsZXIgPSBmdW5jdGlvbiAoaWRlbnQsIGNhbGxiYWNrKSB7XG4gICAgICAgIGlmICh0aGlzLl9vc2NIYW5kbGVyc1tpZGVudF0gPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5fb3NjSGFuZGxlcnNbaWRlbnRdID0gW107XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGhhbmRsZXJMaXN0ID0gdGhpcy5fb3NjSGFuZGxlcnNbaWRlbnRdO1xuICAgICAgICBoYW5kbGVyTGlzdC5wdXNoKGNhbGxiYWNrKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGRpc3Bvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgaGFuZGxlckluZGV4ID0gaGFuZGxlckxpc3QuaW5kZXhPZihjYWxsYmFjayk7XG4gICAgICAgICAgICAgICAgaWYgKGhhbmRsZXJJbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlckxpc3Quc3BsaWNlKGhhbmRsZXJJbmRleCwgMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH07XG4gICAgRXNjYXBlU2VxdWVuY2VQYXJzZXIucHJvdG90eXBlLnNldE9zY0hhbmRsZXIgPSBmdW5jdGlvbiAoaWRlbnQsIGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX29zY0hhbmRsZXJzW2lkZW50XSA9IFtjYWxsYmFja107XG4gICAgfTtcbiAgICBFc2NhcGVTZXF1ZW5jZVBhcnNlci5wcm90b3R5cGUuY2xlYXJPc2NIYW5kbGVyID0gZnVuY3Rpb24gKGlkZW50KSB7XG4gICAgICAgIGlmICh0aGlzLl9vc2NIYW5kbGVyc1tpZGVudF0pXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fb3NjSGFuZGxlcnNbaWRlbnRdO1xuICAgIH07XG4gICAgRXNjYXBlU2VxdWVuY2VQYXJzZXIucHJvdG90eXBlLnNldE9zY0hhbmRsZXJGYWxsYmFjayA9IGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICB0aGlzLl9vc2NIYW5kbGVyRmIgPSBjYWxsYmFjaztcbiAgICB9O1xuICAgIEVzY2FwZVNlcXVlbmNlUGFyc2VyLnByb3RvdHlwZS5zZXREY3NIYW5kbGVyID0gZnVuY3Rpb24gKGNvbGxlY3RBbmRGbGFnLCBoYW5kbGVyKSB7XG4gICAgICAgIHRoaXMuX2Rjc0hhbmRsZXJzW2NvbGxlY3RBbmRGbGFnXSA9IGhhbmRsZXI7XG4gICAgfTtcbiAgICBFc2NhcGVTZXF1ZW5jZVBhcnNlci5wcm90b3R5cGUuY2xlYXJEY3NIYW5kbGVyID0gZnVuY3Rpb24gKGNvbGxlY3RBbmRGbGFnKSB7XG4gICAgICAgIGlmICh0aGlzLl9kY3NIYW5kbGVyc1tjb2xsZWN0QW5kRmxhZ10pXG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fZGNzSGFuZGxlcnNbY29sbGVjdEFuZEZsYWddO1xuICAgIH07XG4gICAgRXNjYXBlU2VxdWVuY2VQYXJzZXIucHJvdG90eXBlLnNldERjc0hhbmRsZXJGYWxsYmFjayA9IGZ1bmN0aW9uIChoYW5kbGVyKSB7XG4gICAgICAgIHRoaXMuX2Rjc0hhbmRsZXJGYiA9IGhhbmRsZXI7XG4gICAgfTtcbiAgICBFc2NhcGVTZXF1ZW5jZVBhcnNlci5wcm90b3R5cGUuc2V0RXJyb3JIYW5kbGVyID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX2Vycm9ySGFuZGxlciA9IGNhbGxiYWNrO1xuICAgIH07XG4gICAgRXNjYXBlU2VxdWVuY2VQYXJzZXIucHJvdG90eXBlLmNsZWFyRXJyb3JIYW5kbGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9lcnJvckhhbmRsZXIgPSB0aGlzLl9lcnJvckhhbmRsZXJGYjtcbiAgICB9O1xuICAgIEVzY2FwZVNlcXVlbmNlUGFyc2VyLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50U3RhdGUgPSB0aGlzLmluaXRpYWxTdGF0ZTtcbiAgICAgICAgdGhpcy5fb3NjID0gJyc7XG4gICAgICAgIHRoaXMuX3BhcmFtcyA9IFswXTtcbiAgICAgICAgdGhpcy5fY29sbGVjdCA9ICcnO1xuICAgICAgICB0aGlzLl9hY3RpdmVEY3NIYW5kbGVyID0gbnVsbDtcbiAgICB9O1xuICAgIEVzY2FwZVNlcXVlbmNlUGFyc2VyLnByb3RvdHlwZS5wYXJzZSA9IGZ1bmN0aW9uIChkYXRhLCBsZW5ndGgpIHtcbiAgICAgICAgdmFyIGNvZGUgPSAwO1xuICAgICAgICB2YXIgdHJhbnNpdGlvbiA9IDA7XG4gICAgICAgIHZhciBlcnJvciA9IGZhbHNlO1xuICAgICAgICB2YXIgY3VycmVudFN0YXRlID0gdGhpcy5jdXJyZW50U3RhdGU7XG4gICAgICAgIHZhciBwcmludCA9IC0xO1xuICAgICAgICB2YXIgZGNzID0gLTE7XG4gICAgICAgIHZhciBvc2MgPSB0aGlzLl9vc2M7XG4gICAgICAgIHZhciBjb2xsZWN0ID0gdGhpcy5fY29sbGVjdDtcbiAgICAgICAgdmFyIHBhcmFtcyA9IHRoaXMuX3BhcmFtcztcbiAgICAgICAgdmFyIHRhYmxlID0gdGhpcy5UUkFOU0lUSU9OUy50YWJsZTtcbiAgICAgICAgdmFyIGRjc0hhbmRsZXIgPSB0aGlzLl9hY3RpdmVEY3NIYW5kbGVyO1xuICAgICAgICB2YXIgY2FsbGJhY2sgPSBudWxsO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICBjb2RlID0gZGF0YVtpXTtcbiAgICAgICAgICAgIGlmIChjdXJyZW50U3RhdGUgPT09IDAgJiYgY29kZSA+IDB4MWYgJiYgY29kZSA8IDB4ODApIHtcbiAgICAgICAgICAgICAgICBwcmludCA9ICh+cHJpbnQpID8gcHJpbnQgOiBpO1xuICAgICAgICAgICAgICAgIGRvXG4gICAgICAgICAgICAgICAgICAgIGkrKztcbiAgICAgICAgICAgICAgICB3aGlsZSAoaSA8IGxlbmd0aCAmJiBkYXRhW2ldID4gMHgxZiAmJiBkYXRhW2ldIDwgMHg4MCk7XG4gICAgICAgICAgICAgICAgaS0tO1xuICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gNCAmJiAoY29kZSA+IDB4MmYgJiYgY29kZSA8IDB4MzkpKSB7XG4gICAgICAgICAgICAgICAgcGFyYW1zW3BhcmFtcy5sZW5ndGggLSAxXSA9IHBhcmFtc1twYXJhbXMubGVuZ3RoIC0gMV0gKiAxMCArIGNvZGUgLSA0ODtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRyYW5zaXRpb24gPSB0YWJsZVtjdXJyZW50U3RhdGUgPDwgOCB8IChjb2RlIDwgMHhhMCA/IGNvZGUgOiBOT05fQVNDSUlfUFJJTlRBQkxFKV07XG4gICAgICAgICAgICBzd2l0Y2ggKHRyYW5zaXRpb24gPj4gNCkge1xuICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgcHJpbnQgPSAofnByaW50KSA/IHByaW50IDogaTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAzOlxuICAgICAgICAgICAgICAgICAgICBpZiAofnByaW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcmludEhhbmRsZXIoZGF0YSwgcHJpbnQsIGkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayA9IHRoaXMuX2V4ZWN1dGVIYW5kbGVyc1tjb2RlXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKVxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fZXhlY3V0ZUhhbmRsZXJGYihjb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICBpZiAofnByaW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9wcmludEhhbmRsZXIoZGF0YSwgcHJpbnQsIGkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh+ZGNzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkY3NIYW5kbGVyLnB1dChkYXRhLCBkY3MsIGkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGNzID0gLTE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICBpZiAoY29kZSA+IDB4OWYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoY3VycmVudFN0YXRlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCA9ICh+cHJpbnQpID8gcHJpbnQgOiBpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb24gfD0gNjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMTpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbiB8PSAxMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAxMzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGNzID0gKH5kY3MpID8gZGNzIDogaTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbiB8PSAxMztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGluamVjdCA9IHRoaXMuX2Vycm9ySGFuZGxlcih7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29kZTogY29kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50U3RhdGU6IGN1cnJlbnRTdGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludDogcHJpbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGNzOiBkY3MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3NjOiBvc2MsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sbGVjdDogY29sbGVjdCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhYm9ydDogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluamVjdC5hYm9ydClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNzpcbiAgICAgICAgICAgICAgICAgICAgdmFyIGhhbmRsZXJzID0gdGhpcy5fY3NpSGFuZGxlcnNbY29kZV07XG4gICAgICAgICAgICAgICAgICAgIHZhciBqID0gaGFuZGxlcnMgPyBoYW5kbGVycy5sZW5ndGggLSAxIDogLTE7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoOyBqID49IDA7IGotLSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGhhbmRsZXJzW2pdKHBhcmFtcywgY29sbGVjdCkgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGogPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jc2lIYW5kbGVyRmIoY29sbGVjdCwgcGFyYW1zLCBjb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDg6XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2RlID09PSAweDNiKVxuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zLnB1c2goMCk7XG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhcmFtc1twYXJhbXMubGVuZ3RoIC0gMV0gPSBwYXJhbXNbcGFyYW1zLmxlbmd0aCAtIDFdICogMTAgKyBjb2RlIC0gNDg7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgOTpcbiAgICAgICAgICAgICAgICAgICAgY29sbGVjdCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGUpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDEwOlxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayA9IHRoaXMuX2VzY0hhbmRsZXJzW2NvbGxlY3QgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGUpXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNhbGxiYWNrKVxuICAgICAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2soY29sbGVjdCwgY29kZSk7XG4gICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2VzY0hhbmRsZXJGYihjb2xsZWN0LCBjb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxMTpcbiAgICAgICAgICAgICAgICAgICAgaWYgKH5wcmludCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcHJpbnRIYW5kbGVyKGRhdGEsIHByaW50LCBpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ID0gLTE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgb3NjID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIHBhcmFtcyA9IFswXTtcbiAgICAgICAgICAgICAgICAgICAgY29sbGVjdCA9ICcnO1xuICAgICAgICAgICAgICAgICAgICBkY3MgPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxMjpcbiAgICAgICAgICAgICAgICAgICAgZGNzSGFuZGxlciA9IHRoaXMuX2Rjc0hhbmRsZXJzW2NvbGxlY3QgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGUpXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFkY3NIYW5kbGVyKVxuICAgICAgICAgICAgICAgICAgICAgICAgZGNzSGFuZGxlciA9IHRoaXMuX2Rjc0hhbmRsZXJGYjtcbiAgICAgICAgICAgICAgICAgICAgZGNzSGFuZGxlci5ob29rKGNvbGxlY3QsIHBhcmFtcywgY29kZSk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMTM6XG4gICAgICAgICAgICAgICAgICAgIGRjcyA9ICh+ZGNzKSA/IGRjcyA6IGk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMTQ6XG4gICAgICAgICAgICAgICAgICAgIGlmIChkY3NIYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAofmRjcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkY3NIYW5kbGVyLnB1dChkYXRhLCBkY3MsIGkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGNzSGFuZGxlci51bmhvb2soKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRjc0hhbmRsZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2RlID09PSAweDFiKVxuICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbiB8PSAxO1xuICAgICAgICAgICAgICAgICAgICBvc2MgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zID0gWzBdO1xuICAgICAgICAgICAgICAgICAgICBjb2xsZWN0ID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIGRjcyA9IC0xO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgIGlmICh+cHJpbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3ByaW50SGFuZGxlcihkYXRhLCBwcmludCwgaSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcmludCA9IC0xO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG9zYyA9ICcnO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGpfMSA9IGkgKyAxOzsgal8xKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChqXzEgPj0gbGVuZ3RoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfHwgKGNvZGUgPSBkYXRhW2pfMV0pIDwgMHgyMFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHx8IChjb2RlID4gMHg3ZiAmJiBjb2RlIDw9IDB4OWYpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3NjICs9IFRleHREZWNvZGVyXzEudXRmMzJUb1N0cmluZyhkYXRhLCBpLCBqXzEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgPSBqXzEgLSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9zYyAmJiBjb2RlICE9PSAweDE4ICYmIGNvZGUgIT09IDB4MWEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpZHggPSBvc2MuaW5kZXhPZignOycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCA9PT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vc2NIYW5kbGVyRmIoLTEsIG9zYyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgaWRlbnRpZmllciA9IHBhcnNlSW50KG9zYy5zdWJzdHJpbmcoMCwgaWR4KSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRlbnQgPSBvc2Muc3Vic3RyaW5nKGlkeCArIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBoYW5kbGVyc18xID0gdGhpcy5fb3NjSGFuZGxlcnNbaWRlbnRpZmllcl07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGpfMiA9IGhhbmRsZXJzXzEgPyBoYW5kbGVyc18xLmxlbmd0aCAtIDEgOiAtMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKDsgal8yID49IDA7IGpfMi0tKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYW5kbGVyc18xW2pfMl0oY29udGVudCkgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoal8yIDwgMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9vc2NIYW5kbGVyRmIoaWRlbnRpZmllciwgY29udGVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb2RlID09PSAweDFiKVxuICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbiB8PSAxO1xuICAgICAgICAgICAgICAgICAgICBvc2MgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgcGFyYW1zID0gWzBdO1xuICAgICAgICAgICAgICAgICAgICBjb2xsZWN0ID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIGRjcyA9IC0xO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN1cnJlbnRTdGF0ZSA9IHRyYW5zaXRpb24gJiAxNTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3VycmVudFN0YXRlID09PSAwICYmIH5wcmludCkge1xuICAgICAgICAgICAgdGhpcy5fcHJpbnRIYW5kbGVyKGRhdGEsIHByaW50LCBsZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGN1cnJlbnRTdGF0ZSA9PT0gMTMgJiYgfmRjcyAmJiBkY3NIYW5kbGVyKSB7XG4gICAgICAgICAgICBkY3NIYW5kbGVyLnB1dChkYXRhLCBkY3MsIGxlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fb3NjID0gb3NjO1xuICAgICAgICB0aGlzLl9jb2xsZWN0ID0gY29sbGVjdDtcbiAgICAgICAgdGhpcy5fcGFyYW1zID0gcGFyYW1zO1xuICAgICAgICB0aGlzLl9hY3RpdmVEY3NIYW5kbGVyID0gZGNzSGFuZGxlcjtcbiAgICAgICAgdGhpcy5jdXJyZW50U3RhdGUgPSBjdXJyZW50U3RhdGU7XG4gICAgfTtcbiAgICByZXR1cm4gRXNjYXBlU2VxdWVuY2VQYXJzZXI7XG59KExpZmVjeWNsZV8xLkRpc3Bvc2FibGUpKTtcbmV4cG9ydHMuRXNjYXBlU2VxdWVuY2VQYXJzZXIgPSBFc2NhcGVTZXF1ZW5jZVBhcnNlcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUVzY2FwZVNlcXVlbmNlUGFyc2VyLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgRXNjYXBlU2VxdWVuY2VzXzEgPSByZXF1aXJlKFwiLi9jb21tb24vZGF0YS9Fc2NhcGVTZXF1ZW5jZXNcIik7XG52YXIgQ2hhcnNldHNfMSA9IHJlcXVpcmUoXCIuL2NvcmUvZGF0YS9DaGFyc2V0c1wiKTtcbnZhciBDaGFyV2lkdGhfMSA9IHJlcXVpcmUoXCIuL0NoYXJXaWR0aFwiKTtcbnZhciBFc2NhcGVTZXF1ZW5jZVBhcnNlcl8xID0gcmVxdWlyZShcIi4vRXNjYXBlU2VxdWVuY2VQYXJzZXJcIik7XG52YXIgTGlmZWN5Y2xlXzEgPSByZXF1aXJlKFwiLi9jb21tb24vTGlmZWN5Y2xlXCIpO1xudmFyIFR5cGVkQXJyYXlVdGlsc18xID0gcmVxdWlyZShcIi4vY29tbW9uL1R5cGVkQXJyYXlVdGlsc1wiKTtcbnZhciBUZXh0RGVjb2Rlcl8xID0gcmVxdWlyZShcIi4vY29yZS9pbnB1dC9UZXh0RGVjb2RlclwiKTtcbnZhciBCdWZmZXJMaW5lXzEgPSByZXF1aXJlKFwiLi9jb3JlL2J1ZmZlci9CdWZmZXJMaW5lXCIpO1xudmFyIEV2ZW50RW1pdHRlcjJfMSA9IHJlcXVpcmUoXCIuL2NvbW1vbi9FdmVudEVtaXR0ZXIyXCIpO1xudmFyIEdMRVZFTCA9IHsgJygnOiAwLCAnKSc6IDEsICcqJzogMiwgJysnOiAzLCAnLSc6IDEsICcuJzogMiB9O1xudmFyIERFQ1JRU1MgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIERFQ1JRU1MoX3Rlcm1pbmFsKSB7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsID0gX3Rlcm1pbmFsO1xuICAgICAgICB0aGlzLl9kYXRhID0gbmV3IFVpbnQzMkFycmF5KDApO1xuICAgIH1cbiAgICBERUNSUVNTLnByb3RvdHlwZS5ob29rID0gZnVuY3Rpb24gKGNvbGxlY3QsIHBhcmFtcywgZmxhZykge1xuICAgICAgICB0aGlzLl9kYXRhID0gbmV3IFVpbnQzMkFycmF5KDApO1xuICAgIH07XG4gICAgREVDUlFTUy5wcm90b3R5cGUucHV0ID0gZnVuY3Rpb24gKGRhdGEsIHN0YXJ0LCBlbmQpIHtcbiAgICAgICAgdGhpcy5fZGF0YSA9IFR5cGVkQXJyYXlVdGlsc18xLmNvbmNhdCh0aGlzLl9kYXRhLCBkYXRhLnN1YmFycmF5KHN0YXJ0LCBlbmQpKTtcbiAgICB9O1xuICAgIERFQ1JRU1MucHJvdG90eXBlLnVuaG9vayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGRhdGEgPSBUZXh0RGVjb2Rlcl8xLnV0ZjMyVG9TdHJpbmcodGhpcy5fZGF0YSk7XG4gICAgICAgIHRoaXMuX2RhdGEgPSBuZXcgVWludDMyQXJyYXkoMCk7XG4gICAgICAgIHN3aXRjaCAoZGF0YSkge1xuICAgICAgICAgICAgY2FzZSAnXCJxJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdGVybWluYWwuaGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyBcIlAxJHIwXFxcInFcIiArIEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArIFwiXFxcXFwiKTtcbiAgICAgICAgICAgIGNhc2UgJ1wicCc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Rlcm1pbmFsLmhhbmRsZXIoRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgXCJQMSRyNjFcXFwicFwiICsgRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgXCJcXFxcXCIpO1xuICAgICAgICAgICAgY2FzZSAncic6XG4gICAgICAgICAgICAgICAgdmFyIHB0ID0gJycgKyAodGhpcy5fdGVybWluYWwuYnVmZmVyLnNjcm9sbFRvcCArIDEpICtcbiAgICAgICAgICAgICAgICAgICAgJzsnICsgKHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5zY3JvbGxCb3R0b20gKyAxKSArICdyJztcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fdGVybWluYWwuaGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyBcIlAxJHJcIiArIHB0ICsgRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgXCJcXFxcXCIpO1xuICAgICAgICAgICAgY2FzZSAnbSc6XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Rlcm1pbmFsLmhhbmRsZXIoRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgXCJQMSRyMG1cIiArIEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArIFwiXFxcXFwiKTtcbiAgICAgICAgICAgIGNhc2UgJyBxJzpcbiAgICAgICAgICAgICAgICB2YXIgU1RZTEVTID0geyAnYmxvY2snOiAyLCAndW5kZXJsaW5lJzogNCwgJ2Jhcic6IDYgfTtcbiAgICAgICAgICAgICAgICB2YXIgc3R5bGUgPSBTVFlMRVNbdGhpcy5fdGVybWluYWwuZ2V0T3B0aW9uKCdjdXJzb3JTdHlsZScpXTtcbiAgICAgICAgICAgICAgICBzdHlsZSAtPSB0aGlzLl90ZXJtaW5hbC5nZXRPcHRpb24oJ2N1cnNvckJsaW5rJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Rlcm1pbmFsLmhhbmRsZXIoRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgXCJQMSRyXCIgKyBzdHlsZSArIFwiIHFcIiArIEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArIFwiXFxcXFwiKTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuZXJyb3IoJ1Vua25vd24gRENTICRxICVzJywgZGF0YSk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuaGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyBcIlAwJHJcIiArIEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArIFwiXFxcXFwiKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIERFQ1JRU1M7XG59KCkpO1xudmFyIElucHV0SGFuZGxlciA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKElucHV0SGFuZGxlciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBJbnB1dEhhbmRsZXIoX3Rlcm1pbmFsLCBfcGFyc2VyKSB7XG4gICAgICAgIGlmIChfcGFyc2VyID09PSB2b2lkIDApIHsgX3BhcnNlciA9IG5ldyBFc2NhcGVTZXF1ZW5jZVBhcnNlcl8xLkVzY2FwZVNlcXVlbmNlUGFyc2VyKCk7IH1cbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuX3Rlcm1pbmFsID0gX3Rlcm1pbmFsO1xuICAgICAgICBfdGhpcy5fcGFyc2VyID0gX3BhcnNlcjtcbiAgICAgICAgX3RoaXMuX3BhcnNlQnVmZmVyID0gbmV3IFVpbnQzMkFycmF5KDQwOTYpO1xuICAgICAgICBfdGhpcy5fc3RyaW5nRGVjb2RlciA9IG5ldyBUZXh0RGVjb2Rlcl8xLlN0cmluZ1RvVXRmMzIoKTtcbiAgICAgICAgX3RoaXMuX3dvcmtDZWxsID0gbmV3IEJ1ZmZlckxpbmVfMS5DZWxsRGF0YSgpO1xuICAgICAgICBfdGhpcy5fb25DdXJzb3JNb3ZlID0gbmV3IEV2ZW50RW1pdHRlcjJfMS5FdmVudEVtaXR0ZXIyKCk7XG4gICAgICAgIF90aGlzLl9vbkRhdGEgPSBuZXcgRXZlbnRFbWl0dGVyMl8xLkV2ZW50RW1pdHRlcjIoKTtcbiAgICAgICAgX3RoaXMuX29uTGluZUZlZWQgPSBuZXcgRXZlbnRFbWl0dGVyMl8xLkV2ZW50RW1pdHRlcjIoKTtcbiAgICAgICAgX3RoaXMuX29uU2Nyb2xsID0gbmV3IEV2ZW50RW1pdHRlcjJfMS5FdmVudEVtaXR0ZXIyKCk7XG4gICAgICAgIF90aGlzLnJlZ2lzdGVyKF90aGlzLl9wYXJzZXIpO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXJGYWxsYmFjayhmdW5jdGlvbiAoY29sbGVjdCwgcGFyYW1zLCBmbGFnKSB7XG4gICAgICAgICAgICBfdGhpcy5fdGVybWluYWwuZXJyb3IoJ1Vua25vd24gQ1NJIGNvZGU6ICcsIHsgY29sbGVjdDogY29sbGVjdCwgcGFyYW1zOiBwYXJhbXMsIGZsYWc6IFN0cmluZy5mcm9tQ2hhckNvZGUoZmxhZykgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVzY0hhbmRsZXJGYWxsYmFjayhmdW5jdGlvbiAoY29sbGVjdCwgZmxhZykge1xuICAgICAgICAgICAgX3RoaXMuX3Rlcm1pbmFsLmVycm9yKCdVbmtub3duIEVTQyBjb2RlOiAnLCB7IGNvbGxlY3Q6IGNvbGxlY3QsIGZsYWc6IFN0cmluZy5mcm9tQ2hhckNvZGUoZmxhZykgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEV4ZWN1dGVIYW5kbGVyRmFsbGJhY2soZnVuY3Rpb24gKGNvZGUpIHtcbiAgICAgICAgICAgIF90aGlzLl90ZXJtaW5hbC5lcnJvcignVW5rbm93biBFWEVDVVRFIGNvZGU6ICcsIHsgY29kZTogY29kZSB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0T3NjSGFuZGxlckZhbGxiYWNrKGZ1bmN0aW9uIChpZGVudGlmaWVyLCBkYXRhKSB7XG4gICAgICAgICAgICBfdGhpcy5fdGVybWluYWwuZXJyb3IoJ1Vua25vd24gT1NDIGNvZGU6ICcsIHsgaWRlbnRpZmllcjogaWRlbnRpZmllciwgZGF0YTogZGF0YSB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0UHJpbnRIYW5kbGVyKGZ1bmN0aW9uIChkYXRhLCBzdGFydCwgZW5kKSB7IHJldHVybiBfdGhpcy5wcmludChkYXRhLCBzdGFydCwgZW5kKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0Q3NpSGFuZGxlcignQCcsIGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHsgcmV0dXJuIF90aGlzLmluc2VydENoYXJzKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ0EnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5jdXJzb3JVcChwYXJhbXMpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdCJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMuY3Vyc29yRG93bihwYXJhbXMpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdDJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMuY3Vyc29yRm9yd2FyZChwYXJhbXMpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdEJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMuY3Vyc29yQmFja3dhcmQocGFyYW1zKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0Q3NpSGFuZGxlcignRScsIGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHsgcmV0dXJuIF90aGlzLmN1cnNvck5leHRMaW5lKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ0YnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5jdXJzb3JQcmVjZWRpbmdMaW5lKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ0cnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5jdXJzb3JDaGFyQWJzb2x1dGUocGFyYW1zKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0Q3NpSGFuZGxlcignSCcsIGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHsgcmV0dXJuIF90aGlzLmN1cnNvclBvc2l0aW9uKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ0knLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5jdXJzb3JGb3J3YXJkVGFiKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ0onLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5lcmFzZUluRGlzcGxheShwYXJhbXMpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdLJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMuZXJhc2VJbkxpbmUocGFyYW1zKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0Q3NpSGFuZGxlcignTCcsIGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHsgcmV0dXJuIF90aGlzLmluc2VydExpbmVzKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ00nLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5kZWxldGVMaW5lcyhwYXJhbXMpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdQJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMuZGVsZXRlQ2hhcnMocGFyYW1zKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0Q3NpSGFuZGxlcignUycsIGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHsgcmV0dXJuIF90aGlzLnNjcm9sbFVwKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ1QnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5zY3JvbGxEb3duKHBhcmFtcywgY29sbGVjdCk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ1gnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5lcmFzZUNoYXJzKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ1onLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5jdXJzb3JCYWNrd2FyZFRhYihwYXJhbXMpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdgJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMuY2hhclBvc0Fic29sdXRlKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ2EnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5oUG9zaXRpb25SZWxhdGl2ZShwYXJhbXMpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdiJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMucmVwZWF0UHJlY2VkaW5nQ2hhcmFjdGVyKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ2MnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5zZW5kRGV2aWNlQXR0cmlidXRlcyhwYXJhbXMsIGNvbGxlY3QpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdkJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMubGluZVBvc0Fic29sdXRlKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ2UnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy52UG9zaXRpb25SZWxhdGl2ZShwYXJhbXMpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdmJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMuaFZQb3NpdGlvbihwYXJhbXMpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdnJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMudGFiQ2xlYXIocGFyYW1zKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0Q3NpSGFuZGxlcignaCcsIGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHsgcmV0dXJuIF90aGlzLnNldE1vZGUocGFyYW1zLCBjb2xsZWN0KTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0Q3NpSGFuZGxlcignbCcsIGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHsgcmV0dXJuIF90aGlzLnJlc2V0TW9kZShwYXJhbXMsIGNvbGxlY3QpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdtJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMuY2hhckF0dHJpYnV0ZXMocGFyYW1zKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0Q3NpSGFuZGxlcignbicsIGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHsgcmV0dXJuIF90aGlzLmRldmljZVN0YXR1cyhwYXJhbXMsIGNvbGxlY3QpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdwJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMuc29mdFJlc2V0KHBhcmFtcywgY29sbGVjdCk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ3EnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5zZXRDdXJzb3JTdHlsZShwYXJhbXMsIGNvbGxlY3QpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRDc2lIYW5kbGVyKCdyJywgZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkgeyByZXR1cm4gX3RoaXMuc2V0U2Nyb2xsUmVnaW9uKHBhcmFtcywgY29sbGVjdCk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ3MnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5zYXZlQ3Vyc29yKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldENzaUhhbmRsZXIoJ3UnLCBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7IHJldHVybiBfdGhpcy5yZXN0b3JlQ3Vyc29yKHBhcmFtcyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEV4ZWN1dGVIYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLkJFTCwgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuYmVsbCgpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRFeGVjdXRlSGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMC5MRiwgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMubGluZUZlZWQoKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0RXhlY3V0ZUhhbmRsZXIoRXNjYXBlU2VxdWVuY2VzXzEuQzAuVlQsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmxpbmVGZWVkKCk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEV4ZWN1dGVIYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLkZGLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5saW5lRmVlZCgpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRFeGVjdXRlSGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMC5DUiwgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuY2FycmlhZ2VSZXR1cm4oKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0RXhlY3V0ZUhhbmRsZXIoRXNjYXBlU2VxdWVuY2VzXzEuQzAuQlMsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmJhY2tzcGFjZSgpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRFeGVjdXRlSGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMC5IVCwgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMudGFiKCk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEV4ZWN1dGVIYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLlNPLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zaGlmdE91dCgpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRFeGVjdXRlSGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMC5TSSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuc2hpZnRJbigpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRFeGVjdXRlSGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMS5JTkQsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmluZGV4KCk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEV4ZWN1dGVIYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMxLk5FTCwgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMubmV4dExpbmUoKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0RXhlY3V0ZUhhbmRsZXIoRXNjYXBlU2VxdWVuY2VzXzEuQzEuSFRTLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy50YWJTZXQoKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0T3NjSGFuZGxlcigwLCBmdW5jdGlvbiAoZGF0YSkgeyByZXR1cm4gX3RoaXMuc2V0VGl0bGUoZGF0YSk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldE9zY0hhbmRsZXIoMiwgZnVuY3Rpb24gKGRhdGEpIHsgcmV0dXJuIF90aGlzLnNldFRpdGxlKGRhdGEpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRFc2NIYW5kbGVyKCc3JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuc2F2ZUN1cnNvcihbXSk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJzgnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5yZXN0b3JlQ3Vyc29yKFtdKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0RXNjSGFuZGxlcignRCcsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmluZGV4KCk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJ0UnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5uZXh0TGluZSgpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRFc2NIYW5kbGVyKCdIJywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMudGFiU2V0KCk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJ00nLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5yZXZlcnNlSW5kZXgoKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0RXNjSGFuZGxlcignPScsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmtleXBhZEFwcGxpY2F0aW9uTW9kZSgpOyB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXRFc2NIYW5kbGVyKCc+JywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMua2V5cGFkTnVtZXJpY01vZGUoKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0RXNjSGFuZGxlcignYycsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLnJlc2V0KCk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJ24nLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZXRnTGV2ZWwoMik7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJ28nLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZXRnTGV2ZWwoMyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJ3wnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZXRnTGV2ZWwoMyk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJ30nLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZXRnTGV2ZWwoMik7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJ34nLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZXRnTGV2ZWwoMSk7IH0pO1xuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJyVAJywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuc2VsZWN0RGVmYXVsdENoYXJzZXQoKTsgfSk7XG4gICAgICAgIF90aGlzLl9wYXJzZXIuc2V0RXNjSGFuZGxlcignJUcnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZWxlY3REZWZhdWx0Q2hhcnNldCgpOyB9KTtcbiAgICAgICAgdmFyIF9sb29wXzEgPSBmdW5jdGlvbiAoZmxhZykge1xuICAgICAgICAgICAgdGhpc18xLl9wYXJzZXIuc2V0RXNjSGFuZGxlcignKCcgKyBmbGFnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZWxlY3RDaGFyc2V0KCcoJyArIGZsYWcpOyB9KTtcbiAgICAgICAgICAgIHRoaXNfMS5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJyknICsgZmxhZywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuc2VsZWN0Q2hhcnNldCgnKScgKyBmbGFnKTsgfSk7XG4gICAgICAgICAgICB0aGlzXzEuX3BhcnNlci5zZXRFc2NIYW5kbGVyKCcqJyArIGZsYWcsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLnNlbGVjdENoYXJzZXQoJyonICsgZmxhZyk7IH0pO1xuICAgICAgICAgICAgdGhpc18xLl9wYXJzZXIuc2V0RXNjSGFuZGxlcignKycgKyBmbGFnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZWxlY3RDaGFyc2V0KCcrJyArIGZsYWcpOyB9KTtcbiAgICAgICAgICAgIHRoaXNfMS5fcGFyc2VyLnNldEVzY0hhbmRsZXIoJy0nICsgZmxhZywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuc2VsZWN0Q2hhcnNldCgnLScgKyBmbGFnKTsgfSk7XG4gICAgICAgICAgICB0aGlzXzEuX3BhcnNlci5zZXRFc2NIYW5kbGVyKCcuJyArIGZsYWcsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLnNlbGVjdENoYXJzZXQoJy4nICsgZmxhZyk7IH0pO1xuICAgICAgICAgICAgdGhpc18xLl9wYXJzZXIuc2V0RXNjSGFuZGxlcignLycgKyBmbGFnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZWxlY3RDaGFyc2V0KCcvJyArIGZsYWcpOyB9KTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHRoaXNfMSA9IHRoaXM7XG4gICAgICAgIGZvciAodmFyIGZsYWcgaW4gQ2hhcnNldHNfMS5DSEFSU0VUUykge1xuICAgICAgICAgICAgX2xvb3BfMShmbGFnKTtcbiAgICAgICAgfVxuICAgICAgICBfdGhpcy5fcGFyc2VyLnNldEVycm9ySGFuZGxlcihmdW5jdGlvbiAoc3RhdGUpIHtcbiAgICAgICAgICAgIF90aGlzLl90ZXJtaW5hbC5lcnJvcignUGFyc2luZyBlcnJvcjogJywgc3RhdGUpO1xuICAgICAgICAgICAgcmV0dXJuIHN0YXRlO1xuICAgICAgICB9KTtcbiAgICAgICAgX3RoaXMuX3BhcnNlci5zZXREY3NIYW5kbGVyKCckcScsIG5ldyBERUNSUVNTKF90aGlzLl90ZXJtaW5hbCkpO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShJbnB1dEhhbmRsZXIucHJvdG90eXBlLCBcIm9uQ3Vyc29yTW92ZVwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fb25DdXJzb3JNb3ZlLmV2ZW50OyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoSW5wdXRIYW5kbGVyLnByb3RvdHlwZSwgXCJvbkRhdGFcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX29uRGF0YS5ldmVudDsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KElucHV0SGFuZGxlci5wcm90b3R5cGUsIFwib25MaW5lRmVlZFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fb25MaW5lRmVlZC5ldmVudDsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KElucHV0SGFuZGxlci5wcm90b3R5cGUsIFwib25TY3JvbGxcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX29uU2Nyb2xsLmV2ZW50OyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuZGlzcG9zZS5jYWxsKHRoaXMpO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbCA9IG51bGw7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgaWYgKCF0aGlzLl90ZXJtaW5hbCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBidWZmZXIgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXI7XG4gICAgICAgIHZhciBjdXJzb3JTdGFydFggPSBidWZmZXIueDtcbiAgICAgICAgdmFyIGN1cnNvclN0YXJ0WSA9IGJ1ZmZlci55O1xuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuZGVidWcpIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmxvZygnZGF0YTogJyArIGRhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9wYXJzZUJ1ZmZlci5sZW5ndGggPCBkYXRhLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5fcGFyc2VCdWZmZXIgPSBuZXcgVWludDMyQXJyYXkoZGF0YS5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3BhcnNlci5wYXJzZSh0aGlzLl9wYXJzZUJ1ZmZlciwgdGhpcy5fc3RyaW5nRGVjb2Rlci5kZWNvZGUoZGF0YSwgdGhpcy5fcGFyc2VCdWZmZXIpKTtcbiAgICAgICAgYnVmZmVyID0gdGhpcy5fdGVybWluYWwuYnVmZmVyO1xuICAgICAgICBpZiAoYnVmZmVyLnggIT09IGN1cnNvclN0YXJ0WCB8fCBidWZmZXIueSAhPT0gY3Vyc29yU3RhcnRZKSB7XG4gICAgICAgICAgICB0aGlzLl9vbkN1cnNvck1vdmUuZmlyZSgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLnByaW50ID0gZnVuY3Rpb24gKGRhdGEsIHN0YXJ0LCBlbmQpIHtcbiAgICAgICAgdmFyIGNvZGU7XG4gICAgICAgIHZhciBjaFdpZHRoO1xuICAgICAgICB2YXIgYnVmZmVyID0gdGhpcy5fdGVybWluYWwuYnVmZmVyO1xuICAgICAgICB2YXIgY2hhcnNldCA9IHRoaXMuX3Rlcm1pbmFsLmNoYXJzZXQ7XG4gICAgICAgIHZhciBzY3JlZW5SZWFkZXJNb2RlID0gdGhpcy5fdGVybWluYWwub3B0aW9ucy5zY3JlZW5SZWFkZXJNb2RlO1xuICAgICAgICB2YXIgY29scyA9IHRoaXMuX3Rlcm1pbmFsLmNvbHM7XG4gICAgICAgIHZhciB3cmFwYXJvdW5kTW9kZSA9IHRoaXMuX3Rlcm1pbmFsLndyYXBhcm91bmRNb2RlO1xuICAgICAgICB2YXIgaW5zZXJ0TW9kZSA9IHRoaXMuX3Rlcm1pbmFsLmluc2VydE1vZGU7XG4gICAgICAgIHZhciBjdXJBdHRyID0gdGhpcy5fdGVybWluYWwuY3VyQXR0ckRhdGE7XG4gICAgICAgIHZhciBidWZmZXJSb3cgPSBidWZmZXIubGluZXMuZ2V0KGJ1ZmZlci55ICsgYnVmZmVyLnliYXNlKTtcbiAgICAgICAgdGhpcy5fdGVybWluYWwudXBkYXRlUmFuZ2UoYnVmZmVyLnkpO1xuICAgICAgICBmb3IgKHZhciBwb3MgPSBzdGFydDsgcG9zIDwgZW5kOyArK3Bvcykge1xuICAgICAgICAgICAgY29kZSA9IGRhdGFbcG9zXTtcbiAgICAgICAgICAgIGNoV2lkdGggPSBDaGFyV2lkdGhfMS53Y3dpZHRoKGNvZGUpO1xuICAgICAgICAgICAgaWYgKGNvZGUgPCAxMjcgJiYgY2hhcnNldCkge1xuICAgICAgICAgICAgICAgIHZhciBjaCA9IGNoYXJzZXRbU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKV07XG4gICAgICAgICAgICAgICAgaWYgKGNoKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvZGUgPSBjaC5jaGFyQ29kZUF0KDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzY3JlZW5SZWFkZXJNb2RlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuZW1pdCgnYTExeS5jaGFyJywgVGV4dERlY29kZXJfMS5zdHJpbmdGcm9tQ29kZVBvaW50KGNvZGUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghY2hXaWR0aCAmJiBidWZmZXIueCkge1xuICAgICAgICAgICAgICAgIGlmICghYnVmZmVyUm93LmdldFdpZHRoKGJ1ZmZlci54IC0gMSkpIHtcbiAgICAgICAgICAgICAgICAgICAgYnVmZmVyUm93LmFkZENvZGVwb2ludFRvQ2VsbChidWZmZXIueCAtIDIsIGNvZGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYnVmZmVyUm93LmFkZENvZGVwb2ludFRvQ2VsbChidWZmZXIueCAtIDEsIGNvZGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChidWZmZXIueCArIGNoV2lkdGggLSAxID49IGNvbHMpIHtcbiAgICAgICAgICAgICAgICBpZiAod3JhcGFyb3VuZE1vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgYnVmZmVyLnggPSAwO1xuICAgICAgICAgICAgICAgICAgICBidWZmZXIueSsrO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYnVmZmVyLnkgPiBidWZmZXIuc2Nyb2xsQm90dG9tKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBidWZmZXIueS0tO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2Nyb2xsKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgYnVmZmVyLmxpbmVzLmdldChidWZmZXIueSkuaXNXcmFwcGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBidWZmZXJSb3cgPSBidWZmZXIubGluZXMuZ2V0KGJ1ZmZlci55ICsgYnVmZmVyLnliYXNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjaFdpZHRoID09PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChpbnNlcnRNb2RlKSB7XG4gICAgICAgICAgICAgICAgYnVmZmVyUm93Lmluc2VydENlbGxzKGJ1ZmZlci54LCBjaFdpZHRoLCBidWZmZXIuZ2V0TnVsbENlbGwoY3VyQXR0cikpO1xuICAgICAgICAgICAgICAgIGlmIChidWZmZXJSb3cuZ2V0V2lkdGgoY29scyAtIDEpID09PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1ZmZlclJvdy5zZXRDZWxsRnJvbUNvZGVQb2ludChjb2xzIC0gMSwgQnVmZmVyTGluZV8xLk5VTExfQ0VMTF9DT0RFLCBCdWZmZXJMaW5lXzEuTlVMTF9DRUxMX1dJRFRILCBjdXJBdHRyLmZnLCBjdXJBdHRyLmJnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBidWZmZXJSb3cuc2V0Q2VsbEZyb21Db2RlUG9pbnQoYnVmZmVyLngrKywgY29kZSwgY2hXaWR0aCwgY3VyQXR0ci5mZywgY3VyQXR0ci5iZyk7XG4gICAgICAgICAgICBpZiAoY2hXaWR0aCA+IDApIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAoLS1jaFdpZHRoKSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1ZmZlclJvdy5zZXRDZWxsRnJvbUNvZGVQb2ludChidWZmZXIueCsrLCAwLCAwLCBjdXJBdHRyLmZnLCBjdXJBdHRyLmJnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdGVybWluYWwudXBkYXRlUmFuZ2UoYnVmZmVyLnkpO1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5hZGRDc2lIYW5kbGVyID0gZnVuY3Rpb24gKGZsYWcsIGNhbGxiYWNrKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9wYXJzZXIuYWRkQ3NpSGFuZGxlcihmbGFnLCBjYWxsYmFjayk7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmFkZE9zY0hhbmRsZXIgPSBmdW5jdGlvbiAoaWRlbnQsIGNhbGxiYWNrKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9wYXJzZXIuYWRkT3NjSGFuZGxlcihpZGVudCwgY2FsbGJhY2spO1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5iZWxsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5iZWxsKCk7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmxpbmVGZWVkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYnVmZmVyID0gdGhpcy5fdGVybWluYWwuYnVmZmVyO1xuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwub3B0aW9ucy5jb252ZXJ0RW9sKSB7XG4gICAgICAgICAgICBidWZmZXIueCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgYnVmZmVyLnkrKztcbiAgICAgICAgaWYgKGJ1ZmZlci55ID4gYnVmZmVyLnNjcm9sbEJvdHRvbSkge1xuICAgICAgICAgICAgYnVmZmVyLnktLTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNjcm9sbCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChidWZmZXIueCA+PSB0aGlzLl90ZXJtaW5hbC5jb2xzKSB7XG4gICAgICAgICAgICBidWZmZXIueC0tO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX29uTGluZUZlZWQuZmlyZSgpO1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5jYXJyaWFnZVJldHVybiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnggPSAwO1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5iYWNrc3BhY2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5idWZmZXIueCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54LS07XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUudGFiID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgb3JpZ2luYWxYID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLng7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLm5leHRTdG9wKCk7XG4gICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5vcHRpb25zLnNjcmVlblJlYWRlck1vZGUpIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmVtaXQoJ2ExMXkudGFiJywgdGhpcy5fdGVybWluYWwuYnVmZmVyLnggLSBvcmlnaW5hbFgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLnNoaWZ0T3V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5zZXRnTGV2ZWwoMSk7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLnNoaWZ0SW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNldGdMZXZlbCgwKTtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuaW5zZXJ0Q2hhcnMgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5saW5lcy5nZXQodGhpcy5fdGVybWluYWwuYnVmZmVyLnkgKyB0aGlzLl90ZXJtaW5hbC5idWZmZXIueWJhc2UpLmluc2VydENlbGxzKHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54LCBwYXJhbXNbMF0gfHwgMSwgdGhpcy5fdGVybWluYWwuYnVmZmVyLmdldE51bGxDZWxsKHRoaXMuX3Rlcm1pbmFsLmVyYXNlQXR0ckRhdGEoKSkpO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC51cGRhdGVSYW5nZSh0aGlzLl90ZXJtaW5hbC5idWZmZXIueSk7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmN1cnNvclVwID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICB2YXIgcGFyYW0gPSBwYXJhbXNbMF07XG4gICAgICAgIGlmIChwYXJhbSA8IDEpIHtcbiAgICAgICAgICAgIHBhcmFtID0gMTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueSAtPSBwYXJhbTtcbiAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55IDwgMCkge1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnkgPSAwO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmN1cnNvckRvd24gPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1swXTtcbiAgICAgICAgaWYgKHBhcmFtIDwgMSkge1xuICAgICAgICAgICAgcGFyYW0gPSAxO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55ICs9IHBhcmFtO1xuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuYnVmZmVyLnkgPj0gdGhpcy5fdGVybWluYWwucm93cykge1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnkgPSB0aGlzLl90ZXJtaW5hbC5yb3dzIC0gMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuYnVmZmVyLnggPj0gdGhpcy5fdGVybWluYWwuY29scykge1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLngtLTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5jdXJzb3JGb3J3YXJkID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICB2YXIgcGFyYW0gPSBwYXJhbXNbMF07XG4gICAgICAgIGlmIChwYXJhbSA8IDEpIHtcbiAgICAgICAgICAgIHBhcmFtID0gMTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueCArPSBwYXJhbTtcbiAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID49IHRoaXMuX3Rlcm1pbmFsLmNvbHMpIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID0gdGhpcy5fdGVybWluYWwuY29scyAtIDE7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuY3Vyc29yQmFja3dhcmQgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1swXTtcbiAgICAgICAgaWYgKHBhcmFtIDwgMSkge1xuICAgICAgICAgICAgcGFyYW0gPSAxO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5idWZmZXIueCA+PSB0aGlzLl90ZXJtaW5hbC5jb2xzKSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueC0tO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54IC09IHBhcmFtO1xuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuYnVmZmVyLnggPCAwKSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueCA9IDA7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuY3Vyc29yTmV4dExpbmUgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1swXTtcbiAgICAgICAgaWYgKHBhcmFtIDwgMSkge1xuICAgICAgICAgICAgcGFyYW0gPSAxO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55ICs9IHBhcmFtO1xuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuYnVmZmVyLnkgPj0gdGhpcy5fdGVybWluYWwucm93cykge1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnkgPSB0aGlzLl90ZXJtaW5hbC5yb3dzIC0gMTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueCA9IDA7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmN1cnNvclByZWNlZGluZ0xpbmUgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1swXTtcbiAgICAgICAgaWYgKHBhcmFtIDwgMSkge1xuICAgICAgICAgICAgcGFyYW0gPSAxO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55IC09IHBhcmFtO1xuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuYnVmZmVyLnkgPCAwKSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueSA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnggPSAwO1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5jdXJzb3JDaGFyQWJzb2x1dGUgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1swXTtcbiAgICAgICAgaWYgKHBhcmFtIDwgMSkge1xuICAgICAgICAgICAgcGFyYW0gPSAxO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID0gcGFyYW0gLSAxO1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5jdXJzb3JQb3NpdGlvbiA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdmFyIGNvbDtcbiAgICAgICAgdmFyIHJvdyA9IHBhcmFtc1swXSAtIDE7XG4gICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID49IDIpIHtcbiAgICAgICAgICAgIGNvbCA9IHBhcmFtc1sxXSAtIDE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb2wgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyb3cgPCAwKSB7XG4gICAgICAgICAgICByb3cgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHJvdyA+PSB0aGlzLl90ZXJtaW5hbC5yb3dzKSB7XG4gICAgICAgICAgICByb3cgPSB0aGlzLl90ZXJtaW5hbC5yb3dzIC0gMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29sIDwgMCkge1xuICAgICAgICAgICAgY29sID0gMDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb2wgPj0gdGhpcy5fdGVybWluYWwuY29scykge1xuICAgICAgICAgICAgY29sID0gdGhpcy5fdGVybWluYWwuY29scyAtIDE7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnggPSBjb2w7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55ID0gcm93O1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5jdXJzb3JGb3J3YXJkVGFiID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICB2YXIgcGFyYW0gPSBwYXJhbXNbMF0gfHwgMTtcbiAgICAgICAgd2hpbGUgKHBhcmFtLS0pIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLm5leHRTdG9wKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuX2VyYXNlSW5CdWZmZXJMaW5lID0gZnVuY3Rpb24gKHksIHN0YXJ0LCBlbmQsIGNsZWFyV3JhcCkge1xuICAgICAgICBpZiAoY2xlYXJXcmFwID09PSB2b2lkIDApIHsgY2xlYXJXcmFwID0gZmFsc2U7IH1cbiAgICAgICAgdmFyIGxpbmUgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXIubGluZXMuZ2V0KHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55YmFzZSArIHkpO1xuICAgICAgICBsaW5lLnJlcGxhY2VDZWxscyhzdGFydCwgZW5kLCB0aGlzLl90ZXJtaW5hbC5idWZmZXIuZ2V0TnVsbENlbGwodGhpcy5fdGVybWluYWwuZXJhc2VBdHRyRGF0YSgpKSk7XG4gICAgICAgIGlmIChjbGVhcldyYXApIHtcbiAgICAgICAgICAgIGxpbmUuaXNXcmFwcGVkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuX3Jlc2V0QnVmZmVyTGluZSA9IGZ1bmN0aW9uICh5KSB7XG4gICAgICAgIHRoaXMuX2VyYXNlSW5CdWZmZXJMaW5lKHksIDAsIHRoaXMuX3Rlcm1pbmFsLmNvbHMsIHRydWUpO1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5lcmFzZUluRGlzcGxheSA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdmFyIGo7XG4gICAgICAgIHN3aXRjaCAocGFyYW1zWzBdKSB7XG4gICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgaiA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55O1xuICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnVwZGF0ZVJhbmdlKGopO1xuICAgICAgICAgICAgICAgIHRoaXMuX2VyYXNlSW5CdWZmZXJMaW5lKGorKywgdGhpcy5fdGVybWluYWwuYnVmZmVyLngsIHRoaXMuX3Rlcm1pbmFsLmNvbHMsIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID09PSAwKTtcbiAgICAgICAgICAgICAgICBmb3IgKDsgaiA8IHRoaXMuX3Rlcm1pbmFsLnJvd3M7IGorKykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXNldEJ1ZmZlckxpbmUoaik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnVwZGF0ZVJhbmdlKGopO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgIGogPSB0aGlzLl90ZXJtaW5hbC5idWZmZXIueTtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC51cGRhdGVSYW5nZShqKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9lcmFzZUluQnVmZmVyTGluZShqLCAwLCB0aGlzLl90ZXJtaW5hbC5idWZmZXIueCArIDEsIHRydWUpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5idWZmZXIueCArIDEgPj0gdGhpcy5fdGVybWluYWwuY29scykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIubGluZXMuZ2V0KGogKyAxKS5pc1dyYXBwZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgd2hpbGUgKGotLSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9yZXNldEJ1ZmZlckxpbmUoaik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnVwZGF0ZVJhbmdlKDApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgIGogPSB0aGlzLl90ZXJtaW5hbC5yb3dzO1xuICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnVwZGF0ZVJhbmdlKGogLSAxKTtcbiAgICAgICAgICAgICAgICB3aGlsZSAoai0tKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc2V0QnVmZmVyTGluZShqKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwudXBkYXRlUmFuZ2UoMCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgdmFyIHNjcm9sbEJhY2tTaXplID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLmxpbmVzLmxlbmd0aCAtIHRoaXMuX3Rlcm1pbmFsLnJvd3M7XG4gICAgICAgICAgICAgICAgaWYgKHNjcm9sbEJhY2tTaXplID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIubGluZXMudHJpbVN0YXJ0KHNjcm9sbEJhY2tTaXplKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnliYXNlID0gTWF0aC5tYXgodGhpcy5fdGVybWluYWwuYnVmZmVyLnliYXNlIC0gc2Nyb2xsQmFja1NpemUsIDApO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueWRpc3AgPSBNYXRoLm1heCh0aGlzLl90ZXJtaW5hbC5idWZmZXIueWRpc3AgLSBzY3JvbGxCYWNrU2l6ZSwgMCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX29uU2Nyb2xsLmZpcmUoMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmVyYXNlSW5MaW5lID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICBzd2l0Y2ggKHBhcmFtc1swXSkge1xuICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgIHRoaXMuX2VyYXNlSW5CdWZmZXJMaW5lKHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55LCB0aGlzLl90ZXJtaW5hbC5idWZmZXIueCwgdGhpcy5fdGVybWluYWwuY29scyk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgdGhpcy5fZXJhc2VJbkJ1ZmZlckxpbmUodGhpcy5fdGVybWluYWwuYnVmZmVyLnksIDAsIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ICsgMSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgdGhpcy5fZXJhc2VJbkJ1ZmZlckxpbmUodGhpcy5fdGVybWluYWwuYnVmZmVyLnksIDAsIHRoaXMuX3Rlcm1pbmFsLmNvbHMpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnVwZGF0ZVJhbmdlKHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55KTtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuaW5zZXJ0TGluZXMgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1swXTtcbiAgICAgICAgaWYgKHBhcmFtIDwgMSkge1xuICAgICAgICAgICAgcGFyYW0gPSAxO1xuICAgICAgICB9XG4gICAgICAgIHZhciBidWZmZXIgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXI7XG4gICAgICAgIHZhciByb3cgPSBidWZmZXIueSArIGJ1ZmZlci55YmFzZTtcbiAgICAgICAgdmFyIHNjcm9sbEJvdHRvbVJvd3NPZmZzZXQgPSB0aGlzLl90ZXJtaW5hbC5yb3dzIC0gMSAtIGJ1ZmZlci5zY3JvbGxCb3R0b207XG4gICAgICAgIHZhciBzY3JvbGxCb3R0b21BYnNvbHV0ZSA9IHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxICsgYnVmZmVyLnliYXNlIC0gc2Nyb2xsQm90dG9tUm93c09mZnNldCArIDE7XG4gICAgICAgIHdoaWxlIChwYXJhbS0tKSB7XG4gICAgICAgICAgICBidWZmZXIubGluZXMuc3BsaWNlKHNjcm9sbEJvdHRvbUFic29sdXRlIC0gMSwgMSk7XG4gICAgICAgICAgICBidWZmZXIubGluZXMuc3BsaWNlKHJvdywgMCwgYnVmZmVyLmdldEJsYW5rTGluZSh0aGlzLl90ZXJtaW5hbC5lcmFzZUF0dHJEYXRhKCkpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl90ZXJtaW5hbC51cGRhdGVSYW5nZShidWZmZXIueSk7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnVwZGF0ZVJhbmdlKGJ1ZmZlci5zY3JvbGxCb3R0b20pO1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5kZWxldGVMaW5lcyA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdmFyIHBhcmFtID0gcGFyYW1zWzBdO1xuICAgICAgICBpZiAocGFyYW0gPCAxKSB7XG4gICAgICAgICAgICBwYXJhbSA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGJ1ZmZlciA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlcjtcbiAgICAgICAgdmFyIHJvdyA9IGJ1ZmZlci55ICsgYnVmZmVyLnliYXNlO1xuICAgICAgICB2YXIgajtcbiAgICAgICAgaiA9IHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxIC0gYnVmZmVyLnNjcm9sbEJvdHRvbTtcbiAgICAgICAgaiA9IHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxICsgYnVmZmVyLnliYXNlIC0gajtcbiAgICAgICAgd2hpbGUgKHBhcmFtLS0pIHtcbiAgICAgICAgICAgIGJ1ZmZlci5saW5lcy5zcGxpY2Uocm93LCAxKTtcbiAgICAgICAgICAgIGJ1ZmZlci5saW5lcy5zcGxpY2UoaiwgMCwgYnVmZmVyLmdldEJsYW5rTGluZSh0aGlzLl90ZXJtaW5hbC5lcmFzZUF0dHJEYXRhKCkpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl90ZXJtaW5hbC51cGRhdGVSYW5nZShidWZmZXIueSk7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnVwZGF0ZVJhbmdlKGJ1ZmZlci5zY3JvbGxCb3R0b20pO1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5kZWxldGVDaGFycyA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLmxpbmVzLmdldCh0aGlzLl90ZXJtaW5hbC5idWZmZXIueSArIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55YmFzZSkuZGVsZXRlQ2VsbHModGhpcy5fdGVybWluYWwuYnVmZmVyLngsIHBhcmFtc1swXSB8fCAxLCB0aGlzLl90ZXJtaW5hbC5idWZmZXIuZ2V0TnVsbENlbGwodGhpcy5fdGVybWluYWwuZXJhc2VBdHRyRGF0YSgpKSk7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnVwZGF0ZVJhbmdlKHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55KTtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuc2Nyb2xsVXAgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1swXSB8fCAxO1xuICAgICAgICB2YXIgYnVmZmVyID0gdGhpcy5fdGVybWluYWwuYnVmZmVyO1xuICAgICAgICB3aGlsZSAocGFyYW0tLSkge1xuICAgICAgICAgICAgYnVmZmVyLmxpbmVzLnNwbGljZShidWZmZXIueWJhc2UgKyBidWZmZXIuc2Nyb2xsVG9wLCAxKTtcbiAgICAgICAgICAgIGJ1ZmZlci5saW5lcy5zcGxpY2UoYnVmZmVyLnliYXNlICsgYnVmZmVyLnNjcm9sbEJvdHRvbSwgMCwgYnVmZmVyLmdldEJsYW5rTGluZShCdWZmZXJMaW5lXzEuREVGQVVMVF9BVFRSX0RBVEEpKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl90ZXJtaW5hbC51cGRhdGVSYW5nZShidWZmZXIuc2Nyb2xsVG9wKTtcbiAgICAgICAgdGhpcy5fdGVybWluYWwudXBkYXRlUmFuZ2UoYnVmZmVyLnNjcm9sbEJvdHRvbSk7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLnNjcm9sbERvd24gPSBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7XG4gICAgICAgIGlmIChwYXJhbXMubGVuZ3RoIDwgMiAmJiAhY29sbGVjdCkge1xuICAgICAgICAgICAgdmFyIHBhcmFtID0gcGFyYW1zWzBdIHx8IDE7XG4gICAgICAgICAgICB2YXIgYnVmZmVyID0gdGhpcy5fdGVybWluYWwuYnVmZmVyO1xuICAgICAgICAgICAgd2hpbGUgKHBhcmFtLS0pIHtcbiAgICAgICAgICAgICAgICBidWZmZXIubGluZXMuc3BsaWNlKGJ1ZmZlci55YmFzZSArIGJ1ZmZlci5zY3JvbGxCb3R0b20sIDEpO1xuICAgICAgICAgICAgICAgIGJ1ZmZlci5saW5lcy5zcGxpY2UoYnVmZmVyLnliYXNlICsgYnVmZmVyLnNjcm9sbFRvcCwgMCwgYnVmZmVyLmdldEJsYW5rTGluZShCdWZmZXJMaW5lXzEuREVGQVVMVF9BVFRSX0RBVEEpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnVwZGF0ZVJhbmdlKGJ1ZmZlci5zY3JvbGxUb3ApO1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwudXBkYXRlUmFuZ2UoYnVmZmVyLnNjcm9sbEJvdHRvbSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuZXJhc2VDaGFycyA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLmxpbmVzLmdldCh0aGlzLl90ZXJtaW5hbC5idWZmZXIueSArIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55YmFzZSkucmVwbGFjZUNlbGxzKHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54LCB0aGlzLl90ZXJtaW5hbC5idWZmZXIueCArIChwYXJhbXNbMF0gfHwgMSksIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5nZXROdWxsQ2VsbCh0aGlzLl90ZXJtaW5hbC5lcmFzZUF0dHJEYXRhKCkpKTtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuY3Vyc29yQmFja3dhcmRUYWIgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1swXSB8fCAxO1xuICAgICAgICB2YXIgYnVmZmVyID0gdGhpcy5fdGVybWluYWwuYnVmZmVyO1xuICAgICAgICB3aGlsZSAocGFyYW0tLSkge1xuICAgICAgICAgICAgYnVmZmVyLnggPSBidWZmZXIucHJldlN0b3AoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5jaGFyUG9zQWJzb2x1dGUgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1swXTtcbiAgICAgICAgaWYgKHBhcmFtIDwgMSkge1xuICAgICAgICAgICAgcGFyYW0gPSAxO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID0gcGFyYW0gLSAxO1xuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuYnVmZmVyLnggPj0gdGhpcy5fdGVybWluYWwuY29scykge1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnggPSB0aGlzLl90ZXJtaW5hbC5jb2xzIC0gMTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5oUG9zaXRpb25SZWxhdGl2ZSA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdmFyIHBhcmFtID0gcGFyYW1zWzBdO1xuICAgICAgICBpZiAocGFyYW0gPCAxKSB7XG4gICAgICAgICAgICBwYXJhbSA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnggKz0gcGFyYW07XG4gICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5idWZmZXIueCA+PSB0aGlzLl90ZXJtaW5hbC5jb2xzKSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueCA9IHRoaXMuX3Rlcm1pbmFsLmNvbHMgLSAxO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLnJlcGVhdFByZWNlZGluZ0NoYXJhY3RlciA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdmFyIGJ1ZmZlciA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlcjtcbiAgICAgICAgdmFyIGxpbmUgPSBidWZmZXIubGluZXMuZ2V0KGJ1ZmZlci55YmFzZSArIGJ1ZmZlci55KTtcbiAgICAgICAgbGluZS5sb2FkQ2VsbChidWZmZXIueCAtIDEsIHRoaXMuX3dvcmtDZWxsKTtcbiAgICAgICAgbGluZS5yZXBsYWNlQ2VsbHMoYnVmZmVyLngsIGJ1ZmZlci54ICsgKHBhcmFtc1swXSB8fCAxKSwgKHRoaXMuX3dvcmtDZWxsLmNvbnRlbnQgIT09IHVuZGVmaW5lZCkgPyB0aGlzLl93b3JrQ2VsbCA6IGJ1ZmZlci5nZXROdWxsQ2VsbChCdWZmZXJMaW5lXzEuREVGQVVMVF9BVFRSX0RBVEEpKTtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuc2VuZERldmljZUF0dHJpYnV0ZXMgPSBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7XG4gICAgICAgIGlmIChwYXJhbXNbMF0gPiAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjb2xsZWN0KSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuaXMoJ3h0ZXJtJykgfHwgdGhpcy5fdGVybWluYWwuaXMoJ3J4dnQtdW5pY29kZScpIHx8IHRoaXMuX3Rlcm1pbmFsLmlzKCdzY3JlZW4nKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmhhbmRsZXIoRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1s/MTsyYycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5fdGVybWluYWwuaXMoJ2xpbnV4JykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5oYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbPzZjJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY29sbGVjdCA9PT0gJz4nKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuaXMoJ3h0ZXJtJykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5oYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbPjA7Mjc2OzBjJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLl90ZXJtaW5hbC5pcygncnh2dC11bmljb2RlJykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5oYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbPjg1Ozk1OzBjJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLl90ZXJtaW5hbC5pcygnbGludXgnKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmhhbmRsZXIocGFyYW1zWzBdICsgJ2MnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuX3Rlcm1pbmFsLmlzKCdzY3JlZW4nKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmhhbmRsZXIoRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1s+ODM7NDAwMDM7MGMnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5saW5lUG9zQWJzb2x1dGUgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1swXTtcbiAgICAgICAgaWYgKHBhcmFtIDwgMSkge1xuICAgICAgICAgICAgcGFyYW0gPSAxO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55ID0gcGFyYW0gLSAxO1xuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuYnVmZmVyLnkgPj0gdGhpcy5fdGVybWluYWwucm93cykge1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnkgPSB0aGlzLl90ZXJtaW5hbC5yb3dzIC0gMTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS52UG9zaXRpb25SZWxhdGl2ZSA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdmFyIHBhcmFtID0gcGFyYW1zWzBdO1xuICAgICAgICBpZiAocGFyYW0gPCAxKSB7XG4gICAgICAgICAgICBwYXJhbSA9IDE7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnkgKz0gcGFyYW07XG4gICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5idWZmZXIueSA+PSB0aGlzLl90ZXJtaW5hbC5yb3dzKSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueSA9IHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5idWZmZXIueCA+PSB0aGlzLl90ZXJtaW5hbC5jb2xzKSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueC0tO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmhWUG9zaXRpb24gPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIGlmIChwYXJhbXNbMF0gPCAxKVxuICAgICAgICAgICAgcGFyYW1zWzBdID0gMTtcbiAgICAgICAgaWYgKHBhcmFtc1sxXSA8IDEpXG4gICAgICAgICAgICBwYXJhbXNbMV0gPSAxO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueSA9IHBhcmFtc1swXSAtIDE7XG4gICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5idWZmZXIueSA+PSB0aGlzLl90ZXJtaW5hbC5yb3dzKSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueSA9IHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID0gcGFyYW1zWzFdIC0gMTtcbiAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID49IHRoaXMuX3Rlcm1pbmFsLmNvbHMpIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID0gdGhpcy5fdGVybWluYWwuY29scyAtIDE7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUudGFiQ2xlYXIgPSBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgIHZhciBwYXJhbSA9IHBhcmFtc1swXTtcbiAgICAgICAgaWYgKHBhcmFtIDw9IDApIHtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl90ZXJtaW5hbC5idWZmZXIudGFic1t0aGlzLl90ZXJtaW5hbC5idWZmZXIueF07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocGFyYW0gPT09IDMpIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci50YWJzID0ge307XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuc2V0TW9kZSA9IGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHtcbiAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhcmFtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0TW9kZShbcGFyYW1zW2ldXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjb2xsZWN0KSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHBhcmFtc1swXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuaW5zZXJ0TW9kZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMjA6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbGxlY3QgPT09ICc/Jykge1xuICAgICAgICAgICAgc3dpdGNoIChwYXJhbXNbMF0pIHtcbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmFwcGxpY2F0aW9uQ3Vyc29yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5zZXRnQ2hhcnNldCgwLCBDaGFyc2V0c18xLkRFRkFVTFRfQ0hBUlNFVCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNldGdDaGFyc2V0KDEsIENoYXJzZXRzXzEuREVGQVVMVF9DSEFSU0VUKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2V0Z0NoYXJzZXQoMiwgQ2hhcnNldHNfMS5ERUZBVUxUX0NIQVJTRVQpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5zZXRnQ2hhcnNldCgzLCBDaGFyc2V0c18xLkRFRkFVTFRfQ0hBUlNFVCk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2F2ZWRDb2xzID0gdGhpcy5fdGVybWluYWwuY29scztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwucmVzaXplKDEzMiwgdGhpcy5fdGVybWluYWwucm93cyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwub3JpZ2luTW9kZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwud3JhcGFyb3VuZE1vZGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDEyOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDY2OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5sb2coJ1NlcmlhbCBwb3J0IHJlcXVlc3RlZCBhcHBsaWNhdGlvbiBrZXlwYWQuJyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmFwcGxpY2F0aW9uS2V5cGFkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLnZpZXdwb3J0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC52aWV3cG9ydC5zeW5jU2Nyb2xsQXJlYSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgOTpcbiAgICAgICAgICAgICAgICBjYXNlIDEwMDA6XG4gICAgICAgICAgICAgICAgY2FzZSAxMDAyOlxuICAgICAgICAgICAgICAgIGNhc2UgMTAwMzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwueDEwTW91c2UgPSBwYXJhbXNbMF0gPT09IDk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnZ0MjAwTW91c2UgPSBwYXJhbXNbMF0gPT09IDEwMDA7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLm5vcm1hbE1vdXNlID0gcGFyYW1zWzBdID4gMTAwMDtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwubW91c2VFdmVudHMgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdlbmFibGUtbW91c2UtZXZlbnRzJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLnNlbGVjdGlvbk1hbmFnZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNlbGVjdGlvbk1hbmFnZXIuZGlzYWJsZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmxvZygnQmluZGluZyB0byBtb3VzZSBldmVudHMuJyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMTAwNDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2VuZEZvY3VzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxMDA1OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC51dGZNb3VzZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMTAwNjpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2dyTW91c2UgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDEwMTU6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnVyeHZ0TW91c2UgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDI1OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5jdXJzb3JIaWRkZW4gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxMDQ4OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmVDdXJzb3IocGFyYW1zKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxMDQ5OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNhdmVDdXJzb3IocGFyYW1zKTtcbiAgICAgICAgICAgICAgICBjYXNlIDQ3OlxuICAgICAgICAgICAgICAgIGNhc2UgMTA0NzpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVycy5hY3RpdmF0ZUFsdEJ1ZmZlcih0aGlzLl90ZXJtaW5hbC5lcmFzZUF0dHJEYXRhKCkpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5yZWZyZXNoKDAsIHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLnZpZXdwb3J0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC52aWV3cG9ydC5zeW5jU2Nyb2xsQXJlYSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNob3dDdXJzb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAyMDA0OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5icmFja2V0ZWRQYXN0ZU1vZGUgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5yZXNldE1vZGUgPSBmdW5jdGlvbiAocGFyYW1zLCBjb2xsZWN0KSB7XG4gICAgICAgIGlmIChwYXJhbXMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYXJhbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLnJlc2V0TW9kZShbcGFyYW1zW2ldXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFjb2xsZWN0KSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHBhcmFtc1swXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuaW5zZXJ0TW9kZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDIwOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjb2xsZWN0ID09PSAnPycpIHtcbiAgICAgICAgICAgIHN3aXRjaCAocGFyYW1zWzBdKSB7XG4gICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5hcHBsaWNhdGlvbkN1cnNvciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5jb2xzID09PSAxMzIgJiYgdGhpcy5fdGVybWluYWwuc2F2ZWRDb2xzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5yZXNpemUodGhpcy5fdGVybWluYWwuc2F2ZWRDb2xzLCB0aGlzLl90ZXJtaW5hbC5yb3dzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fdGVybWluYWwuc2F2ZWRDb2xzO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLm9yaWdpbk1vZGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSA3OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC53cmFwYXJvdW5kTW9kZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDEyOlxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDY2OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5sb2coJ1N3aXRjaGluZyBiYWNrIHRvIG5vcm1hbCBrZXlwYWQuJyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmFwcGxpY2F0aW9uS2V5cGFkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC52aWV3cG9ydCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwudmlld3BvcnQuc3luY1Njcm9sbEFyZWEoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDk6XG4gICAgICAgICAgICAgICAgY2FzZSAxMDAwOlxuICAgICAgICAgICAgICAgIGNhc2UgMTAwMjpcbiAgICAgICAgICAgICAgICBjYXNlIDEwMDM6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLngxME1vdXNlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnZ0MjAwTW91c2UgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwubm9ybWFsTW91c2UgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwubW91c2VFdmVudHMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX3Rlcm1pbmFsLmVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZW5hYmxlLW1vdXNlLWV2ZW50cycpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5zZWxlY3Rpb25NYW5hZ2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5zZWxlY3Rpb25NYW5hZ2VyLmVuYWJsZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMTAwNDpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2VuZEZvY3VzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMTAwNTpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwudXRmTW91c2UgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxMDA2OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5zZ3JNb3VzZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDEwMTU6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnVyeHZ0TW91c2UgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAyNTpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuY3Vyc29ySGlkZGVuID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxMDQ4OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlc3RvcmVDdXJzb3IocGFyYW1zKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxMDQ5OlxuICAgICAgICAgICAgICAgIGNhc2UgNDc6XG4gICAgICAgICAgICAgICAgY2FzZSAxMDQ3OlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXJzLmFjdGl2YXRlTm9ybWFsQnVmZmVyKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXJhbXNbMF0gPT09IDEwNDkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmVzdG9yZUN1cnNvcihwYXJhbXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnJlZnJlc2goMCwgdGhpcy5fdGVybWluYWwucm93cyAtIDEpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fdGVybWluYWwudmlld3BvcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnZpZXdwb3J0LnN5bmNTY3JvbGxBcmVhKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2hvd0N1cnNvcigpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDIwMDQ6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJyYWNrZXRlZFBhc3RlTW9kZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5jaGFyQXR0cmlidXRlcyA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgaWYgKHBhcmFtcy5sZW5ndGggPT09IDEgJiYgcGFyYW1zWzBdID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5jdXJBdHRyRGF0YS5mZyA9IEJ1ZmZlckxpbmVfMS5ERUZBVUxUX0FUVFJfREFUQS5mZztcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmN1ckF0dHJEYXRhLmJnID0gQnVmZmVyTGluZV8xLkRFRkFVTFRfQVRUUl9EQVRBLmJnO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBsID0gcGFyYW1zLmxlbmd0aDtcbiAgICAgICAgdmFyIHA7XG4gICAgICAgIHZhciBhdHRyID0gdGhpcy5fdGVybWluYWwuY3VyQXR0ckRhdGE7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICBwID0gcGFyYW1zW2ldO1xuICAgICAgICAgICAgaWYgKHAgPj0gMzAgJiYgcCA8PSAzNykge1xuICAgICAgICAgICAgICAgIGF0dHIuZmcgJj0gfig1MDMzMTY0OCB8IDI1NSk7XG4gICAgICAgICAgICAgICAgYXR0ci5mZyB8PSAxNjc3NzIxNiB8IChwIC0gMzApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocCA+PSA0MCAmJiBwIDw9IDQ3KSB7XG4gICAgICAgICAgICAgICAgYXR0ci5iZyAmPSB+KDUwMzMxNjQ4IHwgMjU1KTtcbiAgICAgICAgICAgICAgICBhdHRyLmJnIHw9IDE2Nzc3MjE2IHwgKHAgLSA0MCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwID49IDkwICYmIHAgPD0gOTcpIHtcbiAgICAgICAgICAgICAgICBhdHRyLmZnICY9IH4oNTAzMzE2NDggfCAyNTUpO1xuICAgICAgICAgICAgICAgIGF0dHIuZmcgfD0gMTY3NzcyMTYgfCAocCAtIDkwKSB8IDg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwID49IDEwMCAmJiBwIDw9IDEwNykge1xuICAgICAgICAgICAgICAgIGF0dHIuYmcgJj0gfig1MDMzMTY0OCB8IDI1NSk7XG4gICAgICAgICAgICAgICAgYXR0ci5iZyB8PSAxNjc3NzIxNiB8IChwIC0gMTAwKSB8IDg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwID09PSAwKSB7XG4gICAgICAgICAgICAgICAgYXR0ci5mZyA9IEJ1ZmZlckxpbmVfMS5ERUZBVUxUX0FUVFJfREFUQS5mZztcbiAgICAgICAgICAgICAgICBhdHRyLmJnID0gQnVmZmVyTGluZV8xLkRFRkFVTFRfQVRUUl9EQVRBLmJnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIGF0dHIuZmcgfD0gMTM0MjE3NzI4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocCA9PT0gMykge1xuICAgICAgICAgICAgICAgIGF0dHIuYmcgfD0gNjcxMDg4NjQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwID09PSA0KSB7XG4gICAgICAgICAgICAgICAgYXR0ci5mZyB8PSAyNjg0MzU0NTY7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwID09PSA1KSB7XG4gICAgICAgICAgICAgICAgYXR0ci5mZyB8PSA1MzY4NzA5MTI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwID09PSA3KSB7XG4gICAgICAgICAgICAgICAgYXR0ci5mZyB8PSA2NzEwODg2NDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHAgPT09IDgpIHtcbiAgICAgICAgICAgICAgICBhdHRyLmZnIHw9IDEwNzM3NDE4MjQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwID09PSAyKSB7XG4gICAgICAgICAgICAgICAgYXR0ci5iZyB8PSAxMzQyMTc3Mjg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwID09PSAyMikge1xuICAgICAgICAgICAgICAgIGF0dHIuZmcgJj0gfjEzNDIxNzcyODtcbiAgICAgICAgICAgICAgICBhdHRyLmJnICY9IH4xMzQyMTc3Mjg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwID09PSAyMykge1xuICAgICAgICAgICAgICAgIGF0dHIuYmcgJj0gfjY3MTA4ODY0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocCA9PT0gMjQpIHtcbiAgICAgICAgICAgICAgICBhdHRyLmZnICY9IH4yNjg0MzU0NTY7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwID09PSAyNSkge1xuICAgICAgICAgICAgICAgIGF0dHIuZmcgJj0gfjUzNjg3MDkxMjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHAgPT09IDI3KSB7XG4gICAgICAgICAgICAgICAgYXR0ci5mZyAmPSB+NjcxMDg4NjQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwID09PSAyOCkge1xuICAgICAgICAgICAgICAgIGF0dHIuZmcgJj0gfjEwNzM3NDE4MjQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwID09PSAzOSkge1xuICAgICAgICAgICAgICAgIGF0dHIuZmcgJj0gfig1MDMzMTY0OCB8IDE2Nzc3MjE1KTtcbiAgICAgICAgICAgICAgICBhdHRyLmZnIHw9IEJ1ZmZlckxpbmVfMS5ERUZBVUxUX0FUVFJfREFUQS5mZyAmICgyNTUgfCAxNjc3NzIxNSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwID09PSA0OSkge1xuICAgICAgICAgICAgICAgIGF0dHIuYmcgJj0gfig1MDMzMTY0OCB8IDE2Nzc3MjE1KTtcbiAgICAgICAgICAgICAgICBhdHRyLmJnIHw9IEJ1ZmZlckxpbmVfMS5ERUZBVUxUX0FUVFJfREFUQS5iZyAmICgyNTUgfCAxNjc3NzIxNSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwID09PSAzOCkge1xuICAgICAgICAgICAgICAgIGlmIChwYXJhbXNbaSArIDFdID09PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgIGkgKz0gMjtcbiAgICAgICAgICAgICAgICAgICAgYXR0ci5mZyB8PSA1MDMzMTY0ODtcbiAgICAgICAgICAgICAgICAgICAgYXR0ci5mZyAmPSB+MTY3NzcyMTU7XG4gICAgICAgICAgICAgICAgICAgIGF0dHIuZmcgfD0gQnVmZmVyTGluZV8xLkF0dHJpYnV0ZURhdGEuZnJvbUNvbG9yUkdCKFtwYXJhbXNbaV0sIHBhcmFtc1tpICsgMV0sIHBhcmFtc1tpICsgMl1dKTtcbiAgICAgICAgICAgICAgICAgICAgaSArPSAyO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChwYXJhbXNbaSArIDFdID09PSA1KSB7XG4gICAgICAgICAgICAgICAgICAgIGkgKz0gMjtcbiAgICAgICAgICAgICAgICAgICAgcCA9IHBhcmFtc1tpXSAmIDB4ZmY7XG4gICAgICAgICAgICAgICAgICAgIGF0dHIuZmcgJj0gfjI1NTtcbiAgICAgICAgICAgICAgICAgICAgYXR0ci5mZyB8PSAzMzU1NDQzMiB8IHA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAocCA9PT0gNDgpIHtcbiAgICAgICAgICAgICAgICBpZiAocGFyYW1zW2kgKyAxXSA9PT0gMikge1xuICAgICAgICAgICAgICAgICAgICBpICs9IDI7XG4gICAgICAgICAgICAgICAgICAgIGF0dHIuYmcgfD0gNTAzMzE2NDg7XG4gICAgICAgICAgICAgICAgICAgIGF0dHIuYmcgJj0gfjE2Nzc3MjE1O1xuICAgICAgICAgICAgICAgICAgICBhdHRyLmJnIHw9IEJ1ZmZlckxpbmVfMS5BdHRyaWJ1dGVEYXRhLmZyb21Db2xvclJHQihbcGFyYW1zW2ldLCBwYXJhbXNbaSArIDFdLCBwYXJhbXNbaSArIDJdXSk7XG4gICAgICAgICAgICAgICAgICAgIGkgKz0gMjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocGFyYW1zW2kgKyAxXSA9PT0gNSkge1xuICAgICAgICAgICAgICAgICAgICBpICs9IDI7XG4gICAgICAgICAgICAgICAgICAgIHAgPSBwYXJhbXNbaV0gJiAweGZmO1xuICAgICAgICAgICAgICAgICAgICBhdHRyLmJnICY9IH4yNTU7XG4gICAgICAgICAgICAgICAgICAgIGF0dHIuYmcgfD0gMzM1NTQ0MzIgfCBwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHAgPT09IDEwMCkge1xuICAgICAgICAgICAgICAgIGF0dHIuZmcgJj0gfig1MDMzMTY0OCB8IDE2Nzc3MjE1KTtcbiAgICAgICAgICAgICAgICBhdHRyLmZnIHw9IEJ1ZmZlckxpbmVfMS5ERUZBVUxUX0FUVFJfREFUQS5mZyAmICgyNTUgfCAxNjc3NzIxNSk7XG4gICAgICAgICAgICAgICAgYXR0ci5iZyAmPSB+KDUwMzMxNjQ4IHwgMTY3NzcyMTUpO1xuICAgICAgICAgICAgICAgIGF0dHIuYmcgfD0gQnVmZmVyTGluZV8xLkRFRkFVTFRfQVRUUl9EQVRBLmJnICYgKDI1NSB8IDE2Nzc3MjE1KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmVycm9yKCdVbmtub3duIFNHUiBhdHRyaWJ1dGU6ICVkLicsIHApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmRldmljZVN0YXR1cyA9IGZ1bmN0aW9uIChwYXJhbXMsIGNvbGxlY3QpIHtcbiAgICAgICAgaWYgKCFjb2xsZWN0KSB7XG4gICAgICAgICAgICBzd2l0Y2ggKHBhcmFtc1swXSkge1xuICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb25EYXRhLmZpcmUoRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgXCJbMG5cIik7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNjpcbiAgICAgICAgICAgICAgICAgICAgdmFyIHkgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXIueSArIDE7XG4gICAgICAgICAgICAgICAgICAgIHZhciB4ID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLnggKyAxO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9vbkRhdGEuZmlyZShFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyBcIltcIiArIHkgKyBcIjtcIiArIHggKyBcIlJcIik7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNvbGxlY3QgPT09ICc/Jykge1xuICAgICAgICAgICAgc3dpdGNoIChwYXJhbXNbMF0pIHtcbiAgICAgICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgICAgIHZhciB5ID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLnkgKyAxO1xuICAgICAgICAgICAgICAgICAgICB2YXIgeCA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ICsgMTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fb25EYXRhLmZpcmUoRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgXCJbP1wiICsgeSArIFwiO1wiICsgeCArIFwiUlwiKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAxNTpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAyNTpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAyNjpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSA1MzpcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuc29mdFJlc2V0ID0gZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkge1xuICAgICAgICBpZiAoY29sbGVjdCA9PT0gJyEnKSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5jdXJzb3JIaWRkZW4gPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmluc2VydE1vZGUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLm9yaWdpbk1vZGUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLndyYXBhcm91bmRNb2RlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmFwcGxpY2F0aW9uS2V5cGFkID0gZmFsc2U7XG4gICAgICAgICAgICBpZiAodGhpcy5fdGVybWluYWwudmlld3BvcnQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC52aWV3cG9ydC5zeW5jU2Nyb2xsQXJlYSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuYXBwbGljYXRpb25DdXJzb3IgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5zY3JvbGxUb3AgPSAwO1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnNjcm9sbEJvdHRvbSA9IHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxO1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuY3VyQXR0ckRhdGEgPSBCdWZmZXJMaW5lXzEuREVGQVVMVF9BVFRSX0RBVEE7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIueCA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55ID0gMDtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmNoYXJzZXQgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuZ2xldmVsID0gMDtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmNoYXJzZXRzID0gW251bGxdO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLnNldEN1cnNvclN0eWxlID0gZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkge1xuICAgICAgICBpZiAoY29sbGVjdCA9PT0gJyAnKSB7XG4gICAgICAgICAgICB2YXIgcGFyYW0gPSBwYXJhbXNbMF0gPCAxID8gMSA6IHBhcmFtc1swXTtcbiAgICAgICAgICAgIHN3aXRjaCAocGFyYW0pIHtcbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5zZXRPcHRpb24oJ2N1cnNvclN0eWxlJywgJ2Jsb2NrJyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNldE9wdGlvbignY3Vyc29yU3R5bGUnLCAndW5kZXJsaW5lJyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNldE9wdGlvbignY3Vyc29yU3R5bGUnLCAnYmFyJyk7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGlzQmxpbmtpbmcgPSBwYXJhbSAlIDIgPT09IDE7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5zZXRPcHRpb24oJ2N1cnNvckJsaW5rJywgaXNCbGlua2luZyk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuc2V0U2Nyb2xsUmVnaW9uID0gZnVuY3Rpb24gKHBhcmFtcywgY29sbGVjdCkge1xuICAgICAgICBpZiAoY29sbGVjdCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5zY3JvbGxUb3AgPSAocGFyYW1zWzBdIHx8IDEpIC0gMTtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnNjcm9sbEJvdHRvbSA9IChwYXJhbXNbMV0gJiYgcGFyYW1zWzFdIDw9IHRoaXMuX3Rlcm1pbmFsLnJvd3MgPyBwYXJhbXNbMV0gOiB0aGlzLl90ZXJtaW5hbC5yb3dzKSAtIDE7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci54ID0gMDtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnkgPSAwO1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5zYXZlQ3Vyc29yID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5idWZmZXIuc2F2ZWRYID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLng7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5zYXZlZFkgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXIueTtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnNhdmVkQ3VyQXR0ckRhdGEuZmcgPSB0aGlzLl90ZXJtaW5hbC5jdXJBdHRyRGF0YS5mZztcbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnNhdmVkQ3VyQXR0ckRhdGEuYmcgPSB0aGlzLl90ZXJtaW5hbC5jdXJBdHRyRGF0YS5iZztcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUucmVzdG9yZUN1cnNvciA9IGZ1bmN0aW9uIChwYXJhbXMpIHtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnggPSB0aGlzLl90ZXJtaW5hbC5idWZmZXIuc2F2ZWRYIHx8IDA7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55ID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLnNhdmVkWSB8fCAwO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5jdXJBdHRyRGF0YS5mZyA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5zYXZlZEN1ckF0dHJEYXRhLmZnO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5jdXJBdHRyRGF0YS5iZyA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5zYXZlZEN1ckF0dHJEYXRhLmJnO1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5zZXRUaXRsZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmhhbmRsZVRpdGxlKGRhdGEpO1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5uZXh0TGluZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVyLnggPSAwO1xuICAgICAgICB0aGlzLmluZGV4KCk7XG4gICAgfTtcbiAgICBJbnB1dEhhbmRsZXIucHJvdG90eXBlLmtleXBhZEFwcGxpY2F0aW9uTW9kZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fdGVybWluYWwubG9nKCdTZXJpYWwgcG9ydCByZXF1ZXN0ZWQgYXBwbGljYXRpb24ga2V5cGFkLicpO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5hcHBsaWNhdGlvbktleXBhZCA9IHRydWU7XG4gICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC52aWV3cG9ydCkge1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwudmlld3BvcnQuc3luY1Njcm9sbEFyZWEoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5rZXlwYWROdW1lcmljTW9kZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fdGVybWluYWwubG9nKCdTd2l0Y2hpbmcgYmFjayB0byBub3JtYWwga2V5cGFkLicpO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5hcHBsaWNhdGlvbktleXBhZCA9IGZhbHNlO1xuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwudmlld3BvcnQpIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnZpZXdwb3J0LnN5bmNTY3JvbGxBcmVhKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUuc2VsZWN0RGVmYXVsdENoYXJzZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNldGdMZXZlbCgwKTtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuc2V0Z0NoYXJzZXQoMCwgQ2hhcnNldHNfMS5ERUZBVUxUX0NIQVJTRVQpO1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5zZWxlY3RDaGFyc2V0ID0gZnVuY3Rpb24gKGNvbGxlY3RBbmRGbGFnKSB7XG4gICAgICAgIGlmIChjb2xsZWN0QW5kRmxhZy5sZW5ndGggIT09IDIpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0RGVmYXVsdENoYXJzZXQoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29sbGVjdEFuZEZsYWdbMF0gPT09ICcvJykge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNldGdDaGFyc2V0KEdMRVZFTFtjb2xsZWN0QW5kRmxhZ1swXV0sIENoYXJzZXRzXzEuQ0hBUlNFVFNbY29sbGVjdEFuZEZsYWdbMV1dIHx8IENoYXJzZXRzXzEuREVGQVVMVF9DSEFSU0VUKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5pbmRleCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuaW5kZXgoKTtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUudGFiU2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC50YWJTZXQoKTtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUucmV2ZXJzZUluZGV4ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5yZXZlcnNlSW5kZXgoKTtcbiAgICB9O1xuICAgIElucHV0SGFuZGxlci5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3BhcnNlci5yZXNldCgpO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5yZXNldCgpO1xuICAgIH07XG4gICAgSW5wdXRIYW5kbGVyLnByb3RvdHlwZS5zZXRnTGV2ZWwgPSBmdW5jdGlvbiAobGV2ZWwpIHtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuc2V0Z0xldmVsKGxldmVsKTtcbiAgICB9O1xuICAgIHJldHVybiBJbnB1dEhhbmRsZXI7XG59KExpZmVjeWNsZV8xLkRpc3Bvc2FibGUpKTtcbmV4cG9ydHMuSW5wdXRIYW5kbGVyID0gSW5wdXRIYW5kbGVyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9SW5wdXRIYW5kbGVyLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIE1vdXNlWm9uZU1hbmFnZXJfMSA9IHJlcXVpcmUoXCIuL01vdXNlWm9uZU1hbmFnZXJcIik7XG52YXIgQ2hhcldpZHRoXzEgPSByZXF1aXJlKFwiLi9DaGFyV2lkdGhcIik7XG52YXIgRXZlbnRFbWl0dGVyMl8xID0gcmVxdWlyZShcIi4vY29tbW9uL0V2ZW50RW1pdHRlcjJcIik7XG52YXIgTGlua2lmaWVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBMaW5raWZpZXIoX3Rlcm1pbmFsKSB7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsID0gX3Rlcm1pbmFsO1xuICAgICAgICB0aGlzLl9saW5rTWF0Y2hlcnMgPSBbXTtcbiAgICAgICAgdGhpcy5fbmV4dExpbmtNYXRjaGVySWQgPSAwO1xuICAgICAgICB0aGlzLl9vbkxpbmtIb3ZlciA9IG5ldyBFdmVudEVtaXR0ZXIyXzEuRXZlbnRFbWl0dGVyMigpO1xuICAgICAgICB0aGlzLl9vbkxpbmtMZWF2ZSA9IG5ldyBFdmVudEVtaXR0ZXIyXzEuRXZlbnRFbWl0dGVyMigpO1xuICAgICAgICB0aGlzLl9vbkxpbmtUb29sdGlwID0gbmV3IEV2ZW50RW1pdHRlcjJfMS5FdmVudEVtaXR0ZXIyKCk7XG4gICAgICAgIHRoaXMuX3Jvd3NUb0xpbmtpZnkgPSB7XG4gICAgICAgICAgICBzdGFydDogbnVsbCxcbiAgICAgICAgICAgIGVuZDogbnVsbFxuICAgICAgICB9O1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTGlua2lmaWVyLnByb3RvdHlwZSwgXCJvbkxpbmtIb3ZlclwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fb25MaW5rSG92ZXIuZXZlbnQ7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShMaW5raWZpZXIucHJvdG90eXBlLCBcIm9uTGlua0xlYXZlXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9vbkxpbmtMZWF2ZS5ldmVudDsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KExpbmtpZmllci5wcm90b3R5cGUsIFwib25MaW5rVG9vbHRpcFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fb25MaW5rVG9vbHRpcC5ldmVudDsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgTGlua2lmaWVyLnByb3RvdHlwZS5hdHRhY2hUb0RvbSA9IGZ1bmN0aW9uIChtb3VzZVpvbmVNYW5hZ2VyKSB7XG4gICAgICAgIHRoaXMuX21vdXNlWm9uZU1hbmFnZXIgPSBtb3VzZVpvbmVNYW5hZ2VyO1xuICAgIH07XG4gICAgTGlua2lmaWVyLnByb3RvdHlwZS5saW5raWZ5Um93cyA9IGZ1bmN0aW9uIChzdGFydCwgZW5kKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICghdGhpcy5fbW91c2Vab25lTWFuYWdlcikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9yb3dzVG9MaW5raWZ5LnN0YXJ0ID09PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLl9yb3dzVG9MaW5raWZ5LnN0YXJ0ID0gc3RhcnQ7XG4gICAgICAgICAgICB0aGlzLl9yb3dzVG9MaW5raWZ5LmVuZCA9IGVuZDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3Jvd3NUb0xpbmtpZnkuc3RhcnQgPSBNYXRoLm1pbih0aGlzLl9yb3dzVG9MaW5raWZ5LnN0YXJ0LCBzdGFydCk7XG4gICAgICAgICAgICB0aGlzLl9yb3dzVG9MaW5raWZ5LmVuZCA9IE1hdGgubWF4KHRoaXMuX3Jvd3NUb0xpbmtpZnkuZW5kLCBlbmQpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX21vdXNlWm9uZU1hbmFnZXIuY2xlYXJBbGwoc3RhcnQsIGVuZCk7XG4gICAgICAgIGlmICh0aGlzLl9yb3dzVGltZW91dElkKSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5fcm93c1RpbWVvdXRJZCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fcm93c1RpbWVvdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX2xpbmtpZnlSb3dzKCk7IH0sIExpbmtpZmllci5USU1FX0JFRk9SRV9MSU5LSUZZKTtcbiAgICB9O1xuICAgIExpbmtpZmllci5wcm90b3R5cGUuX2xpbmtpZnlSb3dzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9yb3dzVGltZW91dElkID0gbnVsbDtcbiAgICAgICAgdmFyIGJ1ZmZlciA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlcjtcbiAgICAgICAgdmFyIGFic29sdXRlUm93SW5kZXhTdGFydCA9IGJ1ZmZlci55ZGlzcCArIHRoaXMuX3Jvd3NUb0xpbmtpZnkuc3RhcnQ7XG4gICAgICAgIGlmIChhYnNvbHV0ZVJvd0luZGV4U3RhcnQgPj0gYnVmZmVyLmxpbmVzLmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBhYnNvbHV0ZVJvd0luZGV4RW5kID0gYnVmZmVyLnlkaXNwICsgTWF0aC5taW4odGhpcy5fcm93c1RvTGlua2lmeS5lbmQsIHRoaXMuX3Rlcm1pbmFsLnJvd3MpICsgMTtcbiAgICAgICAgdmFyIG92ZXJzY2FuTGluZUxpbWl0ID0gTWF0aC5jZWlsKExpbmtpZmllci5PVkVSU0NBTl9DSEFSX0xJTUlUIC8gdGhpcy5fdGVybWluYWwuY29scyk7XG4gICAgICAgIHZhciBpdGVyYXRvciA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5pdGVyYXRvcihmYWxzZSwgYWJzb2x1dGVSb3dJbmRleFN0YXJ0LCBhYnNvbHV0ZVJvd0luZGV4RW5kLCBvdmVyc2NhbkxpbmVMaW1pdCwgb3ZlcnNjYW5MaW5lTGltaXQpO1xuICAgICAgICB3aGlsZSAoaXRlcmF0b3IuaGFzTmV4dCgpKSB7XG4gICAgICAgICAgICB2YXIgbGluZURhdGEgPSBpdGVyYXRvci5uZXh0KCk7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX2xpbmtNYXRjaGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMuX2RvTGlua2lmeVJvdyhsaW5lRGF0YS5yYW5nZS5maXJzdCwgbGluZURhdGEuY29udGVudCwgdGhpcy5fbGlua01hdGNoZXJzW2ldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9yb3dzVG9MaW5raWZ5LnN0YXJ0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5fcm93c1RvTGlua2lmeS5lbmQgPSBudWxsO1xuICAgIH07XG4gICAgTGlua2lmaWVyLnByb3RvdHlwZS5yZWdpc3RlckxpbmtNYXRjaGVyID0gZnVuY3Rpb24gKHJlZ2V4LCBoYW5kbGVyLCBvcHRpb25zKSB7XG4gICAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsgb3B0aW9ucyA9IHt9OyB9XG4gICAgICAgIGlmICghaGFuZGxlcikge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdoYW5kbGVyIG11c3QgYmUgZGVmaW5lZCcpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBtYXRjaGVyID0ge1xuICAgICAgICAgICAgaWQ6IHRoaXMuX25leHRMaW5rTWF0Y2hlcklkKyssXG4gICAgICAgICAgICByZWdleDogcmVnZXgsXG4gICAgICAgICAgICBoYW5kbGVyOiBoYW5kbGVyLFxuICAgICAgICAgICAgbWF0Y2hJbmRleDogb3B0aW9ucy5tYXRjaEluZGV4LFxuICAgICAgICAgICAgdmFsaWRhdGlvbkNhbGxiYWNrOiBvcHRpb25zLnZhbGlkYXRpb25DYWxsYmFjayxcbiAgICAgICAgICAgIGhvdmVyVG9vbHRpcENhbGxiYWNrOiBvcHRpb25zLnRvb2x0aXBDYWxsYmFjayxcbiAgICAgICAgICAgIGhvdmVyTGVhdmVDYWxsYmFjazogb3B0aW9ucy5sZWF2ZUNhbGxiYWNrLFxuICAgICAgICAgICAgd2lsbExpbmtBY3RpdmF0ZTogb3B0aW9ucy53aWxsTGlua0FjdGl2YXRlLFxuICAgICAgICAgICAgcHJpb3JpdHk6IG9wdGlvbnMucHJpb3JpdHkgfHwgMFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9hZGRMaW5rTWF0Y2hlclRvTGlzdChtYXRjaGVyKTtcbiAgICAgICAgcmV0dXJuIG1hdGNoZXIuaWQ7XG4gICAgfTtcbiAgICBMaW5raWZpZXIucHJvdG90eXBlLl9hZGRMaW5rTWF0Y2hlclRvTGlzdCA9IGZ1bmN0aW9uIChtYXRjaGVyKSB7XG4gICAgICAgIGlmICh0aGlzLl9saW5rTWF0Y2hlcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLl9saW5rTWF0Y2hlcnMucHVzaChtYXRjaGVyKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5fbGlua01hdGNoZXJzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICBpZiAobWF0Y2hlci5wcmlvcml0eSA8PSB0aGlzLl9saW5rTWF0Y2hlcnNbaV0ucHJpb3JpdHkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9saW5rTWF0Y2hlcnMuc3BsaWNlKGkgKyAxLCAwLCBtYXRjaGVyKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fbGlua01hdGNoZXJzLnNwbGljZSgwLCAwLCBtYXRjaGVyKTtcbiAgICB9O1xuICAgIExpbmtpZmllci5wcm90b3R5cGUuZGVyZWdpc3RlckxpbmtNYXRjaGVyID0gZnVuY3Rpb24gKG1hdGNoZXJJZCkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX2xpbmtNYXRjaGVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2xpbmtNYXRjaGVyc1tpXS5pZCA9PT0gbWF0Y2hlcklkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbGlua01hdGNoZXJzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICBMaW5raWZpZXIucHJvdG90eXBlLl9kb0xpbmtpZnlSb3cgPSBmdW5jdGlvbiAocm93SW5kZXgsIHRleHQsIG1hdGNoZXIpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIHJleCA9IG5ldyBSZWdFeHAobWF0Y2hlci5yZWdleC5zb3VyY2UsIG1hdGNoZXIucmVnZXguZmxhZ3MgKyAnZycpO1xuICAgICAgICB2YXIgbWF0Y2g7XG4gICAgICAgIHZhciBzdHJpbmdJbmRleCA9IC0xO1xuICAgICAgICB2YXIgX2xvb3BfMSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB1cmkgPSBtYXRjaFt0eXBlb2YgbWF0Y2hlci5tYXRjaEluZGV4ICE9PSAnbnVtYmVyJyA/IDAgOiBtYXRjaGVyLm1hdGNoSW5kZXhdO1xuICAgICAgICAgICAgaWYgKCF1cmkpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpc18xLl90ZXJtaW5hbC5kZWJ1Zykge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh7IG1hdGNoOiBtYXRjaCwgbWF0Y2hlcjogbWF0Y2hlciB9KTtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdtYXRjaCBmb3VuZCB3aXRob3V0IGNvcnJlc3BvbmRpbmcgbWF0Y2hJbmRleCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gXCJicmVha1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3RyaW5nSW5kZXggPSB0ZXh0LmluZGV4T2YodXJpLCBzdHJpbmdJbmRleCArIDEpO1xuICAgICAgICAgICAgcmV4Lmxhc3RJbmRleCA9IHN0cmluZ0luZGV4ICsgdXJpLmxlbmd0aDtcbiAgICAgICAgICAgIGlmIChzdHJpbmdJbmRleCA8IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJicmVha1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGJ1ZmZlckluZGV4ID0gdGhpc18xLl90ZXJtaW5hbC5idWZmZXIuc3RyaW5nSW5kZXhUb0J1ZmZlckluZGV4KHJvd0luZGV4LCBzdHJpbmdJbmRleCk7XG4gICAgICAgICAgICBpZiAoYnVmZmVySW5kZXhbMF0gPCAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiYnJlYWtcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBsaW5lID0gdGhpc18xLl90ZXJtaW5hbC5idWZmZXIubGluZXMuZ2V0KGJ1ZmZlckluZGV4WzBdKTtcbiAgICAgICAgICAgIHZhciBhdHRyID0gbGluZS5nZXRGZyhidWZmZXJJbmRleFsxXSk7XG4gICAgICAgICAgICB2YXIgZmc7XG4gICAgICAgICAgICBpZiAoYXR0cikge1xuICAgICAgICAgICAgICAgIGZnID0gKGF0dHIgPj4gOSkgJiAweDFmZjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChtYXRjaGVyLnZhbGlkYXRpb25DYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIG1hdGNoZXIudmFsaWRhdGlvbkNhbGxiYWNrKHVyaSwgZnVuY3Rpb24gKGlzVmFsaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKF90aGlzLl9yb3dzVGltZW91dElkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzVmFsaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLl9hZGRMaW5rKGJ1ZmZlckluZGV4WzFdLCBidWZmZXJJbmRleFswXSAtIF90aGlzLl90ZXJtaW5hbC5idWZmZXIueWRpc3AsIHVyaSwgbWF0Y2hlciwgZmcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzXzEuX2FkZExpbmsoYnVmZmVySW5kZXhbMV0sIGJ1ZmZlckluZGV4WzBdIC0gdGhpc18xLl90ZXJtaW5hbC5idWZmZXIueWRpc3AsIHVyaSwgbWF0Y2hlciwgZmcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB2YXIgdGhpc18xID0gdGhpcztcbiAgICAgICAgd2hpbGUgKChtYXRjaCA9IHJleC5leGVjKHRleHQpKSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdmFyIHN0YXRlXzEgPSBfbG9vcF8xKCk7XG4gICAgICAgICAgICBpZiAoc3RhdGVfMSA9PT0gXCJicmVha1wiKVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBMaW5raWZpZXIucHJvdG90eXBlLl9hZGRMaW5rID0gZnVuY3Rpb24gKHgsIHksIHVyaSwgbWF0Y2hlciwgZmcpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIHdpZHRoID0gQ2hhcldpZHRoXzEuZ2V0U3RyaW5nQ2VsbFdpZHRoKHVyaSk7XG4gICAgICAgIHZhciB4MSA9IHggJSB0aGlzLl90ZXJtaW5hbC5jb2xzO1xuICAgICAgICB2YXIgeTEgPSB5ICsgTWF0aC5mbG9vcih4IC8gdGhpcy5fdGVybWluYWwuY29scyk7XG4gICAgICAgIHZhciB4MiA9ICh4MSArIHdpZHRoKSAlIHRoaXMuX3Rlcm1pbmFsLmNvbHM7XG4gICAgICAgIHZhciB5MiA9IHkxICsgTWF0aC5mbG9vcigoeDEgKyB3aWR0aCkgLyB0aGlzLl90ZXJtaW5hbC5jb2xzKTtcbiAgICAgICAgaWYgKHgyID09PSAwKSB7XG4gICAgICAgICAgICB4MiA9IHRoaXMuX3Rlcm1pbmFsLmNvbHM7XG4gICAgICAgICAgICB5Mi0tO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX21vdXNlWm9uZU1hbmFnZXIuYWRkKG5ldyBNb3VzZVpvbmVNYW5hZ2VyXzEuTW91c2Vab25lKHgxICsgMSwgeTEgKyAxLCB4MiArIDEsIHkyICsgMSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGlmIChtYXRjaGVyLmhhbmRsZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hlci5oYW5kbGVyKGUsIHVyaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB3aW5kb3cub3Blbih1cmksICdfYmxhbmsnKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgX3RoaXMuX29uTGlua0hvdmVyLmZpcmUoX3RoaXMuX2NyZWF0ZUxpbmtIb3ZlckV2ZW50KHgxLCB5MSwgeDIsIHkyLCBmZykpO1xuICAgICAgICAgICAgX3RoaXMuX3Rlcm1pbmFsLmVsZW1lbnQuY2xhc3NMaXN0LmFkZCgneHRlcm0tY3Vyc29yLXBvaW50ZXInKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIF90aGlzLl9vbkxpbmtUb29sdGlwLmZpcmUoX3RoaXMuX2NyZWF0ZUxpbmtIb3ZlckV2ZW50KHgxLCB5MSwgeDIsIHkyLCBmZykpO1xuICAgICAgICAgICAgaWYgKG1hdGNoZXIuaG92ZXJUb29sdGlwQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBtYXRjaGVyLmhvdmVyVG9vbHRpcENhbGxiYWNrKGUsIHVyaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF90aGlzLl9vbkxpbmtMZWF2ZS5maXJlKF90aGlzLl9jcmVhdGVMaW5rSG92ZXJFdmVudCh4MSwgeTEsIHgyLCB5MiwgZmcpKTtcbiAgICAgICAgICAgIF90aGlzLl90ZXJtaW5hbC5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ3h0ZXJtLWN1cnNvci1wb2ludGVyJyk7XG4gICAgICAgICAgICBpZiAobWF0Y2hlci5ob3ZlckxlYXZlQ2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBtYXRjaGVyLmhvdmVyTGVhdmVDYWxsYmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgaWYgKG1hdGNoZXIud2lsbExpbmtBY3RpdmF0ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBtYXRjaGVyLndpbGxMaW5rQWN0aXZhdGUoZSwgdXJpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9KSk7XG4gICAgfTtcbiAgICBMaW5raWZpZXIucHJvdG90eXBlLl9jcmVhdGVMaW5rSG92ZXJFdmVudCA9IGZ1bmN0aW9uICh4MSwgeTEsIHgyLCB5MiwgZmcpIHtcbiAgICAgICAgcmV0dXJuIHsgeDE6IHgxLCB5MTogeTEsIHgyOiB4MiwgeTI6IHkyLCBjb2xzOiB0aGlzLl90ZXJtaW5hbC5jb2xzLCBmZzogZmcgfTtcbiAgICB9O1xuICAgIExpbmtpZmllci5USU1FX0JFRk9SRV9MSU5LSUZZID0gMjAwO1xuICAgIExpbmtpZmllci5PVkVSU0NBTl9DSEFSX0xJTUlUID0gMjAwMDtcbiAgICByZXR1cm4gTGlua2lmaWVyO1xufSgpKTtcbmV4cG9ydHMuTGlua2lmaWVyID0gTGlua2lmaWVyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9TGlua2lmaWVyLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIE1vdXNlSGVscGVyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBNb3VzZUhlbHBlcihfcmVuZGVyZXIpIHtcbiAgICAgICAgdGhpcy5fcmVuZGVyZXIgPSBfcmVuZGVyZXI7XG4gICAgfVxuICAgIE1vdXNlSGVscGVyLnByb3RvdHlwZS5zZXRSZW5kZXJlciA9IGZ1bmN0aW9uIChyZW5kZXJlcikge1xuICAgICAgICB0aGlzLl9yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgIH07XG4gICAgTW91c2VIZWxwZXIuZ2V0Q29vcmRzUmVsYXRpdmVUb0VsZW1lbnQgPSBmdW5jdGlvbiAoZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgdmFyIHJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgICAgICByZXR1cm4gW2V2ZW50LmNsaWVudFggLSByZWN0LmxlZnQsIGV2ZW50LmNsaWVudFkgLSByZWN0LnRvcF07XG4gICAgfTtcbiAgICBNb3VzZUhlbHBlci5wcm90b3R5cGUuZ2V0Q29vcmRzID0gZnVuY3Rpb24gKGV2ZW50LCBlbGVtZW50LCBjaGFyTWVhc3VyZSwgY29sQ291bnQsIHJvd0NvdW50LCBpc1NlbGVjdGlvbikge1xuICAgICAgICBpZiAoIWNoYXJNZWFzdXJlLndpZHRoIHx8ICFjaGFyTWVhc3VyZS5oZWlnaHQpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjb29yZHMgPSBNb3VzZUhlbHBlci5nZXRDb29yZHNSZWxhdGl2ZVRvRWxlbWVudChldmVudCwgZWxlbWVudCk7XG4gICAgICAgIGlmICghY29vcmRzKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb29yZHNbMF0gPSBNYXRoLmNlaWwoKGNvb3Jkc1swXSArIChpc1NlbGVjdGlvbiA/IHRoaXMuX3JlbmRlcmVyLmRpbWVuc2lvbnMuYWN0dWFsQ2VsbFdpZHRoIC8gMiA6IDApKSAvIHRoaXMuX3JlbmRlcmVyLmRpbWVuc2lvbnMuYWN0dWFsQ2VsbFdpZHRoKTtcbiAgICAgICAgY29vcmRzWzFdID0gTWF0aC5jZWlsKGNvb3Jkc1sxXSAvIHRoaXMuX3JlbmRlcmVyLmRpbWVuc2lvbnMuYWN0dWFsQ2VsbEhlaWdodCk7XG4gICAgICAgIGNvb3Jkc1swXSA9IE1hdGgubWluKE1hdGgubWF4KGNvb3Jkc1swXSwgMSksIGNvbENvdW50ICsgKGlzU2VsZWN0aW9uID8gMSA6IDApKTtcbiAgICAgICAgY29vcmRzWzFdID0gTWF0aC5taW4oTWF0aC5tYXgoY29vcmRzWzFdLCAxKSwgcm93Q291bnQpO1xuICAgICAgICByZXR1cm4gY29vcmRzO1xuICAgIH07XG4gICAgTW91c2VIZWxwZXIucHJvdG90eXBlLmdldFJhd0J5dGVDb29yZHMgPSBmdW5jdGlvbiAoZXZlbnQsIGVsZW1lbnQsIGNoYXJNZWFzdXJlLCBjb2xDb3VudCwgcm93Q291bnQpIHtcbiAgICAgICAgdmFyIGNvb3JkcyA9IHRoaXMuZ2V0Q29vcmRzKGV2ZW50LCBlbGVtZW50LCBjaGFyTWVhc3VyZSwgY29sQ291bnQsIHJvd0NvdW50KTtcbiAgICAgICAgdmFyIHggPSBjb29yZHNbMF07XG4gICAgICAgIHZhciB5ID0gY29vcmRzWzFdO1xuICAgICAgICB4ICs9IDMyO1xuICAgICAgICB5ICs9IDMyO1xuICAgICAgICByZXR1cm4geyB4OiB4LCB5OiB5IH07XG4gICAgfTtcbiAgICByZXR1cm4gTW91c2VIZWxwZXI7XG59KCkpO1xuZXhwb3J0cy5Nb3VzZUhlbHBlciA9IE1vdXNlSGVscGVyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9TW91c2VIZWxwZXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBMaWZlY3ljbGVfMSA9IHJlcXVpcmUoXCIuL2NvbW1vbi9MaWZlY3ljbGVcIik7XG52YXIgTGlmZWN5Y2xlXzIgPSByZXF1aXJlKFwiLi91aS9MaWZlY3ljbGVcIik7XG52YXIgSE9WRVJfRFVSQVRJT04gPSA1MDA7XG52YXIgTW91c2Vab25lTWFuYWdlciA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKE1vdXNlWm9uZU1hbmFnZXIsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gTW91c2Vab25lTWFuYWdlcihfdGVybWluYWwpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuX3Rlcm1pbmFsID0gX3Rlcm1pbmFsO1xuICAgICAgICBfdGhpcy5fem9uZXMgPSBbXTtcbiAgICAgICAgX3RoaXMuX2FyZVpvbmVzQWN0aXZlID0gZmFsc2U7XG4gICAgICAgIF90aGlzLl90b29sdGlwVGltZW91dCA9IG51bGw7XG4gICAgICAgIF90aGlzLl9jdXJyZW50Wm9uZSA9IG51bGw7XG4gICAgICAgIF90aGlzLl9sYXN0SG92ZXJDb29yZHMgPSBbbnVsbCwgbnVsbF07XG4gICAgICAgIF90aGlzLnJlZ2lzdGVyKExpZmVjeWNsZV8yLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcihfdGhpcy5fdGVybWluYWwuZWxlbWVudCwgJ21vdXNlZG93bicsIGZ1bmN0aW9uIChlKSB7IHJldHVybiBfdGhpcy5fb25Nb3VzZURvd24oZSk7IH0pKTtcbiAgICAgICAgX3RoaXMuX21vdXNlTW92ZUxpc3RlbmVyID0gZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLl9vbk1vdXNlTW92ZShlKTsgfTtcbiAgICAgICAgX3RoaXMuX21vdXNlTGVhdmVMaXN0ZW5lciA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBfdGhpcy5fb25Nb3VzZUxlYXZlKGUpOyB9O1xuICAgICAgICBfdGhpcy5fY2xpY2tMaXN0ZW5lciA9IGZ1bmN0aW9uIChlKSB7IHJldHVybiBfdGhpcy5fb25DbGljayhlKTsgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBNb3VzZVpvbmVNYW5hZ2VyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmRpc3Bvc2UuY2FsbCh0aGlzKTtcbiAgICAgICAgdGhpcy5fZGVhY3RpdmF0ZSgpO1xuICAgIH07XG4gICAgTW91c2Vab25lTWFuYWdlci5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKHpvbmUpIHtcbiAgICAgICAgdGhpcy5fem9uZXMucHVzaCh6b25lKTtcbiAgICAgICAgaWYgKHRoaXMuX3pvbmVzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgdGhpcy5fYWN0aXZhdGUoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgTW91c2Vab25lTWFuYWdlci5wcm90b3R5cGUuY2xlYXJBbGwgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkge1xuICAgICAgICBpZiAodGhpcy5fem9uZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFlbmQpIHtcbiAgICAgICAgICAgIHN0YXJ0ID0gMDtcbiAgICAgICAgICAgIGVuZCA9IHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxO1xuICAgICAgICB9XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5fem9uZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciB6b25lID0gdGhpcy5fem9uZXNbaV07XG4gICAgICAgICAgICBpZiAoKHpvbmUueTEgPiBzdGFydCAmJiB6b25lLnkxIDw9IGVuZCArIDEpIHx8XG4gICAgICAgICAgICAgICAgKHpvbmUueTIgPiBzdGFydCAmJiB6b25lLnkyIDw9IGVuZCArIDEpIHx8XG4gICAgICAgICAgICAgICAgKHpvbmUueTEgPCBzdGFydCAmJiB6b25lLnkyID4gZW5kICsgMSkpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fY3VycmVudFpvbmUgJiYgdGhpcy5fY3VycmVudFpvbmUgPT09IHpvbmUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY3VycmVudFpvbmUubGVhdmVDYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9jdXJyZW50Wm9uZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX3pvbmVzLnNwbGljZShpLS0sIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl96b25lcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuX2RlYWN0aXZhdGUoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgTW91c2Vab25lTWFuYWdlci5wcm90b3R5cGUuX2FjdGl2YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuX2FyZVpvbmVzQWN0aXZlKSB7XG4gICAgICAgICAgICB0aGlzLl9hcmVab25lc0FjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMuX21vdXNlTW92ZUxpc3RlbmVyKTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsIHRoaXMuX21vdXNlTGVhdmVMaXN0ZW5lcik7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5fY2xpY2tMaXN0ZW5lcik7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIE1vdXNlWm9uZU1hbmFnZXIucHJvdG90eXBlLl9kZWFjdGl2YXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fYXJlWm9uZXNBY3RpdmUpIHtcbiAgICAgICAgICAgIHRoaXMuX2FyZVpvbmVzQWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIHRoaXMuX21vdXNlTW92ZUxpc3RlbmVyKTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLmVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsIHRoaXMuX21vdXNlTGVhdmVMaXN0ZW5lcik7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5fY2xpY2tMaXN0ZW5lcik7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIE1vdXNlWm9uZU1hbmFnZXIucHJvdG90eXBlLl9vbk1vdXNlTW92ZSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmICh0aGlzLl9sYXN0SG92ZXJDb29yZHNbMF0gIT09IGUucGFnZVggfHwgdGhpcy5fbGFzdEhvdmVyQ29vcmRzWzFdICE9PSBlLnBhZ2VZKSB7XG4gICAgICAgICAgICB0aGlzLl9vbkhvdmVyKGUpO1xuICAgICAgICAgICAgdGhpcy5fbGFzdEhvdmVyQ29vcmRzID0gW2UucGFnZVgsIGUucGFnZVldO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBNb3VzZVpvbmVNYW5hZ2VyLnByb3RvdHlwZS5fb25Ib3ZlciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciB6b25lID0gdGhpcy5fZmluZFpvbmVFdmVudEF0KGUpO1xuICAgICAgICBpZiAoem9uZSA9PT0gdGhpcy5fY3VycmVudFpvbmUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fY3VycmVudFpvbmUpIHtcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRab25lLmxlYXZlQ2FsbGJhY2soKTtcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRab25lID0gbnVsbDtcbiAgICAgICAgICAgIGlmICh0aGlzLl90b29sdGlwVGltZW91dCkge1xuICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLl90b29sdGlwVGltZW91dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF6b25lKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fY3VycmVudFpvbmUgPSB6b25lO1xuICAgICAgICBpZiAoem9uZS5ob3ZlckNhbGxiYWNrKSB7XG4gICAgICAgICAgICB6b25lLmhvdmVyQ2FsbGJhY2soZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdG9vbHRpcFRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9vblRvb2x0aXAoZSk7IH0sIEhPVkVSX0RVUkFUSU9OKTtcbiAgICB9O1xuICAgIE1vdXNlWm9uZU1hbmFnZXIucHJvdG90eXBlLl9vblRvb2x0aXAgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB0aGlzLl90b29sdGlwVGltZW91dCA9IG51bGw7XG4gICAgICAgIHZhciB6b25lID0gdGhpcy5fZmluZFpvbmVFdmVudEF0KGUpO1xuICAgICAgICBpZiAoem9uZSAmJiB6b25lLnRvb2x0aXBDYWxsYmFjaykge1xuICAgICAgICAgICAgem9uZS50b29sdGlwQ2FsbGJhY2soZSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIE1vdXNlWm9uZU1hbmFnZXIucHJvdG90eXBlLl9vbk1vdXNlRG93biA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHRoaXMuX2luaXRpYWxTZWxlY3Rpb25MZW5ndGggPSB0aGlzLl90ZXJtaW5hbC5nZXRTZWxlY3Rpb24oKS5sZW5ndGg7XG4gICAgICAgIGlmICghdGhpcy5fYXJlWm9uZXNBY3RpdmUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgem9uZSA9IHRoaXMuX2ZpbmRab25lRXZlbnRBdChlKTtcbiAgICAgICAgaWYgKHpvbmUpIHtcbiAgICAgICAgICAgIGlmICh6b25lLndpbGxMaW5rQWN0aXZhdGUoZSkpIHtcbiAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgTW91c2Vab25lTWFuYWdlci5wcm90b3R5cGUuX29uTW91c2VMZWF2ZSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmICh0aGlzLl9jdXJyZW50Wm9uZSkge1xuICAgICAgICAgICAgdGhpcy5fY3VycmVudFpvbmUubGVhdmVDYWxsYmFjaygpO1xuICAgICAgICAgICAgdGhpcy5fY3VycmVudFpvbmUgPSBudWxsO1xuICAgICAgICAgICAgaWYgKHRoaXMuX3Rvb2x0aXBUaW1lb3V0KSB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX3Rvb2x0aXBUaW1lb3V0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgTW91c2Vab25lTWFuYWdlci5wcm90b3R5cGUuX29uQ2xpY2sgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgem9uZSA9IHRoaXMuX2ZpbmRab25lRXZlbnRBdChlKTtcbiAgICAgICAgdmFyIGN1cnJlbnRTZWxlY3Rpb25MZW5ndGggPSB0aGlzLl90ZXJtaW5hbC5nZXRTZWxlY3Rpb24oKS5sZW5ndGg7XG4gICAgICAgIGlmICh6b25lICYmIGN1cnJlbnRTZWxlY3Rpb25MZW5ndGggPT09IHRoaXMuX2luaXRpYWxTZWxlY3Rpb25MZW5ndGgpIHtcbiAgICAgICAgICAgIHpvbmUuY2xpY2tDYWxsYmFjayhlKTtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIE1vdXNlWm9uZU1hbmFnZXIucHJvdG90eXBlLl9maW5kWm9uZUV2ZW50QXQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgY29vcmRzID0gdGhpcy5fdGVybWluYWwubW91c2VIZWxwZXIuZ2V0Q29vcmRzKGUsIHRoaXMuX3Rlcm1pbmFsLnNjcmVlbkVsZW1lbnQsIHRoaXMuX3Rlcm1pbmFsLmNoYXJNZWFzdXJlLCB0aGlzLl90ZXJtaW5hbC5jb2xzLCB0aGlzLl90ZXJtaW5hbC5yb3dzKTtcbiAgICAgICAgaWYgKCFjb29yZHMpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHZhciB4ID0gY29vcmRzWzBdO1xuICAgICAgICB2YXIgeSA9IGNvb3Jkc1sxXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLl96b25lcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIHpvbmUgPSB0aGlzLl96b25lc1tpXTtcbiAgICAgICAgICAgIGlmICh6b25lLnkxID09PSB6b25lLnkyKSB7XG4gICAgICAgICAgICAgICAgaWYgKHkgPT09IHpvbmUueTEgJiYgeCA+PSB6b25lLngxICYmIHggPCB6b25lLngyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB6b25lO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICgoeSA9PT0gem9uZS55MSAmJiB4ID49IHpvbmUueDEpIHx8XG4gICAgICAgICAgICAgICAgICAgICh5ID09PSB6b25lLnkyICYmIHggPCB6b25lLngyKSB8fFxuICAgICAgICAgICAgICAgICAgICAoeSA+IHpvbmUueTEgJiYgeSA8IHpvbmUueTIpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB6b25lO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xuICAgIHJldHVybiBNb3VzZVpvbmVNYW5hZ2VyO1xufShMaWZlY3ljbGVfMS5EaXNwb3NhYmxlKSk7XG5leHBvcnRzLk1vdXNlWm9uZU1hbmFnZXIgPSBNb3VzZVpvbmVNYW5hZ2VyO1xudmFyIE1vdXNlWm9uZSA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gTW91c2Vab25lKHgxLCB5MSwgeDIsIHkyLCBjbGlja0NhbGxiYWNrLCBob3ZlckNhbGxiYWNrLCB0b29sdGlwQ2FsbGJhY2ssIGxlYXZlQ2FsbGJhY2ssIHdpbGxMaW5rQWN0aXZhdGUpIHtcbiAgICAgICAgdGhpcy54MSA9IHgxO1xuICAgICAgICB0aGlzLnkxID0geTE7XG4gICAgICAgIHRoaXMueDIgPSB4MjtcbiAgICAgICAgdGhpcy55MiA9IHkyO1xuICAgICAgICB0aGlzLmNsaWNrQ2FsbGJhY2sgPSBjbGlja0NhbGxiYWNrO1xuICAgICAgICB0aGlzLmhvdmVyQ2FsbGJhY2sgPSBob3ZlckNhbGxiYWNrO1xuICAgICAgICB0aGlzLnRvb2x0aXBDYWxsYmFjayA9IHRvb2x0aXBDYWxsYmFjaztcbiAgICAgICAgdGhpcy5sZWF2ZUNhbGxiYWNrID0gbGVhdmVDYWxsYmFjaztcbiAgICAgICAgdGhpcy53aWxsTGlua0FjdGl2YXRlID0gd2lsbExpbmtBY3RpdmF0ZTtcbiAgICB9XG4gICAgcmV0dXJuIE1vdXNlWm9uZTtcbn0oKSk7XG5leHBvcnRzLk1vdXNlWm9uZSA9IE1vdXNlWm9uZTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPU1vdXNlWm9uZU1hbmFnZXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgTW91c2VIZWxwZXJfMSA9IHJlcXVpcmUoXCIuL01vdXNlSGVscGVyXCIpO1xudmFyIEJyb3dzZXIgPSByZXF1aXJlKFwiLi9jb21tb24vUGxhdGZvcm1cIik7XG52YXIgU2VsZWN0aW9uTW9kZWxfMSA9IHJlcXVpcmUoXCIuL1NlbGVjdGlvbk1vZGVsXCIpO1xudmFyIEFsdENsaWNrSGFuZGxlcl8xID0gcmVxdWlyZShcIi4vaGFuZGxlcnMvQWx0Q2xpY2tIYW5kbGVyXCIpO1xudmFyIEJ1ZmZlckxpbmVfMSA9IHJlcXVpcmUoXCIuL2NvcmUvYnVmZmVyL0J1ZmZlckxpbmVcIik7XG52YXIgRXZlbnRFbWl0dGVyMl8xID0gcmVxdWlyZShcIi4vY29tbW9uL0V2ZW50RW1pdHRlcjJcIik7XG52YXIgRFJBR19TQ1JPTExfTUFYX1RIUkVTSE9MRCA9IDUwO1xudmFyIERSQUdfU0NST0xMX01BWF9TUEVFRCA9IDE1O1xudmFyIERSQUdfU0NST0xMX0lOVEVSVkFMID0gNTA7XG52YXIgQUxUX0NMSUNLX01PVkVfQ1VSU09SX1RJTUUgPSA1MDA7XG52YXIgV09SRF9TRVBBUkFUT1JTID0gJyAoKVtde31cXCdcIic7XG52YXIgTk9OX0JSRUFLSU5HX1NQQUNFX0NIQVIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDE2MCk7XG52YXIgQUxMX05PTl9CUkVBS0lOR19TUEFDRV9SRUdFWCA9IG5ldyBSZWdFeHAoTk9OX0JSRUFLSU5HX1NQQUNFX0NIQVIsICdnJyk7XG52YXIgU2VsZWN0aW9uTWFuYWdlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gU2VsZWN0aW9uTWFuYWdlcihfdGVybWluYWwsIF9jaGFyTWVhc3VyZSkge1xuICAgICAgICB0aGlzLl90ZXJtaW5hbCA9IF90ZXJtaW5hbDtcbiAgICAgICAgdGhpcy5fY2hhck1lYXN1cmUgPSBfY2hhck1lYXN1cmU7XG4gICAgICAgIHRoaXMuX2VuYWJsZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLl93b3JrQ2VsbCA9IG5ldyBCdWZmZXJMaW5lXzEuQ2VsbERhdGEoKTtcbiAgICAgICAgdGhpcy5fb25MaW51eE1vdXNlU2VsZWN0aW9uID0gbmV3IEV2ZW50RW1pdHRlcjJfMS5FdmVudEVtaXR0ZXIyKCk7XG4gICAgICAgIHRoaXMuX29uUmVkcmF3UmVxdWVzdCA9IG5ldyBFdmVudEVtaXR0ZXIyXzEuRXZlbnRFbWl0dGVyMigpO1xuICAgICAgICB0aGlzLl9vblNlbGVjdGlvbkNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIyXzEuRXZlbnRFbWl0dGVyMigpO1xuICAgICAgICB0aGlzLl9pbml0TGlzdGVuZXJzKCk7XG4gICAgICAgIHRoaXMuZW5hYmxlKCk7XG4gICAgICAgIHRoaXMuX21vZGVsID0gbmV3IFNlbGVjdGlvbk1vZGVsXzEuU2VsZWN0aW9uTW9kZWwoX3Rlcm1pbmFsKTtcbiAgICAgICAgdGhpcy5fYWN0aXZlU2VsZWN0aW9uTW9kZSA9IDA7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZSwgXCJvbkxpbnV4TW91c2VTZWxlY3Rpb25cIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX29uTGludXhNb3VzZVNlbGVjdGlvbi5ldmVudDsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLCBcIm9uUmVkcmF3UmVxdWVzdFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fb25SZWRyYXdSZXF1ZXN0LmV2ZW50OyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU2VsZWN0aW9uTWFuYWdlci5wcm90b3R5cGUsIFwib25TZWxlY3Rpb25DaGFuZ2VcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX29uU2VsZWN0aW9uQ2hhbmdlLmV2ZW50OyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9yZW1vdmVNb3VzZURvd25MaXN0ZW5lcnMoKTtcbiAgICB9O1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZSwgXCJfYnVmZmVyXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fdGVybWluYWwuYnVmZmVycy5hY3RpdmU7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLl9pbml0TGlzdGVuZXJzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLl9tb3VzZU1vdmVMaXN0ZW5lciA9IGZ1bmN0aW9uIChldmVudCkgeyByZXR1cm4gX3RoaXMuX29uTW91c2VNb3ZlKGV2ZW50KTsgfTtcbiAgICAgICAgdGhpcy5fbW91c2VVcExpc3RlbmVyID0gZnVuY3Rpb24gKGV2ZW50KSB7IHJldHVybiBfdGhpcy5fb25Nb3VzZVVwKGV2ZW50KTsgfTtcbiAgICAgICAgdGhpcy5pbml0QnVmZmVyc0xpc3RlbmVycygpO1xuICAgIH07XG4gICAgU2VsZWN0aW9uTWFuYWdlci5wcm90b3R5cGUuaW5pdEJ1ZmZlcnNMaXN0ZW5lcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuX3RyaW1MaXN0ZW5lciA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5saW5lcy5vblRyaW0oZnVuY3Rpb24gKGFtb3VudCkgeyByZXR1cm4gX3RoaXMuX29uVHJpbShhbW91bnQpOyB9KTtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuYnVmZmVycy5vbkJ1ZmZlckFjdGl2YXRlKGZ1bmN0aW9uIChlKSB7IHJldHVybiBfdGhpcy5fb25CdWZmZXJBY3RpdmF0ZShlKTsgfSk7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5kaXNhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmNsZWFyU2VsZWN0aW9uKCk7XG4gICAgICAgIHRoaXMuX2VuYWJsZWQgPSBmYWxzZTtcbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLmVuYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fZW5hYmxlZCA9IHRydWU7XG4gICAgfTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU2VsZWN0aW9uTWFuYWdlci5wcm90b3R5cGUsIFwic2VsZWN0aW9uU3RhcnRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX21vZGVsLmZpbmFsU2VsZWN0aW9uU3RhcnQ7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZSwgXCJzZWxlY3Rpb25FbmRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX21vZGVsLmZpbmFsU2VsZWN0aW9uRW5kOyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoU2VsZWN0aW9uTWFuYWdlci5wcm90b3R5cGUsIFwiaGFzU2VsZWN0aW9uXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLl9tb2RlbC5maW5hbFNlbGVjdGlvblN0YXJ0O1xuICAgICAgICAgICAgdmFyIGVuZCA9IHRoaXMuX21vZGVsLmZpbmFsU2VsZWN0aW9uRW5kO1xuICAgICAgICAgICAgaWYgKCFzdGFydCB8fCAhZW5kKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHN0YXJ0WzBdICE9PSBlbmRbMF0gfHwgc3RhcnRbMV0gIT09IGVuZFsxXTtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLCBcInNlbGVjdGlvblRleHRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBzdGFydCA9IHRoaXMuX21vZGVsLmZpbmFsU2VsZWN0aW9uU3RhcnQ7XG4gICAgICAgICAgICB2YXIgZW5kID0gdGhpcy5fbW9kZWwuZmluYWxTZWxlY3Rpb25FbmQ7XG4gICAgICAgICAgICBpZiAoIXN0YXJ0IHx8ICFlbmQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgICAgICAgICBpZiAodGhpcy5fYWN0aXZlU2VsZWN0aW9uTW9kZSA9PT0gMykge1xuICAgICAgICAgICAgICAgIGlmIChzdGFydFswXSA9PT0gZW5kWzBdKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0WzFdOyBpIDw9IGVuZFsxXTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBsaW5lVGV4dCA9IHRoaXMuX2J1ZmZlci50cmFuc2xhdGVCdWZmZXJMaW5lVG9TdHJpbmcoaSwgdHJ1ZSwgc3RhcnRbMF0sIGVuZFswXSk7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKGxpbmVUZXh0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhcnRSb3dFbmRDb2wgPSBzdGFydFsxXSA9PT0gZW5kWzFdID8gZW5kWzBdIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRoaXMuX2J1ZmZlci50cmFuc2xhdGVCdWZmZXJMaW5lVG9TdHJpbmcoc3RhcnRbMV0sIHRydWUsIHN0YXJ0WzBdLCBzdGFydFJvd0VuZENvbCkpO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydFsxXSArIDE7IGkgPD0gZW5kWzFdIC0gMTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBidWZmZXJMaW5lID0gdGhpcy5fYnVmZmVyLmxpbmVzLmdldChpKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxpbmVUZXh0ID0gdGhpcy5fYnVmZmVyLnRyYW5zbGF0ZUJ1ZmZlckxpbmVUb1N0cmluZyhpLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJ1ZmZlckxpbmUuaXNXcmFwcGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0Lmxlbmd0aCAtIDFdICs9IGxpbmVUZXh0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobGluZVRleHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChzdGFydFsxXSAhPT0gZW5kWzFdKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBidWZmZXJMaW5lID0gdGhpcy5fYnVmZmVyLmxpbmVzLmdldChlbmRbMV0pO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbGluZVRleHQgPSB0aGlzLl9idWZmZXIudHJhbnNsYXRlQnVmZmVyTGluZVRvU3RyaW5nKGVuZFsxXSwgdHJ1ZSwgMCwgZW5kWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJ1ZmZlckxpbmUuaXNXcmFwcGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRbcmVzdWx0Lmxlbmd0aCAtIDFdICs9IGxpbmVUZXh0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0LnB1c2gobGluZVRleHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGZvcm1hdHRlZFJlc3VsdCA9IHJlc3VsdC5tYXAoZnVuY3Rpb24gKGxpbmUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbGluZS5yZXBsYWNlKEFMTF9OT05fQlJFQUtJTkdfU1BBQ0VfUkVHRVgsICcgJyk7XG4gICAgICAgICAgICB9KS5qb2luKEJyb3dzZXIuaXNNU1dpbmRvd3MgPyAnXFxyXFxuJyA6ICdcXG4nKTtcbiAgICAgICAgICAgIHJldHVybiBmb3JtYXR0ZWRSZXN1bHQ7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLmNsZWFyU2VsZWN0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9tb2RlbC5jbGVhclNlbGVjdGlvbigpO1xuICAgICAgICB0aGlzLl9yZW1vdmVNb3VzZURvd25MaXN0ZW5lcnMoKTtcbiAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgICAgIHRoaXMuX29uU2VsZWN0aW9uQ2hhbmdlLmZpcmUoKTtcbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLnJlZnJlc2ggPSBmdW5jdGlvbiAoaXNMaW51eE1vdXNlU2VsZWN0aW9uKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICghdGhpcy5fcmVmcmVzaEFuaW1hdGlvbkZyYW1lKSB7XG4gICAgICAgICAgICB0aGlzLl9yZWZyZXNoQW5pbWF0aW9uRnJhbWUgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9yZWZyZXNoKCk7IH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChCcm93c2VyLmlzTGludXggJiYgaXNMaW51eE1vdXNlU2VsZWN0aW9uKSB7XG4gICAgICAgICAgICB2YXIgc2VsZWN0aW9uVGV4dCA9IHRoaXMuc2VsZWN0aW9uVGV4dDtcbiAgICAgICAgICAgIGlmIChzZWxlY3Rpb25UZXh0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX29uTGludXhNb3VzZVNlbGVjdGlvbi5maXJlKHRoaXMuc2VsZWN0aW9uVGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLl9yZWZyZXNoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9yZWZyZXNoQW5pbWF0aW9uRnJhbWUgPSBudWxsO1xuICAgICAgICB0aGlzLl9vblJlZHJhd1JlcXVlc3QuZmlyZSh7XG4gICAgICAgICAgICBzdGFydDogdGhpcy5fbW9kZWwuZmluYWxTZWxlY3Rpb25TdGFydCxcbiAgICAgICAgICAgIGVuZDogdGhpcy5fbW9kZWwuZmluYWxTZWxlY3Rpb25FbmQsXG4gICAgICAgICAgICBjb2x1bW5TZWxlY3RNb2RlOiB0aGlzLl9hY3RpdmVTZWxlY3Rpb25Nb2RlID09PSAzXG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgU2VsZWN0aW9uTWFuYWdlci5wcm90b3R5cGUuaXNDbGlja0luU2VsZWN0aW9uID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHZhciBjb29yZHMgPSB0aGlzLl9nZXRNb3VzZUJ1ZmZlckNvb3JkcyhldmVudCk7XG4gICAgICAgIHZhciBzdGFydCA9IHRoaXMuX21vZGVsLmZpbmFsU2VsZWN0aW9uU3RhcnQ7XG4gICAgICAgIHZhciBlbmQgPSB0aGlzLl9tb2RlbC5maW5hbFNlbGVjdGlvbkVuZDtcbiAgICAgICAgaWYgKCFzdGFydCB8fCAhZW5kKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX2FyZUNvb3Jkc0luU2VsZWN0aW9uKGNvb3Jkcywgc3RhcnQsIGVuZCk7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5fYXJlQ29vcmRzSW5TZWxlY3Rpb24gPSBmdW5jdGlvbiAoY29vcmRzLCBzdGFydCwgZW5kKSB7XG4gICAgICAgIHJldHVybiAoY29vcmRzWzFdID4gc3RhcnRbMV0gJiYgY29vcmRzWzFdIDwgZW5kWzFdKSB8fFxuICAgICAgICAgICAgKHN0YXJ0WzFdID09PSBlbmRbMV0gJiYgY29vcmRzWzFdID09PSBzdGFydFsxXSAmJiBjb29yZHNbMF0gPj0gc3RhcnRbMF0gJiYgY29vcmRzWzBdIDwgZW5kWzBdKSB8fFxuICAgICAgICAgICAgKHN0YXJ0WzFdIDwgZW5kWzFdICYmIGNvb3Jkc1sxXSA9PT0gZW5kWzFdICYmIGNvb3Jkc1swXSA8IGVuZFswXSkgfHxcbiAgICAgICAgICAgIChzdGFydFsxXSA8IGVuZFsxXSAmJiBjb29yZHNbMV0gPT09IHN0YXJ0WzFdICYmIGNvb3Jkc1swXSA+PSBzdGFydFswXSk7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5zZWxlY3RXb3JkQXRDdXJzb3IgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdmFyIGNvb3JkcyA9IHRoaXMuX2dldE1vdXNlQnVmZmVyQ29vcmRzKGV2ZW50KTtcbiAgICAgICAgaWYgKGNvb3Jkcykge1xuICAgICAgICAgICAgdGhpcy5fc2VsZWN0V29yZEF0KGNvb3JkcywgZmFsc2UpO1xuICAgICAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kID0gbnVsbDtcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaCh0cnVlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgU2VsZWN0aW9uTWFuYWdlci5wcm90b3R5cGUuc2VsZWN0QWxsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9tb2RlbC5pc1NlbGVjdEFsbEFjdGl2ZSA9IHRydWU7XG4gICAgICAgIHRoaXMucmVmcmVzaCgpO1xuICAgICAgICB0aGlzLl9vblNlbGVjdGlvbkNoYW5nZS5maXJlKCk7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5zZWxlY3RMaW5lcyA9IGZ1bmN0aW9uIChzdGFydCwgZW5kKSB7XG4gICAgICAgIHRoaXMuX21vZGVsLmNsZWFyU2VsZWN0aW9uKCk7XG4gICAgICAgIHN0YXJ0ID0gTWF0aC5tYXgoc3RhcnQsIDApO1xuICAgICAgICBlbmQgPSBNYXRoLm1pbihlbmQsIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5saW5lcy5sZW5ndGggLSAxKTtcbiAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uU3RhcnQgPSBbMCwgc3RhcnRdO1xuICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25FbmQgPSBbdGhpcy5fdGVybWluYWwuY29scywgZW5kXTtcbiAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgICAgIHRoaXMuX29uU2VsZWN0aW9uQ2hhbmdlLmZpcmUoKTtcbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLl9vblRyaW0gPSBmdW5jdGlvbiAoYW1vdW50KSB7XG4gICAgICAgIHZhciBuZWVkc1JlZnJlc2ggPSB0aGlzLl9tb2RlbC5vblRyaW0oYW1vdW50KTtcbiAgICAgICAgaWYgKG5lZWRzUmVmcmVzaCkge1xuICAgICAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLl9nZXRNb3VzZUJ1ZmZlckNvb3JkcyA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB2YXIgY29vcmRzID0gdGhpcy5fdGVybWluYWwubW91c2VIZWxwZXIuZ2V0Q29vcmRzKGV2ZW50LCB0aGlzLl90ZXJtaW5hbC5zY3JlZW5FbGVtZW50LCB0aGlzLl9jaGFyTWVhc3VyZSwgdGhpcy5fdGVybWluYWwuY29scywgdGhpcy5fdGVybWluYWwucm93cywgdHJ1ZSk7XG4gICAgICAgIGlmICghY29vcmRzKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb29yZHNbMF0tLTtcbiAgICAgICAgY29vcmRzWzFdLS07XG4gICAgICAgIGNvb3Jkc1sxXSArPSB0aGlzLl90ZXJtaW5hbC5idWZmZXIueWRpc3A7XG4gICAgICAgIHJldHVybiBjb29yZHM7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5fZ2V0TW91c2VFdmVudFNjcm9sbEFtb3VudCA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB2YXIgb2Zmc2V0ID0gTW91c2VIZWxwZXJfMS5Nb3VzZUhlbHBlci5nZXRDb29yZHNSZWxhdGl2ZVRvRWxlbWVudChldmVudCwgdGhpcy5fdGVybWluYWwuc2NyZWVuRWxlbWVudClbMV07XG4gICAgICAgIHZhciB0ZXJtaW5hbEhlaWdodCA9IHRoaXMuX3Rlcm1pbmFsLnJvd3MgKiBNYXRoLmNlaWwodGhpcy5fY2hhck1lYXN1cmUuaGVpZ2h0ICogdGhpcy5fdGVybWluYWwub3B0aW9ucy5saW5lSGVpZ2h0KTtcbiAgICAgICAgaWYgKG9mZnNldCA+PSAwICYmIG9mZnNldCA8PSB0ZXJtaW5hbEhlaWdodCkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9mZnNldCA+IHRlcm1pbmFsSGVpZ2h0KSB7XG4gICAgICAgICAgICBvZmZzZXQgLT0gdGVybWluYWxIZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgb2Zmc2V0ID0gTWF0aC5taW4oTWF0aC5tYXgob2Zmc2V0LCAtRFJBR19TQ1JPTExfTUFYX1RIUkVTSE9MRCksIERSQUdfU0NST0xMX01BWF9USFJFU0hPTEQpO1xuICAgICAgICBvZmZzZXQgLz0gRFJBR19TQ1JPTExfTUFYX1RIUkVTSE9MRDtcbiAgICAgICAgcmV0dXJuIChvZmZzZXQgLyBNYXRoLmFicyhvZmZzZXQpKSArIE1hdGgucm91bmQob2Zmc2V0ICogKERSQUdfU0NST0xMX01BWF9TUEVFRCAtIDEpKTtcbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLnNob3VsZEZvcmNlU2VsZWN0aW9uID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGlmIChCcm93c2VyLmlzTWFjKSB7XG4gICAgICAgICAgICByZXR1cm4gZXZlbnQuYWx0S2V5ICYmIHRoaXMuX3Rlcm1pbmFsLm9wdGlvbnMubWFjT3B0aW9uQ2xpY2tGb3JjZXNTZWxlY3Rpb247XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGV2ZW50LnNoaWZ0S2V5O1xuICAgIH07XG4gICAgU2VsZWN0aW9uTWFuYWdlci5wcm90b3R5cGUub25Nb3VzZURvd24gPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdGhpcy5fbW91c2VEb3duVGltZVN0YW1wID0gZXZlbnQudGltZVN0YW1wO1xuICAgICAgICBpZiAoZXZlbnQuYnV0dG9uID09PSAyICYmIHRoaXMuaGFzU2VsZWN0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGV2ZW50LmJ1dHRvbiAhPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5fZW5hYmxlZCkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLnNob3VsZEZvcmNlU2VsZWN0aW9uKGV2ZW50KSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHRoaXMuX2RyYWdTY3JvbGxBbW91bnQgPSAwO1xuICAgICAgICBpZiAodGhpcy5fZW5hYmxlZCAmJiBldmVudC5zaGlmdEtleSkge1xuICAgICAgICAgICAgdGhpcy5fb25JbmNyZW1lbnRhbENsaWNrKGV2ZW50KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChldmVudC5kZXRhaWwgPT09IDEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9vblNpbmdsZUNsaWNrKGV2ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGV2ZW50LmRldGFpbCA9PT0gMikge1xuICAgICAgICAgICAgICAgIHRoaXMuX29uRG91YmxlQ2xpY2soZXZlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZXZlbnQuZGV0YWlsID09PSAzKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fb25UcmlwbGVDbGljayhldmVudCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fYWRkTW91c2VEb3duTGlzdGVuZXJzKCk7XG4gICAgICAgIHRoaXMucmVmcmVzaCh0cnVlKTtcbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLl9hZGRNb3VzZURvd25MaXN0ZW5lcnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmVsZW1lbnQub3duZXJEb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZW1vdmUnLCB0aGlzLl9tb3VzZU1vdmVMaXN0ZW5lcik7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLmVsZW1lbnQub3duZXJEb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgdGhpcy5fbW91c2VVcExpc3RlbmVyKTtcbiAgICAgICAgdGhpcy5fZHJhZ1Njcm9sbEludGVydmFsVGltZXIgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5fZHJhZ1Njcm9sbCgpOyB9LCBEUkFHX1NDUk9MTF9JTlRFUlZBTCk7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5fcmVtb3ZlTW91c2VEb3duTGlzdGVuZXJzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fdGVybWluYWwuZWxlbWVudC5vd25lckRvY3VtZW50KSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5lbGVtZW50Lm93bmVyRG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgdGhpcy5fbW91c2VNb3ZlTGlzdGVuZXIpO1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuZWxlbWVudC5vd25lckRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCB0aGlzLl9tb3VzZVVwTGlzdGVuZXIpO1xuICAgICAgICB9XG4gICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5fZHJhZ1Njcm9sbEludGVydmFsVGltZXIpO1xuICAgICAgICB0aGlzLl9kcmFnU2Nyb2xsSW50ZXJ2YWxUaW1lciA9IG51bGw7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5fb25JbmNyZW1lbnRhbENsaWNrID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGlmICh0aGlzLl9tb2RlbC5zZWxlY3Rpb25TdGFydCkge1xuICAgICAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kID0gdGhpcy5fZ2V0TW91c2VCdWZmZXJDb29yZHMoZXZlbnQpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5fb25TaW5nbGVDbGljayA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25TdGFydExlbmd0aCA9IDA7XG4gICAgICAgIHRoaXMuX21vZGVsLmlzU2VsZWN0QWxsQWN0aXZlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX2FjdGl2ZVNlbGVjdGlvbk1vZGUgPSB0aGlzLnNob3VsZENvbHVtblNlbGVjdChldmVudCkgPyAzIDogMDtcbiAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uU3RhcnQgPSB0aGlzLl9nZXRNb3VzZUJ1ZmZlckNvb3JkcyhldmVudCk7XG4gICAgICAgIGlmICghdGhpcy5fbW9kZWwuc2VsZWN0aW9uU3RhcnQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25FbmQgPSBudWxsO1xuICAgICAgICB2YXIgbGluZSA9IHRoaXMuX2J1ZmZlci5saW5lcy5nZXQodGhpcy5fbW9kZWwuc2VsZWN0aW9uU3RhcnRbMV0pO1xuICAgICAgICBpZiAoIWxpbmUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAobGluZS5sZW5ndGggPj0gdGhpcy5fbW9kZWwuc2VsZWN0aW9uU3RhcnRbMF0pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAobGluZS5oYXNXaWR0aCh0aGlzLl9tb2RlbC5zZWxlY3Rpb25TdGFydFswXSkgPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuX21vZGVsLnNlbGVjdGlvblN0YXJ0WzBdKys7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLl9vbkRvdWJsZUNsaWNrID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHZhciBjb29yZHMgPSB0aGlzLl9nZXRNb3VzZUJ1ZmZlckNvb3JkcyhldmVudCk7XG4gICAgICAgIGlmIChjb29yZHMpIHtcbiAgICAgICAgICAgIHRoaXMuX2FjdGl2ZVNlbGVjdGlvbk1vZGUgPSAxO1xuICAgICAgICAgICAgdGhpcy5fc2VsZWN0V29yZEF0KGNvb3JkcywgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLl9vblRyaXBsZUNsaWNrID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHZhciBjb29yZHMgPSB0aGlzLl9nZXRNb3VzZUJ1ZmZlckNvb3JkcyhldmVudCk7XG4gICAgICAgIGlmIChjb29yZHMpIHtcbiAgICAgICAgICAgIHRoaXMuX2FjdGl2ZVNlbGVjdGlvbk1vZGUgPSAyO1xuICAgICAgICAgICAgdGhpcy5fc2VsZWN0TGluZUF0KGNvb3Jkc1sxXSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLnNob3VsZENvbHVtblNlbGVjdCA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICByZXR1cm4gZXZlbnQuYWx0S2V5ICYmICEoQnJvd3Nlci5pc01hYyAmJiB0aGlzLl90ZXJtaW5hbC5vcHRpb25zLm1hY09wdGlvbkNsaWNrRm9yY2VzU2VsZWN0aW9uKTtcbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLl9vbk1vdXNlTW92ZSA9IGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBldmVudC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTtcbiAgICAgICAgdmFyIHByZXZpb3VzU2VsZWN0aW9uRW5kID0gdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kID8gW3RoaXMuX21vZGVsLnNlbGVjdGlvbkVuZFswXSwgdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kWzFdXSA6IG51bGw7XG4gICAgICAgIHRoaXMuX21vZGVsLnNlbGVjdGlvbkVuZCA9IHRoaXMuX2dldE1vdXNlQnVmZmVyQ29vcmRzKGV2ZW50KTtcbiAgICAgICAgaWYgKCF0aGlzLl9tb2RlbC5zZWxlY3Rpb25FbmQpIHtcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaCh0cnVlKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fYWN0aXZlU2VsZWN0aW9uTW9kZSA9PT0gMikge1xuICAgICAgICAgICAgaWYgKHRoaXMuX21vZGVsLnNlbGVjdGlvbkVuZFsxXSA8IHRoaXMuX21vZGVsLnNlbGVjdGlvblN0YXJ0WzFdKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kWzBdID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX21vZGVsLnNlbGVjdGlvbkVuZFswXSA9IHRoaXMuX3Rlcm1pbmFsLmNvbHM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5fYWN0aXZlU2VsZWN0aW9uTW9kZSA9PT0gMSkge1xuICAgICAgICAgICAgdGhpcy5fc2VsZWN0VG9Xb3JkQXQodGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9kcmFnU2Nyb2xsQW1vdW50ID0gdGhpcy5fZ2V0TW91c2VFdmVudFNjcm9sbEFtb3VudChldmVudCk7XG4gICAgICAgIGlmICh0aGlzLl9hY3RpdmVTZWxlY3Rpb25Nb2RlICE9PSAzKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fZHJhZ1Njcm9sbEFtb3VudCA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25FbmRbMF0gPSB0aGlzLl90ZXJtaW5hbC5jb2xzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5fZHJhZ1Njcm9sbEFtb3VudCA8IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25FbmRbMF0gPSAwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9tb2RlbC5zZWxlY3Rpb25FbmRbMV0gPCB0aGlzLl9idWZmZXIubGluZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fYnVmZmVyLmxpbmVzLmdldCh0aGlzLl9tb2RlbC5zZWxlY3Rpb25FbmRbMV0pLmhhc1dpZHRoKHRoaXMuX21vZGVsLnNlbGVjdGlvbkVuZFswXSkgPT09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25FbmRbMF0rKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIXByZXZpb3VzU2VsZWN0aW9uRW5kIHx8XG4gICAgICAgICAgICBwcmV2aW91c1NlbGVjdGlvbkVuZFswXSAhPT0gdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kWzBdIHx8XG4gICAgICAgICAgICBwcmV2aW91c1NlbGVjdGlvbkVuZFsxXSAhPT0gdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kWzFdKSB7XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2godHJ1ZSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLl9kcmFnU2Nyb2xsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fZHJhZ1Njcm9sbEFtb3VudCkge1xuICAgICAgICAgICAgdGhpcy5fdGVybWluYWwuc2Nyb2xsTGluZXModGhpcy5fZHJhZ1Njcm9sbEFtb3VudCwgZmFsc2UpO1xuICAgICAgICAgICAgaWYgKHRoaXMuX2RyYWdTY3JvbGxBbW91bnQgPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2FjdGl2ZVNlbGVjdGlvbk1vZGUgIT09IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kWzBdID0gdGhpcy5fdGVybWluYWwuY29scztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kWzFdID0gTWF0aC5taW4odGhpcy5fdGVybWluYWwuYnVmZmVyLnlkaXNwICsgdGhpcy5fdGVybWluYWwucm93cywgdGhpcy5fdGVybWluYWwuYnVmZmVyLmxpbmVzLmxlbmd0aCAtIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX2FjdGl2ZVNlbGVjdGlvbk1vZGUgIT09IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kWzBdID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uRW5kWzFdID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLnlkaXNwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLl9vbk1vdXNlVXAgPSBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdmFyIHRpbWVFbGFwc2VkID0gZXZlbnQudGltZVN0YW1wIC0gdGhpcy5fbW91c2VEb3duVGltZVN0YW1wO1xuICAgICAgICB0aGlzLl9yZW1vdmVNb3VzZURvd25MaXN0ZW5lcnMoKTtcbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uVGV4dC5sZW5ndGggPD0gMSAmJiB0aW1lRWxhcHNlZCA8IEFMVF9DTElDS19NT1ZFX0NVUlNPUl9USU1FKSB7XG4gICAgICAgICAgICAobmV3IEFsdENsaWNrSGFuZGxlcl8xLkFsdENsaWNrSGFuZGxlcihldmVudCwgdGhpcy5fdGVybWluYWwpKS5tb3ZlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5oYXNTZWxlY3Rpb24pIHtcbiAgICAgICAgICAgIHRoaXMuX29uU2VsZWN0aW9uQ2hhbmdlLmZpcmUoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgU2VsZWN0aW9uTWFuYWdlci5wcm90b3R5cGUuX29uQnVmZmVyQWN0aXZhdGUgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLmNsZWFyU2VsZWN0aW9uKCk7XG4gICAgICAgIGlmICh0aGlzLl90cmltTGlzdGVuZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX3RyaW1MaXN0ZW5lci5kaXNwb3NlKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdHJpbUxpc3RlbmVyID0gZS5hY3RpdmVCdWZmZXIubGluZXMub25UcmltKGZ1bmN0aW9uIChhbW91bnQpIHsgcmV0dXJuIF90aGlzLl9vblRyaW0oYW1vdW50KTsgfSk7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5fY29udmVydFZpZXdwb3J0Q29sVG9DaGFyYWN0ZXJJbmRleCA9IGZ1bmN0aW9uIChidWZmZXJMaW5lLCBjb29yZHMpIHtcbiAgICAgICAgdmFyIGNoYXJJbmRleCA9IGNvb3Jkc1swXTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGNvb3Jkc1swXSA+PSBpOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBsZW5ndGhfMSA9IGJ1ZmZlckxpbmUubG9hZENlbGwoaSwgdGhpcy5fd29ya0NlbGwpLmdldENoYXJzKCkubGVuZ3RoO1xuICAgICAgICAgICAgaWYgKHRoaXMuX3dvcmtDZWxsLmdldFdpZHRoKCkgPT09IDApIHtcbiAgICAgICAgICAgICAgICBjaGFySW5kZXgtLTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGxlbmd0aF8xID4gMSAmJiBjb29yZHNbMF0gIT09IGkpIHtcbiAgICAgICAgICAgICAgICBjaGFySW5kZXggKz0gbGVuZ3RoXzEgLSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjaGFySW5kZXg7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5zZXRTZWxlY3Rpb24gPSBmdW5jdGlvbiAoY29sLCByb3csIGxlbmd0aCkge1xuICAgICAgICB0aGlzLl9tb2RlbC5jbGVhclNlbGVjdGlvbigpO1xuICAgICAgICB0aGlzLl9yZW1vdmVNb3VzZURvd25MaXN0ZW5lcnMoKTtcbiAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uU3RhcnQgPSBbY29sLCByb3ddO1xuICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25TdGFydExlbmd0aCA9IGxlbmd0aDtcbiAgICAgICAgdGhpcy5yZWZyZXNoKCk7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5fZ2V0V29yZEF0ID0gZnVuY3Rpb24gKGNvb3JkcywgYWxsb3dXaGl0ZXNwYWNlT25seVNlbGVjdGlvbiwgZm9sbG93V3JhcHBlZExpbmVzQWJvdmUsIGZvbGxvd1dyYXBwZWRMaW5lc0JlbG93KSB7XG4gICAgICAgIGlmIChmb2xsb3dXcmFwcGVkTGluZXNBYm92ZSA9PT0gdm9pZCAwKSB7IGZvbGxvd1dyYXBwZWRMaW5lc0Fib3ZlID0gdHJ1ZTsgfVxuICAgICAgICBpZiAoZm9sbG93V3JhcHBlZExpbmVzQmVsb3cgPT09IHZvaWQgMCkgeyBmb2xsb3dXcmFwcGVkTGluZXNCZWxvdyA9IHRydWU7IH1cbiAgICAgICAgaWYgKGNvb3Jkc1swXSA+PSB0aGlzLl90ZXJtaW5hbC5jb2xzKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgYnVmZmVyTGluZSA9IHRoaXMuX2J1ZmZlci5saW5lcy5nZXQoY29vcmRzWzFdKTtcbiAgICAgICAgaWYgKCFidWZmZXJMaW5lKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbGluZSA9IHRoaXMuX2J1ZmZlci50cmFuc2xhdGVCdWZmZXJMaW5lVG9TdHJpbmcoY29vcmRzWzFdLCBmYWxzZSk7XG4gICAgICAgIHZhciBzdGFydEluZGV4ID0gdGhpcy5fY29udmVydFZpZXdwb3J0Q29sVG9DaGFyYWN0ZXJJbmRleChidWZmZXJMaW5lLCBjb29yZHMpO1xuICAgICAgICB2YXIgZW5kSW5kZXggPSBzdGFydEluZGV4O1xuICAgICAgICB2YXIgY2hhck9mZnNldCA9IGNvb3Jkc1swXSAtIHN0YXJ0SW5kZXg7XG4gICAgICAgIHZhciBsZWZ0V2lkZUNoYXJDb3VudCA9IDA7XG4gICAgICAgIHZhciByaWdodFdpZGVDaGFyQ291bnQgPSAwO1xuICAgICAgICB2YXIgbGVmdExvbmdDaGFyT2Zmc2V0ID0gMDtcbiAgICAgICAgdmFyIHJpZ2h0TG9uZ0NoYXJPZmZzZXQgPSAwO1xuICAgICAgICBpZiAobGluZS5jaGFyQXQoc3RhcnRJbmRleCkgPT09ICcgJykge1xuICAgICAgICAgICAgd2hpbGUgKHN0YXJ0SW5kZXggPiAwICYmIGxpbmUuY2hhckF0KHN0YXJ0SW5kZXggLSAxKSA9PT0gJyAnKSB7XG4gICAgICAgICAgICAgICAgc3RhcnRJbmRleC0tO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgd2hpbGUgKGVuZEluZGV4IDwgbGluZS5sZW5ndGggJiYgbGluZS5jaGFyQXQoZW5kSW5kZXggKyAxKSA9PT0gJyAnKSB7XG4gICAgICAgICAgICAgICAgZW5kSW5kZXgrKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciBzdGFydENvbCA9IGNvb3Jkc1swXTtcbiAgICAgICAgICAgIHZhciBlbmRDb2wgPSBjb29yZHNbMF07XG4gICAgICAgICAgICBpZiAoYnVmZmVyTGluZS5nZXRXaWR0aChzdGFydENvbCkgPT09IDApIHtcbiAgICAgICAgICAgICAgICBsZWZ0V2lkZUNoYXJDb3VudCsrO1xuICAgICAgICAgICAgICAgIHN0YXJ0Q29sLS07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYnVmZmVyTGluZS5nZXRXaWR0aChlbmRDb2wpID09PSAyKSB7XG4gICAgICAgICAgICAgICAgcmlnaHRXaWRlQ2hhckNvdW50Kys7XG4gICAgICAgICAgICAgICAgZW5kQ29sKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgbGVuZ3RoXzIgPSBidWZmZXJMaW5lLmdldFN0cmluZyhlbmRDb2wpLmxlbmd0aDtcbiAgICAgICAgICAgIGlmIChsZW5ndGhfMiA+IDEpIHtcbiAgICAgICAgICAgICAgICByaWdodExvbmdDaGFyT2Zmc2V0ICs9IGxlbmd0aF8yIC0gMTtcbiAgICAgICAgICAgICAgICBlbmRJbmRleCArPSBsZW5ndGhfMiAtIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB3aGlsZSAoc3RhcnRDb2wgPiAwICYmIHN0YXJ0SW5kZXggPiAwICYmICF0aGlzLl9pc0NoYXJXb3JkU2VwYXJhdG9yKGJ1ZmZlckxpbmUubG9hZENlbGwoc3RhcnRDb2wgLSAxLCB0aGlzLl93b3JrQ2VsbCkpKSB7XG4gICAgICAgICAgICAgICAgYnVmZmVyTGluZS5sb2FkQ2VsbChzdGFydENvbCAtIDEsIHRoaXMuX3dvcmtDZWxsKTtcbiAgICAgICAgICAgICAgICB2YXIgbGVuZ3RoXzMgPSB0aGlzLl93b3JrQ2VsbC5nZXRDaGFycygpLmxlbmd0aDtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fd29ya0NlbGwuZ2V0V2lkdGgoKSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICBsZWZ0V2lkZUNoYXJDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICBzdGFydENvbC0tO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChsZW5ndGhfMyA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgbGVmdExvbmdDaGFyT2Zmc2V0ICs9IGxlbmd0aF8zIC0gMTtcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRJbmRleCAtPSBsZW5ndGhfMyAtIDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN0YXJ0SW5kZXgtLTtcbiAgICAgICAgICAgICAgICBzdGFydENvbC0tO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgd2hpbGUgKGVuZENvbCA8IGJ1ZmZlckxpbmUubGVuZ3RoICYmIGVuZEluZGV4ICsgMSA8IGxpbmUubGVuZ3RoICYmICF0aGlzLl9pc0NoYXJXb3JkU2VwYXJhdG9yKGJ1ZmZlckxpbmUubG9hZENlbGwoZW5kQ29sICsgMSwgdGhpcy5fd29ya0NlbGwpKSkge1xuICAgICAgICAgICAgICAgIGJ1ZmZlckxpbmUubG9hZENlbGwoZW5kQ29sICsgMSwgdGhpcy5fd29ya0NlbGwpO1xuICAgICAgICAgICAgICAgIHZhciBsZW5ndGhfNCA9IHRoaXMuX3dvcmtDZWxsLmdldENoYXJzKCkubGVuZ3RoO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl93b3JrQ2VsbC5nZXRXaWR0aCgpID09PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgIHJpZ2h0V2lkZUNoYXJDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICBlbmRDb2wrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAobGVuZ3RoXzQgPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHJpZ2h0TG9uZ0NoYXJPZmZzZXQgKz0gbGVuZ3RoXzQgLSAxO1xuICAgICAgICAgICAgICAgICAgICBlbmRJbmRleCArPSBsZW5ndGhfNCAtIDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVuZEluZGV4Kys7XG4gICAgICAgICAgICAgICAgZW5kQ29sKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZW5kSW5kZXgrKztcbiAgICAgICAgdmFyIHN0YXJ0ID0gc3RhcnRJbmRleFxuICAgICAgICAgICAgKyBjaGFyT2Zmc2V0XG4gICAgICAgICAgICAtIGxlZnRXaWRlQ2hhckNvdW50XG4gICAgICAgICAgICArIGxlZnRMb25nQ2hhck9mZnNldDtcbiAgICAgICAgdmFyIGxlbmd0aCA9IE1hdGgubWluKHRoaXMuX3Rlcm1pbmFsLmNvbHMsIGVuZEluZGV4XG4gICAgICAgICAgICAtIHN0YXJ0SW5kZXhcbiAgICAgICAgICAgICsgbGVmdFdpZGVDaGFyQ291bnRcbiAgICAgICAgICAgICsgcmlnaHRXaWRlQ2hhckNvdW50XG4gICAgICAgICAgICAtIGxlZnRMb25nQ2hhck9mZnNldFxuICAgICAgICAgICAgLSByaWdodExvbmdDaGFyT2Zmc2V0KTtcbiAgICAgICAgaWYgKCFhbGxvd1doaXRlc3BhY2VPbmx5U2VsZWN0aW9uICYmIGxpbmUuc2xpY2Uoc3RhcnRJbmRleCwgZW5kSW5kZXgpLnRyaW0oKSA9PT0gJycpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmIChmb2xsb3dXcmFwcGVkTGluZXNBYm92ZSkge1xuICAgICAgICAgICAgaWYgKHN0YXJ0ID09PSAwICYmIGJ1ZmZlckxpbmUuZ2V0Q29kZVBvaW50KDApICE9PSAzMikge1xuICAgICAgICAgICAgICAgIHZhciBwcmV2aW91c0J1ZmZlckxpbmUgPSB0aGlzLl9idWZmZXIubGluZXMuZ2V0KGNvb3Jkc1sxXSAtIDEpO1xuICAgICAgICAgICAgICAgIGlmIChwcmV2aW91c0J1ZmZlckxpbmUgJiYgYnVmZmVyTGluZS5pc1dyYXBwZWQgJiYgcHJldmlvdXNCdWZmZXJMaW5lLmdldENvZGVQb2ludCh0aGlzLl90ZXJtaW5hbC5jb2xzIC0gMSkgIT09IDMyKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBwcmV2aW91c0xpbmVXb3JkUG9zaXRpb24gPSB0aGlzLl9nZXRXb3JkQXQoW3RoaXMuX3Rlcm1pbmFsLmNvbHMgLSAxLCBjb29yZHNbMV0gLSAxXSwgZmFsc2UsIHRydWUsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByZXZpb3VzTGluZVdvcmRQb3NpdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG9mZnNldCA9IHRoaXMuX3Rlcm1pbmFsLmNvbHMgLSBwcmV2aW91c0xpbmVXb3JkUG9zaXRpb24uc3RhcnQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydCAtPSBvZmZzZXQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZW5ndGggKz0gb2Zmc2V0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChmb2xsb3dXcmFwcGVkTGluZXNCZWxvdykge1xuICAgICAgICAgICAgaWYgKHN0YXJ0ICsgbGVuZ3RoID09PSB0aGlzLl90ZXJtaW5hbC5jb2xzICYmIGJ1ZmZlckxpbmUuZ2V0Q29kZVBvaW50KHRoaXMuX3Rlcm1pbmFsLmNvbHMgLSAxKSAhPT0gMzIpIHtcbiAgICAgICAgICAgICAgICB2YXIgbmV4dEJ1ZmZlckxpbmUgPSB0aGlzLl9idWZmZXIubGluZXMuZ2V0KGNvb3Jkc1sxXSArIDEpO1xuICAgICAgICAgICAgICAgIGlmIChuZXh0QnVmZmVyTGluZSAmJiBuZXh0QnVmZmVyTGluZS5pc1dyYXBwZWQgJiYgbmV4dEJ1ZmZlckxpbmUuZ2V0Q29kZVBvaW50KDApICE9PSAzMikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmV4dExpbmVXb3JkUG9zaXRpb24gPSB0aGlzLl9nZXRXb3JkQXQoWzAsIGNvb3Jkc1sxXSArIDFdLCBmYWxzZSwgZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobmV4dExpbmVXb3JkUG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxlbmd0aCArPSBuZXh0TGluZVdvcmRQb3NpdGlvbi5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3RhcnQ6IHN0YXJ0LCBsZW5ndGg6IGxlbmd0aCB9O1xuICAgIH07XG4gICAgU2VsZWN0aW9uTWFuYWdlci5wcm90b3R5cGUuX3NlbGVjdFdvcmRBdCA9IGZ1bmN0aW9uIChjb29yZHMsIGFsbG93V2hpdGVzcGFjZU9ubHlTZWxlY3Rpb24pIHtcbiAgICAgICAgdmFyIHdvcmRQb3NpdGlvbiA9IHRoaXMuX2dldFdvcmRBdChjb29yZHMsIGFsbG93V2hpdGVzcGFjZU9ubHlTZWxlY3Rpb24pO1xuICAgICAgICBpZiAod29yZFBvc2l0aW9uKSB7XG4gICAgICAgICAgICB3aGlsZSAod29yZFBvc2l0aW9uLnN0YXJ0IDwgMCkge1xuICAgICAgICAgICAgICAgIHdvcmRQb3NpdGlvbi5zdGFydCArPSB0aGlzLl90ZXJtaW5hbC5jb2xzO1xuICAgICAgICAgICAgICAgIGNvb3Jkc1sxXS0tO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uU3RhcnQgPSBbd29yZFBvc2l0aW9uLnN0YXJ0LCBjb29yZHNbMV1dO1xuICAgICAgICAgICAgdGhpcy5fbW9kZWwuc2VsZWN0aW9uU3RhcnRMZW5ndGggPSB3b3JkUG9zaXRpb24ubGVuZ3RoO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5fc2VsZWN0VG9Xb3JkQXQgPSBmdW5jdGlvbiAoY29vcmRzKSB7XG4gICAgICAgIHZhciB3b3JkUG9zaXRpb24gPSB0aGlzLl9nZXRXb3JkQXQoY29vcmRzLCB0cnVlKTtcbiAgICAgICAgaWYgKHdvcmRQb3NpdGlvbikge1xuICAgICAgICAgICAgdmFyIGVuZFJvdyA9IGNvb3Jkc1sxXTtcbiAgICAgICAgICAgIHdoaWxlICh3b3JkUG9zaXRpb24uc3RhcnQgPCAwKSB7XG4gICAgICAgICAgICAgICAgd29yZFBvc2l0aW9uLnN0YXJ0ICs9IHRoaXMuX3Rlcm1pbmFsLmNvbHM7XG4gICAgICAgICAgICAgICAgZW5kUm93LS07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMuX21vZGVsLmFyZVNlbGVjdGlvblZhbHVlc1JldmVyc2VkKCkpIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAod29yZFBvc2l0aW9uLnN0YXJ0ICsgd29yZFBvc2l0aW9uLmxlbmd0aCA+IHRoaXMuX3Rlcm1pbmFsLmNvbHMpIHtcbiAgICAgICAgICAgICAgICAgICAgd29yZFBvc2l0aW9uLmxlbmd0aCAtPSB0aGlzLl90ZXJtaW5hbC5jb2xzO1xuICAgICAgICAgICAgICAgICAgICBlbmRSb3crKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25FbmQgPSBbdGhpcy5fbW9kZWwuYXJlU2VsZWN0aW9uVmFsdWVzUmV2ZXJzZWQoKSA/IHdvcmRQb3NpdGlvbi5zdGFydCA6IHdvcmRQb3NpdGlvbi5zdGFydCArIHdvcmRQb3NpdGlvbi5sZW5ndGgsIGVuZFJvd107XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFNlbGVjdGlvbk1hbmFnZXIucHJvdG90eXBlLl9pc0NoYXJXb3JkU2VwYXJhdG9yID0gZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgaWYgKGNlbGwuZ2V0V2lkdGgoKSA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBXT1JEX1NFUEFSQVRPUlMuaW5kZXhPZihjZWxsLmdldENoYXJzKCkpID49IDA7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25NYW5hZ2VyLnByb3RvdHlwZS5fc2VsZWN0TGluZUF0ID0gZnVuY3Rpb24gKGxpbmUpIHtcbiAgICAgICAgdmFyIHdyYXBwZWRSYW5nZSA9IHRoaXMuX2J1ZmZlci5nZXRXcmFwcGVkUmFuZ2VGb3JMaW5lKGxpbmUpO1xuICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25TdGFydCA9IFswLCB3cmFwcGVkUmFuZ2UuZmlyc3RdO1xuICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25FbmQgPSBbdGhpcy5fdGVybWluYWwuY29scywgd3JhcHBlZFJhbmdlLmxhc3RdO1xuICAgICAgICB0aGlzLl9tb2RlbC5zZWxlY3Rpb25TdGFydExlbmd0aCA9IDA7XG4gICAgfTtcbiAgICByZXR1cm4gU2VsZWN0aW9uTWFuYWdlcjtcbn0oKSk7XG5leHBvcnRzLlNlbGVjdGlvbk1hbmFnZXIgPSBTZWxlY3Rpb25NYW5hZ2VyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9U2VsZWN0aW9uTWFuYWdlci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBTZWxlY3Rpb25Nb2RlbCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gU2VsZWN0aW9uTW9kZWwoX3Rlcm1pbmFsKSB7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsID0gX3Rlcm1pbmFsO1xuICAgICAgICB0aGlzLmNsZWFyU2VsZWN0aW9uKCk7XG4gICAgfVxuICAgIFNlbGVjdGlvbk1vZGVsLnByb3RvdHlwZS5jbGVhclNlbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25TdGFydCA9IG51bGw7XG4gICAgICAgIHRoaXMuc2VsZWN0aW9uRW5kID0gbnVsbDtcbiAgICAgICAgdGhpcy5pc1NlbGVjdEFsbEFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLnNlbGVjdGlvblN0YXJ0TGVuZ3RoID0gMDtcbiAgICB9O1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTZWxlY3Rpb25Nb2RlbC5wcm90b3R5cGUsIFwiZmluYWxTZWxlY3Rpb25TdGFydFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNTZWxlY3RBbGxBY3RpdmUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gWzAsIDBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0aGlzLnNlbGVjdGlvbkVuZCB8fCAhdGhpcy5zZWxlY3Rpb25TdGFydCkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvblN0YXJ0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXJlU2VsZWN0aW9uVmFsdWVzUmV2ZXJzZWQoKSA/IHRoaXMuc2VsZWN0aW9uRW5kIDogdGhpcy5zZWxlY3Rpb25TdGFydDtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNlbGVjdGlvbk1vZGVsLnByb3RvdHlwZSwgXCJmaW5hbFNlbGVjdGlvbkVuZFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNTZWxlY3RBbGxBY3RpdmUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gW3RoaXMuX3Rlcm1pbmFsLmNvbHMsIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55YmFzZSArIHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGhpcy5zZWxlY3Rpb25TdGFydCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCF0aGlzLnNlbGVjdGlvbkVuZCB8fCB0aGlzLmFyZVNlbGVjdGlvblZhbHVlc1JldmVyc2VkKCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgc3RhcnRQbHVzTGVuZ3RoID0gdGhpcy5zZWxlY3Rpb25TdGFydFswXSArIHRoaXMuc2VsZWN0aW9uU3RhcnRMZW5ndGg7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXJ0UGx1c0xlbmd0aCA+IHRoaXMuX3Rlcm1pbmFsLmNvbHMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFtzdGFydFBsdXNMZW5ndGggJSB0aGlzLl90ZXJtaW5hbC5jb2xzLCB0aGlzLnNlbGVjdGlvblN0YXJ0WzFdICsgTWF0aC5mbG9vcihzdGFydFBsdXNMZW5ndGggLyB0aGlzLl90ZXJtaW5hbC5jb2xzKV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBbc3RhcnRQbHVzTGVuZ3RoLCB0aGlzLnNlbGVjdGlvblN0YXJ0WzFdXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGlvblN0YXJ0TGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uRW5kWzFdID09PSB0aGlzLnNlbGVjdGlvblN0YXJ0WzFdKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbTWF0aC5tYXgodGhpcy5zZWxlY3Rpb25TdGFydFswXSArIHRoaXMuc2VsZWN0aW9uU3RhcnRMZW5ndGgsIHRoaXMuc2VsZWN0aW9uRW5kWzBdKSwgdGhpcy5zZWxlY3Rpb25FbmRbMV1dO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbkVuZDtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgU2VsZWN0aW9uTW9kZWwucHJvdG90eXBlLmFyZVNlbGVjdGlvblZhbHVlc1JldmVyc2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc3RhcnQgPSB0aGlzLnNlbGVjdGlvblN0YXJ0O1xuICAgICAgICB2YXIgZW5kID0gdGhpcy5zZWxlY3Rpb25FbmQ7XG4gICAgICAgIGlmICghc3RhcnQgfHwgIWVuZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzdGFydFsxXSA+IGVuZFsxXSB8fCAoc3RhcnRbMV0gPT09IGVuZFsxXSAmJiBzdGFydFswXSA+IGVuZFswXSk7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25Nb2RlbC5wcm90b3R5cGUub25UcmltID0gZnVuY3Rpb24gKGFtb3VudCkge1xuICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25TdGFydCkge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25TdGFydFsxXSAtPSBhbW91bnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uRW5kKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvbkVuZFsxXSAtPSBhbW91bnQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uRW5kICYmIHRoaXMuc2VsZWN0aW9uRW5kWzFdIDwgMCkge1xuICAgICAgICAgICAgdGhpcy5jbGVhclNlbGVjdGlvbigpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uU3RhcnQgJiYgdGhpcy5zZWxlY3Rpb25TdGFydFsxXSA8IDApIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9uU3RhcnRbMV0gPSAwO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIHJldHVybiBTZWxlY3Rpb25Nb2RlbDtcbn0oKSk7XG5leHBvcnRzLlNlbGVjdGlvbk1vZGVsID0gU2VsZWN0aW9uTW9kZWw7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1TZWxlY3Rpb25Nb2RlbC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuREVGQVVMVF9CRUxMX1NPVU5EID0gJ2RhdGE6YXVkaW8vd2F2O2Jhc2U2NCxVa2xHUmlnQkFBQlhRVlpGWm0xMElCQUFBQUFCQUFFQVJLd0FBSWhZQVFBQ0FCQUFaR0YwWVFRQkFBRHBBRmdDd0FNbEJab0cvd2RtQ2NvS1JBeXBEUThQYlJEQkVRUVRPeFJ0RlljV2xCZVBHSVVaWGhvaUc4OGJjQno3SEhJZHpoMFdIbE1lWng1MUhta2VVeDRXSHM4ZGFoMEFIWHdjM2hzOUc0c2F4Um55R0JJWUdCY1FGdjhVNFJQQUVvWVJRQkFDRDcwTld3d0hDNmdKT3dqV0Jsb0Y3Z09CQWhBQmtmOGIvcXY4Ui92ZStYZjRJZmU3OVcvMEpmUFo4Wi93ZGU5TjdpanRFK3dVNnh2cU0rbGI2SDdudytZWDVtcmx4dVF6NU16amUrTWE0OWZpb2VLRDRuWGlZZUp5NHBIaXRPTDA0ai9qbitNTjVJUGtGT1dzNVUzbURlZk01NS9vZ09sMzZtN3JkT3lFN2FidXl1OEQ4VW55ai9QZzlELzJxZmNiK1luNi92dUsvUWovbEFBbEFnPT0nO1xudmFyIFNvdW5kTWFuYWdlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gU291bmRNYW5hZ2VyKF90ZXJtaW5hbCkge1xuICAgICAgICB0aGlzLl90ZXJtaW5hbCA9IF90ZXJtaW5hbDtcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNvdW5kTWFuYWdlciwgXCJhdWRpb0NvbnRleHRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICghU291bmRNYW5hZ2VyLl9hdWRpb0NvbnRleHQpIHtcbiAgICAgICAgICAgICAgICB2YXIgYXVkaW9Db250ZXh0Q3RvciA9IHdpbmRvdy5BdWRpb0NvbnRleHQgfHwgd2luZG93LndlYmtpdEF1ZGlvQ29udGV4dDtcbiAgICAgICAgICAgICAgICBpZiAoIWF1ZGlvQ29udGV4dEN0b3IpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS53YXJuKCdXZWIgQXVkaW8gQVBJIGlzIG5vdCBzdXBwb3J0ZWQgYnkgdGhpcyBicm93c2VyLiBDb25zaWRlciB1cGdyYWRpbmcgdG8gdGhlIGxhdGVzdCB2ZXJzaW9uJyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBTb3VuZE1hbmFnZXIuX2F1ZGlvQ29udGV4dCA9IG5ldyBhdWRpb0NvbnRleHRDdG9yKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gU291bmRNYW5hZ2VyLl9hdWRpb0NvbnRleHQ7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIFNvdW5kTWFuYWdlci5wcm90b3R5cGUucGxheUJlbGxTb3VuZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGN0eCA9IFNvdW5kTWFuYWdlci5hdWRpb0NvbnRleHQ7XG4gICAgICAgIGlmICghY3R4KSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGJlbGxBdWRpb1NvdXJjZSA9IGN0eC5jcmVhdGVCdWZmZXJTb3VyY2UoKTtcbiAgICAgICAgY3R4LmRlY29kZUF1ZGlvRGF0YSh0aGlzLl9iYXNlNjRUb0FycmF5QnVmZmVyKHRoaXMuX3JlbW92ZU1pbWVUeXBlKHRoaXMuX3Rlcm1pbmFsLm9wdGlvbnMuYmVsbFNvdW5kKSksIGZ1bmN0aW9uIChidWZmZXIpIHtcbiAgICAgICAgICAgIGJlbGxBdWRpb1NvdXJjZS5idWZmZXIgPSBidWZmZXI7XG4gICAgICAgICAgICBiZWxsQXVkaW9Tb3VyY2UuY29ubmVjdChjdHguZGVzdGluYXRpb24pO1xuICAgICAgICAgICAgYmVsbEF1ZGlvU291cmNlLnN0YXJ0KDApO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFNvdW5kTWFuYWdlci5wcm90b3R5cGUuX2Jhc2U2NFRvQXJyYXlCdWZmZXIgPSBmdW5jdGlvbiAoYmFzZTY0KSB7XG4gICAgICAgIHZhciBiaW5hcnlTdHJpbmcgPSB3aW5kb3cuYXRvYihiYXNlNjQpO1xuICAgICAgICB2YXIgbGVuID0gYmluYXJ5U3RyaW5nLmxlbmd0aDtcbiAgICAgICAgdmFyIGJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkobGVuKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgYnl0ZXNbaV0gPSBiaW5hcnlTdHJpbmcuY2hhckNvZGVBdChpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYnl0ZXMuYnVmZmVyO1xuICAgIH07XG4gICAgU291bmRNYW5hZ2VyLnByb3RvdHlwZS5fcmVtb3ZlTWltZVR5cGUgPSBmdW5jdGlvbiAoZGF0YVVSSSkge1xuICAgICAgICB2YXIgc3BsaXRVcmkgPSBkYXRhVVJJLnNwbGl0KCcsJyk7XG4gICAgICAgIHJldHVybiBzcGxpdFVyaVsxXTtcbiAgICB9O1xuICAgIHJldHVybiBTb3VuZE1hbmFnZXI7XG59KCkpO1xuZXhwb3J0cy5Tb3VuZE1hbmFnZXIgPSBTb3VuZE1hbmFnZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1Tb3VuZE1hbmFnZXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLmJsYW5rTGluZSA9ICdCbGFuayBsaW5lJztcbmV4cG9ydHMucHJvbXB0TGFiZWwgPSAnVGVybWluYWwgaW5wdXQnO1xuZXhwb3J0cy50b29NdWNoT3V0cHV0ID0gJ1RvbyBtdWNoIG91dHB1dCB0byBhbm5vdW5jZSwgbmF2aWdhdGUgdG8gcm93cyBtYW51YWxseSB0byByZWFkJztcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVN0cmluZ3MuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBCdWZmZXJTZXRfMSA9IHJlcXVpcmUoXCIuL0J1ZmZlclNldFwiKTtcbnZhciBCdWZmZXJfMSA9IHJlcXVpcmUoXCIuL0J1ZmZlclwiKTtcbnZhciBDb21wb3NpdGlvbkhlbHBlcl8xID0gcmVxdWlyZShcIi4vQ29tcG9zaXRpb25IZWxwZXJcIik7XG52YXIgRXZlbnRFbWl0dGVyXzEgPSByZXF1aXJlKFwiLi9jb21tb24vRXZlbnRFbWl0dGVyXCIpO1xudmFyIFZpZXdwb3J0XzEgPSByZXF1aXJlKFwiLi9WaWV3cG9ydFwiKTtcbnZhciBDbGlwYm9hcmRfMSA9IHJlcXVpcmUoXCIuL0NsaXBib2FyZFwiKTtcbnZhciBFc2NhcGVTZXF1ZW5jZXNfMSA9IHJlcXVpcmUoXCIuL2NvbW1vbi9kYXRhL0VzY2FwZVNlcXVlbmNlc1wiKTtcbnZhciBJbnB1dEhhbmRsZXJfMSA9IHJlcXVpcmUoXCIuL0lucHV0SGFuZGxlclwiKTtcbnZhciBSZW5kZXJlcl8xID0gcmVxdWlyZShcIi4vcmVuZGVyZXIvUmVuZGVyZXJcIik7XG52YXIgTGlua2lmaWVyXzEgPSByZXF1aXJlKFwiLi9MaW5raWZpZXJcIik7XG52YXIgU2VsZWN0aW9uTWFuYWdlcl8xID0gcmVxdWlyZShcIi4vU2VsZWN0aW9uTWFuYWdlclwiKTtcbnZhciBDaGFyTWVhc3VyZV8xID0gcmVxdWlyZShcIi4vQ2hhck1lYXN1cmVcIik7XG52YXIgQnJvd3NlciA9IHJlcXVpcmUoXCIuL2NvbW1vbi9QbGF0Zm9ybVwiKTtcbnZhciBMaWZlY3ljbGVfMSA9IHJlcXVpcmUoXCIuL3VpL0xpZmVjeWNsZVwiKTtcbnZhciBTdHJpbmdzID0gcmVxdWlyZShcIi4vU3RyaW5nc1wiKTtcbnZhciBNb3VzZUhlbHBlcl8xID0gcmVxdWlyZShcIi4vTW91c2VIZWxwZXJcIik7XG52YXIgU291bmRNYW5hZ2VyXzEgPSByZXF1aXJlKFwiLi9Tb3VuZE1hbmFnZXJcIik7XG52YXIgTW91c2Vab25lTWFuYWdlcl8xID0gcmVxdWlyZShcIi4vTW91c2Vab25lTWFuYWdlclwiKTtcbnZhciBBY2Nlc3NpYmlsaXR5TWFuYWdlcl8xID0gcmVxdWlyZShcIi4vQWNjZXNzaWJpbGl0eU1hbmFnZXJcIik7XG52YXIgU2NyZWVuRHByTW9uaXRvcl8xID0gcmVxdWlyZShcIi4vdWkvU2NyZWVuRHByTW9uaXRvclwiKTtcbnZhciBDaGFyQXRsYXNDYWNoZV8xID0gcmVxdWlyZShcIi4vcmVuZGVyZXIvYXRsYXMvQ2hhckF0bGFzQ2FjaGVcIik7XG52YXIgRG9tUmVuZGVyZXJfMSA9IHJlcXVpcmUoXCIuL3JlbmRlcmVyL2RvbS9Eb21SZW5kZXJlclwiKTtcbnZhciBLZXlib2FyZF8xID0gcmVxdWlyZShcIi4vY29yZS9pbnB1dC9LZXlib2FyZFwiKTtcbnZhciBDbG9uZV8xID0gcmVxdWlyZShcIi4vY29tbW9uL0Nsb25lXCIpO1xudmFyIEV2ZW50RW1pdHRlcjJfMSA9IHJlcXVpcmUoXCIuL2NvbW1vbi9FdmVudEVtaXR0ZXIyXCIpO1xudmFyIEJ1ZmZlckxpbmVfMSA9IHJlcXVpcmUoXCIuL2NvcmUvYnVmZmVyL0J1ZmZlckxpbmVcIik7XG52YXIgV2luZG93c01vZGVfMSA9IHJlcXVpcmUoXCIuL1dpbmRvd3NNb2RlXCIpO1xudmFyIGRvY3VtZW50ID0gKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSA/IHdpbmRvdy5kb2N1bWVudCA6IG51bGw7XG52YXIgV1JJVEVfQlVGRkVSX1BBVVNFX1RIUkVTSE9MRCA9IDU7XG52YXIgV1JJVEVfVElNRU9VVF9NUyA9IDEyO1xudmFyIE1JTklNVU1fQ09MUyA9IDI7XG52YXIgTUlOSU1VTV9ST1dTID0gMTtcbnZhciBDT05TVFJVQ1RPUl9PTkxZX09QVElPTlMgPSBbJ2NvbHMnLCAncm93cyddO1xudmFyIERFRkFVTFRfT1BUSU9OUyA9IHtcbiAgICBjb2xzOiA4MCxcbiAgICByb3dzOiAyNCxcbiAgICBjb252ZXJ0RW9sOiBmYWxzZSxcbiAgICB0ZXJtTmFtZTogJ3h0ZXJtJyxcbiAgICBjdXJzb3JCbGluazogZmFsc2UsXG4gICAgY3Vyc29yU3R5bGU6ICdibG9jaycsXG4gICAgYmVsbFNvdW5kOiBTb3VuZE1hbmFnZXJfMS5ERUZBVUxUX0JFTExfU09VTkQsXG4gICAgYmVsbFN0eWxlOiAnbm9uZScsXG4gICAgZHJhd0JvbGRUZXh0SW5CcmlnaHRDb2xvcnM6IHRydWUsXG4gICAgZW5hYmxlQm9sZDogdHJ1ZSxcbiAgICBleHBlcmltZW50YWxDaGFyQXRsYXM6ICdzdGF0aWMnLFxuICAgIGZvbnRGYW1pbHk6ICdjb3VyaWVyLW5ldywgY291cmllciwgbW9ub3NwYWNlJyxcbiAgICBmb250U2l6ZTogMTUsXG4gICAgZm9udFdlaWdodDogJ25vcm1hbCcsXG4gICAgZm9udFdlaWdodEJvbGQ6ICdib2xkJyxcbiAgICBsaW5lSGVpZ2h0OiAxLjAsXG4gICAgbGV0dGVyU3BhY2luZzogMCxcbiAgICBzY3JvbGxiYWNrOiAxMDAwLFxuICAgIHNjcmVlbktleXM6IGZhbHNlLFxuICAgIHNjcmVlblJlYWRlck1vZGU6IGZhbHNlLFxuICAgIGRlYnVnOiBmYWxzZSxcbiAgICBtYWNPcHRpb25Jc01ldGE6IGZhbHNlLFxuICAgIG1hY09wdGlvbkNsaWNrRm9yY2VzU2VsZWN0aW9uOiBmYWxzZSxcbiAgICBjYW5jZWxFdmVudHM6IGZhbHNlLFxuICAgIGRpc2FibGVTdGRpbjogZmFsc2UsXG4gICAgdXNlRmxvd0NvbnRyb2w6IGZhbHNlLFxuICAgIGFsbG93VHJhbnNwYXJlbmN5OiBmYWxzZSxcbiAgICB0YWJTdG9wV2lkdGg6IDgsXG4gICAgdGhlbWU6IG51bGwsXG4gICAgcmlnaHRDbGlja1NlbGVjdHNXb3JkOiBCcm93c2VyLmlzTWFjLFxuICAgIHJlbmRlcmVyVHlwZTogJ2NhbnZhcycsXG4gICAgd2luZG93c01vZGU6IGZhbHNlXG59O1xudmFyIFRlcm1pbmFsID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoVGVybWluYWwsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gVGVybWluYWwob3B0aW9ucykge1xuICAgICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7IG9wdGlvbnMgPSB7fTsgfVxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5icm93c2VyID0gQnJvd3NlcjtcbiAgICAgICAgX3RoaXMuX2JsYW5rTGluZSA9IG51bGw7XG4gICAgICAgIF90aGlzLl9vbkN1cnNvck1vdmUgPSBuZXcgRXZlbnRFbWl0dGVyMl8xLkV2ZW50RW1pdHRlcjIoKTtcbiAgICAgICAgX3RoaXMuX29uRGF0YSA9IG5ldyBFdmVudEVtaXR0ZXIyXzEuRXZlbnRFbWl0dGVyMigpO1xuICAgICAgICBfdGhpcy5fb25LZXkgPSBuZXcgRXZlbnRFbWl0dGVyMl8xLkV2ZW50RW1pdHRlcjIoKTtcbiAgICAgICAgX3RoaXMuX29uTGluZUZlZWQgPSBuZXcgRXZlbnRFbWl0dGVyMl8xLkV2ZW50RW1pdHRlcjIoKTtcbiAgICAgICAgX3RoaXMuX29uUmVuZGVyID0gbmV3IEV2ZW50RW1pdHRlcjJfMS5FdmVudEVtaXR0ZXIyKCk7XG4gICAgICAgIF90aGlzLl9vblJlc2l6ZSA9IG5ldyBFdmVudEVtaXR0ZXIyXzEuRXZlbnRFbWl0dGVyMigpO1xuICAgICAgICBfdGhpcy5fb25TY3JvbGwgPSBuZXcgRXZlbnRFbWl0dGVyMl8xLkV2ZW50RW1pdHRlcjIoKTtcbiAgICAgICAgX3RoaXMuX29uU2VsZWN0aW9uQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjJfMS5FdmVudEVtaXR0ZXIyKCk7XG4gICAgICAgIF90aGlzLl9vblRpdGxlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcjJfMS5FdmVudEVtaXR0ZXIyKCk7XG4gICAgICAgIF90aGlzLm9wdGlvbnMgPSBDbG9uZV8xLmNsb25lKG9wdGlvbnMpO1xuICAgICAgICBfdGhpcy5fc2V0dXAoKTtcbiAgICAgICAgX3RoaXMub25DdXJzb3JNb3ZlKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLmVtaXQoJ2N1cnNvcm1vdmUnKTsgfSk7XG4gICAgICAgIF90aGlzLm9uRGF0YShmdW5jdGlvbiAoZSkgeyByZXR1cm4gX3RoaXMuZW1pdCgnZGF0YScsIGUpOyB9KTtcbiAgICAgICAgX3RoaXMub25LZXkoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLmVtaXQoJ2tleScsIGUua2V5LCBlLmRvbUV2ZW50KTsgfSk7XG4gICAgICAgIF90aGlzLm9uTGluZUZlZWQoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuZW1pdCgnbGluZWZlZWQnKTsgfSk7XG4gICAgICAgIF90aGlzLm9uUmVuZGVyKGZ1bmN0aW9uIChlKSB7IHJldHVybiBfdGhpcy5lbWl0KCdyZWZyZXNoJywgZSk7IH0pO1xuICAgICAgICBfdGhpcy5vblJlc2l6ZShmdW5jdGlvbiAoZSkgeyByZXR1cm4gX3RoaXMuZW1pdCgncmVzaXplJywgZSk7IH0pO1xuICAgICAgICBfdGhpcy5vblNlbGVjdGlvbkNoYW5nZShmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5lbWl0KCdzZWxlY3Rpb24nKTsgfSk7XG4gICAgICAgIF90aGlzLm9uU2Nyb2xsKGZ1bmN0aW9uIChlKSB7IHJldHVybiBfdGhpcy5lbWl0KCdzY3JvbGwnLCBlKTsgfSk7XG4gICAgICAgIF90aGlzLm9uVGl0bGVDaGFuZ2UoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLmVtaXQoJ3RpdGxlJywgZSk7IH0pO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwib25DdXJzb3JNb3ZlXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9vbkN1cnNvck1vdmUuZXZlbnQ7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwib25EYXRhXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9vbkRhdGEuZXZlbnQ7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwib25LZXlcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX29uS2V5LmV2ZW50OyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVGVybWluYWwucHJvdG90eXBlLCBcIm9uTGluZUZlZWRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX29uTGluZUZlZWQuZXZlbnQ7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwib25SZW5kZXJcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX29uUmVuZGVyLmV2ZW50OyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVGVybWluYWwucHJvdG90eXBlLCBcIm9uUmVzaXplXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9vblJlc2l6ZS5ldmVudDsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFRlcm1pbmFsLnByb3RvdHlwZSwgXCJvblNjcm9sbFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fb25TY3JvbGwuZXZlbnQ7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwib25TZWxlY3Rpb25DaGFuZ2VcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX29uU2VsZWN0aW9uQ2hhbmdlLmV2ZW50OyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVGVybWluYWwucHJvdG90eXBlLCBcIm9uVGl0bGVDaGFuZ2VcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX29uVGl0bGVDaGFuZ2UuZXZlbnQ7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmRpc3Bvc2UuY2FsbCh0aGlzKTtcbiAgICAgICAgaWYgKHRoaXMuX3dpbmRvd3NNb2RlKSB7XG4gICAgICAgICAgICB0aGlzLl93aW5kb3dzTW9kZS5kaXNwb3NlKCk7XG4gICAgICAgICAgICB0aGlzLl93aW5kb3dzTW9kZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9jdXN0b21LZXlFdmVudEhhbmRsZXIgPSBudWxsO1xuICAgICAgICBDaGFyQXRsYXNDYWNoZV8xLnJlbW92ZVRlcm1pbmFsRnJvbUNhY2hlKHRoaXMpO1xuICAgICAgICB0aGlzLmhhbmRsZXIgPSBmdW5jdGlvbiAoKSB7IH07XG4gICAgICAgIHRoaXMud3JpdGUgPSBmdW5jdGlvbiAoKSB7IH07XG4gICAgICAgIGlmICh0aGlzLmVsZW1lbnQgJiYgdGhpcy5lbGVtZW50LnBhcmVudE5vZGUpIHtcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZWxlbWVudCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmRpc3Bvc2UoKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5fc2V0dXAgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIE9iamVjdC5rZXlzKERFRkFVTFRfT1BUSU9OUykuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICBpZiAoX3RoaXMub3B0aW9uc1trZXldID09PSBudWxsIHx8IF90aGlzLm9wdGlvbnNba2V5XSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMub3B0aW9uc1trZXldID0gREVGQVVMVF9PUFRJT05TW2tleV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl9wYXJlbnQgPSBkb2N1bWVudCA/IGRvY3VtZW50LmJvZHkgOiBudWxsO1xuICAgICAgICB0aGlzLmNvbHMgPSBNYXRoLm1heCh0aGlzLm9wdGlvbnMuY29scywgTUlOSU1VTV9DT0xTKTtcbiAgICAgICAgdGhpcy5yb3dzID0gTWF0aC5tYXgodGhpcy5vcHRpb25zLnJvd3MsIE1JTklNVU1fUk9XUyk7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaGFuZGxlcikge1xuICAgICAgICAgICAgdGhpcy5vbkRhdGEodGhpcy5vcHRpb25zLmhhbmRsZXIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY3Vyc29yU3RhdGUgPSAwO1xuICAgICAgICB0aGlzLmN1cnNvckhpZGRlbiA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9jdXN0b21LZXlFdmVudEhhbmRsZXIgPSBudWxsO1xuICAgICAgICB0aGlzLmFwcGxpY2F0aW9uS2V5cGFkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuYXBwbGljYXRpb25DdXJzb3IgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5vcmlnaW5Nb2RlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuaW5zZXJ0TW9kZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLndyYXBhcm91bmRNb2RlID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5icmFja2V0ZWRQYXN0ZU1vZGUgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5jaGFyc2V0ID0gbnVsbDtcbiAgICAgICAgdGhpcy5nY2hhcnNldCA9IG51bGw7XG4gICAgICAgIHRoaXMuZ2xldmVsID0gMDtcbiAgICAgICAgdGhpcy5jaGFyc2V0cyA9IFtudWxsXTtcbiAgICAgICAgdGhpcy5jdXJBdHRyRGF0YSA9IEJ1ZmZlckxpbmVfMS5ERUZBVUxUX0FUVFJfREFUQS5jbG9uZSgpO1xuICAgICAgICB0aGlzLl9lcmFzZUF0dHJEYXRhID0gQnVmZmVyTGluZV8xLkRFRkFVTFRfQVRUUl9EQVRBLmNsb25lKCk7XG4gICAgICAgIHRoaXMucGFyYW1zID0gW107XG4gICAgICAgIHRoaXMuY3VycmVudFBhcmFtID0gMDtcbiAgICAgICAgdGhpcy53cml0ZUJ1ZmZlciA9IFtdO1xuICAgICAgICB0aGlzLl93cml0ZUluUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5feG9mZlNlbnRUb0NhdGNoVXAgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fdXNlclNjcm9sbGluZyA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9pbnB1dEhhbmRsZXIgPSBuZXcgSW5wdXRIYW5kbGVyXzEuSW5wdXRIYW5kbGVyKHRoaXMpO1xuICAgICAgICB0aGlzLl9pbnB1dEhhbmRsZXIub25DdXJzb3JNb3ZlKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9vbkN1cnNvck1vdmUuZmlyZSgpOyB9KTtcbiAgICAgICAgdGhpcy5faW5wdXRIYW5kbGVyLm9uTGluZUZlZWQoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX29uTGluZUZlZWQuZmlyZSgpOyB9KTtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih0aGlzLl9pbnB1dEhhbmRsZXIpO1xuICAgICAgICB0aGlzLnJlbmRlcmVyID0gdGhpcy5yZW5kZXJlciB8fCBudWxsO1xuICAgICAgICB0aGlzLnNlbGVjdGlvbk1hbmFnZXIgPSB0aGlzLnNlbGVjdGlvbk1hbmFnZXIgfHwgbnVsbDtcbiAgICAgICAgdGhpcy5saW5raWZpZXIgPSB0aGlzLmxpbmtpZmllciB8fCBuZXcgTGlua2lmaWVyXzEuTGlua2lmaWVyKHRoaXMpO1xuICAgICAgICB0aGlzLl9tb3VzZVpvbmVNYW5hZ2VyID0gdGhpcy5fbW91c2Vab25lTWFuYWdlciB8fCBudWxsO1xuICAgICAgICB0aGlzLnNvdW5kTWFuYWdlciA9IHRoaXMuc291bmRNYW5hZ2VyIHx8IG5ldyBTb3VuZE1hbmFnZXJfMS5Tb3VuZE1hbmFnZXIodGhpcyk7XG4gICAgICAgIHRoaXMuYnVmZmVycyA9IG5ldyBCdWZmZXJTZXRfMS5CdWZmZXJTZXQodGhpcyk7XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbk1hbmFnZXIpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9uTWFuYWdlci5jbGVhclNlbGVjdGlvbigpO1xuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25NYW5hZ2VyLmluaXRCdWZmZXJzTGlzdGVuZXJzKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy53aW5kb3dzTW9kZSkge1xuICAgICAgICAgICAgdGhpcy5fd2luZG93c01vZGUgPSBXaW5kb3dzTW9kZV8xLmFwcGx5V2luZG93c01vZGUodGhpcyk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwiYnVmZmVyXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5idWZmZXJzLmFjdGl2ZTtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgVGVybWluYWwucHJvdG90eXBlLmVyYXNlQXR0ckRhdGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2VyYXNlQXR0ckRhdGEuYmcgJj0gfig1MDMzMTY0OCB8IDB4RkZGRkZGKTtcbiAgICAgICAgdGhpcy5fZXJhc2VBdHRyRGF0YS5iZyB8PSB0aGlzLmN1ckF0dHJEYXRhLmJnICYgfjB4RkMwMDAwMDA7XG4gICAgICAgIHJldHVybiB0aGlzLl9lcmFzZUF0dHJEYXRhO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLmZvY3VzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy50ZXh0YXJlYSkge1xuICAgICAgICAgICAgdGhpcy50ZXh0YXJlYS5mb2N1cyh7IHByZXZlbnRTY3JvbGw6IHRydWUgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwiaXNGb2N1c2VkXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCA9PT0gdGhpcy50ZXh0YXJlYSAmJiBkb2N1bWVudC5oYXNGb2N1cygpO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuZ2V0T3B0aW9uID0gZnVuY3Rpb24gKGtleSkge1xuICAgICAgICBpZiAoIShrZXkgaW4gREVGQVVMVF9PUFRJT05TKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBvcHRpb24gd2l0aCBrZXkgXCInICsga2V5ICsgJ1wiJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9uc1trZXldO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnNldE9wdGlvbiA9IGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICAgIGlmICghKGtleSBpbiBERUZBVUxUX09QVElPTlMpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIG9wdGlvbiB3aXRoIGtleSBcIicgKyBrZXkgKyAnXCInKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoQ09OU1RSVUNUT1JfT05MWV9PUFRJT05TLmluZGV4T2Yoa2V5KSAhPT0gLTEpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJPcHRpb24gXFxcIlwiICsga2V5ICsgXCJcXFwiIGNhbiBvbmx5IGJlIHNldCBpbiB0aGUgY29uc3RydWN0b3JcIik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMub3B0aW9uc1trZXldID09PSB2YWx1ZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHN3aXRjaCAoa2V5KSB7XG4gICAgICAgICAgICBjYXNlICdiZWxsU3R5bGUnOlxuICAgICAgICAgICAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAnbm9uZSc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnY3Vyc29yU3R5bGUnOlxuICAgICAgICAgICAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAnYmxvY2snO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2ZvbnRXZWlnaHQnOlxuICAgICAgICAgICAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUgPSAnbm9ybWFsJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdmb250V2VpZ2h0Qm9sZCc6XG4gICAgICAgICAgICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICdib2xkJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdsaW5lSGVpZ2h0JzpcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPCAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihrZXkgKyBcIiBjYW5ub3QgYmUgbGVzcyB0aGFuIDEsIHZhbHVlOiBcIiArIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhc2UgJ3JlbmRlcmVyVHlwZSc6XG4gICAgICAgICAgICAgICAgaWYgKCF2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZSA9ICdjYW52YXMnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3RhYlN0b3BXaWR0aCc6XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlIDwgMSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oa2V5ICsgXCIgY2Fubm90IGJlIGxlc3MgdGhhbiAxLCB2YWx1ZTogXCIgKyB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd0aGVtZSc6XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucmVuZGVyZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0VGhlbWUodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnc2Nyb2xsYmFjayc6XG4gICAgICAgICAgICAgICAgdmFsdWUgPSBNYXRoLm1pbih2YWx1ZSwgQnVmZmVyXzEuTUFYX0JVRkZFUl9TSVpFKTtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUgPCAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihrZXkgKyBcIiBjYW5ub3QgYmUgbGVzcyB0aGFuIDAsIHZhbHVlOiBcIiArIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vcHRpb25zW2tleV0gIT09IHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXdCdWZmZXJMZW5ndGggPSB0aGlzLnJvd3MgKyB2YWx1ZTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYnVmZmVyLmxpbmVzLmxlbmd0aCA+IG5ld0J1ZmZlckxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFtb3VudFRvVHJpbSA9IHRoaXMuYnVmZmVyLmxpbmVzLmxlbmd0aCAtIG5ld0J1ZmZlckxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZWVkc1JlZnJlc2ggPSAodGhpcy5idWZmZXIueWRpc3AgLSBhbW91bnRUb1RyaW0gPCAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuYnVmZmVyLmxpbmVzLnRyaW1TdGFydChhbW91bnRUb1RyaW0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5idWZmZXIueWJhc2UgPSBNYXRoLm1heCh0aGlzLmJ1ZmZlci55YmFzZSAtIGFtb3VudFRvVHJpbSwgMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlci55ZGlzcCA9IE1hdGgubWF4KHRoaXMuYnVmZmVyLnlkaXNwIC0gYW1vdW50VG9UcmltLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZWVkc1JlZnJlc2gpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZnJlc2goMCwgdGhpcy5yb3dzIC0gMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vcHRpb25zW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgc3dpdGNoIChrZXkpIHtcbiAgICAgICAgICAgIGNhc2UgJ2ZvbnRGYW1pbHknOlxuICAgICAgICAgICAgY2FzZSAnZm9udFNpemUnOlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlbmRlcmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuY2xlYXIoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jaGFyTWVhc3VyZS5tZWFzdXJlKHRoaXMub3B0aW9ucyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnZHJhd0JvbGRUZXh0SW5CcmlnaHRDb2xvcnMnOlxuICAgICAgICAgICAgY2FzZSAnZXhwZXJpbWVudGFsQ2hhckF0bGFzJzpcbiAgICAgICAgICAgIGNhc2UgJ2VuYWJsZUJvbGQnOlxuICAgICAgICAgICAgY2FzZSAnbGV0dGVyU3BhY2luZyc6XG4gICAgICAgICAgICBjYXNlICdsaW5lSGVpZ2h0JzpcbiAgICAgICAgICAgIGNhc2UgJ2ZvbnRXZWlnaHQnOlxuICAgICAgICAgICAgY2FzZSAnZm9udFdlaWdodEJvbGQnOlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlbmRlcmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuY2xlYXIoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5vblJlc2l6ZSh0aGlzLmNvbHMsIHRoaXMucm93cyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVmcmVzaCgwLCB0aGlzLnJvd3MgLSAxKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdyZW5kZXJlclR5cGUnOlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJlbmRlcmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudW5yZWdpc3Rlcih0aGlzLnJlbmRlcmVyKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5kaXNwb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLl9zZXR1cFJlbmRlcmVyKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5vbkNoYXJTaXplQ2hhbmdlZCgpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl90aGVtZSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFRoZW1lKHRoaXMuX3RoZW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5tb3VzZUhlbHBlci5zZXRSZW5kZXJlcih0aGlzLnJlbmRlcmVyKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3Njcm9sbGJhY2snOlxuICAgICAgICAgICAgICAgIHRoaXMuYnVmZmVycy5yZXNpemUodGhpcy5jb2xzLCB0aGlzLnJvd3MpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnZpZXdwb3J0KSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmlld3BvcnQuc3luY1Njcm9sbEFyZWEoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICdzY3JlZW5SZWFkZXJNb2RlJzpcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLl9hY2Nlc3NpYmlsaXR5TWFuYWdlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fYWNjZXNzaWJpbGl0eU1hbmFnZXIgPSBuZXcgQWNjZXNzaWJpbGl0eU1hbmFnZXJfMS5BY2Nlc3NpYmlsaXR5TWFuYWdlcih0aGlzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2FjY2Vzc2liaWxpdHlNYW5hZ2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hY2Nlc3NpYmlsaXR5TWFuYWdlci5kaXNwb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9hY2Nlc3NpYmlsaXR5TWFuYWdlciA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd0YWJTdG9wV2lkdGgnOlxuICAgICAgICAgICAgICAgIHRoaXMuYnVmZmVycy5zZXR1cFRhYlN0b3BzKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlICd3aW5kb3dzTW9kZSc6XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy5fd2luZG93c01vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3dpbmRvd3NNb2RlID0gV2luZG93c01vZGVfMS5hcHBseVdpbmRvd3NNb2RlKHRoaXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fd2luZG93c01vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3dpbmRvd3NNb2RlLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX3dpbmRvd3NNb2RlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnJlbmRlcmVyKSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLm9uT3B0aW9uc0NoYW5nZWQoKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLl9vblRleHRBcmVhRm9jdXMgPSBmdW5jdGlvbiAoZXYpIHtcbiAgICAgICAgaWYgKHRoaXMuc2VuZEZvY3VzKSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZXIoRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1tJJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51cGRhdGVDdXJzb3JTdHlsZShldik7XG4gICAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QuYWRkKCdmb2N1cycpO1xuICAgICAgICB0aGlzLnNob3dDdXJzb3IoKTtcbiAgICAgICAgdGhpcy5lbWl0KCdmb2N1cycpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLmJsdXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRleHRhcmVhLmJsdXIoKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5fb25UZXh0QXJlYUJsdXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudGV4dGFyZWEudmFsdWUgPSAnJztcbiAgICAgICAgdGhpcy5yZWZyZXNoKHRoaXMuYnVmZmVyLnksIHRoaXMuYnVmZmVyLnkpO1xuICAgICAgICBpZiAodGhpcy5zZW5kRm9jdXMpIHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnW08nKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZSgnZm9jdXMnKTtcbiAgICAgICAgdGhpcy5lbWl0KCdibHVyJyk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuX2luaXRHbG9iYWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuX2JpbmRLZXlzKCk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoTGlmZWN5Y2xlXzEuYWRkRGlzcG9zYWJsZURvbUxpc3RlbmVyKHRoaXMuZWxlbWVudCwgJ2NvcHknLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGlmICghX3RoaXMuaGFzU2VsZWN0aW9uKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBDbGlwYm9hcmRfMS5jb3B5SGFuZGxlcihldmVudCwgX3RoaXMsIF90aGlzLnNlbGVjdGlvbk1hbmFnZXIpO1xuICAgICAgICB9KSk7XG4gICAgICAgIHZhciBwYXN0ZUhhbmRsZXJXcmFwcGVyID0gZnVuY3Rpb24gKGV2ZW50KSB7IHJldHVybiBDbGlwYm9hcmRfMS5wYXN0ZUhhbmRsZXIoZXZlbnQsIF90aGlzKTsgfTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihMaWZlY3ljbGVfMS5hZGREaXNwb3NhYmxlRG9tTGlzdGVuZXIodGhpcy50ZXh0YXJlYSwgJ3Bhc3RlJywgcGFzdGVIYW5kbGVyV3JhcHBlcikpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKExpZmVjeWNsZV8xLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcih0aGlzLmVsZW1lbnQsICdwYXN0ZScsIHBhc3RlSGFuZGxlcldyYXBwZXIpKTtcbiAgICAgICAgaWYgKEJyb3dzZXIuaXNGaXJlZm94KSB7XG4gICAgICAgICAgICB0aGlzLnJlZ2lzdGVyKExpZmVjeWNsZV8xLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcih0aGlzLmVsZW1lbnQsICdtb3VzZWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuYnV0dG9uID09PSAyKSB7XG4gICAgICAgICAgICAgICAgICAgIENsaXBib2FyZF8xLnJpZ2h0Q2xpY2tIYW5kbGVyKGV2ZW50LCBfdGhpcywgX3RoaXMuc2VsZWN0aW9uTWFuYWdlciwgX3RoaXMub3B0aW9ucy5yaWdodENsaWNrU2VsZWN0c1dvcmQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucmVnaXN0ZXIoTGlmZWN5Y2xlXzEuYWRkRGlzcG9zYWJsZURvbUxpc3RlbmVyKHRoaXMuZWxlbWVudCwgJ2NvbnRleHRtZW51JywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgQ2xpcGJvYXJkXzEucmlnaHRDbGlja0hhbmRsZXIoZXZlbnQsIF90aGlzLCBfdGhpcy5zZWxlY3Rpb25NYW5hZ2VyLCBfdGhpcy5vcHRpb25zLnJpZ2h0Q2xpY2tTZWxlY3RzV29yZCk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKEJyb3dzZXIuaXNMaW51eCkge1xuICAgICAgICAgICAgdGhpcy5yZWdpc3RlcihMaWZlY3ljbGVfMS5hZGREaXNwb3NhYmxlRG9tTGlzdGVuZXIodGhpcy5lbGVtZW50LCAnYXV4Y2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBpZiAoZXZlbnQuYnV0dG9uID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIENsaXBib2FyZF8xLm1vdmVUZXh0QXJlYVVuZGVyTW91c2VDdXJzb3IoZXZlbnQsIF90aGlzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5fYmluZEtleXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgdGhpcy5yZWdpc3RlcihMaWZlY3ljbGVfMS5hZGREaXNwb3NhYmxlRG9tTGlzdGVuZXIodGhpcy5lbGVtZW50LCAna2V5ZG93bicsIGZ1bmN0aW9uIChldikge1xuICAgICAgICAgICAgaWYgKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgIT09IHRoaXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZWxmLl9rZXlEb3duKGV2KTtcbiAgICAgICAgfSwgdHJ1ZSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKExpZmVjeWNsZV8xLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcih0aGlzLmVsZW1lbnQsICdrZXlwcmVzcycsIGZ1bmN0aW9uIChldikge1xuICAgICAgICAgICAgaWYgKGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgIT09IHRoaXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZWxmLl9rZXlQcmVzcyhldik7XG4gICAgICAgIH0sIHRydWUpKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihMaWZlY3ljbGVfMS5hZGREaXNwb3NhYmxlRG9tTGlzdGVuZXIodGhpcy5lbGVtZW50LCAna2V5dXAnLCBmdW5jdGlvbiAoZXYpIHtcbiAgICAgICAgICAgIGlmICghd2FzTW9kaWZpZXJLZXlPbmx5RXZlbnQoZXYpKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuZm9jdXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNlbGYuX2tleVVwKGV2KTtcbiAgICAgICAgfSwgdHJ1ZSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKExpZmVjeWNsZV8xLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcih0aGlzLnRleHRhcmVhLCAna2V5ZG93bicsIGZ1bmN0aW9uIChldikgeyByZXR1cm4gX3RoaXMuX2tleURvd24oZXYpOyB9LCB0cnVlKSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoTGlmZWN5Y2xlXzEuYWRkRGlzcG9zYWJsZURvbUxpc3RlbmVyKHRoaXMudGV4dGFyZWEsICdrZXlwcmVzcycsIGZ1bmN0aW9uIChldikgeyByZXR1cm4gX3RoaXMuX2tleVByZXNzKGV2KTsgfSwgdHJ1ZSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKExpZmVjeWNsZV8xLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcih0aGlzLnRleHRhcmVhLCAnY29tcG9zaXRpb25zdGFydCcsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9jb21wb3NpdGlvbkhlbHBlci5jb21wb3NpdGlvbnN0YXJ0KCk7IH0pKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihMaWZlY3ljbGVfMS5hZGREaXNwb3NhYmxlRG9tTGlzdGVuZXIodGhpcy50ZXh0YXJlYSwgJ2NvbXBvc2l0aW9udXBkYXRlJywgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLl9jb21wb3NpdGlvbkhlbHBlci5jb21wb3NpdGlvbnVwZGF0ZShlKTsgfSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKExpZmVjeWNsZV8xLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcih0aGlzLnRleHRhcmVhLCAnY29tcG9zaXRpb25lbmQnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5fY29tcG9zaXRpb25IZWxwZXIuY29tcG9zaXRpb25lbmQoKTsgfSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHRoaXMub25SZW5kZXIoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX2NvbXBvc2l0aW9uSGVscGVyLnVwZGF0ZUNvbXBvc2l0aW9uRWxlbWVudHMoKTsgfSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHRoaXMub25SZW5kZXIoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLl9xdWV1ZUxpbmtpZmljYXRpb24oZS5zdGFydCwgZS5lbmQpOyB9KSk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uIChwYXJlbnQpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5fcGFyZW50ID0gcGFyZW50IHx8IHRoaXMuX3BhcmVudDtcbiAgICAgICAgaWYgKCF0aGlzLl9wYXJlbnQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignVGVybWluYWwgcmVxdWlyZXMgYSBwYXJlbnQgZWxlbWVudC4nKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9jb250ZXh0ID0gdGhpcy5fcGFyZW50Lm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXc7XG4gICAgICAgIHRoaXMuX2RvY3VtZW50ID0gdGhpcy5fcGFyZW50Lm93bmVyRG9jdW1lbnQ7XG4gICAgICAgIHRoaXMuX3NjcmVlbkRwck1vbml0b3IgPSBuZXcgU2NyZWVuRHByTW9uaXRvcl8xLlNjcmVlbkRwck1vbml0b3IoKTtcbiAgICAgICAgdGhpcy5fc2NyZWVuRHByTW9uaXRvci5zZXRMaXN0ZW5lcihmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5lbWl0KCdkcHJjaGFuZ2UnLCB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyk7IH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHRoaXMuX3NjcmVlbkRwck1vbml0b3IpO1xuICAgICAgICB0aGlzLmVsZW1lbnQgPSB0aGlzLl9kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy5lbGVtZW50LmRpciA9ICdsdHInO1xuICAgICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZCgndGVybWluYWwnKTtcbiAgICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3h0ZXJtJyk7XG4gICAgICAgIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywgJzAnKTtcbiAgICAgICAgdGhpcy5fcGFyZW50LmFwcGVuZENoaWxkKHRoaXMuZWxlbWVudCk7XG4gICAgICAgIHZhciBmcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAgICAgdGhpcy5fdmlld3BvcnRFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMuX3ZpZXdwb3J0RWxlbWVudC5jbGFzc0xpc3QuYWRkKCd4dGVybS12aWV3cG9ydCcpO1xuICAgICAgICBmcmFnbWVudC5hcHBlbmRDaGlsZCh0aGlzLl92aWV3cG9ydEVsZW1lbnQpO1xuICAgICAgICB0aGlzLl92aWV3cG9ydFNjcm9sbEFyZWEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy5fdmlld3BvcnRTY3JvbGxBcmVhLmNsYXNzTGlzdC5hZGQoJ3h0ZXJtLXNjcm9sbC1hcmVhJyk7XG4gICAgICAgIHRoaXMuX3ZpZXdwb3J0RWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLl92aWV3cG9ydFNjcm9sbEFyZWEpO1xuICAgICAgICB0aGlzLnNjcmVlbkVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy5zY3JlZW5FbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3h0ZXJtLXNjcmVlbicpO1xuICAgICAgICB0aGlzLl9oZWxwZXJDb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGhpcy5faGVscGVyQ29udGFpbmVyLmNsYXNzTGlzdC5hZGQoJ3h0ZXJtLWhlbHBlcnMnKTtcbiAgICAgICAgdGhpcy5zY3JlZW5FbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuX2hlbHBlckNvbnRhaW5lcik7XG4gICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKHRoaXMuc2NyZWVuRWxlbWVudCk7XG4gICAgICAgIHRoaXMuX21vdXNlWm9uZU1hbmFnZXIgPSBuZXcgTW91c2Vab25lTWFuYWdlcl8xLk1vdXNlWm9uZU1hbmFnZXIodGhpcyk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodGhpcy5fbW91c2Vab25lTWFuYWdlcik7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodGhpcy5vblNjcm9sbChmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5fbW91c2Vab25lTWFuYWdlci5jbGVhckFsbCgpOyB9KSk7XG4gICAgICAgIHRoaXMubGlua2lmaWVyLmF0dGFjaFRvRG9tKHRoaXMuX21vdXNlWm9uZU1hbmFnZXIpO1xuICAgICAgICB0aGlzLnRleHRhcmVhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKTtcbiAgICAgICAgdGhpcy50ZXh0YXJlYS5jbGFzc0xpc3QuYWRkKCd4dGVybS1oZWxwZXItdGV4dGFyZWEnKTtcbiAgICAgICAgdGhpcy50ZXh0YXJlYS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBTdHJpbmdzLnByb21wdExhYmVsKTtcbiAgICAgICAgdGhpcy50ZXh0YXJlYS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbXVsdGlsaW5lJywgJ2ZhbHNlJyk7XG4gICAgICAgIHRoaXMudGV4dGFyZWEuc2V0QXR0cmlidXRlKCdhdXRvY29ycmVjdCcsICdvZmYnKTtcbiAgICAgICAgdGhpcy50ZXh0YXJlYS5zZXRBdHRyaWJ1dGUoJ2F1dG9jYXBpdGFsaXplJywgJ29mZicpO1xuICAgICAgICB0aGlzLnRleHRhcmVhLnNldEF0dHJpYnV0ZSgnc3BlbGxjaGVjaycsICdmYWxzZScpO1xuICAgICAgICB0aGlzLnRleHRhcmVhLnRhYkluZGV4ID0gMDtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihMaWZlY3ljbGVfMS5hZGREaXNwb3NhYmxlRG9tTGlzdGVuZXIodGhpcy50ZXh0YXJlYSwgJ2ZvY3VzJywgZnVuY3Rpb24gKGV2KSB7IHJldHVybiBfdGhpcy5fb25UZXh0QXJlYUZvY3VzKGV2KTsgfSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKExpZmVjeWNsZV8xLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcih0aGlzLnRleHRhcmVhLCAnYmx1cicsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9vblRleHRBcmVhQmx1cigpOyB9KSk7XG4gICAgICAgIHRoaXMuX2hlbHBlckNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLnRleHRhcmVhKTtcbiAgICAgICAgdGhpcy5fY29tcG9zaXRpb25WaWV3ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgIHRoaXMuX2NvbXBvc2l0aW9uVmlldy5jbGFzc0xpc3QuYWRkKCdjb21wb3NpdGlvbi12aWV3Jyk7XG4gICAgICAgIHRoaXMuX2NvbXBvc2l0aW9uSGVscGVyID0gbmV3IENvbXBvc2l0aW9uSGVscGVyXzEuQ29tcG9zaXRpb25IZWxwZXIodGhpcy50ZXh0YXJlYSwgdGhpcy5fY29tcG9zaXRpb25WaWV3LCB0aGlzKTtcbiAgICAgICAgdGhpcy5faGVscGVyQ29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuX2NvbXBvc2l0aW9uVmlldyk7XG4gICAgICAgIHRoaXMuY2hhck1lYXN1cmUgPSBuZXcgQ2hhck1lYXN1cmVfMS5DaGFyTWVhc3VyZShkb2N1bWVudCwgdGhpcy5faGVscGVyQ29udGFpbmVyKTtcbiAgICAgICAgdGhpcy5lbGVtZW50LmFwcGVuZENoaWxkKGZyYWdtZW50KTtcbiAgICAgICAgdGhpcy5fc2V0dXBSZW5kZXJlcigpO1xuICAgICAgICB0aGlzLl90aGVtZSA9IHRoaXMub3B0aW9ucy50aGVtZTtcbiAgICAgICAgdGhpcy5vcHRpb25zLnRoZW1lID0gbnVsbDtcbiAgICAgICAgdGhpcy52aWV3cG9ydCA9IG5ldyBWaWV3cG9ydF8xLlZpZXdwb3J0KHRoaXMsIHRoaXMuX3ZpZXdwb3J0RWxlbWVudCwgdGhpcy5fdmlld3BvcnRTY3JvbGxBcmVhLCB0aGlzLmNoYXJNZWFzdXJlKTtcbiAgICAgICAgdGhpcy52aWV3cG9ydC5vblRoZW1lQ2hhbmdlZCh0aGlzLnJlbmRlcmVyLmNvbG9yTWFuYWdlci5jb2xvcnMpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHRoaXMudmlld3BvcnQpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHRoaXMub25DdXJzb3JNb3ZlKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLnJlbmRlcmVyLm9uQ3Vyc29yTW92ZSgpOyB9KSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodGhpcy5vblJlc2l6ZShmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5yZW5kZXJlci5vblJlc2l6ZShfdGhpcy5jb2xzLCBfdGhpcy5yb3dzKTsgfSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHRoaXMuYWRkRGlzcG9zYWJsZUxpc3RlbmVyKCdibHVyJywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMucmVuZGVyZXIub25CbHVyKCk7IH0pKTtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih0aGlzLmFkZERpc3Bvc2FibGVMaXN0ZW5lcignZm9jdXMnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5yZW5kZXJlci5vbkZvY3VzKCk7IH0pKTtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih0aGlzLmFkZERpc3Bvc2FibGVMaXN0ZW5lcignZHByY2hhbmdlJywgZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMucmVuZGVyZXIub25XaW5kb3dSZXNpemUod2luZG93LmRldmljZVBpeGVsUmF0aW8pOyB9KSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoTGlmZWN5Y2xlXzEuYWRkRGlzcG9zYWJsZURvbUxpc3RlbmVyKHdpbmRvdywgJ3Jlc2l6ZScsIGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLnJlbmRlcmVyLm9uV2luZG93UmVzaXplKHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKTsgfSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHRoaXMuY2hhck1lYXN1cmUub25DaGFyU2l6ZUNoYW5nZWQoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMucmVuZGVyZXIub25DaGFyU2l6ZUNoYW5nZWQoKTsgfSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHRoaXMucmVuZGVyZXIub25DYW52YXNSZXNpemUoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMudmlld3BvcnQuc3luY1Njcm9sbEFyZWEoKTsgfSkpO1xuICAgICAgICB0aGlzLnNlbGVjdGlvbk1hbmFnZXIgPSBuZXcgU2VsZWN0aW9uTWFuYWdlcl8xLlNlbGVjdGlvbk1hbmFnZXIodGhpcywgdGhpcy5jaGFyTWVhc3VyZSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIodGhpcy5zZWxlY3Rpb25NYW5hZ2VyLm9uU2VsZWN0aW9uQ2hhbmdlKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9vblNlbGVjdGlvbkNoYW5nZS5maXJlKCk7IH0pKTtcbiAgICAgICAgdGhpcy5yZWdpc3RlcihMaWZlY3ljbGVfMS5hZGREaXNwb3NhYmxlRG9tTGlzdGVuZXIodGhpcy5lbGVtZW50LCAnbW91c2Vkb3duJywgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLnNlbGVjdGlvbk1hbmFnZXIub25Nb3VzZURvd24oZSk7IH0pKTtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih0aGlzLnNlbGVjdGlvbk1hbmFnZXIub25SZWRyYXdSZXF1ZXN0KGZ1bmN0aW9uIChlKSB7IHJldHVybiBfdGhpcy5yZW5kZXJlci5vblNlbGVjdGlvbkNoYW5nZWQoZS5zdGFydCwgZS5lbmQsIGUuY29sdW1uU2VsZWN0TW9kZSk7IH0pKTtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih0aGlzLnNlbGVjdGlvbk1hbmFnZXIub25MaW51eE1vdXNlU2VsZWN0aW9uKGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgICAgICAgICBfdGhpcy50ZXh0YXJlYS52YWx1ZSA9IHRleHQ7XG4gICAgICAgICAgICBfdGhpcy50ZXh0YXJlYS5mb2N1cygpO1xuICAgICAgICAgICAgX3RoaXMudGV4dGFyZWEuc2VsZWN0KCk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgdGhpcy5yZWdpc3Rlcih0aGlzLm9uU2Nyb2xsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIF90aGlzLnZpZXdwb3J0LnN5bmNTY3JvbGxBcmVhKCk7XG4gICAgICAgICAgICBfdGhpcy5zZWxlY3Rpb25NYW5hZ2VyLnJlZnJlc2goKTtcbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKExpZmVjeWNsZV8xLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcih0aGlzLl92aWV3cG9ydEVsZW1lbnQsICdzY3JvbGwnLCBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zZWxlY3Rpb25NYW5hZ2VyLnJlZnJlc2goKTsgfSkpO1xuICAgICAgICB0aGlzLm1vdXNlSGVscGVyID0gbmV3IE1vdXNlSGVscGVyXzEuTW91c2VIZWxwZXIodGhpcy5yZW5kZXJlcik7XG4gICAgICAgIHRoaXMuZWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKCdlbmFibGUtbW91c2UtZXZlbnRzJywgdGhpcy5tb3VzZUV2ZW50cyk7XG4gICAgICAgIGlmICh0aGlzLm1vdXNlRXZlbnRzKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvbk1hbmFnZXIuZGlzYWJsZSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3Rpb25NYW5hZ2VyLmVuYWJsZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuc2NyZWVuUmVhZGVyTW9kZSkge1xuICAgICAgICAgICAgdGhpcy5fYWNjZXNzaWJpbGl0eU1hbmFnZXIgPSBuZXcgQWNjZXNzaWJpbGl0eU1hbmFnZXJfMS5BY2Nlc3NpYmlsaXR5TWFuYWdlcih0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNoYXJNZWFzdXJlLm1lYXN1cmUodGhpcy5vcHRpb25zKTtcbiAgICAgICAgdGhpcy5yZWZyZXNoKDAsIHRoaXMucm93cyAtIDEpO1xuICAgICAgICB0aGlzLl9pbml0R2xvYmFsKCk7XG4gICAgICAgIHRoaXMuYmluZE1vdXNlKCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuX3NldHVwUmVuZGVyZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHN3aXRjaCAodGhpcy5vcHRpb25zLnJlbmRlcmVyVHlwZSkge1xuICAgICAgICAgICAgY2FzZSAnY2FudmFzJzpcbiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVyID0gbmV3IFJlbmRlcmVyXzEuUmVuZGVyZXIodGhpcywgdGhpcy5vcHRpb25zLnRoZW1lKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2RvbSc6XG4gICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJlciA9IG5ldyBEb21SZW5kZXJlcl8xLkRvbVJlbmRlcmVyKHRoaXMsIHRoaXMub3B0aW9ucy50aGVtZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoXCJVbnJlY29nbml6ZWQgcmVuZGVyZXJUeXBlIFxcXCJcIiArIHRoaXMub3B0aW9ucy5yZW5kZXJlclR5cGUgKyBcIlxcXCJcIik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZW5kZXJlci5vblJlbmRlcihmdW5jdGlvbiAoZSkgeyByZXR1cm4gX3RoaXMuX29uUmVuZGVyLmZpcmUoZSk7IH0pO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKHRoaXMucmVuZGVyZXIpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLl9zZXRUaGVtZSA9IGZ1bmN0aW9uICh0aGVtZSkge1xuICAgICAgICB0aGlzLl90aGVtZSA9IHRoZW1lO1xuICAgICAgICB2YXIgY29sb3JzID0gdGhpcy5yZW5kZXJlci5zZXRUaGVtZSh0aGVtZSk7XG4gICAgICAgIGlmICh0aGlzLnZpZXdwb3J0KSB7XG4gICAgICAgICAgICB0aGlzLnZpZXdwb3J0Lm9uVGhlbWVDaGFuZ2VkKGNvbG9ycyk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5iaW5kTW91c2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHZhciBlbCA9IHRoaXMuZWxlbWVudDtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICB2YXIgcHJlc3NlZCA9IDMyO1xuICAgICAgICBmdW5jdGlvbiBzZW5kQnV0dG9uKGV2KSB7XG4gICAgICAgICAgICB2YXIgYnV0dG9uO1xuICAgICAgICAgICAgdmFyIHBvcztcbiAgICAgICAgICAgIGJ1dHRvbiA9IGdldEJ1dHRvbihldik7XG4gICAgICAgICAgICBwb3MgPSBzZWxmLm1vdXNlSGVscGVyLmdldFJhd0J5dGVDb29yZHMoZXYsIHNlbGYuc2NyZWVuRWxlbWVudCwgc2VsZi5jaGFyTWVhc3VyZSwgc2VsZi5jb2xzLCBzZWxmLnJvd3MpO1xuICAgICAgICAgICAgaWYgKCFwb3MpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgc2VuZEV2ZW50KGJ1dHRvbiwgcG9zKTtcbiAgICAgICAgICAgIHN3aXRjaCAoZXYub3ZlcnJpZGVUeXBlIHx8IGV2LnR5cGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlICdtb3VzZWRvd24nOlxuICAgICAgICAgICAgICAgICAgICBwcmVzc2VkID0gYnV0dG9uO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdtb3VzZXVwJzpcbiAgICAgICAgICAgICAgICAgICAgcHJlc3NlZCA9IDMyO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICd3aGVlbCc6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHNlbmRNb3ZlKGV2KSB7XG4gICAgICAgICAgICB2YXIgYnV0dG9uID0gcHJlc3NlZDtcbiAgICAgICAgICAgIHZhciBwb3MgPSBzZWxmLm1vdXNlSGVscGVyLmdldFJhd0J5dGVDb29yZHMoZXYsIHNlbGYuc2NyZWVuRWxlbWVudCwgc2VsZi5jaGFyTWVhc3VyZSwgc2VsZi5jb2xzLCBzZWxmLnJvd3MpO1xuICAgICAgICAgICAgaWYgKCFwb3MpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgYnV0dG9uICs9IDMyO1xuICAgICAgICAgICAgc2VuZEV2ZW50KGJ1dHRvbiwgcG9zKTtcbiAgICAgICAgfVxuICAgICAgICBmdW5jdGlvbiBlbmNvZGUoZGF0YSwgY2gpIHtcbiAgICAgICAgICAgIGlmICghc2VsZi51dGZNb3VzZSkge1xuICAgICAgICAgICAgICAgIGlmIChjaCA9PT0gMjU1KSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaCgwKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY2ggPiAxMjcpXG4gICAgICAgICAgICAgICAgICAgIGNoID0gMTI3O1xuICAgICAgICAgICAgICAgIGRhdGEucHVzaChjaCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoY2ggPiAyMDQ3KSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEucHVzaCgyMDQ3KTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkYXRhLnB1c2goY2gpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHNlbmRFdmVudChidXR0b24sIHBvcykge1xuICAgICAgICAgICAgaWYgKHNlbGYuX3Z0MzAwTW91c2UpIHtcbiAgICAgICAgICAgICAgICBidXR0b24gJj0gMztcbiAgICAgICAgICAgICAgICBwb3MueCAtPSAzMjtcbiAgICAgICAgICAgICAgICBwb3MueSAtPSAzMjtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YV8xID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1syNCc7XG4gICAgICAgICAgICAgICAgaWYgKGJ1dHRvbiA9PT0gMClcbiAgICAgICAgICAgICAgICAgICAgZGF0YV8xICs9ICcxJztcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChidXR0b24gPT09IDEpXG4gICAgICAgICAgICAgICAgICAgIGRhdGFfMSArPSAnMyc7XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoYnV0dG9uID09PSAyKVxuICAgICAgICAgICAgICAgICAgICBkYXRhXzEgKz0gJzUnO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJ1dHRvbiA9PT0gMylcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgZGF0YV8xICs9ICcwJztcbiAgICAgICAgICAgICAgICBkYXRhXzEgKz0gJ35bJyArIHBvcy54ICsgJywnICsgcG9zLnkgKyAnXVxccic7XG4gICAgICAgICAgICAgICAgc2VsZi5oYW5kbGVyKGRhdGFfMSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHNlbGYuX2RlY0xvY2F0b3IpIHtcbiAgICAgICAgICAgICAgICBidXR0b24gJj0gMztcbiAgICAgICAgICAgICAgICBwb3MueCAtPSAzMjtcbiAgICAgICAgICAgICAgICBwb3MueSAtPSAzMjtcbiAgICAgICAgICAgICAgICBpZiAoYnV0dG9uID09PSAwKVxuICAgICAgICAgICAgICAgICAgICBidXR0b24gPSAyO1xuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGJ1dHRvbiA9PT0gMSlcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uID0gNDtcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChidXR0b24gPT09IDIpXG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbiA9IDY7XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoYnV0dG9uID09PSAzKVxuICAgICAgICAgICAgICAgICAgICBidXR0b24gPSAzO1xuICAgICAgICAgICAgICAgIHNlbGYuaGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWydcbiAgICAgICAgICAgICAgICAgICAgKyBidXR0b25cbiAgICAgICAgICAgICAgICAgICAgKyAnOydcbiAgICAgICAgICAgICAgICAgICAgKyAoYnV0dG9uID09PSAzID8gNCA6IDApXG4gICAgICAgICAgICAgICAgICAgICsgJzsnXG4gICAgICAgICAgICAgICAgICAgICsgcG9zLnlcbiAgICAgICAgICAgICAgICAgICAgKyAnOydcbiAgICAgICAgICAgICAgICAgICAgKyBwb3MueFxuICAgICAgICAgICAgICAgICAgICArICc7J1xuICAgICAgICAgICAgICAgICAgICArIHBvcy5wYWdlIHx8IDBcbiAgICAgICAgICAgICAgICAgICAgKyAnJncnKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2VsZi51cnh2dE1vdXNlKSB7XG4gICAgICAgICAgICAgICAgcG9zLnggLT0gMzI7XG4gICAgICAgICAgICAgICAgcG9zLnkgLT0gMzI7XG4gICAgICAgICAgICAgICAgcG9zLngrKztcbiAgICAgICAgICAgICAgICBwb3MueSsrO1xuICAgICAgICAgICAgICAgIHNlbGYuaGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWycgKyBidXR0b24gKyAnOycgKyBwb3MueCArICc7JyArIHBvcy55ICsgJ00nKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2VsZi5zZ3JNb3VzZSkge1xuICAgICAgICAgICAgICAgIHBvcy54IC09IDMyO1xuICAgICAgICAgICAgICAgIHBvcy55IC09IDMyO1xuICAgICAgICAgICAgICAgIHNlbGYuaGFuZGxlcihFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzwnXG4gICAgICAgICAgICAgICAgICAgICsgKCgoYnV0dG9uICYgMykgPT09IDMgPyBidXR0b24gJiB+MyA6IGJ1dHRvbikgLSAzMilcbiAgICAgICAgICAgICAgICAgICAgKyAnOydcbiAgICAgICAgICAgICAgICAgICAgKyBwb3MueFxuICAgICAgICAgICAgICAgICAgICArICc7J1xuICAgICAgICAgICAgICAgICAgICArIHBvcy55XG4gICAgICAgICAgICAgICAgICAgICsgKChidXR0b24gJiAzKSA9PT0gMyA/ICdtJyA6ICdNJykpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBkYXRhID0gW107XG4gICAgICAgICAgICBlbmNvZGUoZGF0YSwgYnV0dG9uKTtcbiAgICAgICAgICAgIGVuY29kZShkYXRhLCBwb3MueCk7XG4gICAgICAgICAgICBlbmNvZGUoZGF0YSwgcG9zLnkpO1xuICAgICAgICAgICAgc2VsZi5oYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbTScgKyBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KFN0cmluZywgZGF0YSkpO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldEJ1dHRvbihldikge1xuICAgICAgICAgICAgdmFyIGJ1dHRvbjtcbiAgICAgICAgICAgIHZhciBzaGlmdDtcbiAgICAgICAgICAgIHZhciBtZXRhO1xuICAgICAgICAgICAgdmFyIGN0cmw7XG4gICAgICAgICAgICB2YXIgbW9kO1xuICAgICAgICAgICAgc3dpdGNoIChldi5vdmVycmlkZVR5cGUgfHwgZXYudHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgJ21vdXNlZG93bic6XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbiA9IGV2LmJ1dHRvbiAhPT0gbnVsbCAmJiBldi5idXR0b24gIT09IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgICAgICAgICAgPyArZXYuYnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICAgICA6IGV2LndoaWNoICE9PSBudWxsICYmIGV2LndoaWNoICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IGV2LndoaWNoIC0gMVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKEJyb3dzZXIuaXNNU0lFKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBidXR0b24gPSBidXR0b24gPT09IDEgPyAwIDogYnV0dG9uID09PSA0ID8gMSA6IGJ1dHRvbjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICdtb3VzZXVwJzpcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uID0gMztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSAnRE9NTW91c2VTY3JvbGwnOlxuICAgICAgICAgICAgICAgICAgICBidXR0b24gPSBldi5kZXRhaWwgPCAwXG4gICAgICAgICAgICAgICAgICAgICAgICA/IDY0XG4gICAgICAgICAgICAgICAgICAgICAgICA6IDY1O1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlICd3aGVlbCc6XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbiA9IGV2LmRlbHRhWSA8IDBcbiAgICAgICAgICAgICAgICAgICAgICAgID8gNjRcbiAgICAgICAgICAgICAgICAgICAgICAgIDogNjU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2hpZnQgPSBldi5zaGlmdEtleSA/IDQgOiAwO1xuICAgICAgICAgICAgbWV0YSA9IGV2Lm1ldGFLZXkgPyA4IDogMDtcbiAgICAgICAgICAgIGN0cmwgPSBldi5jdHJsS2V5ID8gMTYgOiAwO1xuICAgICAgICAgICAgbW9kID0gc2hpZnQgfCBtZXRhIHwgY3RybDtcbiAgICAgICAgICAgIGlmIChzZWxmLnZ0MjAwTW91c2UpIHtcbiAgICAgICAgICAgICAgICBtb2QgJj0gY3RybDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKCFzZWxmLm5vcm1hbE1vdXNlKSB7XG4gICAgICAgICAgICAgICAgbW9kID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJ1dHRvbiA9ICgzMiArIChtb2QgPDwgMikpICsgYnV0dG9uO1xuICAgICAgICAgICAgcmV0dXJuIGJ1dHRvbjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlZ2lzdGVyKExpZmVjeWNsZV8xLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcihlbCwgJ21vdXNlZG93bicsIGZ1bmN0aW9uIChldikge1xuICAgICAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIF90aGlzLmZvY3VzKCk7XG4gICAgICAgICAgICBpZiAoIV90aGlzLm1vdXNlRXZlbnRzIHx8IF90aGlzLnNlbGVjdGlvbk1hbmFnZXIuc2hvdWxkRm9yY2VTZWxlY3Rpb24oZXYpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2VuZEJ1dHRvbihldik7XG4gICAgICAgICAgICBpZiAoX3RoaXMudnQyMDBNb3VzZSkge1xuICAgICAgICAgICAgICAgIGV2Lm92ZXJyaWRlVHlwZSA9ICdtb3VzZXVwJztcbiAgICAgICAgICAgICAgICBzZW5kQnV0dG9uKGV2KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuY2FuY2VsKGV2KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBtb3ZlSGFuZGxlcjtcbiAgICAgICAgICAgIGlmIChfdGhpcy5ub3JtYWxNb3VzZSkge1xuICAgICAgICAgICAgICAgIG1vdmVIYW5kbGVyID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghX3RoaXMubm9ybWFsTW91c2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBzZW5kTW92ZShldmVudCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBfdGhpcy5fZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgbW92ZUhhbmRsZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGhhbmRsZXIgPSBmdW5jdGlvbiAoZXYpIHtcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMubm9ybWFsTW91c2UgJiYgIV90aGlzLngxME1vdXNlKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbmRCdXR0b24oZXYpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobW92ZUhhbmRsZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX2RvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIG1vdmVIYW5kbGVyKTtcbiAgICAgICAgICAgICAgICAgICAgbW92ZUhhbmRsZXIgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBfdGhpcy5fZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIGhhbmRsZXIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5jYW5jZWwoZXYpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIF90aGlzLl9kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgaGFuZGxlcik7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuY2FuY2VsKGV2KTtcbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKExpZmVjeWNsZV8xLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcihlbCwgJ3doZWVsJywgZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgICAgICBpZiAoIV90aGlzLm1vdXNlRXZlbnRzKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFfdGhpcy5idWZmZXIuaGFzU2Nyb2xsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYW1vdW50ID0gX3RoaXMudmlld3BvcnQuZ2V0TGluZXNTY3JvbGxlZChldik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhbW91bnQgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YXIgc2VxdWVuY2UgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAoX3RoaXMuYXBwbGljYXRpb25DdXJzb3IgPyAnTycgOiAnWycpICsgKGV2LmRlbHRhWSA8IDAgPyAnQScgOiAnQicpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgZGF0YSA9ICcnO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IE1hdGguYWJzKGFtb3VudCk7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGF0YSArPSBzZXF1ZW5jZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5oYW5kbGVyKGRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoX3RoaXMueDEwTW91c2UgfHwgX3RoaXMuX3Z0MzAwTW91c2UgfHwgX3RoaXMuX2RlY0xvY2F0b3IpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgc2VuZEJ1dHRvbihldik7XG4gICAgICAgICAgICBldi5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoTGlmZWN5Y2xlXzEuYWRkRGlzcG9zYWJsZURvbUxpc3RlbmVyKGVsLCAnd2hlZWwnLCBmdW5jdGlvbiAoZXYpIHtcbiAgICAgICAgICAgIGlmIChfdGhpcy5tb3VzZUV2ZW50cylcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICBfdGhpcy52aWV3cG9ydC5vbldoZWVsKGV2KTtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5jYW5jZWwoZXYpO1xuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMucmVnaXN0ZXIoTGlmZWN5Y2xlXzEuYWRkRGlzcG9zYWJsZURvbUxpc3RlbmVyKGVsLCAndG91Y2hzdGFydCcsIGZ1bmN0aW9uIChldikge1xuICAgICAgICAgICAgaWYgKF90aGlzLm1vdXNlRXZlbnRzKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIF90aGlzLnZpZXdwb3J0Lm9uVG91Y2hTdGFydChldik7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuY2FuY2VsKGV2KTtcbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLnJlZ2lzdGVyKExpZmVjeWNsZV8xLmFkZERpc3Bvc2FibGVEb21MaXN0ZW5lcihlbCwgJ3RvdWNobW92ZScsIGZ1bmN0aW9uIChldikge1xuICAgICAgICAgICAgaWYgKF90aGlzLm1vdXNlRXZlbnRzKVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIF90aGlzLnZpZXdwb3J0Lm9uVG91Y2hNb3ZlKGV2KTtcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5jYW5jZWwoZXYpO1xuICAgICAgICB9KSk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUucmVmcmVzaCA9IGZ1bmN0aW9uIChzdGFydCwgZW5kKSB7XG4gICAgICAgIGlmICh0aGlzLnJlbmRlcmVyKSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLnJlZnJlc2hSb3dzKHN0YXJ0LCBlbmQpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuX3F1ZXVlTGlua2lmaWNhdGlvbiA9IGZ1bmN0aW9uIChzdGFydCwgZW5kKSB7XG4gICAgICAgIGlmICh0aGlzLmxpbmtpZmllcikge1xuICAgICAgICAgICAgdGhpcy5saW5raWZpZXIubGlua2lmeVJvd3Moc3RhcnQsIGVuZCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS51cGRhdGVDdXJzb3JTdHlsZSA9IGZ1bmN0aW9uIChldikge1xuICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25NYW5hZ2VyICYmIHRoaXMuc2VsZWN0aW9uTWFuYWdlci5zaG91bGRDb2x1bW5TZWxlY3QoZXYpKSB7XG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZCgnY29sdW1uLXNlbGVjdCcpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2NvbHVtbi1zZWxlY3QnKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnNob3dDdXJzb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5jdXJzb3JTdGF0ZSkge1xuICAgICAgICAgICAgdGhpcy5jdXJzb3JTdGF0ZSA9IDE7XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2godGhpcy5idWZmZXIueSwgdGhpcy5idWZmZXIueSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5zY3JvbGwgPSBmdW5jdGlvbiAoaXNXcmFwcGVkKSB7XG4gICAgICAgIGlmIChpc1dyYXBwZWQgPT09IHZvaWQgMCkgeyBpc1dyYXBwZWQgPSBmYWxzZTsgfVxuICAgICAgICB2YXIgbmV3TGluZTtcbiAgICAgICAgbmV3TGluZSA9IHRoaXMuX2JsYW5rTGluZTtcbiAgICAgICAgdmFyIGVyYXNlQXR0ciA9IHRoaXMuZXJhc2VBdHRyRGF0YSgpO1xuICAgICAgICBpZiAoIW5ld0xpbmUgfHwgbmV3TGluZS5sZW5ndGggIT09IHRoaXMuY29scyB8fCBuZXdMaW5lLmdldEZnKDApICE9PSBlcmFzZUF0dHIuZmcgfHwgbmV3TGluZS5nZXRCZygwKSAhPT0gZXJhc2VBdHRyLmJnKSB7XG4gICAgICAgICAgICBuZXdMaW5lID0gdGhpcy5idWZmZXIuZ2V0QmxhbmtMaW5lKGVyYXNlQXR0ciwgaXNXcmFwcGVkKTtcbiAgICAgICAgICAgIHRoaXMuX2JsYW5rTGluZSA9IG5ld0xpbmU7XG4gICAgICAgIH1cbiAgICAgICAgbmV3TGluZS5pc1dyYXBwZWQgPSBpc1dyYXBwZWQ7XG4gICAgICAgIHZhciB0b3BSb3cgPSB0aGlzLmJ1ZmZlci55YmFzZSArIHRoaXMuYnVmZmVyLnNjcm9sbFRvcDtcbiAgICAgICAgdmFyIGJvdHRvbVJvdyA9IHRoaXMuYnVmZmVyLnliYXNlICsgdGhpcy5idWZmZXIuc2Nyb2xsQm90dG9tO1xuICAgICAgICBpZiAodGhpcy5idWZmZXIuc2Nyb2xsVG9wID09PSAwKSB7XG4gICAgICAgICAgICB2YXIgd2lsbEJ1ZmZlckJlVHJpbW1lZCA9IHRoaXMuYnVmZmVyLmxpbmVzLmlzRnVsbDtcbiAgICAgICAgICAgIGlmIChib3R0b21Sb3cgPT09IHRoaXMuYnVmZmVyLmxpbmVzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICAgICAgICBpZiAod2lsbEJ1ZmZlckJlVHJpbW1lZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlci5saW5lcy5yZWN5Y2xlKCkuY29weUZyb20obmV3TGluZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlci5saW5lcy5wdXNoKG5ld0xpbmUuY2xvbmUoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5idWZmZXIubGluZXMuc3BsaWNlKGJvdHRvbVJvdyArIDEsIDAsIG5ld0xpbmUuY2xvbmUoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXdpbGxCdWZmZXJCZVRyaW1tZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlci55YmFzZSsrO1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5fdXNlclNjcm9sbGluZykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZlci55ZGlzcCsrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLl91c2VyU2Nyb2xsaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYnVmZmVyLnlkaXNwID0gTWF0aC5tYXgodGhpcy5idWZmZXIueWRpc3AgLSAxLCAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgc2Nyb2xsUmVnaW9uSGVpZ2h0ID0gYm90dG9tUm93IC0gdG9wUm93ICsgMTtcbiAgICAgICAgICAgIHRoaXMuYnVmZmVyLmxpbmVzLnNoaWZ0RWxlbWVudHModG9wUm93ICsgMSwgc2Nyb2xsUmVnaW9uSGVpZ2h0IC0gMSwgLTEpO1xuICAgICAgICAgICAgdGhpcy5idWZmZXIubGluZXMuc2V0KGJvdHRvbVJvdywgbmV3TGluZS5jbG9uZSgpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuX3VzZXJTY3JvbGxpbmcpIHtcbiAgICAgICAgICAgIHRoaXMuYnVmZmVyLnlkaXNwID0gdGhpcy5idWZmZXIueWJhc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy51cGRhdGVSYW5nZSh0aGlzLmJ1ZmZlci5zY3JvbGxUb3ApO1xuICAgICAgICB0aGlzLnVwZGF0ZVJhbmdlKHRoaXMuYnVmZmVyLnNjcm9sbEJvdHRvbSk7XG4gICAgICAgIHRoaXMuX29uU2Nyb2xsLmZpcmUodGhpcy5idWZmZXIueWRpc3ApO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnNjcm9sbExpbmVzID0gZnVuY3Rpb24gKGRpc3AsIHN1cHByZXNzU2Nyb2xsRXZlbnQpIHtcbiAgICAgICAgaWYgKGRpc3AgPCAwKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5idWZmZXIueWRpc3AgPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl91c2VyU2Nyb2xsaW5nID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChkaXNwICsgdGhpcy5idWZmZXIueWRpc3AgPj0gdGhpcy5idWZmZXIueWJhc2UpIHtcbiAgICAgICAgICAgIHRoaXMuX3VzZXJTY3JvbGxpbmcgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgb2xkWWRpc3AgPSB0aGlzLmJ1ZmZlci55ZGlzcDtcbiAgICAgICAgdGhpcy5idWZmZXIueWRpc3AgPSBNYXRoLm1heChNYXRoLm1pbih0aGlzLmJ1ZmZlci55ZGlzcCArIGRpc3AsIHRoaXMuYnVmZmVyLnliYXNlKSwgMCk7XG4gICAgICAgIGlmIChvbGRZZGlzcCA9PT0gdGhpcy5idWZmZXIueWRpc3ApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXN1cHByZXNzU2Nyb2xsRXZlbnQpIHtcbiAgICAgICAgICAgIHRoaXMuX29uU2Nyb2xsLmZpcmUodGhpcy5idWZmZXIueWRpc3ApO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucmVmcmVzaCgwLCB0aGlzLnJvd3MgLSAxKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5zY3JvbGxQYWdlcyA9IGZ1bmN0aW9uIChwYWdlQ291bnQpIHtcbiAgICAgICAgdGhpcy5zY3JvbGxMaW5lcyhwYWdlQ291bnQgKiAodGhpcy5yb3dzIC0gMSkpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnNjcm9sbFRvVG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnNjcm9sbExpbmVzKC10aGlzLmJ1ZmZlci55ZGlzcCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuc2Nyb2xsVG9Cb3R0b20gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuc2Nyb2xsTGluZXModGhpcy5idWZmZXIueWJhc2UgLSB0aGlzLmJ1ZmZlci55ZGlzcCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuc2Nyb2xsVG9MaW5lID0gZnVuY3Rpb24gKGxpbmUpIHtcbiAgICAgICAgdmFyIHNjcm9sbEFtb3VudCA9IGxpbmUgLSB0aGlzLmJ1ZmZlci55ZGlzcDtcbiAgICAgICAgaWYgKHNjcm9sbEFtb3VudCAhPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5zY3JvbGxMaW5lcyhzY3JvbGxBbW91bnQpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy5faXNEaXNwb3NlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZGF0YSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMud3JpdGVCdWZmZXIucHVzaChkYXRhKTtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy51c2VGbG93Q29udHJvbCAmJiAhdGhpcy5feG9mZlNlbnRUb0NhdGNoVXAgJiYgdGhpcy53cml0ZUJ1ZmZlci5sZW5ndGggPj0gV1JJVEVfQlVGRkVSX1BBVVNFX1RIUkVTSE9MRCkge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLkRDMyk7XG4gICAgICAgICAgICB0aGlzLl94b2ZmU2VudFRvQ2F0Y2hVcCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLl93cml0ZUluUHJvZ3Jlc3MgJiYgdGhpcy53cml0ZUJ1ZmZlci5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB0aGlzLl93cml0ZUluUHJvZ3Jlc3MgPSB0cnVlO1xuICAgICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX2lubmVyV3JpdGUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuX2lubmVyV3JpdGUgPSBmdW5jdGlvbiAoYnVmZmVyT2Zmc2V0KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmIChidWZmZXJPZmZzZXQgPT09IHZvaWQgMCkgeyBidWZmZXJPZmZzZXQgPSAwOyB9XG4gICAgICAgIGlmICh0aGlzLl9pc0Rpc3Bvc2VkKSB7XG4gICAgICAgICAgICB0aGlzLndyaXRlQnVmZmVyID0gW107XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgICAgIHdoaWxlICh0aGlzLndyaXRlQnVmZmVyLmxlbmd0aCA+IGJ1ZmZlck9mZnNldCkge1xuICAgICAgICAgICAgdmFyIGRhdGEgPSB0aGlzLndyaXRlQnVmZmVyW2J1ZmZlck9mZnNldF07XG4gICAgICAgICAgICBidWZmZXJPZmZzZXQrKztcbiAgICAgICAgICAgIGlmICh0aGlzLl94b2ZmU2VudFRvQ2F0Y2hVcCAmJiB0aGlzLndyaXRlQnVmZmVyLmxlbmd0aCA9PT0gYnVmZmVyT2Zmc2V0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5oYW5kbGVyKEVzY2FwZVNlcXVlbmNlc18xLkMwLkRDMSk7XG4gICAgICAgICAgICAgICAgdGhpcy5feG9mZlNlbnRUb0NhdGNoVXAgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX3JlZnJlc2hTdGFydCA9IHRoaXMuYnVmZmVyLnk7XG4gICAgICAgICAgICB0aGlzLl9yZWZyZXNoRW5kID0gdGhpcy5idWZmZXIueTtcbiAgICAgICAgICAgIHRoaXMuX2lucHV0SGFuZGxlci5wYXJzZShkYXRhKTtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlUmFuZ2UodGhpcy5idWZmZXIueSk7XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2godGhpcy5fcmVmcmVzaFN0YXJ0LCB0aGlzLl9yZWZyZXNoRW5kKTtcbiAgICAgICAgICAgIGlmIChEYXRlLm5vdygpIC0gc3RhcnRUaW1lID49IFdSSVRFX1RJTUVPVVRfTVMpIHtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy53cml0ZUJ1ZmZlci5sZW5ndGggPiBidWZmZXJPZmZzZXQpIHtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX2lubmVyV3JpdGUoYnVmZmVyT2Zmc2V0KTsgfSwgMCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl93cml0ZUluUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMud3JpdGVCdWZmZXIgPSBbXTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLndyaXRlbG4gPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICB0aGlzLndyaXRlKGRhdGEgKyAnXFxyXFxuJyk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuYXR0YWNoQ3VzdG9tS2V5RXZlbnRIYW5kbGVyID0gZnVuY3Rpb24gKGN1c3RvbUtleUV2ZW50SGFuZGxlcikge1xuICAgICAgICB0aGlzLl9jdXN0b21LZXlFdmVudEhhbmRsZXIgPSBjdXN0b21LZXlFdmVudEhhbmRsZXI7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuYWRkQ3NpSGFuZGxlciA9IGZ1bmN0aW9uIChmbGFnLCBjYWxsYmFjaykge1xuICAgICAgICByZXR1cm4gdGhpcy5faW5wdXRIYW5kbGVyLmFkZENzaUhhbmRsZXIoZmxhZywgY2FsbGJhY2spO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLmFkZE9zY0hhbmRsZXIgPSBmdW5jdGlvbiAoaWRlbnQsIGNhbGxiYWNrKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pbnB1dEhhbmRsZXIuYWRkT3NjSGFuZGxlcihpZGVudCwgY2FsbGJhY2spO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnJlZ2lzdGVyTGlua01hdGNoZXIgPSBmdW5jdGlvbiAocmVnZXgsIGhhbmRsZXIsIG9wdGlvbnMpIHtcbiAgICAgICAgdmFyIG1hdGNoZXJJZCA9IHRoaXMubGlua2lmaWVyLnJlZ2lzdGVyTGlua01hdGNoZXIocmVnZXgsIGhhbmRsZXIsIG9wdGlvbnMpO1xuICAgICAgICB0aGlzLnJlZnJlc2goMCwgdGhpcy5yb3dzIC0gMSk7XG4gICAgICAgIHJldHVybiBtYXRjaGVySWQ7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuZGVyZWdpc3RlckxpbmtNYXRjaGVyID0gZnVuY3Rpb24gKG1hdGNoZXJJZCkge1xuICAgICAgICBpZiAodGhpcy5saW5raWZpZXIuZGVyZWdpc3RlckxpbmtNYXRjaGVyKG1hdGNoZXJJZCkpIHtcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaCgwLCB0aGlzLnJvd3MgLSAxKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnJlZ2lzdGVyQ2hhcmFjdGVySm9pbmVyID0gZnVuY3Rpb24gKGhhbmRsZXIpIHtcbiAgICAgICAgdmFyIGpvaW5lcklkID0gdGhpcy5yZW5kZXJlci5yZWdpc3RlckNoYXJhY3RlckpvaW5lcihoYW5kbGVyKTtcbiAgICAgICAgdGhpcy5yZWZyZXNoKDAsIHRoaXMucm93cyAtIDEpO1xuICAgICAgICByZXR1cm4gam9pbmVySWQ7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuZGVyZWdpc3RlckNoYXJhY3RlckpvaW5lciA9IGZ1bmN0aW9uIChqb2luZXJJZCkge1xuICAgICAgICBpZiAodGhpcy5yZW5kZXJlci5kZXJlZ2lzdGVyQ2hhcmFjdGVySm9pbmVyKGpvaW5lcklkKSkge1xuICAgICAgICAgICAgdGhpcy5yZWZyZXNoKDAsIHRoaXMucm93cyAtIDEpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVGVybWluYWwucHJvdG90eXBlLCBcIm1hcmtlcnNcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlci5tYXJrZXJzO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuYWRkTWFya2VyID0gZnVuY3Rpb24gKGN1cnNvcllPZmZzZXQpIHtcbiAgICAgICAgaWYgKHRoaXMuYnVmZmVyICE9PSB0aGlzLmJ1ZmZlcnMubm9ybWFsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyLmFkZE1hcmtlcih0aGlzLmJ1ZmZlci55YmFzZSArIHRoaXMuYnVmZmVyLnkgKyBjdXJzb3JZT2Zmc2V0KTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5oYXNTZWxlY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbk1hbmFnZXIgPyB0aGlzLnNlbGVjdGlvbk1hbmFnZXIuaGFzU2VsZWN0aW9uIDogZmFsc2U7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuc2VsZWN0ID0gZnVuY3Rpb24gKGNvbHVtbiwgcm93LCBsZW5ndGgpIHtcbiAgICAgICAgdGhpcy5zZWxlY3Rpb25NYW5hZ2VyLnNldFNlbGVjdGlvbihjb2x1bW4sIHJvdywgbGVuZ3RoKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5nZXRTZWxlY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlbGVjdGlvbk1hbmFnZXIgPyB0aGlzLnNlbGVjdGlvbk1hbmFnZXIuc2VsZWN0aW9uVGV4dCA6ICcnO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLmdldFNlbGVjdGlvblBvc2l0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuc2VsZWN0aW9uTWFuYWdlci5oYXNTZWxlY3Rpb24pIHtcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHN0YXJ0Q29sdW1uOiB0aGlzLnNlbGVjdGlvbk1hbmFnZXIuc2VsZWN0aW9uU3RhcnRbMF0sXG4gICAgICAgICAgICBzdGFydFJvdzogdGhpcy5zZWxlY3Rpb25NYW5hZ2VyLnNlbGVjdGlvblN0YXJ0WzFdLFxuICAgICAgICAgICAgZW5kQ29sdW1uOiB0aGlzLnNlbGVjdGlvbk1hbmFnZXIuc2VsZWN0aW9uRW5kWzBdLFxuICAgICAgICAgICAgZW5kUm93OiB0aGlzLnNlbGVjdGlvbk1hbmFnZXIuc2VsZWN0aW9uRW5kWzFdXG4gICAgICAgIH07XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuY2xlYXJTZWxlY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbk1hbmFnZXIpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9uTWFuYWdlci5jbGVhclNlbGVjdGlvbigpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuc2VsZWN0QWxsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5zZWxlY3Rpb25NYW5hZ2VyKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvbk1hbmFnZXIuc2VsZWN0QWxsKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5zZWxlY3RMaW5lcyA9IGZ1bmN0aW9uIChzdGFydCwgZW5kKSB7XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdGlvbk1hbmFnZXIpIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9uTWFuYWdlci5zZWxlY3RMaW5lcyhzdGFydCwgZW5kKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLl9rZXlEb3duID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGlmICh0aGlzLl9jdXN0b21LZXlFdmVudEhhbmRsZXIgJiYgdGhpcy5fY3VzdG9tS2V5RXZlbnRIYW5kbGVyKGV2ZW50KSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuX2NvbXBvc2l0aW9uSGVscGVyLmtleWRvd24oZXZlbnQpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5idWZmZXIueWJhc2UgIT09IHRoaXMuYnVmZmVyLnlkaXNwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY3JvbGxUb0JvdHRvbSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHZhciByZXN1bHQgPSBLZXlib2FyZF8xLmV2YWx1YXRlS2V5Ym9hcmRFdmVudChldmVudCwgdGhpcy5hcHBsaWNhdGlvbkN1cnNvciwgdGhpcy5icm93c2VyLmlzTWFjLCB0aGlzLm9wdGlvbnMubWFjT3B0aW9uSXNNZXRhKTtcbiAgICAgICAgdGhpcy51cGRhdGVDdXJzb3JTdHlsZShldmVudCk7XG4gICAgICAgIGlmIChyZXN1bHQudHlwZSA9PT0gMyB8fCByZXN1bHQudHlwZSA9PT0gMikge1xuICAgICAgICAgICAgdmFyIHNjcm9sbENvdW50ID0gdGhpcy5yb3dzIC0gMTtcbiAgICAgICAgICAgIHRoaXMuc2Nyb2xsTGluZXMocmVzdWx0LnR5cGUgPT09IDIgPyAtc2Nyb2xsQ291bnQgOiBzY3JvbGxDb3VudCk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jYW5jZWwoZXZlbnQsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXN1bHQudHlwZSA9PT0gMSkge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RBbGwoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5faXNUaGlyZExldmVsU2hpZnQodGhpcy5icm93c2VyLCBldmVudCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXN1bHQuY2FuY2VsKSB7XG4gICAgICAgICAgICB0aGlzLmNhbmNlbChldmVudCwgdHJ1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFyZXN1bHQua2V5KSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmVtaXQoJ2tleWRvd24nLCBldmVudCk7XG4gICAgICAgIHRoaXMuX29uS2V5LmZpcmUoeyBrZXk6IHJlc3VsdC5rZXksIGRvbUV2ZW50OiBldmVudCB9KTtcbiAgICAgICAgdGhpcy5zaG93Q3Vyc29yKCk7XG4gICAgICAgIHRoaXMuaGFuZGxlcihyZXN1bHQua2V5KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FuY2VsKGV2ZW50LCB0cnVlKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5faXNUaGlyZExldmVsU2hpZnQgPSBmdW5jdGlvbiAoYnJvd3NlciwgZXYpIHtcbiAgICAgICAgdmFyIHRoaXJkTGV2ZWxLZXkgPSAoYnJvd3Nlci5pc01hYyAmJiAhdGhpcy5vcHRpb25zLm1hY09wdGlvbklzTWV0YSAmJiBldi5hbHRLZXkgJiYgIWV2LmN0cmxLZXkgJiYgIWV2Lm1ldGFLZXkpIHx8XG4gICAgICAgICAgICAoYnJvd3Nlci5pc01TV2luZG93cyAmJiBldi5hbHRLZXkgJiYgZXYuY3RybEtleSAmJiAhZXYubWV0YUtleSk7XG4gICAgICAgIGlmIChldi50eXBlID09PSAna2V5cHJlc3MnKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcmRMZXZlbEtleTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcmRMZXZlbEtleSAmJiAoIWV2LmtleUNvZGUgfHwgZXYua2V5Q29kZSA+IDQ3KTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5zZXRnTGV2ZWwgPSBmdW5jdGlvbiAoZykge1xuICAgICAgICB0aGlzLmdsZXZlbCA9IGc7XG4gICAgICAgIHRoaXMuY2hhcnNldCA9IHRoaXMuY2hhcnNldHNbZ107XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuc2V0Z0NoYXJzZXQgPSBmdW5jdGlvbiAoZywgY2hhcnNldCkge1xuICAgICAgICB0aGlzLmNoYXJzZXRzW2ddID0gY2hhcnNldDtcbiAgICAgICAgaWYgKHRoaXMuZ2xldmVsID09PSBnKSB7XG4gICAgICAgICAgICB0aGlzLmNoYXJzZXQgPSBjaGFyc2V0O1xuICAgICAgICB9XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuX2tleVVwID0gZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgIHRoaXMudXBkYXRlQ3Vyc29yU3R5bGUoZXYpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLl9rZXlQcmVzcyA9IGZ1bmN0aW9uIChldikge1xuICAgICAgICB2YXIga2V5O1xuICAgICAgICBpZiAodGhpcy5fY3VzdG9tS2V5RXZlbnRIYW5kbGVyICYmIHRoaXMuX2N1c3RvbUtleUV2ZW50SGFuZGxlcihldikgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jYW5jZWwoZXYpO1xuICAgICAgICBpZiAoZXYuY2hhckNvZGUpIHtcbiAgICAgICAgICAgIGtleSA9IGV2LmNoYXJDb2RlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGV2LndoaWNoID09PSBudWxsIHx8IGV2LndoaWNoID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGtleSA9IGV2LmtleUNvZGU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZXYud2hpY2ggIT09IDAgJiYgZXYuY2hhckNvZGUgIT09IDApIHtcbiAgICAgICAgICAgIGtleSA9IGV2LndoaWNoO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICgha2V5IHx8ICgoZXYuYWx0S2V5IHx8IGV2LmN0cmxLZXkgfHwgZXYubWV0YUtleSkgJiYgIXRoaXMuX2lzVGhpcmRMZXZlbFNoaWZ0KHRoaXMuYnJvd3NlciwgZXYpKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGtleSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoa2V5KTtcbiAgICAgICAgdGhpcy5lbWl0KCdrZXlwcmVzcycsIGtleSwgZXYpO1xuICAgICAgICB0aGlzLl9vbktleS5maXJlKHsga2V5OiBrZXksIGRvbUV2ZW50OiBldiB9KTtcbiAgICAgICAgdGhpcy5zaG93Q3Vyc29yKCk7XG4gICAgICAgIHRoaXMuaGFuZGxlcihrZXkpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5iZWxsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLmVtaXQoJ2JlbGwnKTtcbiAgICAgICAgaWYgKHRoaXMuX3NvdW5kQmVsbCgpKSB7XG4gICAgICAgICAgICB0aGlzLnNvdW5kTWFuYWdlci5wbGF5QmVsbFNvdW5kKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX3Zpc3VhbEJlbGwoKSkge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmNsYXNzTGlzdC5hZGQoJ3Zpc3VhbC1iZWxsLWFjdGl2ZScpO1xuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX3Zpc3VhbEJlbGxUaW1lcik7XG4gICAgICAgICAgICB0aGlzLl92aXN1YWxCZWxsVGltZXIgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKCd2aXN1YWwtYmVsbC1hY3RpdmUnKTtcbiAgICAgICAgICAgIH0sIDIwMCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5sb2cgPSBmdW5jdGlvbiAodGV4dCwgZGF0YSkge1xuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5kZWJ1ZylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKCF0aGlzLl9jb250ZXh0LmNvbnNvbGUgfHwgIXRoaXMuX2NvbnRleHQuY29uc29sZS5sb2cpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRoaXMuX2NvbnRleHQuY29uc29sZS5sb2codGV4dCwgZGF0YSk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiAodGV4dCwgZGF0YSkge1xuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5kZWJ1ZylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaWYgKCF0aGlzLl9jb250ZXh0LmNvbnNvbGUgfHwgIXRoaXMuX2NvbnRleHQuY29uc29sZS5lcnJvcilcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdGhpcy5fY29udGV4dC5jb25zb2xlLmVycm9yKHRleHQsIGRhdGEpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnJlc2l6ZSA9IGZ1bmN0aW9uICh4LCB5KSB7XG4gICAgICAgIGlmIChpc05hTih4KSB8fCBpc05hTih5KSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh4ID09PSB0aGlzLmNvbHMgJiYgeSA9PT0gdGhpcy5yb3dzKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5jaGFyTWVhc3VyZSAmJiAoIXRoaXMuY2hhck1lYXN1cmUud2lkdGggfHwgIXRoaXMuY2hhck1lYXN1cmUuaGVpZ2h0KSkge1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhck1lYXN1cmUubWVhc3VyZSh0aGlzLm9wdGlvbnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh4IDwgTUlOSU1VTV9DT0xTKVxuICAgICAgICAgICAgeCA9IE1JTklNVU1fQ09MUztcbiAgICAgICAgaWYgKHkgPCBNSU5JTVVNX1JPV1MpXG4gICAgICAgICAgICB5ID0gTUlOSU1VTV9ST1dTO1xuICAgICAgICB0aGlzLmJ1ZmZlcnMucmVzaXplKHgsIHkpO1xuICAgICAgICB0aGlzLmNvbHMgPSB4O1xuICAgICAgICB0aGlzLnJvd3MgPSB5O1xuICAgICAgICB0aGlzLmJ1ZmZlcnMuc2V0dXBUYWJTdG9wcyh0aGlzLmNvbHMpO1xuICAgICAgICBpZiAodGhpcy5jaGFyTWVhc3VyZSkge1xuICAgICAgICAgICAgdGhpcy5jaGFyTWVhc3VyZS5tZWFzdXJlKHRoaXMub3B0aW9ucyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZWZyZXNoKDAsIHRoaXMucm93cyAtIDEpO1xuICAgICAgICB0aGlzLl9vblJlc2l6ZS5maXJlKHsgY29sczogeCwgcm93czogeSB9KTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS51cGRhdGVSYW5nZSA9IGZ1bmN0aW9uICh5KSB7XG4gICAgICAgIGlmICh5IDwgdGhpcy5fcmVmcmVzaFN0YXJ0KVxuICAgICAgICAgICAgdGhpcy5fcmVmcmVzaFN0YXJ0ID0geTtcbiAgICAgICAgaWYgKHkgPiB0aGlzLl9yZWZyZXNoRW5kKVxuICAgICAgICAgICAgdGhpcy5fcmVmcmVzaEVuZCA9IHk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUubWF4UmFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3JlZnJlc2hTdGFydCA9IDA7XG4gICAgICAgIHRoaXMuX3JlZnJlc2hFbmQgPSB0aGlzLnJvd3MgLSAxO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5idWZmZXIueWJhc2UgPT09IDAgJiYgdGhpcy5idWZmZXIueSA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYnVmZmVyLmxpbmVzLnNldCgwLCB0aGlzLmJ1ZmZlci5saW5lcy5nZXQodGhpcy5idWZmZXIueWJhc2UgKyB0aGlzLmJ1ZmZlci55KSk7XG4gICAgICAgIHRoaXMuYnVmZmVyLmxpbmVzLmxlbmd0aCA9IDE7XG4gICAgICAgIHRoaXMuYnVmZmVyLnlkaXNwID0gMDtcbiAgICAgICAgdGhpcy5idWZmZXIueWJhc2UgPSAwO1xuICAgICAgICB0aGlzLmJ1ZmZlci55ID0gMDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDE7IGkgPCB0aGlzLnJvd3M7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5idWZmZXIubGluZXMucHVzaCh0aGlzLmJ1ZmZlci5nZXRCbGFua0xpbmUoQnVmZmVyTGluZV8xLkRFRkFVTFRfQVRUUl9EQVRBKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZWZyZXNoKDAsIHRoaXMucm93cyAtIDEpO1xuICAgICAgICB0aGlzLl9vblNjcm9sbC5maXJlKHRoaXMuYnVmZmVyLnlkaXNwKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5pcyA9IGZ1bmN0aW9uICh0ZXJtKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5vcHRpb25zLnRlcm1OYW1lICsgJycpLmluZGV4T2YodGVybSkgPT09IDA7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuaGFuZGxlciA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZGlzYWJsZVN0ZGluKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0aW9uTWFuYWdlciAmJiB0aGlzLnNlbGVjdGlvbk1hbmFnZXIuaGFzU2VsZWN0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdGlvbk1hbmFnZXIuY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5idWZmZXIueWJhc2UgIT09IHRoaXMuYnVmZmVyLnlkaXNwKSB7XG4gICAgICAgICAgICB0aGlzLnNjcm9sbFRvQm90dG9tKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fb25EYXRhLmZpcmUoZGF0YSk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuaGFuZGxlVGl0bGUgPSBmdW5jdGlvbiAodGl0bGUpIHtcbiAgICAgICAgdGhpcy5fb25UaXRsZUNoYW5nZS5maXJlKHRpdGxlKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5pbmRleCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5idWZmZXIueSsrO1xuICAgICAgICBpZiAodGhpcy5idWZmZXIueSA+IHRoaXMuYnVmZmVyLnNjcm9sbEJvdHRvbSkge1xuICAgICAgICAgICAgdGhpcy5idWZmZXIueS0tO1xuICAgICAgICAgICAgdGhpcy5zY3JvbGwoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5idWZmZXIueCA+PSB0aGlzLmNvbHMpIHtcbiAgICAgICAgICAgIHRoaXMuYnVmZmVyLngtLTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnJldmVyc2VJbmRleCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuYnVmZmVyLnkgPT09IHRoaXMuYnVmZmVyLnNjcm9sbFRvcCkge1xuICAgICAgICAgICAgdmFyIHNjcm9sbFJlZ2lvbkhlaWdodCA9IHRoaXMuYnVmZmVyLnNjcm9sbEJvdHRvbSAtIHRoaXMuYnVmZmVyLnNjcm9sbFRvcDtcbiAgICAgICAgICAgIHRoaXMuYnVmZmVyLmxpbmVzLnNoaWZ0RWxlbWVudHModGhpcy5idWZmZXIueSArIHRoaXMuYnVmZmVyLnliYXNlLCBzY3JvbGxSZWdpb25IZWlnaHQsIDEpO1xuICAgICAgICAgICAgdGhpcy5idWZmZXIubGluZXMuc2V0KHRoaXMuYnVmZmVyLnkgKyB0aGlzLmJ1ZmZlci55YmFzZSwgdGhpcy5idWZmZXIuZ2V0QmxhbmtMaW5lKHRoaXMuZXJhc2VBdHRyRGF0YSgpKSk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVJhbmdlKHRoaXMuYnVmZmVyLnNjcm9sbFRvcCk7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVJhbmdlKHRoaXMuYnVmZmVyLnNjcm9sbEJvdHRvbSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmJ1ZmZlci55LS07XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5vcHRpb25zLnJvd3MgPSB0aGlzLnJvd3M7XG4gICAgICAgIHRoaXMub3B0aW9ucy5jb2xzID0gdGhpcy5jb2xzO1xuICAgICAgICB2YXIgY3VzdG9tS2V5RXZlbnRIYW5kbGVyID0gdGhpcy5fY3VzdG9tS2V5RXZlbnRIYW5kbGVyO1xuICAgICAgICB2YXIgaW5wdXRIYW5kbGVyID0gdGhpcy5faW5wdXRIYW5kbGVyO1xuICAgICAgICB2YXIgY3Vyc29yU3RhdGUgPSB0aGlzLmN1cnNvclN0YXRlO1xuICAgICAgICB0aGlzLl9zZXR1cCgpO1xuICAgICAgICB0aGlzLl9jdXN0b21LZXlFdmVudEhhbmRsZXIgPSBjdXN0b21LZXlFdmVudEhhbmRsZXI7XG4gICAgICAgIHRoaXMuX2lucHV0SGFuZGxlciA9IGlucHV0SGFuZGxlcjtcbiAgICAgICAgdGhpcy5jdXJzb3JTdGF0ZSA9IGN1cnNvclN0YXRlO1xuICAgICAgICB0aGlzLnJlZnJlc2goMCwgdGhpcy5yb3dzIC0gMSk7XG4gICAgICAgIGlmICh0aGlzLnZpZXdwb3J0KSB7XG4gICAgICAgICAgICB0aGlzLnZpZXdwb3J0LnN5bmNTY3JvbGxBcmVhKCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS50YWJTZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuYnVmZmVyLnRhYnNbdGhpcy5idWZmZXIueF0gPSB0cnVlO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLmNhbmNlbCA9IGZ1bmN0aW9uIChldiwgZm9yY2UpIHtcbiAgICAgICAgaWYgKCF0aGlzLm9wdGlvbnMuY2FuY2VsRXZlbnRzICYmICFmb3JjZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGV2LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuX3Zpc3VhbEJlbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5fc291bmRCZWxsID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmJlbGxTdHlsZSA9PT0gJ3NvdW5kJztcbiAgICB9O1xuICAgIHJldHVybiBUZXJtaW5hbDtcbn0oRXZlbnRFbWl0dGVyXzEuRXZlbnRFbWl0dGVyKSk7XG5leHBvcnRzLlRlcm1pbmFsID0gVGVybWluYWw7XG5mdW5jdGlvbiB3YXNNb2RpZmllcktleU9ubHlFdmVudChldikge1xuICAgIHJldHVybiBldi5rZXlDb2RlID09PSAxNiB8fFxuICAgICAgICBldi5rZXlDb2RlID09PSAxNyB8fFxuICAgICAgICBldi5rZXlDb2RlID09PSAxODtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVRlcm1pbmFsLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgTGlmZWN5Y2xlXzEgPSByZXF1aXJlKFwiLi9jb21tb24vTGlmZWN5Y2xlXCIpO1xudmFyIExpZmVjeWNsZV8yID0gcmVxdWlyZShcIi4vdWkvTGlmZWN5Y2xlXCIpO1xudmFyIEZBTExCQUNLX1NDUk9MTF9CQVJfV0lEVEggPSAxNTtcbnZhciBWaWV3cG9ydCA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFZpZXdwb3J0LCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFZpZXdwb3J0KF90ZXJtaW5hbCwgX3ZpZXdwb3J0RWxlbWVudCwgX3Njcm9sbEFyZWEsIF9jaGFyTWVhc3VyZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5fdGVybWluYWwgPSBfdGVybWluYWw7XG4gICAgICAgIF90aGlzLl92aWV3cG9ydEVsZW1lbnQgPSBfdmlld3BvcnRFbGVtZW50O1xuICAgICAgICBfdGhpcy5fc2Nyb2xsQXJlYSA9IF9zY3JvbGxBcmVhO1xuICAgICAgICBfdGhpcy5fY2hhck1lYXN1cmUgPSBfY2hhck1lYXN1cmU7XG4gICAgICAgIF90aGlzLnNjcm9sbEJhcldpZHRoID0gMDtcbiAgICAgICAgX3RoaXMuX2N1cnJlbnRSb3dIZWlnaHQgPSAwO1xuICAgICAgICBfdGhpcy5fbGFzdFJlY29yZGVkQnVmZmVyTGVuZ3RoID0gMDtcbiAgICAgICAgX3RoaXMuX2xhc3RSZWNvcmRlZFZpZXdwb3J0SGVpZ2h0ID0gMDtcbiAgICAgICAgX3RoaXMuX2xhc3RSZWNvcmRlZEJ1ZmZlckhlaWdodCA9IDA7XG4gICAgICAgIF90aGlzLl9sYXN0U2Nyb2xsVG9wID0gMDtcbiAgICAgICAgX3RoaXMuX3doZWVsUGFydGlhbFNjcm9sbCA9IDA7XG4gICAgICAgIF90aGlzLl9yZWZyZXNoQW5pbWF0aW9uRnJhbWUgPSBudWxsO1xuICAgICAgICBfdGhpcy5faWdub3JlTmV4dFNjcm9sbEV2ZW50ID0gZmFsc2U7XG4gICAgICAgIF90aGlzLnNjcm9sbEJhcldpZHRoID0gKF90aGlzLl92aWV3cG9ydEVsZW1lbnQub2Zmc2V0V2lkdGggLSBfdGhpcy5fc2Nyb2xsQXJlYS5vZmZzZXRXaWR0aCkgfHwgRkFMTEJBQ0tfU0NST0xMX0JBUl9XSURUSDtcbiAgICAgICAgX3RoaXMucmVnaXN0ZXIoTGlmZWN5Y2xlXzIuYWRkRGlzcG9zYWJsZURvbUxpc3RlbmVyKF90aGlzLl92aWV3cG9ydEVsZW1lbnQsICdzY3JvbGwnLCBfdGhpcy5fb25TY3JvbGwuYmluZChfdGhpcykpKTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5zeW5jU2Nyb2xsQXJlYSgpOyB9LCAwKTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBWaWV3cG9ydC5wcm90b3R5cGUub25UaGVtZUNoYW5nZWQgPSBmdW5jdGlvbiAoY29sb3JzKSB7XG4gICAgICAgIHRoaXMuX3ZpZXdwb3J0RWxlbWVudC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBjb2xvcnMuYmFja2dyb3VuZC5jc3M7XG4gICAgfTtcbiAgICBWaWV3cG9ydC5wcm90b3R5cGUuX3JlZnJlc2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICh0aGlzLl9yZWZyZXNoQW5pbWF0aW9uRnJhbWUgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuX3JlZnJlc2hBbmltYXRpb25GcmFtZSA9IHJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5faW5uZXJSZWZyZXNoKCk7IH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBWaWV3cG9ydC5wcm90b3R5cGUuX2lubmVyUmVmcmVzaCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2NoYXJNZWFzdXJlLmhlaWdodCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRSb3dIZWlnaHQgPSB0aGlzLl90ZXJtaW5hbC5yZW5kZXJlci5kaW1lbnNpb25zLnNjYWxlZENlbGxIZWlnaHQgLyB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbztcbiAgICAgICAgICAgIHRoaXMuX2xhc3RSZWNvcmRlZFZpZXdwb3J0SGVpZ2h0ID0gdGhpcy5fdmlld3BvcnRFbGVtZW50Lm9mZnNldEhlaWdodDtcbiAgICAgICAgICAgIHZhciBuZXdCdWZmZXJIZWlnaHQgPSBNYXRoLnJvdW5kKHRoaXMuX2N1cnJlbnRSb3dIZWlnaHQgKiB0aGlzLl9sYXN0UmVjb3JkZWRCdWZmZXJMZW5ndGgpICsgKHRoaXMuX2xhc3RSZWNvcmRlZFZpZXdwb3J0SGVpZ2h0IC0gdGhpcy5fdGVybWluYWwucmVuZGVyZXIuZGltZW5zaW9ucy5jYW52YXNIZWlnaHQpO1xuICAgICAgICAgICAgaWYgKHRoaXMuX2xhc3RSZWNvcmRlZEJ1ZmZlckhlaWdodCAhPT0gbmV3QnVmZmVySGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fbGFzdFJlY29yZGVkQnVmZmVySGVpZ2h0ID0gbmV3QnVmZmVySGVpZ2h0O1xuICAgICAgICAgICAgICAgIHRoaXMuX3Njcm9sbEFyZWEuc3R5bGUuaGVpZ2h0ID0gdGhpcy5fbGFzdFJlY29yZGVkQnVmZmVySGVpZ2h0ICsgJ3B4JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2YXIgc2Nyb2xsVG9wID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLnlkaXNwICogdGhpcy5fY3VycmVudFJvd0hlaWdodDtcbiAgICAgICAgaWYgKHRoaXMuX3ZpZXdwb3J0RWxlbWVudC5zY3JvbGxUb3AgIT09IHNjcm9sbFRvcCkge1xuICAgICAgICAgICAgdGhpcy5faWdub3JlTmV4dFNjcm9sbEV2ZW50ID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuX3ZpZXdwb3J0RWxlbWVudC5zY3JvbGxUb3AgPSBzY3JvbGxUb3A7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fcmVmcmVzaEFuaW1hdGlvbkZyYW1lID0gbnVsbDtcbiAgICB9O1xuICAgIFZpZXdwb3J0LnByb3RvdHlwZS5zeW5jU2Nyb2xsQXJlYSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2xhc3RSZWNvcmRlZEJ1ZmZlckxlbmd0aCAhPT0gdGhpcy5fdGVybWluYWwuYnVmZmVyLmxpbmVzLmxlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5fbGFzdFJlY29yZGVkQnVmZmVyTGVuZ3RoID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLmxpbmVzLmxlbmd0aDtcbiAgICAgICAgICAgIHRoaXMuX3JlZnJlc2goKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fbGFzdFJlY29yZGVkVmlld3BvcnRIZWlnaHQgIT09IHRoaXMuX3Rlcm1pbmFsLnJlbmRlcmVyLmRpbWVuc2lvbnMuY2FudmFzSGVpZ2h0KSB7XG4gICAgICAgICAgICB0aGlzLl9yZWZyZXNoKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG5ld1Njcm9sbFRvcCA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55ZGlzcCAqIHRoaXMuX2N1cnJlbnRSb3dIZWlnaHQ7XG4gICAgICAgIGlmICh0aGlzLl9sYXN0U2Nyb2xsVG9wICE9PSBuZXdTY3JvbGxUb3ApIHtcbiAgICAgICAgICAgIHRoaXMuX3JlZnJlc2goKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fbGFzdFNjcm9sbFRvcCAhPT0gdGhpcy5fdmlld3BvcnRFbGVtZW50LnNjcm9sbFRvcCkge1xuICAgICAgICAgICAgdGhpcy5fcmVmcmVzaCgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5yZW5kZXJlci5kaW1lbnNpb25zLnNjYWxlZENlbGxIZWlnaHQgLyB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyAhPT0gdGhpcy5fY3VycmVudFJvd0hlaWdodCkge1xuICAgICAgICAgICAgdGhpcy5fcmVmcmVzaCgpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBWaWV3cG9ydC5wcm90b3R5cGUuX29uU2Nyb2xsID0gZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgIHRoaXMuX2xhc3RTY3JvbGxUb3AgPSB0aGlzLl92aWV3cG9ydEVsZW1lbnQuc2Nyb2xsVG9wO1xuICAgICAgICBpZiAoIXRoaXMuX3ZpZXdwb3J0RWxlbWVudC5vZmZzZXRQYXJlbnQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5faWdub3JlTmV4dFNjcm9sbEV2ZW50KSB7XG4gICAgICAgICAgICB0aGlzLl9pZ25vcmVOZXh0U2Nyb2xsRXZlbnQgPSBmYWxzZTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbmV3Um93ID0gTWF0aC5yb3VuZCh0aGlzLl9sYXN0U2Nyb2xsVG9wIC8gdGhpcy5fY3VycmVudFJvd0hlaWdodCk7XG4gICAgICAgIHZhciBkaWZmID0gbmV3Um93IC0gdGhpcy5fdGVybWluYWwuYnVmZmVyLnlkaXNwO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5zY3JvbGxMaW5lcyhkaWZmLCB0cnVlKTtcbiAgICB9O1xuICAgIFZpZXdwb3J0LnByb3RvdHlwZS5vbldoZWVsID0gZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgIHZhciBhbW91bnQgPSB0aGlzLl9nZXRQaXhlbHNTY3JvbGxlZChldik7XG4gICAgICAgIGlmIChhbW91bnQgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl92aWV3cG9ydEVsZW1lbnQuc2Nyb2xsVG9wICs9IGFtb3VudDtcbiAgICAgICAgZXYucHJldmVudERlZmF1bHQoKTtcbiAgICB9O1xuICAgIFZpZXdwb3J0LnByb3RvdHlwZS5fZ2V0UGl4ZWxzU2Nyb2xsZWQgPSBmdW5jdGlvbiAoZXYpIHtcbiAgICAgICAgaWYgKGV2LmRlbHRhWSA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGFtb3VudCA9IGV2LmRlbHRhWTtcbiAgICAgICAgaWYgKGV2LmRlbHRhTW9kZSA9PT0gV2hlZWxFdmVudC5ET01fREVMVEFfTElORSkge1xuICAgICAgICAgICAgYW1vdW50ICo9IHRoaXMuX2N1cnJlbnRSb3dIZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZXYuZGVsdGFNb2RlID09PSBXaGVlbEV2ZW50LkRPTV9ERUxUQV9QQUdFKSB7XG4gICAgICAgICAgICBhbW91bnQgKj0gdGhpcy5fY3VycmVudFJvd0hlaWdodCAqIHRoaXMuX3Rlcm1pbmFsLnJvd3M7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFtb3VudDtcbiAgICB9O1xuICAgIFZpZXdwb3J0LnByb3RvdHlwZS5nZXRMaW5lc1Njcm9sbGVkID0gZnVuY3Rpb24gKGV2KSB7XG4gICAgICAgIGlmIChldi5kZWx0YVkgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIHZhciBhbW91bnQgPSBldi5kZWx0YVk7XG4gICAgICAgIGlmIChldi5kZWx0YU1vZGUgPT09IFdoZWVsRXZlbnQuRE9NX0RFTFRBX1BJWEVMKSB7XG4gICAgICAgICAgICBhbW91bnQgLz0gdGhpcy5fY3VycmVudFJvd0hlaWdodCArIDAuMDtcbiAgICAgICAgICAgIHRoaXMuX3doZWVsUGFydGlhbFNjcm9sbCArPSBhbW91bnQ7XG4gICAgICAgICAgICBhbW91bnQgPSBNYXRoLmZsb29yKE1hdGguYWJzKHRoaXMuX3doZWVsUGFydGlhbFNjcm9sbCkpICogKHRoaXMuX3doZWVsUGFydGlhbFNjcm9sbCA+IDAgPyAxIDogLTEpO1xuICAgICAgICAgICAgdGhpcy5fd2hlZWxQYXJ0aWFsU2Nyb2xsICU9IDE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZXYuZGVsdGFNb2RlID09PSBXaGVlbEV2ZW50LkRPTV9ERUxUQV9QQUdFKSB7XG4gICAgICAgICAgICBhbW91bnQgKj0gdGhpcy5fdGVybWluYWwucm93cztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYW1vdW50O1xuICAgIH07XG4gICAgVmlld3BvcnQucHJvdG90eXBlLm9uVG91Y2hTdGFydCA9IGZ1bmN0aW9uIChldikge1xuICAgICAgICB0aGlzLl9sYXN0VG91Y2hZID0gZXYudG91Y2hlc1swXS5wYWdlWTtcbiAgICB9O1xuICAgIFZpZXdwb3J0LnByb3RvdHlwZS5vblRvdWNoTW92ZSA9IGZ1bmN0aW9uIChldikge1xuICAgICAgICB2YXIgZGVsdGFZID0gdGhpcy5fbGFzdFRvdWNoWSAtIGV2LnRvdWNoZXNbMF0ucGFnZVk7XG4gICAgICAgIHRoaXMuX2xhc3RUb3VjaFkgPSBldi50b3VjaGVzWzBdLnBhZ2VZO1xuICAgICAgICBpZiAoZGVsdGFZID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdmlld3BvcnRFbGVtZW50LnNjcm9sbFRvcCArPSBkZWx0YVk7XG4gICAgICAgIGV2LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfTtcbiAgICByZXR1cm4gVmlld3BvcnQ7XG59KExpZmVjeWNsZV8xLkRpc3Bvc2FibGUpKTtcbmV4cG9ydHMuVmlld3BvcnQgPSBWaWV3cG9ydDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVZpZXdwb3J0LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIEJ1ZmZlckxpbmVfMSA9IHJlcXVpcmUoXCIuL2NvcmUvYnVmZmVyL0J1ZmZlckxpbmVcIik7XG5mdW5jdGlvbiBhcHBseVdpbmRvd3NNb2RlKHRlcm1pbmFsKSB7XG4gICAgcmV0dXJuIHRlcm1pbmFsLm9uTGluZUZlZWQoZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgbGluZSA9IHRlcm1pbmFsLmJ1ZmZlci5saW5lcy5nZXQodGVybWluYWwuYnVmZmVyLnliYXNlICsgdGVybWluYWwuYnVmZmVyLnkgLSAxKTtcbiAgICAgICAgdmFyIGxhc3RDaGFyID0gbGluZS5nZXQodGVybWluYWwuY29scyAtIDEpO1xuICAgICAgICBpZiAobGFzdENoYXJbQnVmZmVyTGluZV8xLkNIQVJfREFUQV9DT0RFX0lOREVYXSAhPT0gQnVmZmVyTGluZV8xLk5VTExfQ0VMTF9DT0RFICYmIGxhc3RDaGFyW0J1ZmZlckxpbmVfMS5DSEFSX0RBVEFfQ09ERV9JTkRFWF0gIT09IEJ1ZmZlckxpbmVfMS5XSElURVNQQUNFX0NFTExfQ09ERSkge1xuICAgICAgICAgICAgdmFyIG5leHRMaW5lID0gdGVybWluYWwuYnVmZmVyLmxpbmVzLmdldCh0ZXJtaW5hbC5idWZmZXIueWJhc2UgKyB0ZXJtaW5hbC5idWZmZXIueSk7XG4gICAgICAgICAgICBuZXh0TGluZS5pc1dyYXBwZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLmFwcGx5V2luZG93c01vZGUgPSBhcHBseVdpbmRvd3NNb2RlO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9V2luZG93c01vZGUuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgRXZlbnRFbWl0dGVyMl8xID0gcmVxdWlyZShcIi4vRXZlbnRFbWl0dGVyMlwiKTtcbnZhciBDaXJjdWxhckxpc3QgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIENpcmN1bGFyTGlzdChfbWF4TGVuZ3RoKSB7XG4gICAgICAgIHRoaXMuX21heExlbmd0aCA9IF9tYXhMZW5ndGg7XG4gICAgICAgIHRoaXMub25EZWxldGVFbWl0dGVyID0gbmV3IEV2ZW50RW1pdHRlcjJfMS5FdmVudEVtaXR0ZXIyKCk7XG4gICAgICAgIHRoaXMub25JbnNlcnRFbWl0dGVyID0gbmV3IEV2ZW50RW1pdHRlcjJfMS5FdmVudEVtaXR0ZXIyKCk7XG4gICAgICAgIHRoaXMub25UcmltRW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXIyXzEuRXZlbnRFbWl0dGVyMigpO1xuICAgICAgICB0aGlzLl9hcnJheSA9IG5ldyBBcnJheSh0aGlzLl9tYXhMZW5ndGgpO1xuICAgICAgICB0aGlzLl9zdGFydEluZGV4ID0gMDtcbiAgICAgICAgdGhpcy5fbGVuZ3RoID0gMDtcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENpcmN1bGFyTGlzdC5wcm90b3R5cGUsIFwib25EZWxldGVcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMub25EZWxldGVFbWl0dGVyLmV2ZW50OyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ2lyY3VsYXJMaXN0LnByb3RvdHlwZSwgXCJvbkluc2VydFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5vbkluc2VydEVtaXR0ZXIuZXZlbnQ7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDaXJjdWxhckxpc3QucHJvdG90eXBlLCBcIm9uVHJpbVwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5vblRyaW1FbWl0dGVyLmV2ZW50OyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ2lyY3VsYXJMaXN0LnByb3RvdHlwZSwgXCJtYXhMZW5ndGhcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9tYXhMZW5ndGg7XG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24gKG5ld01heExlbmd0aCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX21heExlbmd0aCA9PT0gbmV3TWF4TGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIG5ld0FycmF5ID0gbmV3IEFycmF5KG5ld01heExlbmd0aCk7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IE1hdGgubWluKG5ld01heExlbmd0aCwgdGhpcy5sZW5ndGgpOyBpKyspIHtcbiAgICAgICAgICAgICAgICBuZXdBcnJheVtpXSA9IHRoaXMuX2FycmF5W3RoaXMuX2dldEN5Y2xpY0luZGV4KGkpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2FycmF5ID0gbmV3QXJyYXk7XG4gICAgICAgICAgICB0aGlzLl9tYXhMZW5ndGggPSBuZXdNYXhMZW5ndGg7XG4gICAgICAgICAgICB0aGlzLl9zdGFydEluZGV4ID0gMDtcbiAgICAgICAgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENpcmN1bGFyTGlzdC5wcm90b3R5cGUsIFwibGVuZ3RoXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbGVuZ3RoO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uIChuZXdMZW5ndGgpIHtcbiAgICAgICAgICAgIGlmIChuZXdMZW5ndGggPiB0aGlzLl9sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5fbGVuZ3RoOyBpIDwgbmV3TGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXJyYXlbaV0gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fbGVuZ3RoID0gbmV3TGVuZ3RoO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBDaXJjdWxhckxpc3QucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYXJyYXlbdGhpcy5fZ2V0Q3ljbGljSW5kZXgoaW5kZXgpXTtcbiAgICB9O1xuICAgIENpcmN1bGFyTGlzdC5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24gKGluZGV4LCB2YWx1ZSkge1xuICAgICAgICB0aGlzLl9hcnJheVt0aGlzLl9nZXRDeWNsaWNJbmRleChpbmRleCldID0gdmFsdWU7XG4gICAgfTtcbiAgICBDaXJjdWxhckxpc3QucHJvdG90eXBlLnB1c2ggPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgdGhpcy5fYXJyYXlbdGhpcy5fZ2V0Q3ljbGljSW5kZXgodGhpcy5fbGVuZ3RoKV0gPSB2YWx1ZTtcbiAgICAgICAgaWYgKHRoaXMuX2xlbmd0aCA9PT0gdGhpcy5fbWF4TGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLl9zdGFydEluZGV4ID0gKyt0aGlzLl9zdGFydEluZGV4ICUgdGhpcy5fbWF4TGVuZ3RoO1xuICAgICAgICAgICAgdGhpcy5vblRyaW1FbWl0dGVyLmZpcmUoMSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9sZW5ndGgrKztcbiAgICAgICAgfVxuICAgIH07XG4gICAgQ2lyY3VsYXJMaXN0LnByb3RvdHlwZS5yZWN5Y2xlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fbGVuZ3RoICE9PSB0aGlzLl9tYXhMZW5ndGgpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FuIG9ubHkgcmVjeWNsZSB3aGVuIHRoZSBidWZmZXIgaXMgZnVsbCcpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3N0YXJ0SW5kZXggPSArK3RoaXMuX3N0YXJ0SW5kZXggJSB0aGlzLl9tYXhMZW5ndGg7XG4gICAgICAgIHRoaXMub25UcmltRW1pdHRlci5maXJlKDEpO1xuICAgICAgICByZXR1cm4gdGhpcy5fYXJyYXlbdGhpcy5fZ2V0Q3ljbGljSW5kZXgodGhpcy5fbGVuZ3RoIC0gMSldO1xuICAgIH07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KENpcmN1bGFyTGlzdC5wcm90b3R5cGUsIFwiaXNGdWxsXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbGVuZ3RoID09PSB0aGlzLl9tYXhMZW5ndGg7XG4gICAgICAgIH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIENpcmN1bGFyTGlzdC5wcm90b3R5cGUucG9wID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYXJyYXlbdGhpcy5fZ2V0Q3ljbGljSW5kZXgodGhpcy5fbGVuZ3RoLS0gLSAxKV07XG4gICAgfTtcbiAgICBDaXJjdWxhckxpc3QucHJvdG90eXBlLnNwbGljZSA9IGZ1bmN0aW9uIChzdGFydCwgZGVsZXRlQ291bnQpIHtcbiAgICAgICAgdmFyIGl0ZW1zID0gW107XG4gICAgICAgIGZvciAodmFyIF9pID0gMjsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XG4gICAgICAgICAgICBpdGVtc1tfaSAtIDJdID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGVsZXRlQ291bnQpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IHRoaXMuX2xlbmd0aCAtIGRlbGV0ZUNvdW50OyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9hcnJheVt0aGlzLl9nZXRDeWNsaWNJbmRleChpKV0gPSB0aGlzLl9hcnJheVt0aGlzLl9nZXRDeWNsaWNJbmRleChpICsgZGVsZXRlQ291bnQpXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2xlbmd0aCAtPSBkZWxldGVDb3VudDtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5fbGVuZ3RoIC0gMTsgaSA+PSBzdGFydDsgaS0tKSB7XG4gICAgICAgICAgICB0aGlzLl9hcnJheVt0aGlzLl9nZXRDeWNsaWNJbmRleChpICsgaXRlbXMubGVuZ3RoKV0gPSB0aGlzLl9hcnJheVt0aGlzLl9nZXRDeWNsaWNJbmRleChpKV07XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5fYXJyYXlbdGhpcy5fZ2V0Q3ljbGljSW5kZXgoc3RhcnQgKyBpKV0gPSBpdGVtc1tpXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fbGVuZ3RoICsgaXRlbXMubGVuZ3RoID4gdGhpcy5fbWF4TGVuZ3RoKSB7XG4gICAgICAgICAgICB2YXIgY291bnRUb1RyaW0gPSAodGhpcy5fbGVuZ3RoICsgaXRlbXMubGVuZ3RoKSAtIHRoaXMuX21heExlbmd0aDtcbiAgICAgICAgICAgIHRoaXMuX3N0YXJ0SW5kZXggKz0gY291bnRUb1RyaW07XG4gICAgICAgICAgICB0aGlzLl9sZW5ndGggPSB0aGlzLl9tYXhMZW5ndGg7XG4gICAgICAgICAgICB0aGlzLm9uVHJpbUVtaXR0ZXIuZmlyZShjb3VudFRvVHJpbSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9sZW5ndGggKz0gaXRlbXMubGVuZ3RoO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBDaXJjdWxhckxpc3QucHJvdG90eXBlLnRyaW1TdGFydCA9IGZ1bmN0aW9uIChjb3VudCkge1xuICAgICAgICBpZiAoY291bnQgPiB0aGlzLl9sZW5ndGgpIHtcbiAgICAgICAgICAgIGNvdW50ID0gdGhpcy5fbGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3N0YXJ0SW5kZXggKz0gY291bnQ7XG4gICAgICAgIHRoaXMuX2xlbmd0aCAtPSBjb3VudDtcbiAgICAgICAgdGhpcy5vblRyaW1FbWl0dGVyLmZpcmUoY291bnQpO1xuICAgIH07XG4gICAgQ2lyY3VsYXJMaXN0LnByb3RvdHlwZS5zaGlmdEVsZW1lbnRzID0gZnVuY3Rpb24gKHN0YXJ0LCBjb3VudCwgb2Zmc2V0KSB7XG4gICAgICAgIGlmIChjb3VudCA8PSAwKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0YXJ0IDwgMCB8fCBzdGFydCA+PSB0aGlzLl9sZW5ndGgpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignc3RhcnQgYXJndW1lbnQgb3V0IG9mIHJhbmdlJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0YXJ0ICsgb2Zmc2V0IDwgMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3Qgc2hpZnQgZWxlbWVudHMgaW4gbGlzdCBiZXlvbmQgaW5kZXggMCcpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvZmZzZXQgPiAwKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gY291bnQgLSAxOyBpID49IDA7IGktLSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0KHN0YXJ0ICsgaSArIG9mZnNldCwgdGhpcy5nZXQoc3RhcnQgKyBpKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgZXhwYW5kTGlzdEJ5ID0gKHN0YXJ0ICsgY291bnQgKyBvZmZzZXQpIC0gdGhpcy5fbGVuZ3RoO1xuICAgICAgICAgICAgaWYgKGV4cGFuZExpc3RCeSA+IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9sZW5ndGggKz0gZXhwYW5kTGlzdEJ5O1xuICAgICAgICAgICAgICAgIHdoaWxlICh0aGlzLl9sZW5ndGggPiB0aGlzLl9tYXhMZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbGVuZ3RoLS07XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3N0YXJ0SW5kZXgrKztcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vblRyaW1FbWl0dGVyLmZpcmUoMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXQoc3RhcnQgKyBpICsgb2Zmc2V0LCB0aGlzLmdldChzdGFydCArIGkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgQ2lyY3VsYXJMaXN0LnByb3RvdHlwZS5fZ2V0Q3ljbGljSW5kZXggPSBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLl9zdGFydEluZGV4ICsgaW5kZXgpICUgdGhpcy5fbWF4TGVuZ3RoO1xuICAgIH07XG4gICAgcmV0dXJuIENpcmN1bGFyTGlzdDtcbn0oKSk7XG5leHBvcnRzLkNpcmN1bGFyTGlzdCA9IENpcmN1bGFyTGlzdDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUNpcmN1bGFyTGlzdC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmZ1bmN0aW9uIGNsb25lKHZhbCwgZGVwdGgpIHtcbiAgICBpZiAoZGVwdGggPT09IHZvaWQgMCkgeyBkZXB0aCA9IDU7IH1cbiAgICBpZiAodHlwZW9mIHZhbCAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgcmV0dXJuIHZhbDtcbiAgICB9XG4gICAgaWYgKHZhbCA9PT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgdmFyIGNsb25lZE9iamVjdCA9IEFycmF5LmlzQXJyYXkodmFsKSA/IFtdIDoge307XG4gICAgZm9yICh2YXIga2V5IGluIHZhbCkge1xuICAgICAgICBjbG9uZWRPYmplY3Rba2V5XSA9IGRlcHRoIDw9IDEgPyB2YWxba2V5XSA6IGNsb25lKHZhbFtrZXldLCBkZXB0aCAtIDEpO1xuICAgIH1cbiAgICByZXR1cm4gY2xvbmVkT2JqZWN0O1xufVxuZXhwb3J0cy5jbG9uZSA9IGNsb25lO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Q2xvbmUuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBMaWZlY3ljbGVfMSA9IHJlcXVpcmUoXCIuL0xpZmVjeWNsZVwiKTtcbnZhciBFdmVudEVtaXR0ZXIgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhFdmVudEVtaXR0ZXIsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gRXZlbnRFbWl0dGVyKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5fZXZlbnRzID0gX3RoaXMuX2V2ZW50cyB8fCB7fTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBFdmVudEVtaXR0ZXIucHJvdG90eXBlLm9uID0gZnVuY3Rpb24gKHR5cGUsIGxpc3RlbmVyKSB7XG4gICAgICAgIHRoaXMuX2V2ZW50c1t0eXBlXSA9IHRoaXMuX2V2ZW50c1t0eXBlXSB8fCBbXTtcbiAgICAgICAgdGhpcy5fZXZlbnRzW3R5cGVdLnB1c2gobGlzdGVuZXIpO1xuICAgIH07XG4gICAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5hZGREaXNwb3NhYmxlTGlzdGVuZXIgPSBmdW5jdGlvbiAodHlwZSwgaGFuZGxlcikge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLm9uKHR5cGUsIGhhbmRsZXIpO1xuICAgICAgICB2YXIgZGlzcG9zZWQgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGRpc3Bvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoZGlzcG9zZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBfdGhpcy5vZmYodHlwZSwgaGFuZGxlcik7XG4gICAgICAgICAgICAgICAgZGlzcG9zZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH07XG4gICAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5vZmYgPSBmdW5jdGlvbiAodHlwZSwgbGlzdGVuZXIpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9ldmVudHNbdHlwZV0pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgb2JqID0gdGhpcy5fZXZlbnRzW3R5cGVdO1xuICAgICAgICB2YXIgaSA9IG9iai5sZW5ndGg7XG4gICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICAgIGlmIChvYmpbaV0gPT09IGxpc3RlbmVyKSB7XG4gICAgICAgICAgICAgICAgb2JqLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEV2ZW50RW1pdHRlci5wcm90b3R5cGUucmVtb3ZlQWxsTGlzdGVuZXJzID0gZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgaWYgKHRoaXMuX2V2ZW50c1t0eXBlXSkge1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMuX2V2ZW50c1t0eXBlXTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5lbWl0ID0gZnVuY3Rpb24gKHR5cGUpIHtcbiAgICAgICAgdmFyIGFyZ3MgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcbiAgICAgICAgICAgIGFyZ3NbX2kgLSAxXSA9IGFyZ3VtZW50c1tfaV07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLl9ldmVudHNbdHlwZV0pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgb2JqID0gdGhpcy5fZXZlbnRzW3R5cGVdO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgb2JqW2ldLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBFdmVudEVtaXR0ZXIucHJvdG90eXBlLmVtaXRNYXlSZW1vdmVMaXN0ZW5lcnMgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICB2YXIgYXJncyA9IFtdO1xuICAgICAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xuICAgICAgICAgICAgYXJnc1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRoaXMuX2V2ZW50c1t0eXBlXSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBvYmogPSB0aGlzLl9ldmVudHNbdHlwZV07XG4gICAgICAgIHZhciBsZW5ndGggPSBvYmoubGVuZ3RoO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9iai5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgb2JqW2ldLmFwcGx5KHRoaXMsIGFyZ3MpO1xuICAgICAgICAgICAgaSAtPSBsZW5ndGggLSBvYmoubGVuZ3RoO1xuICAgICAgICAgICAgbGVuZ3RoID0gb2JqLmxlbmd0aDtcbiAgICAgICAgfVxuICAgIH07XG4gICAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5saXN0ZW5lcnMgPSBmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRzW3R5cGVdIHx8IFtdO1xuICAgIH07XG4gICAgRXZlbnRFbWl0dGVyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmRpc3Bvc2UuY2FsbCh0aGlzKTtcbiAgICAgICAgdGhpcy5fZXZlbnRzID0ge307XG4gICAgfTtcbiAgICByZXR1cm4gRXZlbnRFbWl0dGVyO1xufShMaWZlY3ljbGVfMS5EaXNwb3NhYmxlKSk7XG5leHBvcnRzLkV2ZW50RW1pdHRlciA9IEV2ZW50RW1pdHRlcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUV2ZW50RW1pdHRlci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBFdmVudEVtaXR0ZXIyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBFdmVudEVtaXR0ZXIyKCkge1xuICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSBbXTtcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEV2ZW50RW1pdHRlcjIucHJvdG90eXBlLCBcImV2ZW50XCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICAgICAgaWYgKCF0aGlzLl9ldmVudCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2V2ZW50ID0gZnVuY3Rpb24gKGxpc3RlbmVyKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLl9saXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkaXNwb3NhYmxlID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcG9zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgX3RoaXMuX2xpc3RlbmVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMuX2xpc3RlbmVyc1tpXSA9PT0gbGlzdGVuZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLl9saXN0ZW5lcnMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZGlzcG9zYWJsZTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2V2ZW50O1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBFdmVudEVtaXR0ZXIyLnByb3RvdHlwZS5maXJlID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgdmFyIHF1ZXVlID0gW107XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5fbGlzdGVuZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBxdWV1ZS5wdXNoKHRoaXMuX2xpc3RlbmVyc1tpXSk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBxdWV1ZS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgcXVldWVbaV0uY2FsbCh1bmRlZmluZWQsIGRhdGEpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gRXZlbnRFbWl0dGVyMjtcbn0oKSk7XG5leHBvcnRzLkV2ZW50RW1pdHRlcjIgPSBFdmVudEVtaXR0ZXIyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9RXZlbnRFbWl0dGVyMi5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBEaXNwb3NhYmxlID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBEaXNwb3NhYmxlKCkge1xuICAgICAgICB0aGlzLl9kaXNwb3NhYmxlcyA9IFtdO1xuICAgICAgICB0aGlzLl9pc0Rpc3Bvc2VkID0gZmFsc2U7XG4gICAgfVxuICAgIERpc3Bvc2FibGUucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2lzRGlzcG9zZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLl9kaXNwb3NhYmxlcy5mb3JFYWNoKGZ1bmN0aW9uIChkKSB7IHJldHVybiBkLmRpc3Bvc2UoKTsgfSk7XG4gICAgICAgIHRoaXMuX2Rpc3Bvc2FibGVzLmxlbmd0aCA9IDA7XG4gICAgfTtcbiAgICBEaXNwb3NhYmxlLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChkKSB7XG4gICAgICAgIHRoaXMuX2Rpc3Bvc2FibGVzLnB1c2goZCk7XG4gICAgfTtcbiAgICBEaXNwb3NhYmxlLnByb3RvdHlwZS51bnJlZ2lzdGVyID0gZnVuY3Rpb24gKGQpIHtcbiAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5fZGlzcG9zYWJsZXMuaW5kZXhPZihkKTtcbiAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgICAgICAgdGhpcy5fZGlzcG9zYWJsZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIERpc3Bvc2FibGU7XG59KCkpO1xuZXhwb3J0cy5EaXNwb3NhYmxlID0gRGlzcG9zYWJsZTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUxpZmVjeWNsZS5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBpc05vZGUgPSAodHlwZW9mIG5hdmlnYXRvciA9PT0gJ3VuZGVmaW5lZCcpID8gdHJ1ZSA6IGZhbHNlO1xudmFyIHVzZXJBZ2VudCA9IChpc05vZGUpID8gJ25vZGUnIDogbmF2aWdhdG9yLnVzZXJBZ2VudDtcbnZhciBwbGF0Zm9ybSA9IChpc05vZGUpID8gJ25vZGUnIDogbmF2aWdhdG9yLnBsYXRmb3JtO1xuZXhwb3J0cy5pc0ZpcmVmb3ggPSAhIX51c2VyQWdlbnQuaW5kZXhPZignRmlyZWZveCcpO1xuZXhwb3J0cy5pc1NhZmFyaSA9IC9eKCg/IWNocm9tZXxhbmRyb2lkKS4pKnNhZmFyaS9pLnRlc3QodXNlckFnZW50KTtcbmV4cG9ydHMuaXNNU0lFID0gISF+dXNlckFnZW50LmluZGV4T2YoJ01TSUUnKSB8fCAhIX51c2VyQWdlbnQuaW5kZXhPZignVHJpZGVudCcpO1xuZXhwb3J0cy5pc01hYyA9IGNvbnRhaW5zKFsnTWFjaW50b3NoJywgJ01hY0ludGVsJywgJ01hY1BQQycsICdNYWM2OEsnXSwgcGxhdGZvcm0pO1xuZXhwb3J0cy5pc0lwYWQgPSBwbGF0Zm9ybSA9PT0gJ2lQYWQnO1xuZXhwb3J0cy5pc0lwaG9uZSA9IHBsYXRmb3JtID09PSAnaVBob25lJztcbmV4cG9ydHMuaXNNU1dpbmRvd3MgPSBjb250YWlucyhbJ1dpbmRvd3MnLCAnV2luMTYnLCAnV2luMzInLCAnV2luQ0UnXSwgcGxhdGZvcm0pO1xuZXhwb3J0cy5pc0xpbnV4ID0gcGxhdGZvcm0uaW5kZXhPZignTGludXgnKSA+PSAwO1xuZnVuY3Rpb24gY29udGFpbnMoYXJyLCBlbCkge1xuICAgIHJldHVybiBhcnIuaW5kZXhPZihlbCkgPj0gMDtcbn1cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPVBsYXRmb3JtLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZnVuY3Rpb24gZmlsbChhcnJheSwgdmFsdWUsIHN0YXJ0LCBlbmQpIHtcbiAgICBpZiAoYXJyYXkuZmlsbCkge1xuICAgICAgICByZXR1cm4gYXJyYXkuZmlsbCh2YWx1ZSwgc3RhcnQsIGVuZCk7XG4gICAgfVxuICAgIHJldHVybiBmaWxsRmFsbGJhY2soYXJyYXksIHZhbHVlLCBzdGFydCwgZW5kKTtcbn1cbmV4cG9ydHMuZmlsbCA9IGZpbGw7XG5mdW5jdGlvbiBmaWxsRmFsbGJhY2soYXJyYXksIHZhbHVlLCBzdGFydCwgZW5kKSB7XG4gICAgaWYgKHN0YXJ0ID09PSB2b2lkIDApIHsgc3RhcnQgPSAwOyB9XG4gICAgaWYgKGVuZCA9PT0gdm9pZCAwKSB7IGVuZCA9IGFycmF5Lmxlbmd0aDsgfVxuICAgIGlmIChzdGFydCA+PSBhcnJheS5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIGFycmF5O1xuICAgIH1cbiAgICBzdGFydCA9IChhcnJheS5sZW5ndGggKyBzdGFydCkgJSBhcnJheS5sZW5ndGg7XG4gICAgaWYgKGVuZCA+PSBhcnJheS5sZW5ndGgpIHtcbiAgICAgICAgZW5kID0gYXJyYXkubGVuZ3RoO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZW5kID0gKGFycmF5Lmxlbmd0aCArIGVuZCkgJSBhcnJheS5sZW5ndGg7XG4gICAgfVxuICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IGVuZDsgKytpKSB7XG4gICAgICAgIGFycmF5W2ldID0gdmFsdWU7XG4gICAgfVxuICAgIHJldHVybiBhcnJheTtcbn1cbmV4cG9ydHMuZmlsbEZhbGxiYWNrID0gZmlsbEZhbGxiYWNrO1xuZnVuY3Rpb24gY29uY2F0KGEsIGIpIHtcbiAgICB2YXIgcmVzdWx0ID0gbmV3IGEuY29uc3RydWN0b3IoYS5sZW5ndGggKyBiLmxlbmd0aCk7XG4gICAgcmVzdWx0LnNldChhKTtcbiAgICByZXN1bHQuc2V0KGIsIGEubGVuZ3RoKTtcbiAgICByZXR1cm4gcmVzdWx0O1xufVxuZXhwb3J0cy5jb25jYXQgPSBjb25jYXQ7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1UeXBlZEFycmF5VXRpbHMuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkRFRkFVTFRfQ09MT1IgPSAyNTY7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1UeXBlcy5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBDMDtcbihmdW5jdGlvbiAoQzApIHtcbiAgICBDMC5OVUwgPSAnXFx4MDAnO1xuICAgIEMwLlNPSCA9ICdcXHgwMSc7XG4gICAgQzAuU1RYID0gJ1xceDAyJztcbiAgICBDMC5FVFggPSAnXFx4MDMnO1xuICAgIEMwLkVPVCA9ICdcXHgwNCc7XG4gICAgQzAuRU5RID0gJ1xceDA1JztcbiAgICBDMC5BQ0sgPSAnXFx4MDYnO1xuICAgIEMwLkJFTCA9ICdcXHgwNyc7XG4gICAgQzAuQlMgPSAnXFx4MDgnO1xuICAgIEMwLkhUID0gJ1xceDA5JztcbiAgICBDMC5MRiA9ICdcXHgwYSc7XG4gICAgQzAuVlQgPSAnXFx4MGInO1xuICAgIEMwLkZGID0gJ1xceDBjJztcbiAgICBDMC5DUiA9ICdcXHgwZCc7XG4gICAgQzAuU08gPSAnXFx4MGUnO1xuICAgIEMwLlNJID0gJ1xceDBmJztcbiAgICBDMC5ETEUgPSAnXFx4MTAnO1xuICAgIEMwLkRDMSA9ICdcXHgxMSc7XG4gICAgQzAuREMyID0gJ1xceDEyJztcbiAgICBDMC5EQzMgPSAnXFx4MTMnO1xuICAgIEMwLkRDNCA9ICdcXHgxNCc7XG4gICAgQzAuTkFLID0gJ1xceDE1JztcbiAgICBDMC5TWU4gPSAnXFx4MTYnO1xuICAgIEMwLkVUQiA9ICdcXHgxNyc7XG4gICAgQzAuQ0FOID0gJ1xceDE4JztcbiAgICBDMC5FTSA9ICdcXHgxOSc7XG4gICAgQzAuU1VCID0gJ1xceDFhJztcbiAgICBDMC5FU0MgPSAnXFx4MWInO1xuICAgIEMwLkZTID0gJ1xceDFjJztcbiAgICBDMC5HUyA9ICdcXHgxZCc7XG4gICAgQzAuUlMgPSAnXFx4MWUnO1xuICAgIEMwLlVTID0gJ1xceDFmJztcbiAgICBDMC5TUCA9ICdcXHgyMCc7XG4gICAgQzAuREVMID0gJ1xceDdmJztcbn0pKEMwID0gZXhwb3J0cy5DMCB8fCAoZXhwb3J0cy5DMCA9IHt9KSk7XG52YXIgQzE7XG4oZnVuY3Rpb24gKEMxKSB7XG4gICAgQzEuUEFEID0gJ1xceDgwJztcbiAgICBDMS5IT1AgPSAnXFx4ODEnO1xuICAgIEMxLkJQSCA9ICdcXHg4Mic7XG4gICAgQzEuTkJIID0gJ1xceDgzJztcbiAgICBDMS5JTkQgPSAnXFx4ODQnO1xuICAgIEMxLk5FTCA9ICdcXHg4NSc7XG4gICAgQzEuU1NBID0gJ1xceDg2JztcbiAgICBDMS5FU0EgPSAnXFx4ODcnO1xuICAgIEMxLkhUUyA9ICdcXHg4OCc7XG4gICAgQzEuSFRKID0gJ1xceDg5JztcbiAgICBDMS5WVFMgPSAnXFx4OGEnO1xuICAgIEMxLlBMRCA9ICdcXHg4Yic7XG4gICAgQzEuUExVID0gJ1xceDhjJztcbiAgICBDMS5SSSA9ICdcXHg4ZCc7XG4gICAgQzEuU1MyID0gJ1xceDhlJztcbiAgICBDMS5TUzMgPSAnXFx4OGYnO1xuICAgIEMxLkRDUyA9ICdcXHg5MCc7XG4gICAgQzEuUFUxID0gJ1xceDkxJztcbiAgICBDMS5QVTIgPSAnXFx4OTInO1xuICAgIEMxLlNUUyA9ICdcXHg5Myc7XG4gICAgQzEuQ0NIID0gJ1xceDk0JztcbiAgICBDMS5NVyA9ICdcXHg5NSc7XG4gICAgQzEuU1BBID0gJ1xceDk2JztcbiAgICBDMS5FUEEgPSAnXFx4OTcnO1xuICAgIEMxLlNPUyA9ICdcXHg5OCc7XG4gICAgQzEuU0dDSSA9ICdcXHg5OSc7XG4gICAgQzEuU0NJID0gJ1xceDlhJztcbiAgICBDMS5DU0kgPSAnXFx4OWInO1xuICAgIEMxLlNUID0gJ1xceDljJztcbiAgICBDMS5PU0MgPSAnXFx4OWQnO1xuICAgIEMxLlBNID0gJ1xceDllJztcbiAgICBDMS5BUEMgPSAnXFx4OWYnO1xufSkoQzEgPSBleHBvcnRzLkMxIHx8IChleHBvcnRzLkMxID0ge30pKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUVzY2FwZVNlcXVlbmNlcy5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIFRleHREZWNvZGVyXzEgPSByZXF1aXJlKFwiLi4vaW5wdXQvVGV4dERlY29kZXJcIik7XG52YXIgVHlwZXNfMSA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vVHlwZXNcIik7XG5leHBvcnRzLkRFRkFVTFRfQVRUUiA9ICgwIDw8IDE4KSB8IChUeXBlc18xLkRFRkFVTFRfQ09MT1IgPDwgOSkgfCAoMjU2IDw8IDApO1xuZXhwb3J0cy5DSEFSX0RBVEFfQVRUUl9JTkRFWCA9IDA7XG5leHBvcnRzLkNIQVJfREFUQV9DSEFSX0lOREVYID0gMTtcbmV4cG9ydHMuQ0hBUl9EQVRBX1dJRFRIX0lOREVYID0gMjtcbmV4cG9ydHMuQ0hBUl9EQVRBX0NPREVfSU5ERVggPSAzO1xuZXhwb3J0cy5OVUxMX0NFTExfQ0hBUiA9ICcnO1xuZXhwb3J0cy5OVUxMX0NFTExfV0lEVEggPSAxO1xuZXhwb3J0cy5OVUxMX0NFTExfQ09ERSA9IDA7XG5leHBvcnRzLldISVRFU1BBQ0VfQ0VMTF9DSEFSID0gJyAnO1xuZXhwb3J0cy5XSElURVNQQUNFX0NFTExfV0lEVEggPSAxO1xuZXhwb3J0cy5XSElURVNQQUNFX0NFTExfQ09ERSA9IDMyO1xudmFyIENFTExfU0laRSA9IDM7XG52YXIgQXR0cmlidXRlRGF0YSA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQXR0cmlidXRlRGF0YSgpIHtcbiAgICAgICAgdGhpcy5mZyA9IDA7XG4gICAgICAgIHRoaXMuYmcgPSAwO1xuICAgIH1cbiAgICBBdHRyaWJ1dGVEYXRhLnRvQ29sb3JSR0IgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIHZhbHVlID4+PiAxNiAmIDI1NSxcbiAgICAgICAgICAgIHZhbHVlID4+PiA4ICYgMjU1LFxuICAgICAgICAgICAgdmFsdWUgJiAyNTVcbiAgICAgICAgXTtcbiAgICB9O1xuICAgIEF0dHJpYnV0ZURhdGEuZnJvbUNvbG9yUkdCID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIHJldHVybiAodmFsdWVbMF0gJiAyNTUpIDw8IDE2IHwgKHZhbHVlWzFdICYgMjU1KSA8PCA4IHwgdmFsdWVbMl0gJiAyNTU7XG4gICAgfTtcbiAgICBBdHRyaWJ1dGVEYXRhLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG5ld09iaiA9IG5ldyBBdHRyaWJ1dGVEYXRhKCk7XG4gICAgICAgIG5ld09iai5mZyA9IHRoaXMuZmc7XG4gICAgICAgIG5ld09iai5iZyA9IHRoaXMuYmc7XG4gICAgICAgIHJldHVybiBuZXdPYmo7XG4gICAgfTtcbiAgICBBdHRyaWJ1dGVEYXRhLnByb3RvdHlwZS5pc0ludmVyc2UgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmZnICYgNjcxMDg4NjQ7IH07XG4gICAgQXR0cmlidXRlRGF0YS5wcm90b3R5cGUuaXNCb2xkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5mZyAmIDEzNDIxNzcyODsgfTtcbiAgICBBdHRyaWJ1dGVEYXRhLnByb3RvdHlwZS5pc1VuZGVybGluZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuZmcgJiAyNjg0MzU0NTY7IH07XG4gICAgQXR0cmlidXRlRGF0YS5wcm90b3R5cGUuaXNCbGluayA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuZmcgJiA1MzY4NzA5MTI7IH07XG4gICAgQXR0cmlidXRlRGF0YS5wcm90b3R5cGUuaXNJbnZpc2libGUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmZnICYgMTA3Mzc0MTgyNDsgfTtcbiAgICBBdHRyaWJ1dGVEYXRhLnByb3RvdHlwZS5pc0l0YWxpYyA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuYmcgJiA2NzEwODg2NDsgfTtcbiAgICBBdHRyaWJ1dGVEYXRhLnByb3RvdHlwZS5pc0RpbSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuYmcgJiAxMzQyMTc3Mjg7IH07XG4gICAgQXR0cmlidXRlRGF0YS5wcm90b3R5cGUuZ2V0RmdDb2xvck1vZGUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmZnICYgNTAzMzE2NDg7IH07XG4gICAgQXR0cmlidXRlRGF0YS5wcm90b3R5cGUuZ2V0QmdDb2xvck1vZGUgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmJnICYgNTAzMzE2NDg7IH07XG4gICAgQXR0cmlidXRlRGF0YS5wcm90b3R5cGUuaXNGZ1JHQiA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICh0aGlzLmZnICYgNTAzMzE2NDgpID09PSA1MDMzMTY0ODsgfTtcbiAgICBBdHRyaWJ1dGVEYXRhLnByb3RvdHlwZS5pc0JnUkdCID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gKHRoaXMuYmcgJiA1MDMzMTY0OCkgPT09IDUwMzMxNjQ4OyB9O1xuICAgIEF0dHJpYnV0ZURhdGEucHJvdG90eXBlLmlzRmdQYWxldHRlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gKHRoaXMuZmcgJiA1MDMzMTY0OCkgPT09IDE2Nzc3MjE2IHx8ICh0aGlzLmZnICYgNTAzMzE2NDgpID09PSAzMzU1NDQzMjsgfTtcbiAgICBBdHRyaWJ1dGVEYXRhLnByb3RvdHlwZS5pc0JnUGFsZXR0ZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICh0aGlzLmJnICYgNTAzMzE2NDgpID09PSAxNjc3NzIxNiB8fCAodGhpcy5iZyAmIDUwMzMxNjQ4KSA9PT0gMzM1NTQ0MzI7IH07XG4gICAgQXR0cmlidXRlRGF0YS5wcm90b3R5cGUuaXNGZ0RlZmF1bHQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAodGhpcy5mZyAmIDUwMzMxNjQ4KSA9PT0gMDsgfTtcbiAgICBBdHRyaWJ1dGVEYXRhLnByb3RvdHlwZS5pc0JnRGVmYXVsdCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuICh0aGlzLmJnICYgNTAzMzE2NDgpID09PSAwOyB9O1xuICAgIEF0dHJpYnV0ZURhdGEucHJvdG90eXBlLmdldEZnQ29sb3IgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHN3aXRjaCAodGhpcy5mZyAmIDUwMzMxNjQ4KSB7XG4gICAgICAgICAgICBjYXNlIDE2Nzc3MjE2OlxuICAgICAgICAgICAgY2FzZSAzMzU1NDQzMjogcmV0dXJuIHRoaXMuZmcgJiAyNTU7XG4gICAgICAgICAgICBjYXNlIDUwMzMxNjQ4OiByZXR1cm4gdGhpcy5mZyAmIDE2Nzc3MjE1O1xuICAgICAgICAgICAgZGVmYXVsdDogcmV0dXJuIC0xO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBBdHRyaWJ1dGVEYXRhLnByb3RvdHlwZS5nZXRCZ0NvbG9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBzd2l0Y2ggKHRoaXMuYmcgJiA1MDMzMTY0OCkge1xuICAgICAgICAgICAgY2FzZSAxNjc3NzIxNjpcbiAgICAgICAgICAgIGNhc2UgMzM1NTQ0MzI6IHJldHVybiB0aGlzLmJnICYgMjU1O1xuICAgICAgICAgICAgY2FzZSA1MDMzMTY0ODogcmV0dXJuIHRoaXMuYmcgJiAxNjc3NzIxNTtcbiAgICAgICAgICAgIGRlZmF1bHQ6IHJldHVybiAtMTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgcmV0dXJuIEF0dHJpYnV0ZURhdGE7XG59KCkpO1xuZXhwb3J0cy5BdHRyaWJ1dGVEYXRhID0gQXR0cmlidXRlRGF0YTtcbmV4cG9ydHMuREVGQVVMVF9BVFRSX0RBVEEgPSBuZXcgQXR0cmlidXRlRGF0YSgpO1xudmFyIENlbGxEYXRhID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoQ2VsbERhdGEsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gQ2VsbERhdGEoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5jb250ZW50ID0gMDtcbiAgICAgICAgX3RoaXMuZmcgPSAwO1xuICAgICAgICBfdGhpcy5iZyA9IDA7XG4gICAgICAgIF90aGlzLmNvbWJpbmVkRGF0YSA9ICcnO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIENlbGxEYXRhLmZyb21DaGFyRGF0YSA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICB2YXIgb2JqID0gbmV3IENlbGxEYXRhKCk7XG4gICAgICAgIG9iai5zZXRGcm9tQ2hhckRhdGEodmFsdWUpO1xuICAgICAgICByZXR1cm4gb2JqO1xuICAgIH07XG4gICAgQ2VsbERhdGEucHJvdG90eXBlLmlzQ29tYmluZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnRlbnQgJiAyMDk3MTUyO1xuICAgIH07XG4gICAgQ2VsbERhdGEucHJvdG90eXBlLmdldFdpZHRoID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb250ZW50ID4+IDIyO1xuICAgIH07XG4gICAgQ2VsbERhdGEucHJvdG90eXBlLmdldENoYXJzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5jb250ZW50ICYgMjA5NzE1Mikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tYmluZWREYXRhO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnQgJiAyMDk3MTUxKSB7XG4gICAgICAgICAgICByZXR1cm4gVGV4dERlY29kZXJfMS5zdHJpbmdGcm9tQ29kZVBvaW50KHRoaXMuY29udGVudCAmIDIwOTcxNTEpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnJztcbiAgICB9O1xuICAgIENlbGxEYXRhLnByb3RvdHlwZS5nZXRDb2RlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gKHRoaXMuaXNDb21iaW5lZCgpKVxuICAgICAgICAgICAgPyB0aGlzLmNvbWJpbmVkRGF0YS5jaGFyQ29kZUF0KHRoaXMuY29tYmluZWREYXRhLmxlbmd0aCAtIDEpXG4gICAgICAgICAgICA6IHRoaXMuY29udGVudCAmIDIwOTcxNTE7XG4gICAgfTtcbiAgICBDZWxsRGF0YS5wcm90b3R5cGUuc2V0RnJvbUNoYXJEYXRhID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgIHRoaXMuZmcgPSB2YWx1ZVtleHBvcnRzLkNIQVJfREFUQV9BVFRSX0lOREVYXTtcbiAgICAgICAgdGhpcy5iZyA9IDA7XG4gICAgICAgIHZhciBjb21iaW5lZCA9IGZhbHNlO1xuICAgICAgICBpZiAodmFsdWVbZXhwb3J0cy5DSEFSX0RBVEFfQ0hBUl9JTkRFWF0ubGVuZ3RoID4gMikge1xuICAgICAgICAgICAgY29tYmluZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHZhbHVlW2V4cG9ydHMuQ0hBUl9EQVRBX0NIQVJfSU5ERVhdLmxlbmd0aCA9PT0gMikge1xuICAgICAgICAgICAgdmFyIGNvZGUgPSB2YWx1ZVtleHBvcnRzLkNIQVJfREFUQV9DSEFSX0lOREVYXS5jaGFyQ29kZUF0KDApO1xuICAgICAgICAgICAgaWYgKDB4RDgwMCA8PSBjb2RlICYmIGNvZGUgPD0gMHhEQkZGKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNlY29uZCA9IHZhbHVlW2V4cG9ydHMuQ0hBUl9EQVRBX0NIQVJfSU5ERVhdLmNoYXJDb2RlQXQoMSk7XG4gICAgICAgICAgICAgICAgaWYgKDB4REMwMCA8PSBzZWNvbmQgJiYgc2Vjb25kIDw9IDB4REZGRikge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRlbnQgPSAoKGNvZGUgLSAweEQ4MDApICogMHg0MDAgKyBzZWNvbmQgLSAweERDMDAgKyAweDEwMDAwKSB8ICh2YWx1ZVtleHBvcnRzLkNIQVJfREFUQV9XSURUSF9JTkRFWF0gPDwgMjIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29tYmluZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbWJpbmVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY29udGVudCA9IHZhbHVlW2V4cG9ydHMuQ0hBUl9EQVRBX0NIQVJfSU5ERVhdLmNoYXJDb2RlQXQoMCkgfCAodmFsdWVbZXhwb3J0cy5DSEFSX0RBVEFfV0lEVEhfSU5ERVhdIDw8IDIyKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29tYmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY29tYmluZWREYXRhID0gdmFsdWVbZXhwb3J0cy5DSEFSX0RBVEFfQ0hBUl9JTkRFWF07XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQgPSAyMDk3MTUyIHwgKHZhbHVlW2V4cG9ydHMuQ0hBUl9EQVRBX1dJRFRIX0lOREVYXSA8PCAyMik7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIENlbGxEYXRhLnByb3RvdHlwZS5nZXRBc0NoYXJEYXRhID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gW3RoaXMuZmcsIHRoaXMuZ2V0Q2hhcnMoKSwgdGhpcy5nZXRXaWR0aCgpLCB0aGlzLmdldENvZGUoKV07XG4gICAgfTtcbiAgICByZXR1cm4gQ2VsbERhdGE7XG59KEF0dHJpYnV0ZURhdGEpKTtcbmV4cG9ydHMuQ2VsbERhdGEgPSBDZWxsRGF0YTtcbnZhciBCdWZmZXJMaW5lID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBCdWZmZXJMaW5lKGNvbHMsIGZpbGxDZWxsRGF0YSwgaXNXcmFwcGVkKSB7XG4gICAgICAgIGlmIChpc1dyYXBwZWQgPT09IHZvaWQgMCkgeyBpc1dyYXBwZWQgPSBmYWxzZTsgfVxuICAgICAgICB0aGlzLmlzV3JhcHBlZCA9IGlzV3JhcHBlZDtcbiAgICAgICAgdGhpcy5fY29tYmluZWQgPSB7fTtcbiAgICAgICAgdGhpcy5fZGF0YSA9IG5ldyBVaW50MzJBcnJheShjb2xzICogQ0VMTF9TSVpFKTtcbiAgICAgICAgdmFyIGNlbGwgPSBmaWxsQ2VsbERhdGEgfHwgQ2VsbERhdGEuZnJvbUNoYXJEYXRhKFswLCBleHBvcnRzLk5VTExfQ0VMTF9DSEFSLCBleHBvcnRzLk5VTExfQ0VMTF9XSURUSCwgZXhwb3J0cy5OVUxMX0NFTExfQ09ERV0pO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbHM7ICsraSkge1xuICAgICAgICAgICAgdGhpcy5zZXRDZWxsKGksIGNlbGwpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubGVuZ3RoID0gY29scztcbiAgICB9XG4gICAgQnVmZmVyTGluZS5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgIHZhciBjb250ZW50ID0gdGhpcy5fZGF0YVtpbmRleCAqIENFTExfU0laRSArIDBdO1xuICAgICAgICB2YXIgY3AgPSBjb250ZW50ICYgMjA5NzE1MTtcbiAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIHRoaXMuX2RhdGFbaW5kZXggKiBDRUxMX1NJWkUgKyAxXSxcbiAgICAgICAgICAgIChjb250ZW50ICYgMjA5NzE1MilcbiAgICAgICAgICAgICAgICA/IHRoaXMuX2NvbWJpbmVkW2luZGV4XVxuICAgICAgICAgICAgICAgIDogKGNwKSA/IFRleHREZWNvZGVyXzEuc3RyaW5nRnJvbUNvZGVQb2ludChjcCkgOiAnJyxcbiAgICAgICAgICAgIGNvbnRlbnQgPj4gMjIsXG4gICAgICAgICAgICAoY29udGVudCAmIDIwOTcxNTIpXG4gICAgICAgICAgICAgICAgPyB0aGlzLl9jb21iaW5lZFtpbmRleF0uY2hhckNvZGVBdCh0aGlzLl9jb21iaW5lZFtpbmRleF0ubGVuZ3RoIC0gMSlcbiAgICAgICAgICAgICAgICA6IGNwXG4gICAgICAgIF07XG4gICAgfTtcbiAgICBCdWZmZXJMaW5lLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoaW5kZXgsIHZhbHVlKSB7XG4gICAgICAgIHRoaXMuX2RhdGFbaW5kZXggKiBDRUxMX1NJWkUgKyAxXSA9IHZhbHVlW2V4cG9ydHMuQ0hBUl9EQVRBX0FUVFJfSU5ERVhdO1xuICAgICAgICBpZiAodmFsdWVbZXhwb3J0cy5DSEFSX0RBVEFfQ0hBUl9JTkRFWF0ubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgdGhpcy5fY29tYmluZWRbaW5kZXhdID0gdmFsdWVbMV07XG4gICAgICAgICAgICB0aGlzLl9kYXRhW2luZGV4ICogQ0VMTF9TSVpFICsgMF0gPSBpbmRleCB8IDIwOTcxNTIgfCAodmFsdWVbZXhwb3J0cy5DSEFSX0RBVEFfV0lEVEhfSU5ERVhdIDw8IDIyKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX2RhdGFbaW5kZXggKiBDRUxMX1NJWkUgKyAwXSA9IHZhbHVlW2V4cG9ydHMuQ0hBUl9EQVRBX0NIQVJfSU5ERVhdLmNoYXJDb2RlQXQoMCkgfCAodmFsdWVbZXhwb3J0cy5DSEFSX0RBVEFfV0lEVEhfSU5ERVhdIDw8IDIyKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQnVmZmVyTGluZS5wcm90b3R5cGUuZ2V0V2lkdGggPSBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGFbaW5kZXggKiBDRUxMX1NJWkUgKyAwXSA+PiAyMjtcbiAgICB9O1xuICAgIEJ1ZmZlckxpbmUucHJvdG90eXBlLmhhc1dpZHRoID0gZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kYXRhW2luZGV4ICogQ0VMTF9TSVpFICsgMF0gJiAxMjU4MjkxMjtcbiAgICB9O1xuICAgIEJ1ZmZlckxpbmUucHJvdG90eXBlLmdldEZnID0gZnVuY3Rpb24gKGluZGV4KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9kYXRhW2luZGV4ICogQ0VMTF9TSVpFICsgMV07XG4gICAgfTtcbiAgICBCdWZmZXJMaW5lLnByb3RvdHlwZS5nZXRCZyA9IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZGF0YVtpbmRleCAqIENFTExfU0laRSArIDJdO1xuICAgIH07XG4gICAgQnVmZmVyTGluZS5wcm90b3R5cGUuaGFzQ29udGVudCA9IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZGF0YVtpbmRleCAqIENFTExfU0laRSArIDBdICYgNDE5NDMwMztcbiAgICB9O1xuICAgIEJ1ZmZlckxpbmUucHJvdG90eXBlLmdldENvZGVQb2ludCA9IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICB2YXIgY29udGVudCA9IHRoaXMuX2RhdGFbaW5kZXggKiBDRUxMX1NJWkUgKyAwXTtcbiAgICAgICAgaWYgKGNvbnRlbnQgJiAyMDk3MTUyKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fY29tYmluZWRbaW5kZXhdLmNoYXJDb2RlQXQodGhpcy5fY29tYmluZWRbaW5kZXhdLmxlbmd0aCAtIDEpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjb250ZW50ICYgMjA5NzE1MTtcbiAgICB9O1xuICAgIEJ1ZmZlckxpbmUucHJvdG90eXBlLmlzQ29tYmluZWQgPSBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2RhdGFbaW5kZXggKiBDRUxMX1NJWkUgKyAwXSAmIDIwOTcxNTI7XG4gICAgfTtcbiAgICBCdWZmZXJMaW5lLnByb3RvdHlwZS5nZXRTdHJpbmcgPSBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgdmFyIGNvbnRlbnQgPSB0aGlzLl9kYXRhW2luZGV4ICogQ0VMTF9TSVpFICsgMF07XG4gICAgICAgIGlmIChjb250ZW50ICYgMjA5NzE1Mikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbWJpbmVkW2luZGV4XTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29udGVudCAmIDIwOTcxNTEpIHtcbiAgICAgICAgICAgIHJldHVybiBUZXh0RGVjb2Rlcl8xLnN0cmluZ0Zyb21Db2RlUG9pbnQoY29udGVudCAmIDIwOTcxNTEpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnJztcbiAgICB9O1xuICAgIEJ1ZmZlckxpbmUucHJvdG90eXBlLmxvYWRDZWxsID0gZnVuY3Rpb24gKGluZGV4LCBjZWxsKSB7XG4gICAgICAgIHZhciBzdGFydEluZGV4ID0gaW5kZXggKiBDRUxMX1NJWkU7XG4gICAgICAgIGNlbGwuY29udGVudCA9IHRoaXMuX2RhdGFbc3RhcnRJbmRleCArIDBdO1xuICAgICAgICBjZWxsLmZnID0gdGhpcy5fZGF0YVtzdGFydEluZGV4ICsgMV07XG4gICAgICAgIGNlbGwuYmcgPSB0aGlzLl9kYXRhW3N0YXJ0SW5kZXggKyAyXTtcbiAgICAgICAgaWYgKGNlbGwuY29udGVudCAmIDIwOTcxNTIpIHtcbiAgICAgICAgICAgIGNlbGwuY29tYmluZWREYXRhID0gdGhpcy5fY29tYmluZWRbaW5kZXhdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjZWxsO1xuICAgIH07XG4gICAgQnVmZmVyTGluZS5wcm90b3R5cGUuc2V0Q2VsbCA9IGZ1bmN0aW9uIChpbmRleCwgY2VsbCkge1xuICAgICAgICBpZiAoY2VsbC5jb250ZW50ICYgMjA5NzE1Mikge1xuICAgICAgICAgICAgdGhpcy5fY29tYmluZWRbaW5kZXhdID0gY2VsbC5jb21iaW5lZERhdGE7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fZGF0YVtpbmRleCAqIENFTExfU0laRSArIDBdID0gY2VsbC5jb250ZW50O1xuICAgICAgICB0aGlzLl9kYXRhW2luZGV4ICogQ0VMTF9TSVpFICsgMV0gPSBjZWxsLmZnO1xuICAgICAgICB0aGlzLl9kYXRhW2luZGV4ICogQ0VMTF9TSVpFICsgMl0gPSBjZWxsLmJnO1xuICAgIH07XG4gICAgQnVmZmVyTGluZS5wcm90b3R5cGUuc2V0Q2VsbEZyb21Db2RlUG9pbnQgPSBmdW5jdGlvbiAoaW5kZXgsIGNvZGVQb2ludCwgd2lkdGgsIGZnLCBiZykge1xuICAgICAgICB0aGlzLl9kYXRhW2luZGV4ICogQ0VMTF9TSVpFICsgMF0gPSBjb2RlUG9pbnQgfCAod2lkdGggPDwgMjIpO1xuICAgICAgICB0aGlzLl9kYXRhW2luZGV4ICogQ0VMTF9TSVpFICsgMV0gPSBmZztcbiAgICAgICAgdGhpcy5fZGF0YVtpbmRleCAqIENFTExfU0laRSArIDJdID0gYmc7XG4gICAgfTtcbiAgICBCdWZmZXJMaW5lLnByb3RvdHlwZS5hZGRDb2RlcG9pbnRUb0NlbGwgPSBmdW5jdGlvbiAoaW5kZXgsIGNvZGVQb2ludCkge1xuICAgICAgICB2YXIgY29udGVudCA9IHRoaXMuX2RhdGFbaW5kZXggKiBDRUxMX1NJWkUgKyAwXTtcbiAgICAgICAgaWYgKGNvbnRlbnQgJiAyMDk3MTUyKSB7XG4gICAgICAgICAgICB0aGlzLl9jb21iaW5lZFtpbmRleF0gKz0gVGV4dERlY29kZXJfMS5zdHJpbmdGcm9tQ29kZVBvaW50KGNvZGVQb2ludCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAoY29udGVudCAmIDIwOTcxNTEpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jb21iaW5lZFtpbmRleF0gPSBUZXh0RGVjb2Rlcl8xLnN0cmluZ0Zyb21Db2RlUG9pbnQoY29udGVudCAmIDIwOTcxNTEpICsgVGV4dERlY29kZXJfMS5zdHJpbmdGcm9tQ29kZVBvaW50KGNvZGVQb2ludCk7XG4gICAgICAgICAgICAgICAgY29udGVudCAmPSB+MjA5NzE1MTtcbiAgICAgICAgICAgICAgICBjb250ZW50IHw9IDIwOTcxNTI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb250ZW50ID0gY29kZVBvaW50IHwgKDEgPDwgMjIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fZGF0YVtpbmRleCAqIENFTExfU0laRSArIDBdID0gY29udGVudDtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQnVmZmVyTGluZS5wcm90b3R5cGUuaW5zZXJ0Q2VsbHMgPSBmdW5jdGlvbiAocG9zLCBuLCBmaWxsQ2VsbERhdGEpIHtcbiAgICAgICAgcG9zICU9IHRoaXMubGVuZ3RoO1xuICAgICAgICBpZiAobiA8IHRoaXMubGVuZ3RoIC0gcG9zKSB7XG4gICAgICAgICAgICB2YXIgY2VsbCA9IG5ldyBDZWxsRGF0YSgpO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IHRoaXMubGVuZ3RoIC0gcG9zIC0gbiAtIDE7IGkgPj0gMDsgLS1pKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDZWxsKHBvcyArIG4gKyBpLCB0aGlzLmxvYWRDZWxsKHBvcyArIGksIGNlbGwpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbjsgKytpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDZWxsKHBvcyArIGksIGZpbGxDZWxsRGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gcG9zOyBpIDwgdGhpcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0Q2VsbChpLCBmaWxsQ2VsbERhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBCdWZmZXJMaW5lLnByb3RvdHlwZS5kZWxldGVDZWxscyA9IGZ1bmN0aW9uIChwb3MsIG4sIGZpbGxDZWxsRGF0YSkge1xuICAgICAgICBwb3MgJT0gdGhpcy5sZW5ndGg7XG4gICAgICAgIGlmIChuIDwgdGhpcy5sZW5ndGggLSBwb3MpIHtcbiAgICAgICAgICAgIHZhciBjZWxsID0gbmV3IENlbGxEYXRhKCk7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoIC0gcG9zIC0gbjsgKytpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDZWxsKHBvcyArIGksIHRoaXMubG9hZENlbGwocG9zICsgbiArIGksIGNlbGwpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLmxlbmd0aCAtIG47IGkgPCB0aGlzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZXRDZWxsKGksIGZpbGxDZWxsRGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gcG9zOyBpIDwgdGhpcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0Q2VsbChpLCBmaWxsQ2VsbERhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBCdWZmZXJMaW5lLnByb3RvdHlwZS5yZXBsYWNlQ2VsbHMgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCwgZmlsbENlbGxEYXRhKSB7XG4gICAgICAgIHdoaWxlIChzdGFydCA8IGVuZCAmJiBzdGFydCA8IHRoaXMubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLnNldENlbGwoc3RhcnQrKywgZmlsbENlbGxEYXRhKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQnVmZmVyTGluZS5wcm90b3R5cGUucmVzaXplID0gZnVuY3Rpb24gKGNvbHMsIGZpbGxDZWxsRGF0YSkge1xuICAgICAgICBpZiAoY29scyA9PT0gdGhpcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29scyA+IHRoaXMubGVuZ3RoKSB7XG4gICAgICAgICAgICB2YXIgZGF0YSA9IG5ldyBVaW50MzJBcnJheShjb2xzICogQ0VMTF9TSVpFKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGlmIChjb2xzICogQ0VMTF9TSVpFIDwgdGhpcy5fZGF0YS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5zZXQodGhpcy5fZGF0YS5zdWJhcnJheSgwLCBjb2xzICogQ0VMTF9TSVpFKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkYXRhLnNldCh0aGlzLl9kYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9kYXRhID0gZGF0YTtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSB0aGlzLmxlbmd0aDsgaSA8IGNvbHM7ICsraSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2V0Q2VsbChpLCBmaWxsQ2VsbERhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKGNvbHMpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IG5ldyBVaW50MzJBcnJheShjb2xzICogQ0VMTF9TSVpFKTtcbiAgICAgICAgICAgICAgICBkYXRhLnNldCh0aGlzLl9kYXRhLnN1YmFycmF5KDAsIGNvbHMgKiBDRUxMX1NJWkUpKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9kYXRhID0gZGF0YTtcbiAgICAgICAgICAgICAgICB2YXIga2V5cyA9IE9iamVjdC5rZXlzKHRoaXMuX2NvbWJpbmVkKTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGtleSA9IHBhcnNlSW50KGtleXNbaV0sIDEwKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGtleSA+PSBjb2xzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fY29tYmluZWRba2V5XTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX2RhdGEgPSBuZXcgVWludDMyQXJyYXkoMCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fY29tYmluZWQgPSB7fTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxlbmd0aCA9IGNvbHM7XG4gICAgfTtcbiAgICBCdWZmZXJMaW5lLnByb3RvdHlwZS5maWxsID0gZnVuY3Rpb24gKGZpbGxDZWxsRGF0YSkge1xuICAgICAgICB0aGlzLl9jb21iaW5lZCA9IHt9O1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0Q2VsbChpLCBmaWxsQ2VsbERhdGEpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBCdWZmZXJMaW5lLnByb3RvdHlwZS5jb3B5RnJvbSA9IGZ1bmN0aW9uIChsaW5lKSB7XG4gICAgICAgIGlmICh0aGlzLmxlbmd0aCAhPT0gbGluZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuX2RhdGEgPSBuZXcgVWludDMyQXJyYXkobGluZS5fZGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9kYXRhLnNldChsaW5lLl9kYXRhKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxlbmd0aCA9IGxpbmUubGVuZ3RoO1xuICAgICAgICB0aGlzLl9jb21iaW5lZCA9IHt9O1xuICAgICAgICBmb3IgKHZhciBlbCBpbiBsaW5lLl9jb21iaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5fY29tYmluZWRbZWxdID0gbGluZS5fY29tYmluZWRbZWxdO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaXNXcmFwcGVkID0gbGluZS5pc1dyYXBwZWQ7XG4gICAgfTtcbiAgICBCdWZmZXJMaW5lLnByb3RvdHlwZS5jbG9uZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG5ld0xpbmUgPSBuZXcgQnVmZmVyTGluZSgwKTtcbiAgICAgICAgbmV3TGluZS5fZGF0YSA9IG5ldyBVaW50MzJBcnJheSh0aGlzLl9kYXRhKTtcbiAgICAgICAgbmV3TGluZS5sZW5ndGggPSB0aGlzLmxlbmd0aDtcbiAgICAgICAgZm9yICh2YXIgZWwgaW4gdGhpcy5fY29tYmluZWQpIHtcbiAgICAgICAgICAgIG5ld0xpbmUuX2NvbWJpbmVkW2VsXSA9IHRoaXMuX2NvbWJpbmVkW2VsXTtcbiAgICAgICAgfVxuICAgICAgICBuZXdMaW5lLmlzV3JhcHBlZCA9IHRoaXMuaXNXcmFwcGVkO1xuICAgICAgICByZXR1cm4gbmV3TGluZTtcbiAgICB9O1xuICAgIEJ1ZmZlckxpbmUucHJvdG90eXBlLmdldFRyaW1tZWRMZW5ndGggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZvciAodmFyIGkgPSB0aGlzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7XG4gICAgICAgICAgICBpZiAoKHRoaXMuX2RhdGFbaSAqIENFTExfU0laRSArIDBdICYgNDE5NDMwMykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaSArICh0aGlzLl9kYXRhW2kgKiBDRUxMX1NJWkUgKyAwXSA+PiAyMik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfTtcbiAgICBCdWZmZXJMaW5lLnByb3RvdHlwZS5jb3B5Q2VsbHNGcm9tID0gZnVuY3Rpb24gKHNyYywgc3JjQ29sLCBkZXN0Q29sLCBsZW5ndGgsIGFwcGx5SW5SZXZlcnNlKSB7XG4gICAgICAgIHZhciBzcmNEYXRhID0gc3JjLl9kYXRhO1xuICAgICAgICBpZiAoYXBwbHlJblJldmVyc2UpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGNlbGwgPSBsZW5ndGggLSAxOyBjZWxsID49IDA7IGNlbGwtLSkge1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgQ0VMTF9TSVpFOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGF0YVsoZGVzdENvbCArIGNlbGwpICogQ0VMTF9TSVpFICsgaV0gPSBzcmNEYXRhWyhzcmNDb2wgKyBjZWxsKSAqIENFTExfU0laRSArIGldO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGZvciAodmFyIGNlbGwgPSAwOyBjZWxsIDwgbGVuZ3RoOyBjZWxsKyspIHtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IENFTExfU0laRTsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX2RhdGFbKGRlc3RDb2wgKyBjZWxsKSAqIENFTExfU0laRSArIGldID0gc3JjRGF0YVsoc3JjQ29sICsgY2VsbCkgKiBDRUxMX1NJWkUgKyBpXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHNyY0NvbWJpbmVkS2V5cyA9IE9iamVjdC5rZXlzKHNyYy5fY29tYmluZWQpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNyY0NvbWJpbmVkS2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIGtleSA9IHBhcnNlSW50KHNyY0NvbWJpbmVkS2V5c1tpXSwgMTApO1xuICAgICAgICAgICAgaWYgKGtleSA+PSBzcmNDb2wpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jb21iaW5lZFtrZXkgLSBzcmNDb2wgKyBkZXN0Q29sXSA9IHNyYy5fY29tYmluZWRba2V5XTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgQnVmZmVyTGluZS5wcm90b3R5cGUudHJhbnNsYXRlVG9TdHJpbmcgPSBmdW5jdGlvbiAodHJpbVJpZ2h0LCBzdGFydENvbCwgZW5kQ29sKSB7XG4gICAgICAgIGlmICh0cmltUmlnaHQgPT09IHZvaWQgMCkgeyB0cmltUmlnaHQgPSBmYWxzZTsgfVxuICAgICAgICBpZiAoc3RhcnRDb2wgPT09IHZvaWQgMCkgeyBzdGFydENvbCA9IDA7IH1cbiAgICAgICAgaWYgKGVuZENvbCA9PT0gdm9pZCAwKSB7IGVuZENvbCA9IHRoaXMubGVuZ3RoOyB9XG4gICAgICAgIGlmICh0cmltUmlnaHQpIHtcbiAgICAgICAgICAgIGVuZENvbCA9IE1hdGgubWluKGVuZENvbCwgdGhpcy5nZXRUcmltbWVkTGVuZ3RoKCkpO1xuICAgICAgICB9XG4gICAgICAgIHZhciByZXN1bHQgPSAnJztcbiAgICAgICAgd2hpbGUgKHN0YXJ0Q29sIDwgZW5kQ29sKSB7XG4gICAgICAgICAgICB2YXIgY29udGVudCA9IHRoaXMuX2RhdGFbc3RhcnRDb2wgKiBDRUxMX1NJWkUgKyAwXTtcbiAgICAgICAgICAgIHZhciBjcCA9IGNvbnRlbnQgJiAyMDk3MTUxO1xuICAgICAgICAgICAgcmVzdWx0ICs9IChjb250ZW50ICYgMjA5NzE1MikgPyB0aGlzLl9jb21iaW5lZFtzdGFydENvbF0gOiAoY3ApID8gVGV4dERlY29kZXJfMS5zdHJpbmdGcm9tQ29kZVBvaW50KGNwKSA6IGV4cG9ydHMuV0hJVEVTUEFDRV9DRUxMX0NIQVI7XG4gICAgICAgICAgICBzdGFydENvbCArPSAoY29udGVudCA+PiAyMikgfHwgMTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG4gICAgcmV0dXJuIEJ1ZmZlckxpbmU7XG59KCkpO1xuZXhwb3J0cy5CdWZmZXJMaW5lID0gQnVmZmVyTGluZTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUJ1ZmZlckxpbmUuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5leHBvcnRzLkNIQVJTRVRTID0ge307XG5leHBvcnRzLkRFRkFVTFRfQ0hBUlNFVCA9IGV4cG9ydHMuQ0hBUlNFVFNbJ0InXTtcbmV4cG9ydHMuQ0hBUlNFVFNbJzAnXSA9IHtcbiAgICAnYCc6ICdcXHUyNWM2JyxcbiAgICAnYSc6ICdcXHUyNTkyJyxcbiAgICAnYic6ICdcXHUwMDA5JyxcbiAgICAnYyc6ICdcXHUwMDBjJyxcbiAgICAnZCc6ICdcXHUwMDBkJyxcbiAgICAnZSc6ICdcXHUwMDBhJyxcbiAgICAnZic6ICdcXHUwMGIwJyxcbiAgICAnZyc6ICdcXHUwMGIxJyxcbiAgICAnaCc6ICdcXHUyNDI0JyxcbiAgICAnaSc6ICdcXHUwMDBiJyxcbiAgICAnaic6ICdcXHUyNTE4JyxcbiAgICAnayc6ICdcXHUyNTEwJyxcbiAgICAnbCc6ICdcXHUyNTBjJyxcbiAgICAnbSc6ICdcXHUyNTE0JyxcbiAgICAnbic6ICdcXHUyNTNjJyxcbiAgICAnbyc6ICdcXHUyM2JhJyxcbiAgICAncCc6ICdcXHUyM2JiJyxcbiAgICAncSc6ICdcXHUyNTAwJyxcbiAgICAncic6ICdcXHUyM2JjJyxcbiAgICAncyc6ICdcXHUyM2JkJyxcbiAgICAndCc6ICdcXHUyNTFjJyxcbiAgICAndSc6ICdcXHUyNTI0JyxcbiAgICAndic6ICdcXHUyNTM0JyxcbiAgICAndyc6ICdcXHUyNTJjJyxcbiAgICAneCc6ICdcXHUyNTAyJyxcbiAgICAneSc6ICdcXHUyMjY0JyxcbiAgICAneic6ICdcXHUyMjY1JyxcbiAgICAneyc6ICdcXHUwM2MwJyxcbiAgICAnfCc6ICdcXHUyMjYwJyxcbiAgICAnfSc6ICdcXHUwMGEzJyxcbiAgICAnfic6ICdcXHUwMGI3J1xufTtcbmV4cG9ydHMuQ0hBUlNFVFNbJ0EnXSA9IHtcbiAgICAnIyc6ICfCoydcbn07XG5leHBvcnRzLkNIQVJTRVRTWydCJ10gPSBudWxsO1xuZXhwb3J0cy5DSEFSU0VUU1snNCddID0ge1xuICAgICcjJzogJ8KjJyxcbiAgICAnQCc6ICfCvicsXG4gICAgJ1snOiAnaWonLFxuICAgICdcXFxcJzogJ8K9JyxcbiAgICAnXSc6ICd8JyxcbiAgICAneyc6ICfCqCcsXG4gICAgJ3wnOiAnZicsXG4gICAgJ30nOiAnwrwnLFxuICAgICd+JzogJ8K0J1xufTtcbmV4cG9ydHMuQ0hBUlNFVFNbJ0MnXSA9XG4gICAgZXhwb3J0cy5DSEFSU0VUU1snNSddID0ge1xuICAgICAgICAnWyc6ICfDhCcsXG4gICAgICAgICdcXFxcJzogJ8OWJyxcbiAgICAgICAgJ10nOiAnw4UnLFxuICAgICAgICAnXic6ICfDnCcsXG4gICAgICAgICdgJzogJ8OpJyxcbiAgICAgICAgJ3snOiAnw6QnLFxuICAgICAgICAnfCc6ICfDticsXG4gICAgICAgICd9JzogJ8OlJyxcbiAgICAgICAgJ34nOiAnw7wnXG4gICAgfTtcbmV4cG9ydHMuQ0hBUlNFVFNbJ1InXSA9IHtcbiAgICAnIyc6ICfCoycsXG4gICAgJ0AnOiAnw6AnLFxuICAgICdbJzogJ8KwJyxcbiAgICAnXFxcXCc6ICfDpycsXG4gICAgJ10nOiAnwqcnLFxuICAgICd7JzogJ8OpJyxcbiAgICAnfCc6ICfDuScsXG4gICAgJ30nOiAnw6gnLFxuICAgICd+JzogJ8KoJ1xufTtcbmV4cG9ydHMuQ0hBUlNFVFNbJ1EnXSA9IHtcbiAgICAnQCc6ICfDoCcsXG4gICAgJ1snOiAnw6InLFxuICAgICdcXFxcJzogJ8OnJyxcbiAgICAnXSc6ICfDqicsXG4gICAgJ14nOiAnw64nLFxuICAgICdgJzogJ8O0JyxcbiAgICAneyc6ICfDqScsXG4gICAgJ3wnOiAnw7knLFxuICAgICd9JzogJ8OoJyxcbiAgICAnfic6ICfDuydcbn07XG5leHBvcnRzLkNIQVJTRVRTWydLJ10gPSB7XG4gICAgJ0AnOiAnwqcnLFxuICAgICdbJzogJ8OEJyxcbiAgICAnXFxcXCc6ICfDlicsXG4gICAgJ10nOiAnw5wnLFxuICAgICd7JzogJ8OkJyxcbiAgICAnfCc6ICfDticsXG4gICAgJ30nOiAnw7wnLFxuICAgICd+JzogJ8OfJ1xufTtcbmV4cG9ydHMuQ0hBUlNFVFNbJ1knXSA9IHtcbiAgICAnIyc6ICfCoycsXG4gICAgJ0AnOiAnwqcnLFxuICAgICdbJzogJ8KwJyxcbiAgICAnXFxcXCc6ICfDpycsXG4gICAgJ10nOiAnw6knLFxuICAgICdgJzogJ8O5JyxcbiAgICAneyc6ICfDoCcsXG4gICAgJ3wnOiAnw7InLFxuICAgICd9JzogJ8OoJyxcbiAgICAnfic6ICfDrCdcbn07XG5leHBvcnRzLkNIQVJTRVRTWydFJ10gPVxuICAgIGV4cG9ydHMuQ0hBUlNFVFNbJzYnXSA9IHtcbiAgICAgICAgJ0AnOiAnw4QnLFxuICAgICAgICAnWyc6ICfDhicsXG4gICAgICAgICdcXFxcJzogJ8OYJyxcbiAgICAgICAgJ10nOiAnw4UnLFxuICAgICAgICAnXic6ICfDnCcsXG4gICAgICAgICdgJzogJ8OkJyxcbiAgICAgICAgJ3snOiAnw6YnLFxuICAgICAgICAnfCc6ICfDuCcsXG4gICAgICAgICd9JzogJ8OlJyxcbiAgICAgICAgJ34nOiAnw7wnXG4gICAgfTtcbmV4cG9ydHMuQ0hBUlNFVFNbJ1onXSA9IHtcbiAgICAnIyc6ICfCoycsXG4gICAgJ0AnOiAnwqcnLFxuICAgICdbJzogJ8KhJyxcbiAgICAnXFxcXCc6ICfDkScsXG4gICAgJ10nOiAnwr8nLFxuICAgICd7JzogJ8KwJyxcbiAgICAnfCc6ICfDsScsXG4gICAgJ30nOiAnw6cnXG59O1xuZXhwb3J0cy5DSEFSU0VUU1snSCddID1cbiAgICBleHBvcnRzLkNIQVJTRVRTWyc3J10gPSB7XG4gICAgICAgICdAJzogJ8OJJyxcbiAgICAgICAgJ1snOiAnw4QnLFxuICAgICAgICAnXFxcXCc6ICfDlicsXG4gICAgICAgICddJzogJ8OFJyxcbiAgICAgICAgJ14nOiAnw5wnLFxuICAgICAgICAnYCc6ICfDqScsXG4gICAgICAgICd7JzogJ8OkJyxcbiAgICAgICAgJ3wnOiAnw7YnLFxuICAgICAgICAnfSc6ICfDpScsXG4gICAgICAgICd+JzogJ8O8J1xuICAgIH07XG5leHBvcnRzLkNIQVJTRVRTWyc9J10gPSB7XG4gICAgJyMnOiAnw7knLFxuICAgICdAJzogJ8OgJyxcbiAgICAnWyc6ICfDqScsXG4gICAgJ1xcXFwnOiAnw6cnLFxuICAgICddJzogJ8OqJyxcbiAgICAnXic6ICfDricsXG4gICAgJ18nOiAnw6gnLFxuICAgICdgJzogJ8O0JyxcbiAgICAneyc6ICfDpCcsXG4gICAgJ3wnOiAnw7YnLFxuICAgICd9JzogJ8O8JyxcbiAgICAnfic6ICfDuydcbn07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1DaGFyc2V0cy5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBFc2NhcGVTZXF1ZW5jZXNfMSA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vZGF0YS9Fc2NhcGVTZXF1ZW5jZXNcIik7XG52YXIgS0VZQ09ERV9LRVlfTUFQUElOR1MgPSB7XG4gICAgNDg6IFsnMCcsICcpJ10sXG4gICAgNDk6IFsnMScsICchJ10sXG4gICAgNTA6IFsnMicsICdAJ10sXG4gICAgNTE6IFsnMycsICcjJ10sXG4gICAgNTI6IFsnNCcsICckJ10sXG4gICAgNTM6IFsnNScsICclJ10sXG4gICAgNTQ6IFsnNicsICdeJ10sXG4gICAgNTU6IFsnNycsICcmJ10sXG4gICAgNTY6IFsnOCcsICcqJ10sXG4gICAgNTc6IFsnOScsICcoJ10sXG4gICAgMTg2OiBbJzsnLCAnOiddLFxuICAgIDE4NzogWyc9JywgJysnXSxcbiAgICAxODg6IFsnLCcsICc8J10sXG4gICAgMTg5OiBbJy0nLCAnXyddLFxuICAgIDE5MDogWycuJywgJz4nXSxcbiAgICAxOTE6IFsnLycsICc/J10sXG4gICAgMTkyOiBbJ2AnLCAnfiddLFxuICAgIDIxOTogWydbJywgJ3snXSxcbiAgICAyMjA6IFsnXFxcXCcsICd8J10sXG4gICAgMjIxOiBbJ10nLCAnfSddLFxuICAgIDIyMjogWydcXCcnLCAnXCInXVxufTtcbmZ1bmN0aW9uIGV2YWx1YXRlS2V5Ym9hcmRFdmVudChldiwgYXBwbGljYXRpb25DdXJzb3JNb2RlLCBpc01hYywgbWFjT3B0aW9uSXNNZXRhKSB7XG4gICAgdmFyIHJlc3VsdCA9IHtcbiAgICAgICAgdHlwZTogMCxcbiAgICAgICAgY2FuY2VsOiBmYWxzZSxcbiAgICAgICAga2V5OiB1bmRlZmluZWRcbiAgICB9O1xuICAgIHZhciBtb2RpZmllcnMgPSAoZXYuc2hpZnRLZXkgPyAxIDogMCkgfCAoZXYuYWx0S2V5ID8gMiA6IDApIHwgKGV2LmN0cmxLZXkgPyA0IDogMCkgfCAoZXYubWV0YUtleSA/IDggOiAwKTtcbiAgICBzd2l0Y2ggKGV2LmtleUNvZGUpIHtcbiAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgaWYgKGV2LmtleSA9PT0gJ1VJS2V5SW5wdXRVcEFycm93Jykge1xuICAgICAgICAgICAgICAgIGlmIChhcHBsaWNhdGlvbkN1cnNvck1vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdPQSc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1tBJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChldi5rZXkgPT09ICdVSUtleUlucHV0TGVmdEFycm93Jykge1xuICAgICAgICAgICAgICAgIGlmIChhcHBsaWNhdGlvbkN1cnNvck1vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdPRCc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1tEJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChldi5rZXkgPT09ICdVSUtleUlucHV0UmlnaHRBcnJvdycpIHtcbiAgICAgICAgICAgICAgICBpZiAoYXBwbGljYXRpb25DdXJzb3JNb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnT0MnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbQyc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZXYua2V5ID09PSAnVUlLZXlJbnB1dERvd25BcnJvdycpIHtcbiAgICAgICAgICAgICAgICBpZiAoYXBwbGljYXRpb25DdXJzb3JNb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnT0InO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbQic7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgODpcbiAgICAgICAgICAgIGlmIChldi5zaGlmdEtleSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5CUztcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGV2LmFsdEtleSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5ERUw7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuREVMO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgOTpcbiAgICAgICAgICAgIGlmIChldi5zaGlmdEtleSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnW1onO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkhUO1xuICAgICAgICAgICAgcmVzdWx0LmNhbmNlbCA9IHRydWU7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAxMzpcbiAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5DUjtcbiAgICAgICAgICAgIHJlc3VsdC5jYW5jZWwgPSB0cnVlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMjc6XG4gICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDO1xuICAgICAgICAgICAgcmVzdWx0LmNhbmNlbCA9IHRydWU7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAzNzpcbiAgICAgICAgICAgIGlmIChtb2RpZmllcnMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1sxOycgKyAobW9kaWZpZXJzICsgMSkgKyAnRCc7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5rZXkgPT09IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTszRCcpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IGlzTWFjID8gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ2InIDogRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1sxOzVEJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhcHBsaWNhdGlvbkN1cnNvck1vZGUpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ09EJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnW0QnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMzk6XG4gICAgICAgICAgICBpZiAobW9kaWZpZXJzKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTsnICsgKG1vZGlmaWVycyArIDEpICsgJ0MnO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQua2V5ID09PSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzE7M0MnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBpc01hYyA/IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdmJyA6IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTs1Qyc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoYXBwbGljYXRpb25DdXJzb3JNb2RlKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdPQyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1tDJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDM4OlxuICAgICAgICAgICAgaWYgKG1vZGlmaWVycykge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzE7JyArIChtb2RpZmllcnMgKyAxKSArICdBJztcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0LmtleSA9PT0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1sxOzNBJykge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1sxOzVBJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhcHBsaWNhdGlvbkN1cnNvck1vZGUpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ09BJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnW0EnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgNDA6XG4gICAgICAgICAgICBpZiAobW9kaWZpZXJzKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTsnICsgKG1vZGlmaWVycyArIDEpICsgJ0InO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQua2V5ID09PSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzE7M0InKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzE7NUInO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGFwcGxpY2F0aW9uQ3Vyc29yTW9kZSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnT0InO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbQic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSA0NTpcbiAgICAgICAgICAgIGlmICghZXYuc2hpZnRLZXkgJiYgIWV2LmN0cmxLZXkpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1syfic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSA0NjpcbiAgICAgICAgICAgIGlmIChtb2RpZmllcnMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1szOycgKyAobW9kaWZpZXJzICsgMSkgKyAnfic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1szfic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAzNjpcbiAgICAgICAgICAgIGlmIChtb2RpZmllcnMpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1sxOycgKyAobW9kaWZpZXJzICsgMSkgKyAnSCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChhcHBsaWNhdGlvbkN1cnNvck1vZGUpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ09IJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnW0gnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMzU6XG4gICAgICAgICAgICBpZiAobW9kaWZpZXJzKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTsnICsgKG1vZGlmaWVycyArIDEpICsgJ0YnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoYXBwbGljYXRpb25DdXJzb3JNb2RlKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdPRic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1tGJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIDMzOlxuICAgICAgICAgICAgaWYgKGV2LnNoaWZ0S2V5KSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LnR5cGUgPSAyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbNX4nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgMzQ6XG4gICAgICAgICAgICBpZiAoZXYuc2hpZnRLZXkpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQudHlwZSA9IDM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gRXNjYXBlU2VxdWVuY2VzXzEuQzAuRVNDICsgJ1s2fic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAxMTI6XG4gICAgICAgICAgICBpZiAobW9kaWZpZXJzKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTsnICsgKG1vZGlmaWVycyArIDEpICsgJ1AnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdPUCc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAxMTM6XG4gICAgICAgICAgICBpZiAobW9kaWZpZXJzKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTsnICsgKG1vZGlmaWVycyArIDEpICsgJ1EnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdPUSc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAxMTQ6XG4gICAgICAgICAgICBpZiAobW9kaWZpZXJzKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTsnICsgKG1vZGlmaWVycyArIDEpICsgJ1InO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdPUic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAxMTU6XG4gICAgICAgICAgICBpZiAobW9kaWZpZXJzKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTsnICsgKG1vZGlmaWVycyArIDEpICsgJ1MnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdPUyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAxMTY6XG4gICAgICAgICAgICBpZiAobW9kaWZpZXJzKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTU7JyArIChtb2RpZmllcnMgKyAxKSArICd+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzE1fic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAxMTc6XG4gICAgICAgICAgICBpZiAobW9kaWZpZXJzKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTc7JyArIChtb2RpZmllcnMgKyAxKSArICd+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzE3fic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAxMTg6XG4gICAgICAgICAgICBpZiAobW9kaWZpZXJzKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTg7JyArIChtb2RpZmllcnMgKyAxKSArICd+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzE4fic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAxMTk6XG4gICAgICAgICAgICBpZiAobW9kaWZpZXJzKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMTk7JyArIChtb2RpZmllcnMgKyAxKSArICd+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzE5fic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAxMjA6XG4gICAgICAgICAgICBpZiAobW9kaWZpZXJzKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMjA7JyArIChtb2RpZmllcnMgKyAxKSArICd+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzIwfic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAxMjE6XG4gICAgICAgICAgICBpZiAobW9kaWZpZXJzKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMjE7JyArIChtb2RpZmllcnMgKyAxKSArICd+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzIxfic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAxMjI6XG4gICAgICAgICAgICBpZiAobW9kaWZpZXJzKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMjM7JyArIChtb2RpZmllcnMgKyAxKSArICd+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzIzfic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAxMjM6XG4gICAgICAgICAgICBpZiAobW9kaWZpZXJzKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArICdbMjQ7JyArIChtb2RpZmllcnMgKyAxKSArICd+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyAnWzI0fic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGlmIChldi5jdHJsS2V5ICYmICFldi5zaGlmdEtleSAmJiAhZXYuYWx0S2V5ICYmICFldi5tZXRhS2V5KSB7XG4gICAgICAgICAgICAgICAgaWYgKGV2LmtleUNvZGUgPj0gNjUgJiYgZXYua2V5Q29kZSA8PSA5MCkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gU3RyaW5nLmZyb21DaGFyQ29kZShldi5rZXlDb2RlIC0gNjQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChldi5rZXlDb2RlID09PSAzMikge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQua2V5ID0gU3RyaW5nLmZyb21DaGFyQ29kZSgwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZXYua2V5Q29kZSA+PSA1MSAmJiBldi5rZXlDb2RlIDw9IDU1KSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGV2LmtleUNvZGUgLSA1MSArIDI3KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZXYua2V5Q29kZSA9PT0gNTYpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoMTI3KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZXYua2V5Q29kZSA9PT0gMjE5KSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDI3KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZXYua2V5Q29kZSA9PT0gMjIwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDI4KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZXYua2V5Q29kZSA9PT0gMjIxKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDI5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICgoIWlzTWFjIHx8IG1hY09wdGlvbklzTWV0YSkgJiYgZXYuYWx0S2V5ICYmICFldi5tZXRhS2V5KSB7XG4gICAgICAgICAgICAgICAgdmFyIGtleU1hcHBpbmcgPSBLRVlDT0RFX0tFWV9NQVBQSU5HU1tldi5rZXlDb2RlXTtcbiAgICAgICAgICAgICAgICB2YXIga2V5ID0ga2V5TWFwcGluZyAmJiBrZXlNYXBwaW5nWyFldi5zaGlmdEtleSA/IDAgOiAxXTtcbiAgICAgICAgICAgICAgICBpZiAoa2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyBrZXk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGV2LmtleUNvZGUgPj0gNjUgJiYgZXYua2V5Q29kZSA8PSA5MCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIga2V5Q29kZSA9IGV2LmN0cmxLZXkgPyBldi5rZXlDb2RlIC0gNjQgOiBldi5rZXlDb2RlICsgMzI7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5FU0MgKyBTdHJpbmcuZnJvbUNoYXJDb2RlKGtleUNvZGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGlzTWFjICYmICFldi5hbHRLZXkgJiYgIWV2LmN0cmxLZXkgJiYgZXYubWV0YUtleSkge1xuICAgICAgICAgICAgICAgIGlmIChldi5rZXlDb2RlID09PSA2NSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQudHlwZSA9IDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoZXYua2V5ICYmICFldi5jdHJsS2V5ICYmICFldi5hbHRLZXkgJiYgIWV2Lm1ldGFLZXkgJiYgZXYua2V5Q29kZSA+PSA0OCAmJiBldi5rZXkubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0LmtleSA9IGV2LmtleTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGV2LmtleSAmJiBldi5jdHJsS2V5KSB7XG4gICAgICAgICAgICAgICAgaWYgKGV2LmtleSA9PT0gJ18nKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5rZXkgPSBFc2NhcGVTZXF1ZW5jZXNfMS5DMC5VUztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cbmV4cG9ydHMuZXZhbHVhdGVLZXlib2FyZEV2ZW50ID0gZXZhbHVhdGVLZXlib2FyZEV2ZW50O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9S2V5Ym9hcmQuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgU3RyaW5nVG9VdGYzMiA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gU3RyaW5nVG9VdGYzMigpIHtcbiAgICAgICAgdGhpcy5faW50ZXJpbSA9IDA7XG4gICAgfVxuICAgIFN0cmluZ1RvVXRmMzIucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9pbnRlcmltID0gMDtcbiAgICB9O1xuICAgIFN0cmluZ1RvVXRmMzIucHJvdG90eXBlLmRlY29kZSA9IGZ1bmN0aW9uIChpbnB1dCwgdGFyZ2V0KSB7XG4gICAgICAgIHZhciBsZW5ndGggPSBpbnB1dC5sZW5ndGg7XG4gICAgICAgIGlmICghbGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICB2YXIgc2l6ZSA9IDA7XG4gICAgICAgIHZhciBzdGFydFBvcyA9IDA7XG4gICAgICAgIGlmICh0aGlzLl9pbnRlcmltKSB7XG4gICAgICAgICAgICB2YXIgc2Vjb25kID0gaW5wdXQuY2hhckNvZGVBdChzdGFydFBvcysrKTtcbiAgICAgICAgICAgIGlmICgweERDMDAgPD0gc2Vjb25kICYmIHNlY29uZCA8PSAweERGRkYpIHtcbiAgICAgICAgICAgICAgICB0YXJnZXRbc2l6ZSsrXSA9ICh0aGlzLl9pbnRlcmltIC0gMHhEODAwKSAqIDB4NDAwICsgc2Vjb25kIC0gMHhEQzAwICsgMHgxMDAwMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRhcmdldFtzaXplKytdID0gdGhpcy5faW50ZXJpbTtcbiAgICAgICAgICAgICAgICB0YXJnZXRbc2l6ZSsrXSA9IHNlY29uZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX2ludGVyaW0gPSAwO1xuICAgICAgICB9XG4gICAgICAgIGZvciAodmFyIGkgPSBzdGFydFBvczsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICB2YXIgY29kZSA9IGlucHV0LmNoYXJDb2RlQXQoaSk7XG4gICAgICAgICAgICBpZiAoMHhEODAwIDw9IGNvZGUgJiYgY29kZSA8PSAweERCRkYpIHtcbiAgICAgICAgICAgICAgICBpZiAoKytpID49IGxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbnRlcmltID0gY29kZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNpemU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBzZWNvbmQgPSBpbnB1dC5jaGFyQ29kZUF0KGkpO1xuICAgICAgICAgICAgICAgIGlmICgweERDMDAgPD0gc2Vjb25kICYmIHNlY29uZCA8PSAweERGRkYpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0W3NpemUrK10gPSAoY29kZSAtIDB4RDgwMCkgKiAweDQwMCArIHNlY29uZCAtIDB4REMwMCArIDB4MTAwMDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRbc2l6ZSsrXSA9IGNvZGU7XG4gICAgICAgICAgICAgICAgICAgIHRhcmdldFtzaXplKytdID0gc2Vjb25kO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRhcmdldFtzaXplKytdID0gY29kZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc2l6ZTtcbiAgICB9O1xuICAgIHJldHVybiBTdHJpbmdUb1V0ZjMyO1xufSgpKTtcbmV4cG9ydHMuU3RyaW5nVG9VdGYzMiA9IFN0cmluZ1RvVXRmMzI7XG5mdW5jdGlvbiBzdHJpbmdGcm9tQ29kZVBvaW50KGNvZGVQb2ludCkge1xuICAgIGlmIChjb2RlUG9pbnQgPiAweEZGRkYpIHtcbiAgICAgICAgY29kZVBvaW50IC09IDB4MTAwMDA7XG4gICAgICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKChjb2RlUG9pbnQgPj4gMTApICsgMHhEODAwKSArIFN0cmluZy5mcm9tQ2hhckNvZGUoKGNvZGVQb2ludCAlIDB4NDAwKSArIDB4REMwMCk7XG4gICAgfVxuICAgIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKGNvZGVQb2ludCk7XG59XG5leHBvcnRzLnN0cmluZ0Zyb21Db2RlUG9pbnQgPSBzdHJpbmdGcm9tQ29kZVBvaW50O1xuZnVuY3Rpb24gdXRmMzJUb1N0cmluZyhkYXRhLCBzdGFydCwgZW5kKSB7XG4gICAgaWYgKHN0YXJ0ID09PSB2b2lkIDApIHsgc3RhcnQgPSAwOyB9XG4gICAgaWYgKGVuZCA9PT0gdm9pZCAwKSB7IGVuZCA9IGRhdGEubGVuZ3RoOyB9XG4gICAgdmFyIHJlc3VsdCA9ICcnO1xuICAgIGZvciAodmFyIGkgPSBzdGFydDsgaSA8IGVuZDsgKytpKSB7XG4gICAgICAgIHZhciBjb2RlcG9pbnQgPSBkYXRhW2ldO1xuICAgICAgICBpZiAoY29kZXBvaW50ID4gMHhGRkZGKSB7XG4gICAgICAgICAgICBjb2RlcG9pbnQgLT0gMHgxMDAwMDtcbiAgICAgICAgICAgIHJlc3VsdCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKChjb2RlcG9pbnQgPj4gMTApICsgMHhEODAwKSArIFN0cmluZy5mcm9tQ2hhckNvZGUoKGNvZGVwb2ludCAlIDB4NDAwKSArIDB4REMwMCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlcG9pbnQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG5leHBvcnRzLnV0ZjMyVG9TdHJpbmcgPSB1dGYzMlRvU3RyaW5nO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9VGV4dERlY29kZXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgRXNjYXBlU2VxdWVuY2VzXzEgPSByZXF1aXJlKFwiLi4vY29tbW9uL2RhdGEvRXNjYXBlU2VxdWVuY2VzXCIpO1xudmFyIEFsdENsaWNrSGFuZGxlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQWx0Q2xpY2tIYW5kbGVyKF9tb3VzZUV2ZW50LCBfdGVybWluYWwpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICB0aGlzLl9tb3VzZUV2ZW50ID0gX21vdXNlRXZlbnQ7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsID0gX3Rlcm1pbmFsO1xuICAgICAgICB0aGlzLl9saW5lcyA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5saW5lcztcbiAgICAgICAgdGhpcy5fc3RhcnRDb2wgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXIueDtcbiAgICAgICAgdGhpcy5fc3RhcnRSb3cgPSB0aGlzLl90ZXJtaW5hbC5idWZmZXIueTtcbiAgICAgICAgdmFyIGNvb3JkaW5hdGVzID0gdGhpcy5fdGVybWluYWwubW91c2VIZWxwZXIuZ2V0Q29vcmRzKHRoaXMuX21vdXNlRXZlbnQsIHRoaXMuX3Rlcm1pbmFsLmVsZW1lbnQsIHRoaXMuX3Rlcm1pbmFsLmNoYXJNZWFzdXJlLCB0aGlzLl90ZXJtaW5hbC5jb2xzLCB0aGlzLl90ZXJtaW5hbC5yb3dzLCBmYWxzZSk7XG4gICAgICAgIGlmIChjb29yZGluYXRlcykge1xuICAgICAgICAgICAgX2EgPSBjb29yZGluYXRlcy5tYXAoZnVuY3Rpb24gKGNvb3JkaW5hdGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY29vcmRpbmF0ZSAtIDE7XG4gICAgICAgICAgICB9KSwgdGhpcy5fZW5kQ29sID0gX2FbMF0sIHRoaXMuX2VuZFJvdyA9IF9hWzFdO1xuICAgICAgICB9XG4gICAgfVxuICAgIEFsdENsaWNrSGFuZGxlci5wcm90b3R5cGUubW92ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX21vdXNlRXZlbnQuYWx0S2V5ICYmIHRoaXMuX2VuZENvbCAhPT0gdW5kZWZpbmVkICYmIHRoaXMuX2VuZFJvdyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbC5oYW5kbGVyKHRoaXMuX2Fycm93U2VxdWVuY2VzKCkpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBBbHRDbGlja0hhbmRsZXIucHJvdG90eXBlLl9hcnJvd1NlcXVlbmNlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl90ZXJtaW5hbC5idWZmZXIuaGFzU2Nyb2xsYmFjaykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Jlc2V0U3RhcnRpbmdSb3coKSArIHRoaXMuX21vdmVUb1JlcXVlc3RlZFJvdygpICsgdGhpcy5fbW92ZVRvUmVxdWVzdGVkQ29sKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX21vdmVIb3Jpem9udGFsbHlPbmx5KCk7XG4gICAgfTtcbiAgICBBbHRDbGlja0hhbmRsZXIucHJvdG90eXBlLl9yZXNldFN0YXJ0aW5nUm93ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fbW92ZVRvUmVxdWVzdGVkUm93KCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlcGVhdCh0aGlzLl9idWZmZXJMaW5lKHRoaXMuX3N0YXJ0Q29sLCB0aGlzLl9zdGFydFJvdywgdGhpcy5fc3RhcnRDb2wsIHRoaXMuX3N0YXJ0Um93IC0gdGhpcy5fd3JhcHBlZFJvd3NGb3JSb3codGhpcy5fc3RhcnRSb3cpLCBmYWxzZSkubGVuZ3RoLCB0aGlzLl9zZXF1ZW5jZShcIkRcIikpO1xuICAgIH07XG4gICAgQWx0Q2xpY2tIYW5kbGVyLnByb3RvdHlwZS5fbW92ZVRvUmVxdWVzdGVkUm93ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgc3RhcnRSb3cgPSB0aGlzLl9zdGFydFJvdyAtIHRoaXMuX3dyYXBwZWRSb3dzRm9yUm93KHRoaXMuX3N0YXJ0Um93KTtcbiAgICAgICAgdmFyIGVuZFJvdyA9IHRoaXMuX2VuZFJvdyAtIHRoaXMuX3dyYXBwZWRSb3dzRm9yUm93KHRoaXMuX2VuZFJvdyk7XG4gICAgICAgIHZhciByb3dzVG9Nb3ZlID0gTWF0aC5hYnMoc3RhcnRSb3cgLSBlbmRSb3cpIC0gdGhpcy5fd3JhcHBlZFJvd3NDb3VudCgpO1xuICAgICAgICByZXR1cm4gcmVwZWF0KHJvd3NUb01vdmUsIHRoaXMuX3NlcXVlbmNlKHRoaXMuX3ZlcnRpY2FsRGlyZWN0aW9uKCkpKTtcbiAgICB9O1xuICAgIEFsdENsaWNrSGFuZGxlci5wcm90b3R5cGUuX21vdmVUb1JlcXVlc3RlZENvbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHN0YXJ0Um93O1xuICAgICAgICBpZiAodGhpcy5fbW92ZVRvUmVxdWVzdGVkUm93KCkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgc3RhcnRSb3cgPSB0aGlzLl9lbmRSb3cgLSB0aGlzLl93cmFwcGVkUm93c0ZvclJvdyh0aGlzLl9lbmRSb3cpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc3RhcnRSb3cgPSB0aGlzLl9zdGFydFJvdztcbiAgICAgICAgfVxuICAgICAgICB2YXIgZW5kUm93ID0gdGhpcy5fZW5kUm93O1xuICAgICAgICB2YXIgZGlyZWN0aW9uID0gdGhpcy5faG9yaXpvbnRhbERpcmVjdGlvbigpO1xuICAgICAgICByZXR1cm4gcmVwZWF0KHRoaXMuX2J1ZmZlckxpbmUodGhpcy5fc3RhcnRDb2wsIHN0YXJ0Um93LCB0aGlzLl9lbmRDb2wsIGVuZFJvdywgZGlyZWN0aW9uID09PSBcIkNcIikubGVuZ3RoLCB0aGlzLl9zZXF1ZW5jZShkaXJlY3Rpb24pKTtcbiAgICB9O1xuICAgIEFsdENsaWNrSGFuZGxlci5wcm90b3R5cGUuX21vdmVIb3Jpem9udGFsbHlPbmx5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZGlyZWN0aW9uID0gdGhpcy5faG9yaXpvbnRhbERpcmVjdGlvbigpO1xuICAgICAgICByZXR1cm4gcmVwZWF0KE1hdGguYWJzKHRoaXMuX3N0YXJ0Q29sIC0gdGhpcy5fZW5kQ29sKSwgdGhpcy5fc2VxdWVuY2UoZGlyZWN0aW9uKSk7XG4gICAgfTtcbiAgICBBbHRDbGlja0hhbmRsZXIucHJvdG90eXBlLl93cmFwcGVkUm93c0NvdW50ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgd3JhcHBlZFJvd3MgPSAwO1xuICAgICAgICB2YXIgc3RhcnRSb3cgPSB0aGlzLl9zdGFydFJvdyAtIHRoaXMuX3dyYXBwZWRSb3dzRm9yUm93KHRoaXMuX3N0YXJ0Um93KTtcbiAgICAgICAgdmFyIGVuZFJvdyA9IHRoaXMuX2VuZFJvdyAtIHRoaXMuX3dyYXBwZWRSb3dzRm9yUm93KHRoaXMuX2VuZFJvdyk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgTWF0aC5hYnMoc3RhcnRSb3cgLSBlbmRSb3cpOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBkaXJlY3Rpb24gPSB0aGlzLl92ZXJ0aWNhbERpcmVjdGlvbigpID09PSBcIkFcIiA/IC0xIDogMTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9saW5lcy5nZXQoc3RhcnRSb3cgKyAoZGlyZWN0aW9uICogaSkpLmlzV3JhcHBlZCkge1xuICAgICAgICAgICAgICAgIHdyYXBwZWRSb3dzKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHdyYXBwZWRSb3dzO1xuICAgIH07XG4gICAgQWx0Q2xpY2tIYW5kbGVyLnByb3RvdHlwZS5fd3JhcHBlZFJvd3NGb3JSb3cgPSBmdW5jdGlvbiAoY3VycmVudFJvdykge1xuICAgICAgICB2YXIgcm93Q291bnQgPSAwO1xuICAgICAgICB2YXIgbGluZVdyYXBzID0gdGhpcy5fbGluZXMuZ2V0KGN1cnJlbnRSb3cpLmlzV3JhcHBlZDtcbiAgICAgICAgd2hpbGUgKGxpbmVXcmFwcyAmJiBjdXJyZW50Um93ID49IDAgJiYgY3VycmVudFJvdyA8IHRoaXMuX3Rlcm1pbmFsLnJvd3MpIHtcbiAgICAgICAgICAgIHJvd0NvdW50Kys7XG4gICAgICAgICAgICBjdXJyZW50Um93LS07XG4gICAgICAgICAgICBsaW5lV3JhcHMgPSB0aGlzLl9saW5lcy5nZXQoY3VycmVudFJvdykuaXNXcmFwcGVkO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByb3dDb3VudDtcbiAgICB9O1xuICAgIEFsdENsaWNrSGFuZGxlci5wcm90b3R5cGUuX2hvcml6b250YWxEaXJlY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzdGFydFJvdztcbiAgICAgICAgaWYgKHRoaXMuX21vdmVUb1JlcXVlc3RlZFJvdygpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHN0YXJ0Um93ID0gdGhpcy5fZW5kUm93IC0gdGhpcy5fd3JhcHBlZFJvd3NGb3JSb3codGhpcy5fZW5kUm93KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHN0YXJ0Um93ID0gdGhpcy5fc3RhcnRSb3c7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCh0aGlzLl9zdGFydENvbCA8IHRoaXMuX2VuZENvbCAmJlxuICAgICAgICAgICAgc3RhcnRSb3cgPD0gdGhpcy5fZW5kUm93KSB8fFxuICAgICAgICAgICAgKHRoaXMuX3N0YXJ0Q29sID49IHRoaXMuX2VuZENvbCAmJlxuICAgICAgICAgICAgICAgIHN0YXJ0Um93IDwgdGhpcy5fZW5kUm93KSkge1xuICAgICAgICAgICAgcmV0dXJuIFwiQ1wiO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBcIkRcIjtcbiAgICB9O1xuICAgIEFsdENsaWNrSGFuZGxlci5wcm90b3R5cGUuX3ZlcnRpY2FsRGlyZWN0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fc3RhcnRSb3cgPiB0aGlzLl9lbmRSb3cpIHtcbiAgICAgICAgICAgIHJldHVybiBcIkFcIjtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gXCJCXCI7XG4gICAgfTtcbiAgICBBbHRDbGlja0hhbmRsZXIucHJvdG90eXBlLl9idWZmZXJMaW5lID0gZnVuY3Rpb24gKHN0YXJ0Q29sLCBzdGFydFJvdywgZW5kQ29sLCBlbmRSb3csIGZvcndhcmQpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRDb2wgPSBzdGFydENvbDtcbiAgICAgICAgdmFyIGN1cnJlbnRSb3cgPSBzdGFydFJvdztcbiAgICAgICAgdmFyIGJ1ZmZlclN0ciA9ICcnO1xuICAgICAgICB3aGlsZSAoY3VycmVudENvbCAhPT0gZW5kQ29sIHx8IGN1cnJlbnRSb3cgIT09IGVuZFJvdykge1xuICAgICAgICAgICAgY3VycmVudENvbCArPSBmb3J3YXJkID8gMSA6IC0xO1xuICAgICAgICAgICAgaWYgKGZvcndhcmQgJiYgY3VycmVudENvbCA+IHRoaXMuX3Rlcm1pbmFsLmNvbHMgLSAxKSB7XG4gICAgICAgICAgICAgICAgYnVmZmVyU3RyICs9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci50cmFuc2xhdGVCdWZmZXJMaW5lVG9TdHJpbmcoY3VycmVudFJvdywgZmFsc2UsIHN0YXJ0Q29sLCBjdXJyZW50Q29sKTtcbiAgICAgICAgICAgICAgICBjdXJyZW50Q29sID0gMDtcbiAgICAgICAgICAgICAgICBzdGFydENvbCA9IDA7XG4gICAgICAgICAgICAgICAgY3VycmVudFJvdysrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoIWZvcndhcmQgJiYgY3VycmVudENvbCA8IDApIHtcbiAgICAgICAgICAgICAgICBidWZmZXJTdHIgKz0gdGhpcy5fdGVybWluYWwuYnVmZmVyLnRyYW5zbGF0ZUJ1ZmZlckxpbmVUb1N0cmluZyhjdXJyZW50Um93LCBmYWxzZSwgMCwgc3RhcnRDb2wgKyAxKTtcbiAgICAgICAgICAgICAgICBjdXJyZW50Q29sID0gdGhpcy5fdGVybWluYWwuY29scyAtIDE7XG4gICAgICAgICAgICAgICAgc3RhcnRDb2wgPSBjdXJyZW50Q29sO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRSb3ctLTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYnVmZmVyU3RyICsgdGhpcy5fdGVybWluYWwuYnVmZmVyLnRyYW5zbGF0ZUJ1ZmZlckxpbmVUb1N0cmluZyhjdXJyZW50Um93LCBmYWxzZSwgc3RhcnRDb2wsIGN1cnJlbnRDb2wpO1xuICAgIH07XG4gICAgQWx0Q2xpY2tIYW5kbGVyLnByb3RvdHlwZS5fc2VxdWVuY2UgPSBmdW5jdGlvbiAoZGlyZWN0aW9uKSB7XG4gICAgICAgIHZhciBtb2QgPSB0aGlzLl90ZXJtaW5hbC5hcHBsaWNhdGlvbkN1cnNvciA/ICdPJyA6ICdbJztcbiAgICAgICAgcmV0dXJuIEVzY2FwZVNlcXVlbmNlc18xLkMwLkVTQyArIG1vZCArIGRpcmVjdGlvbjtcbiAgICB9O1xuICAgIHJldHVybiBBbHRDbGlja0hhbmRsZXI7XG59KCkpO1xuZXhwb3J0cy5BbHRDbGlja0hhbmRsZXIgPSBBbHRDbGlja0hhbmRsZXI7XG5mdW5jdGlvbiByZXBlYXQoY291bnQsIHN0cikge1xuICAgIGNvdW50ID0gTWF0aC5mbG9vcihjb3VudCk7XG4gICAgdmFyIHJwdCA9ICcnO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgICAgICBycHQgKz0gc3RyO1xuICAgIH1cbiAgICByZXR1cm4gcnB0O1xufVxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9QWx0Q2xpY2tIYW5kbGVyLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIEFkZG9uTWFuYWdlciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQWRkb25NYW5hZ2VyKCkge1xuICAgICAgICB0aGlzLl9hZGRvbnMgPSBbXTtcbiAgICB9XG4gICAgQWRkb25NYW5hZ2VyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5fYWRkb25zLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICB0aGlzLl9hZGRvbnNbaV0uaW5zdGFuY2UuZGlzcG9zZSgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBBZGRvbk1hbmFnZXIucHJvdG90eXBlLmxvYWRBZGRvbiA9IGZ1bmN0aW9uICh0ZXJtaW5hbCwgaW5zdGFuY2UpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIGxvYWRlZEFkZG9uID0ge1xuICAgICAgICAgICAgaW5zdGFuY2U6IGluc3RhbmNlLFxuICAgICAgICAgICAgZGlzcG9zZTogaW5zdGFuY2UuZGlzcG9zZSxcbiAgICAgICAgICAgIGlzRGlzcG9zZWQ6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX2FkZG9ucy5wdXNoKGxvYWRlZEFkZG9uKTtcbiAgICAgICAgaW5zdGFuY2UuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl93cmFwcGVkQWRkb25EaXNwb3NlKGxvYWRlZEFkZG9uKTsgfTtcbiAgICAgICAgaW5zdGFuY2UuYWN0aXZhdGUodGVybWluYWwpO1xuICAgIH07XG4gICAgQWRkb25NYW5hZ2VyLnByb3RvdHlwZS5fd3JhcHBlZEFkZG9uRGlzcG9zZSA9IGZ1bmN0aW9uIChsb2FkZWRBZGRvbikge1xuICAgICAgICBpZiAobG9hZGVkQWRkb24uaXNEaXNwb3NlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciBpbmRleCA9IC0xO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX2FkZG9ucy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2FkZG9uc1tpXSA9PT0gbG9hZGVkQWRkb24pIHtcbiAgICAgICAgICAgICAgICBpbmRleCA9IGk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDb3VsZCBub3QgZGlzcG9zZSBhbiBhZGRvbiB0aGF0IGhhcyBub3QgYmVlbiBsb2FkZWQnKTtcbiAgICAgICAgfVxuICAgICAgICBsb2FkZWRBZGRvbi5pc0Rpc3Bvc2VkID0gdHJ1ZTtcbiAgICAgICAgbG9hZGVkQWRkb24uZGlzcG9zZSgpO1xuICAgICAgICB0aGlzLl9hZGRvbnMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICB9O1xuICAgIHJldHVybiBBZGRvbk1hbmFnZXI7XG59KCkpO1xuZXhwb3J0cy5BZGRvbk1hbmFnZXIgPSBBZGRvbk1hbmFnZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1BZGRvbk1hbmFnZXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgVGVybWluYWxfMSA9IHJlcXVpcmUoXCIuLi9UZXJtaW5hbFwiKTtcbnZhciBTdHJpbmdzID0gcmVxdWlyZShcIi4uL1N0cmluZ3NcIik7XG52YXIgQWRkb25NYW5hZ2VyXzEgPSByZXF1aXJlKFwiLi9BZGRvbk1hbmFnZXJcIik7XG52YXIgVGVybWluYWwgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFRlcm1pbmFsKG9wdGlvbnMpIHtcbiAgICAgICAgdGhpcy5fY29yZSA9IG5ldyBUZXJtaW5hbF8xLlRlcm1pbmFsKG9wdGlvbnMpO1xuICAgICAgICB0aGlzLl9hZGRvbk1hbmFnZXIgPSBuZXcgQWRkb25NYW5hZ2VyXzEuQWRkb25NYW5hZ2VyKCk7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwib25DdXJzb3JNb3ZlXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9jb3JlLm9uQ3Vyc29yTW92ZTsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFRlcm1pbmFsLnByb3RvdHlwZSwgXCJvbkxpbmVGZWVkXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9jb3JlLm9uTGluZUZlZWQ7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwib25TZWxlY3Rpb25DaGFuZ2VcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2NvcmUub25TZWxlY3Rpb25DaGFuZ2U7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwib25EYXRhXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9jb3JlLm9uRGF0YTsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFRlcm1pbmFsLnByb3RvdHlwZSwgXCJvblRpdGxlQ2hhbmdlXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9jb3JlLm9uVGl0bGVDaGFuZ2U7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwib25TY3JvbGxcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2NvcmUub25TY3JvbGw7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwib25LZXlcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2NvcmUub25LZXk7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwib25SZW5kZXJcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2NvcmUub25SZW5kZXI7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwib25SZXNpemVcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2NvcmUub25SZXNpemU7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwiZWxlbWVudFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fY29yZS5lbGVtZW50OyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVGVybWluYWwucHJvdG90eXBlLCBcInRleHRhcmVhXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9jb3JlLnRleHRhcmVhOyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoVGVybWluYWwucHJvdG90eXBlLCBcInJvd3NcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2NvcmUucm93czsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFRlcm1pbmFsLnByb3RvdHlwZSwgXCJjb2xzXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9jb3JlLmNvbHM7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwiYnVmZmVyXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiBuZXcgQnVmZmVyQXBpVmlldyh0aGlzLl9jb3JlLmJ1ZmZlcik7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShUZXJtaW5hbC5wcm90b3R5cGUsIFwibWFya2Vyc1wiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fY29yZS5tYXJrZXJzOyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuYmx1ciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fY29yZS5ibHVyKCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuZm9jdXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2NvcmUuZm9jdXMoKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uICh0eXBlLCBsaXN0ZW5lcikge1xuICAgICAgICB0aGlzLl9jb3JlLm9uKHR5cGUsIGxpc3RlbmVyKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5vZmYgPSBmdW5jdGlvbiAodHlwZSwgbGlzdGVuZXIpIHtcbiAgICAgICAgdGhpcy5fY29yZS5vZmYodHlwZSwgbGlzdGVuZXIpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLmVtaXQgPSBmdW5jdGlvbiAodHlwZSwgZGF0YSkge1xuICAgICAgICB0aGlzLl9jb3JlLmVtaXQodHlwZSwgZGF0YSk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuYWRkRGlzcG9zYWJsZUxpc3RlbmVyID0gZnVuY3Rpb24gKHR5cGUsIGhhbmRsZXIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvcmUuYWRkRGlzcG9zYWJsZUxpc3RlbmVyKHR5cGUsIGhhbmRsZXIpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnJlc2l6ZSA9IGZ1bmN0aW9uIChjb2x1bW5zLCByb3dzKSB7XG4gICAgICAgIHRoaXMuX2NvcmUucmVzaXplKGNvbHVtbnMsIHJvd3MpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLndyaXRlbG4gPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICB0aGlzLl9jb3JlLndyaXRlbG4oZGF0YSk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uIChwYXJlbnQpIHtcbiAgICAgICAgdGhpcy5fY29yZS5vcGVuKHBhcmVudCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuYXR0YWNoQ3VzdG9tS2V5RXZlbnRIYW5kbGVyID0gZnVuY3Rpb24gKGN1c3RvbUtleUV2ZW50SGFuZGxlcikge1xuICAgICAgICB0aGlzLl9jb3JlLmF0dGFjaEN1c3RvbUtleUV2ZW50SGFuZGxlcihjdXN0b21LZXlFdmVudEhhbmRsZXIpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLmFkZENzaUhhbmRsZXIgPSBmdW5jdGlvbiAoZmxhZywgY2FsbGJhY2spIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvcmUuYWRkQ3NpSGFuZGxlcihmbGFnLCBjYWxsYmFjayk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuYWRkT3NjSGFuZGxlciA9IGZ1bmN0aW9uIChpZGVudCwgY2FsbGJhY2spIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvcmUuYWRkT3NjSGFuZGxlcihpZGVudCwgY2FsbGJhY2spO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnJlZ2lzdGVyTGlua01hdGNoZXIgPSBmdW5jdGlvbiAocmVnZXgsIGhhbmRsZXIsIG9wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvcmUucmVnaXN0ZXJMaW5rTWF0Y2hlcihyZWdleCwgaGFuZGxlciwgb3B0aW9ucyk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuZGVyZWdpc3RlckxpbmtNYXRjaGVyID0gZnVuY3Rpb24gKG1hdGNoZXJJZCkge1xuICAgICAgICB0aGlzLl9jb3JlLmRlcmVnaXN0ZXJMaW5rTWF0Y2hlcihtYXRjaGVySWQpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnJlZ2lzdGVyQ2hhcmFjdGVySm9pbmVyID0gZnVuY3Rpb24gKGhhbmRsZXIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvcmUucmVnaXN0ZXJDaGFyYWN0ZXJKb2luZXIoaGFuZGxlcik7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuZGVyZWdpc3RlckNoYXJhY3RlckpvaW5lciA9IGZ1bmN0aW9uIChqb2luZXJJZCkge1xuICAgICAgICB0aGlzLl9jb3JlLmRlcmVnaXN0ZXJDaGFyYWN0ZXJKb2luZXIoam9pbmVySWQpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLmFkZE1hcmtlciA9IGZ1bmN0aW9uIChjdXJzb3JZT2Zmc2V0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jb3JlLmFkZE1hcmtlcihjdXJzb3JZT2Zmc2V0KTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5oYXNTZWxlY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jb3JlLmhhc1NlbGVjdGlvbigpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnNlbGVjdCA9IGZ1bmN0aW9uIChjb2x1bW4sIHJvdywgbGVuZ3RoKSB7XG4gICAgICAgIHRoaXMuX2NvcmUuc2VsZWN0KGNvbHVtbiwgcm93LCBsZW5ndGgpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLmdldFNlbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvcmUuZ2V0U2VsZWN0aW9uKCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuZ2V0U2VsZWN0aW9uUG9zaXRpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9jb3JlLmdldFNlbGVjdGlvblBvc2l0aW9uKCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuY2xlYXJTZWxlY3Rpb24gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2NvcmUuY2xlYXJTZWxlY3Rpb24oKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5zZWxlY3RBbGwgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2NvcmUuc2VsZWN0QWxsKCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuc2VsZWN0TGluZXMgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkge1xuICAgICAgICB0aGlzLl9jb3JlLnNlbGVjdExpbmVzKHN0YXJ0LCBlbmQpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2FkZG9uTWFuYWdlci5kaXNwb3NlKCk7XG4gICAgICAgIHRoaXMuX2NvcmUuZGlzcG9zZSgpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2NvcmUuZGVzdHJveSgpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnNjcm9sbExpbmVzID0gZnVuY3Rpb24gKGFtb3VudCkge1xuICAgICAgICB0aGlzLl9jb3JlLnNjcm9sbExpbmVzKGFtb3VudCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuc2Nyb2xsUGFnZXMgPSBmdW5jdGlvbiAocGFnZUNvdW50KSB7XG4gICAgICAgIHRoaXMuX2NvcmUuc2Nyb2xsUGFnZXMocGFnZUNvdW50KTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5zY3JvbGxUb1RvcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fY29yZS5zY3JvbGxUb1RvcCgpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnNjcm9sbFRvQm90dG9tID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9jb3JlLnNjcm9sbFRvQm90dG9tKCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuc2Nyb2xsVG9MaW5lID0gZnVuY3Rpb24gKGxpbmUpIHtcbiAgICAgICAgdGhpcy5fY29yZS5zY3JvbGxUb0xpbmUobGluZSk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2NvcmUuY2xlYXIoKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS53cml0ZSA9IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHRoaXMuX2NvcmUud3JpdGUoZGF0YSk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5wcm90b3R5cGUuZ2V0T3B0aW9uID0gZnVuY3Rpb24gKGtleSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fY29yZS5nZXRPcHRpb24oa2V5KTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5zZXRPcHRpb24gPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICB0aGlzLl9jb3JlLnNldE9wdGlvbihrZXksIHZhbHVlKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5yZWZyZXNoID0gZnVuY3Rpb24gKHN0YXJ0LCBlbmQpIHtcbiAgICAgICAgdGhpcy5fY29yZS5yZWZyZXNoKHN0YXJ0LCBlbmQpO1xuICAgIH07XG4gICAgVGVybWluYWwucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9jb3JlLnJlc2V0KCk7XG4gICAgfTtcbiAgICBUZXJtaW5hbC5hcHBseUFkZG9uID0gZnVuY3Rpb24gKGFkZG9uKSB7XG4gICAgICAgIGFkZG9uLmFwcGx5KFRlcm1pbmFsKTtcbiAgICB9O1xuICAgIFRlcm1pbmFsLnByb3RvdHlwZS5sb2FkQWRkb24gPSBmdW5jdGlvbiAoYWRkb24pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FkZG9uTWFuYWdlci5sb2FkQWRkb24odGhpcywgYWRkb24pO1xuICAgIH07XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFRlcm1pbmFsLCBcInN0cmluZ3NcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiBTdHJpbmdzO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICByZXR1cm4gVGVybWluYWw7XG59KCkpO1xuZXhwb3J0cy5UZXJtaW5hbCA9IFRlcm1pbmFsO1xudmFyIEJ1ZmZlckFwaVZpZXcgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEJ1ZmZlckFwaVZpZXcoX2J1ZmZlcikge1xuICAgICAgICB0aGlzLl9idWZmZXIgPSBfYnVmZmVyO1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQnVmZmVyQXBpVmlldy5wcm90b3R5cGUsIFwiY3Vyc29yWVwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fYnVmZmVyLnk7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShCdWZmZXJBcGlWaWV3LnByb3RvdHlwZSwgXCJjdXJzb3JYXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9idWZmZXIueDsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEJ1ZmZlckFwaVZpZXcucHJvdG90eXBlLCBcInZpZXdwb3J0WVwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fYnVmZmVyLnlkaXNwOyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQnVmZmVyQXBpVmlldy5wcm90b3R5cGUsIFwiYmFzZVlcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2J1ZmZlci55YmFzZTsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEJ1ZmZlckFwaVZpZXcucHJvdG90eXBlLCBcImxlbmd0aFwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fYnVmZmVyLmxpbmVzLmxlbmd0aDsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgQnVmZmVyQXBpVmlldy5wcm90b3R5cGUuZ2V0TGluZSA9IGZ1bmN0aW9uICh5KSB7XG4gICAgICAgIHZhciBsaW5lID0gdGhpcy5fYnVmZmVyLmxpbmVzLmdldCh5KTtcbiAgICAgICAgaWYgKCFsaW5lKSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgQnVmZmVyTGluZUFwaVZpZXcobGluZSk7XG4gICAgfTtcbiAgICByZXR1cm4gQnVmZmVyQXBpVmlldztcbn0oKSk7XG52YXIgQnVmZmVyTGluZUFwaVZpZXcgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEJ1ZmZlckxpbmVBcGlWaWV3KF9saW5lKSB7XG4gICAgICAgIHRoaXMuX2xpbmUgPSBfbGluZTtcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KEJ1ZmZlckxpbmVBcGlWaWV3LnByb3RvdHlwZSwgXCJpc1dyYXBwZWRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2xpbmUuaXNXcmFwcGVkOyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBCdWZmZXJMaW5lQXBpVmlldy5wcm90b3R5cGUuZ2V0Q2VsbCA9IGZ1bmN0aW9uICh4KSB7XG4gICAgICAgIGlmICh4IDwgMCB8fCB4ID49IHRoaXMuX2xpbmUubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgQnVmZmVyQ2VsbEFwaVZpZXcodGhpcy5fbGluZSwgeCk7XG4gICAgfTtcbiAgICBCdWZmZXJMaW5lQXBpVmlldy5wcm90b3R5cGUudHJhbnNsYXRlVG9TdHJpbmcgPSBmdW5jdGlvbiAodHJpbVJpZ2h0LCBzdGFydENvbHVtbiwgZW5kQ29sdW1uKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9saW5lLnRyYW5zbGF0ZVRvU3RyaW5nKHRyaW1SaWdodCwgc3RhcnRDb2x1bW4sIGVuZENvbHVtbik7XG4gICAgfTtcbiAgICByZXR1cm4gQnVmZmVyTGluZUFwaVZpZXc7XG59KCkpO1xudmFyIEJ1ZmZlckNlbGxBcGlWaWV3ID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBCdWZmZXJDZWxsQXBpVmlldyhfbGluZSwgX3gpIHtcbiAgICAgICAgdGhpcy5fbGluZSA9IF9saW5lO1xuICAgICAgICB0aGlzLl94ID0gX3g7XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShCdWZmZXJDZWxsQXBpVmlldy5wcm90b3R5cGUsIFwiY2hhclwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fbGluZS5nZXRTdHJpbmcodGhpcy5feCk7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShCdWZmZXJDZWxsQXBpVmlldy5wcm90b3R5cGUsIFwid2lkdGhcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX2xpbmUuZ2V0V2lkdGgodGhpcy5feCk7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIHJldHVybiBCdWZmZXJDZWxsQXBpVmlldztcbn0oKSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1UZXJtaW5hbC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBUeXBlc18xID0gcmVxdWlyZShcIi4uL2NvbW1vbi9UeXBlc1wiKTtcbnZhciBUeXBlc18yID0gcmVxdWlyZShcIi4vYXRsYXMvVHlwZXNcIik7XG52YXIgQ2hhckF0bGFzQ2FjaGVfMSA9IHJlcXVpcmUoXCIuL2F0bGFzL0NoYXJBdGxhc0NhY2hlXCIpO1xudmFyIEJ1ZmZlckxpbmVfMSA9IHJlcXVpcmUoXCIuLi9jb3JlL2J1ZmZlci9CdWZmZXJMaW5lXCIpO1xudmFyIEJhc2VSZW5kZXJMYXllciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQmFzZVJlbmRlckxheWVyKF9jb250YWluZXIsIGlkLCB6SW5kZXgsIF9hbHBoYSwgX2NvbG9ycykge1xuICAgICAgICB0aGlzLl9jb250YWluZXIgPSBfY29udGFpbmVyO1xuICAgICAgICB0aGlzLl9hbHBoYSA9IF9hbHBoYTtcbiAgICAgICAgdGhpcy5fY29sb3JzID0gX2NvbG9ycztcbiAgICAgICAgdGhpcy5fc2NhbGVkQ2hhcldpZHRoID0gMDtcbiAgICAgICAgdGhpcy5fc2NhbGVkQ2hhckhlaWdodCA9IDA7XG4gICAgICAgIHRoaXMuX3NjYWxlZENlbGxXaWR0aCA9IDA7XG4gICAgICAgIHRoaXMuX3NjYWxlZENlbGxIZWlnaHQgPSAwO1xuICAgICAgICB0aGlzLl9zY2FsZWRDaGFyTGVmdCA9IDA7XG4gICAgICAgIHRoaXMuX3NjYWxlZENoYXJUb3AgPSAwO1xuICAgICAgICB0aGlzLl9jdXJyZW50R2x5cGhJZGVudGlmaWVyID0ge1xuICAgICAgICAgICAgY2hhcnM6ICcnLFxuICAgICAgICAgICAgY29kZTogMCxcbiAgICAgICAgICAgIGJnOiAwLFxuICAgICAgICAgICAgZmc6IDAsXG4gICAgICAgICAgICBib2xkOiBmYWxzZSxcbiAgICAgICAgICAgIGRpbTogZmFsc2UsXG4gICAgICAgICAgICBpdGFsaWM6IGZhbHNlXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX2NhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgICAgICB0aGlzLl9jYW52YXMuY2xhc3NMaXN0LmFkZChcInh0ZXJtLVwiICsgaWQgKyBcIi1sYXllclwiKTtcbiAgICAgICAgdGhpcy5fY2FudmFzLnN0eWxlLnpJbmRleCA9IHpJbmRleC50b1N0cmluZygpO1xuICAgICAgICB0aGlzLl9pbml0Q2FudmFzKCk7XG4gICAgICAgIHRoaXMuX2NvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLl9jYW52YXMpO1xuICAgIH1cbiAgICBCYXNlUmVuZGVyTGF5ZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2NvbnRhaW5lci5yZW1vdmVDaGlsZCh0aGlzLl9jYW52YXMpO1xuICAgICAgICBpZiAodGhpcy5fY2hhckF0bGFzKSB7XG4gICAgICAgICAgICB0aGlzLl9jaGFyQXRsYXMuZGlzcG9zZSgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBCYXNlUmVuZGVyTGF5ZXIucHJvdG90eXBlLl9pbml0Q2FudmFzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9jdHggPSB0aGlzLl9jYW52YXMuZ2V0Q29udGV4dCgnMmQnLCB7IGFscGhhOiB0aGlzLl9hbHBoYSB9KTtcbiAgICAgICAgaWYgKCF0aGlzLl9hbHBoYSkge1xuICAgICAgICAgICAgdGhpcy5jbGVhckFsbCgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBCYXNlUmVuZGVyTGF5ZXIucHJvdG90eXBlLm9uT3B0aW9uc0NoYW5nZWQgPSBmdW5jdGlvbiAodGVybWluYWwpIHsgfTtcbiAgICBCYXNlUmVuZGVyTGF5ZXIucHJvdG90eXBlLm9uQmx1ciA9IGZ1bmN0aW9uICh0ZXJtaW5hbCkgeyB9O1xuICAgIEJhc2VSZW5kZXJMYXllci5wcm90b3R5cGUub25Gb2N1cyA9IGZ1bmN0aW9uICh0ZXJtaW5hbCkgeyB9O1xuICAgIEJhc2VSZW5kZXJMYXllci5wcm90b3R5cGUub25DdXJzb3JNb3ZlID0gZnVuY3Rpb24gKHRlcm1pbmFsKSB7IH07XG4gICAgQmFzZVJlbmRlckxheWVyLnByb3RvdHlwZS5vbkdyaWRDaGFuZ2VkID0gZnVuY3Rpb24gKHRlcm1pbmFsLCBzdGFydFJvdywgZW5kUm93KSB7IH07XG4gICAgQmFzZVJlbmRlckxheWVyLnByb3RvdHlwZS5vblNlbGVjdGlvbkNoYW5nZWQgPSBmdW5jdGlvbiAodGVybWluYWwsIHN0YXJ0LCBlbmQsIGNvbHVtblNlbGVjdE1vZGUpIHtcbiAgICAgICAgaWYgKGNvbHVtblNlbGVjdE1vZGUgPT09IHZvaWQgMCkgeyBjb2x1bW5TZWxlY3RNb2RlID0gZmFsc2U7IH1cbiAgICB9O1xuICAgIEJhc2VSZW5kZXJMYXllci5wcm90b3R5cGUub25UaGVtZUNoYW5nZWQgPSBmdW5jdGlvbiAodGVybWluYWwsIGNvbG9yU2V0KSB7XG4gICAgICAgIHRoaXMuX3JlZnJlc2hDaGFyQXRsYXModGVybWluYWwsIGNvbG9yU2V0KTtcbiAgICB9O1xuICAgIEJhc2VSZW5kZXJMYXllci5wcm90b3R5cGUuc2V0VHJhbnNwYXJlbmN5ID0gZnVuY3Rpb24gKHRlcm1pbmFsLCBhbHBoYSkge1xuICAgICAgICBpZiAoYWxwaGEgPT09IHRoaXMuX2FscGhhKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG9sZENhbnZhcyA9IHRoaXMuX2NhbnZhcztcbiAgICAgICAgdGhpcy5fYWxwaGEgPSBhbHBoYTtcbiAgICAgICAgdGhpcy5fY2FudmFzID0gdGhpcy5fY2FudmFzLmNsb25lTm9kZSgpO1xuICAgICAgICB0aGlzLl9pbml0Q2FudmFzKCk7XG4gICAgICAgIHRoaXMuX2NvbnRhaW5lci5yZXBsYWNlQ2hpbGQodGhpcy5fY2FudmFzLCBvbGRDYW52YXMpO1xuICAgICAgICB0aGlzLl9yZWZyZXNoQ2hhckF0bGFzKHRlcm1pbmFsLCB0aGlzLl9jb2xvcnMpO1xuICAgICAgICB0aGlzLm9uR3JpZENoYW5nZWQodGVybWluYWwsIDAsIHRlcm1pbmFsLnJvd3MgLSAxKTtcbiAgICB9O1xuICAgIEJhc2VSZW5kZXJMYXllci5wcm90b3R5cGUuX3JlZnJlc2hDaGFyQXRsYXMgPSBmdW5jdGlvbiAodGVybWluYWwsIGNvbG9yU2V0KSB7XG4gICAgICAgIGlmICh0aGlzLl9zY2FsZWRDaGFyV2lkdGggPD0gMCAmJiB0aGlzLl9zY2FsZWRDaGFySGVpZ2h0IDw9IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9jaGFyQXRsYXMgPSBDaGFyQXRsYXNDYWNoZV8xLmFjcXVpcmVDaGFyQXRsYXModGVybWluYWwsIGNvbG9yU2V0LCB0aGlzLl9zY2FsZWRDaGFyV2lkdGgsIHRoaXMuX3NjYWxlZENoYXJIZWlnaHQpO1xuICAgICAgICB0aGlzLl9jaGFyQXRsYXMud2FybVVwKCk7XG4gICAgfTtcbiAgICBCYXNlUmVuZGVyTGF5ZXIucHJvdG90eXBlLnJlc2l6ZSA9IGZ1bmN0aW9uICh0ZXJtaW5hbCwgZGltKSB7XG4gICAgICAgIHRoaXMuX3NjYWxlZENlbGxXaWR0aCA9IGRpbS5zY2FsZWRDZWxsV2lkdGg7XG4gICAgICAgIHRoaXMuX3NjYWxlZENlbGxIZWlnaHQgPSBkaW0uc2NhbGVkQ2VsbEhlaWdodDtcbiAgICAgICAgdGhpcy5fc2NhbGVkQ2hhcldpZHRoID0gZGltLnNjYWxlZENoYXJXaWR0aDtcbiAgICAgICAgdGhpcy5fc2NhbGVkQ2hhckhlaWdodCA9IGRpbS5zY2FsZWRDaGFySGVpZ2h0O1xuICAgICAgICB0aGlzLl9zY2FsZWRDaGFyTGVmdCA9IGRpbS5zY2FsZWRDaGFyTGVmdDtcbiAgICAgICAgdGhpcy5fc2NhbGVkQ2hhclRvcCA9IGRpbS5zY2FsZWRDaGFyVG9wO1xuICAgICAgICB0aGlzLl9jYW52YXMud2lkdGggPSBkaW0uc2NhbGVkQ2FudmFzV2lkdGg7XG4gICAgICAgIHRoaXMuX2NhbnZhcy5oZWlnaHQgPSBkaW0uc2NhbGVkQ2FudmFzSGVpZ2h0O1xuICAgICAgICB0aGlzLl9jYW52YXMuc3R5bGUud2lkdGggPSBkaW0uY2FudmFzV2lkdGggKyBcInB4XCI7XG4gICAgICAgIHRoaXMuX2NhbnZhcy5zdHlsZS5oZWlnaHQgPSBkaW0uY2FudmFzSGVpZ2h0ICsgXCJweFwiO1xuICAgICAgICBpZiAoIXRoaXMuX2FscGhhKSB7XG4gICAgICAgICAgICB0aGlzLmNsZWFyQWxsKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fcmVmcmVzaENoYXJBdGxhcyh0ZXJtaW5hbCwgdGhpcy5fY29sb3JzKTtcbiAgICB9O1xuICAgIEJhc2VSZW5kZXJMYXllci5wcm90b3R5cGUuZmlsbENlbGxzID0gZnVuY3Rpb24gKHgsIHksIHdpZHRoLCBoZWlnaHQpIHtcbiAgICAgICAgdGhpcy5fY3R4LmZpbGxSZWN0KHggKiB0aGlzLl9zY2FsZWRDZWxsV2lkdGgsIHkgKiB0aGlzLl9zY2FsZWRDZWxsSGVpZ2h0LCB3aWR0aCAqIHRoaXMuX3NjYWxlZENlbGxXaWR0aCwgaGVpZ2h0ICogdGhpcy5fc2NhbGVkQ2VsbEhlaWdodCk7XG4gICAgfTtcbiAgICBCYXNlUmVuZGVyTGF5ZXIucHJvdG90eXBlLmZpbGxCb3R0b21MaW5lQXRDZWxscyA9IGZ1bmN0aW9uICh4LCB5LCB3aWR0aCkge1xuICAgICAgICBpZiAod2lkdGggPT09IHZvaWQgMCkgeyB3aWR0aCA9IDE7IH1cbiAgICAgICAgdGhpcy5fY3R4LmZpbGxSZWN0KHggKiB0aGlzLl9zY2FsZWRDZWxsV2lkdGgsICh5ICsgMSkgKiB0aGlzLl9zY2FsZWRDZWxsSGVpZ2h0IC0gd2luZG93LmRldmljZVBpeGVsUmF0aW8gLSAxLCB3aWR0aCAqIHRoaXMuX3NjYWxlZENlbGxXaWR0aCwgd2luZG93LmRldmljZVBpeGVsUmF0aW8pO1xuICAgIH07XG4gICAgQmFzZVJlbmRlckxheWVyLnByb3RvdHlwZS5maWxsTGVmdExpbmVBdENlbGwgPSBmdW5jdGlvbiAoeCwgeSkge1xuICAgICAgICB0aGlzLl9jdHguZmlsbFJlY3QoeCAqIHRoaXMuX3NjYWxlZENlbGxXaWR0aCwgeSAqIHRoaXMuX3NjYWxlZENlbGxIZWlnaHQsIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvLCB0aGlzLl9zY2FsZWRDZWxsSGVpZ2h0KTtcbiAgICB9O1xuICAgIEJhc2VSZW5kZXJMYXllci5wcm90b3R5cGUuc3Ryb2tlUmVjdEF0Q2VsbCA9IGZ1bmN0aW9uICh4LCB5LCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgIHRoaXMuX2N0eC5saW5lV2lkdGggPSB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbztcbiAgICAgICAgdGhpcy5fY3R4LnN0cm9rZVJlY3QoeCAqIHRoaXMuX3NjYWxlZENlbGxXaWR0aCArIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvIC8gMiwgeSAqIHRoaXMuX3NjYWxlZENlbGxIZWlnaHQgKyAod2luZG93LmRldmljZVBpeGVsUmF0aW8gLyAyKSwgd2lkdGggKiB0aGlzLl9zY2FsZWRDZWxsV2lkdGggLSB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbywgKGhlaWdodCAqIHRoaXMuX3NjYWxlZENlbGxIZWlnaHQpIC0gd2luZG93LmRldmljZVBpeGVsUmF0aW8pO1xuICAgIH07XG4gICAgQmFzZVJlbmRlckxheWVyLnByb3RvdHlwZS5jbGVhckFsbCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2FscGhhKSB7XG4gICAgICAgICAgICB0aGlzLl9jdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMuX2NhbnZhcy53aWR0aCwgdGhpcy5fY2FudmFzLmhlaWdodCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9jdHguZmlsbFN0eWxlID0gdGhpcy5fY29sb3JzLmJhY2tncm91bmQuY3NzO1xuICAgICAgICAgICAgdGhpcy5fY3R4LmZpbGxSZWN0KDAsIDAsIHRoaXMuX2NhbnZhcy53aWR0aCwgdGhpcy5fY2FudmFzLmhlaWdodCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEJhc2VSZW5kZXJMYXllci5wcm90b3R5cGUuY2xlYXJDZWxscyA9IGZ1bmN0aW9uICh4LCB5LCB3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgIGlmICh0aGlzLl9hbHBoYSkge1xuICAgICAgICAgICAgdGhpcy5fY3R4LmNsZWFyUmVjdCh4ICogdGhpcy5fc2NhbGVkQ2VsbFdpZHRoLCB5ICogdGhpcy5fc2NhbGVkQ2VsbEhlaWdodCwgd2lkdGggKiB0aGlzLl9zY2FsZWRDZWxsV2lkdGgsIGhlaWdodCAqIHRoaXMuX3NjYWxlZENlbGxIZWlnaHQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fY3R4LmZpbGxTdHlsZSA9IHRoaXMuX2NvbG9ycy5iYWNrZ3JvdW5kLmNzcztcbiAgICAgICAgICAgIHRoaXMuX2N0eC5maWxsUmVjdCh4ICogdGhpcy5fc2NhbGVkQ2VsbFdpZHRoLCB5ICogdGhpcy5fc2NhbGVkQ2VsbEhlaWdodCwgd2lkdGggKiB0aGlzLl9zY2FsZWRDZWxsV2lkdGgsIGhlaWdodCAqIHRoaXMuX3NjYWxlZENlbGxIZWlnaHQpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBCYXNlUmVuZGVyTGF5ZXIucHJvdG90eXBlLmZpbGxDaGFyVHJ1ZUNvbG9yID0gZnVuY3Rpb24gKHRlcm1pbmFsLCBjZWxsLCB4LCB5KSB7XG4gICAgICAgIHRoaXMuX2N0eC5mb250ID0gdGhpcy5fZ2V0Rm9udCh0ZXJtaW5hbCwgZmFsc2UsIGZhbHNlKTtcbiAgICAgICAgdGhpcy5fY3R4LnRleHRCYXNlbGluZSA9ICdtaWRkbGUnO1xuICAgICAgICB0aGlzLl9jbGlwUm93KHRlcm1pbmFsLCB5KTtcbiAgICAgICAgdGhpcy5fY3R4LmZpbGxUZXh0KGNlbGwuZ2V0Q2hhcnMoKSwgeCAqIHRoaXMuX3NjYWxlZENlbGxXaWR0aCArIHRoaXMuX3NjYWxlZENoYXJMZWZ0LCB5ICogdGhpcy5fc2NhbGVkQ2VsbEhlaWdodCArIHRoaXMuX3NjYWxlZENoYXJUb3AgKyB0aGlzLl9zY2FsZWRDaGFySGVpZ2h0IC8gMik7XG4gICAgfTtcbiAgICBCYXNlUmVuZGVyTGF5ZXIucHJvdG90eXBlLmRyYXdDaGFycyA9IGZ1bmN0aW9uICh0ZXJtaW5hbCwgY2VsbCwgeCwgeSkge1xuICAgICAgICBpZiAoY2VsbC5pc0ZnUkdCKCkgfHwgY2VsbC5pc0JnUkdCKCkpIHtcbiAgICAgICAgICAgIHRoaXMuX2RyYXdVbmNhY2hlZENoYXJzKHRlcm1pbmFsLCBjZWxsLCB4LCB5KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZmc7XG4gICAgICAgIHZhciBiZztcbiAgICAgICAgaWYgKGNlbGwuaXNJbnZlcnNlKCkpIHtcbiAgICAgICAgICAgIGZnID0gKGNlbGwuaXNCZ0RlZmF1bHQoKSkgPyBUeXBlc18yLklOVkVSVEVEX0RFRkFVTFRfQ09MT1IgOiBjZWxsLmdldEJnQ29sb3IoKTtcbiAgICAgICAgICAgIGJnID0gKGNlbGwuaXNGZ0RlZmF1bHQoKSkgPyBUeXBlc18yLklOVkVSVEVEX0RFRkFVTFRfQ09MT1IgOiBjZWxsLmdldEZnQ29sb3IoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGJnID0gKGNlbGwuaXNCZ0RlZmF1bHQoKSkgPyBUeXBlc18xLkRFRkFVTFRfQ09MT1IgOiBjZWxsLmdldEJnQ29sb3IoKTtcbiAgICAgICAgICAgIGZnID0gKGNlbGwuaXNGZ0RlZmF1bHQoKSkgPyBUeXBlc18xLkRFRkFVTFRfQ09MT1IgOiBjZWxsLmdldEZnQ29sb3IoKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZHJhd0luQnJpZ2h0Q29sb3IgPSB0ZXJtaW5hbC5vcHRpb25zLmRyYXdCb2xkVGV4dEluQnJpZ2h0Q29sb3JzICYmIGNlbGwuaXNCb2xkKCkgJiYgZmcgPCA4ICYmIGZnICE9PSBUeXBlc18yLklOVkVSVEVEX0RFRkFVTFRfQ09MT1I7XG4gICAgICAgIGZnICs9IGRyYXdJbkJyaWdodENvbG9yID8gOCA6IDA7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRHbHlwaElkZW50aWZpZXIuY2hhcnMgPSBjZWxsLmdldENoYXJzKCkgfHwgQnVmZmVyTGluZV8xLldISVRFU1BBQ0VfQ0VMTF9DSEFSO1xuICAgICAgICB0aGlzLl9jdXJyZW50R2x5cGhJZGVudGlmaWVyLmNvZGUgPSBjZWxsLmdldENvZGUoKSB8fCBCdWZmZXJMaW5lXzEuV0hJVEVTUEFDRV9DRUxMX0NPREU7XG4gICAgICAgIHRoaXMuX2N1cnJlbnRHbHlwaElkZW50aWZpZXIuYmcgPSBiZztcbiAgICAgICAgdGhpcy5fY3VycmVudEdseXBoSWRlbnRpZmllci5mZyA9IGZnO1xuICAgICAgICB0aGlzLl9jdXJyZW50R2x5cGhJZGVudGlmaWVyLmJvbGQgPSBjZWxsLmlzQm9sZCgpICYmIHRlcm1pbmFsLm9wdGlvbnMuZW5hYmxlQm9sZDtcbiAgICAgICAgdGhpcy5fY3VycmVudEdseXBoSWRlbnRpZmllci5kaW0gPSAhIWNlbGwuaXNEaW0oKTtcbiAgICAgICAgdGhpcy5fY3VycmVudEdseXBoSWRlbnRpZmllci5pdGFsaWMgPSAhIWNlbGwuaXNJdGFsaWMoKTtcbiAgICAgICAgdmFyIGF0bGFzRGlkRHJhdyA9IHRoaXMuX2NoYXJBdGxhcyAmJiB0aGlzLl9jaGFyQXRsYXMuZHJhdyh0aGlzLl9jdHgsIHRoaXMuX2N1cnJlbnRHbHlwaElkZW50aWZpZXIsIHggKiB0aGlzLl9zY2FsZWRDZWxsV2lkdGggKyB0aGlzLl9zY2FsZWRDaGFyTGVmdCwgeSAqIHRoaXMuX3NjYWxlZENlbGxIZWlnaHQgKyB0aGlzLl9zY2FsZWRDaGFyVG9wKTtcbiAgICAgICAgaWYgKCFhdGxhc0RpZERyYXcpIHtcbiAgICAgICAgICAgIHRoaXMuX2RyYXdVbmNhY2hlZENoYXJzKHRlcm1pbmFsLCBjZWxsLCB4LCB5KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQmFzZVJlbmRlckxheWVyLnByb3RvdHlwZS5fZHJhd1VuY2FjaGVkQ2hhcnMgPSBmdW5jdGlvbiAodGVybWluYWwsIGNlbGwsIHgsIHkpIHtcbiAgICAgICAgdGhpcy5fY3R4LnNhdmUoKTtcbiAgICAgICAgdGhpcy5fY3R4LmZvbnQgPSB0aGlzLl9nZXRGb250KHRlcm1pbmFsLCBjZWxsLmlzQm9sZCgpICYmIHRlcm1pbmFsLm9wdGlvbnMuZW5hYmxlQm9sZCwgISFjZWxsLmlzSXRhbGljKCkpO1xuICAgICAgICB0aGlzLl9jdHgudGV4dEJhc2VsaW5lID0gJ21pZGRsZSc7XG4gICAgICAgIGlmIChjZWxsLmlzSW52ZXJzZSgpKSB7XG4gICAgICAgICAgICBpZiAoY2VsbC5pc0JnRGVmYXVsdCgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3R4LmZpbGxTdHlsZSA9IHRoaXMuX2NvbG9ycy5iYWNrZ3JvdW5kLmNzcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNlbGwuaXNCZ1JHQigpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3R4LmZpbGxTdHlsZSA9IFwicmdiKFwiICsgQnVmZmVyTGluZV8xLkF0dHJpYnV0ZURhdGEudG9Db2xvclJHQihjZWxsLmdldEJnQ29sb3IoKSkuam9pbignLCcpICsgXCIpXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jdHguZmlsbFN0eWxlID0gdGhpcy5fY29sb3JzLmFuc2lbY2VsbC5nZXRCZ0NvbG9yKCldLmNzcztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChjZWxsLmlzRmdEZWZhdWx0KCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jdHguZmlsbFN0eWxlID0gdGhpcy5fY29sb3JzLmZvcmVncm91bmQuY3NzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY2VsbC5pc0ZnUkdCKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9jdHguZmlsbFN0eWxlID0gXCJyZ2IoXCIgKyBCdWZmZXJMaW5lXzEuQXR0cmlidXRlRGF0YS50b0NvbG9yUkdCKGNlbGwuZ2V0RmdDb2xvcigpKS5qb2luKCcsJykgKyBcIilcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBmZyA9IGNlbGwuZ2V0RmdDb2xvcigpO1xuICAgICAgICAgICAgICAgIGlmICh0ZXJtaW5hbC5vcHRpb25zLmRyYXdCb2xkVGV4dEluQnJpZ2h0Q29sb3JzICYmIGNlbGwuaXNCb2xkKCkgJiYgZmcgPCA4KSB7XG4gICAgICAgICAgICAgICAgICAgIGZnICs9IDg7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuX2N0eC5maWxsU3R5bGUgPSB0aGlzLl9jb2xvcnMuYW5zaVtmZ10uY3NzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2NsaXBSb3codGVybWluYWwsIHkpO1xuICAgICAgICBpZiAoY2VsbC5pc0RpbSgpKSB7XG4gICAgICAgICAgICB0aGlzLl9jdHguZ2xvYmFsQWxwaGEgPSBUeXBlc18yLkRJTV9PUEFDSVRZO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2N0eC5maWxsVGV4dChjZWxsLmdldENoYXJzKCksIHggKiB0aGlzLl9zY2FsZWRDZWxsV2lkdGggKyB0aGlzLl9zY2FsZWRDaGFyTGVmdCwgeSAqIHRoaXMuX3NjYWxlZENlbGxIZWlnaHQgKyB0aGlzLl9zY2FsZWRDaGFyVG9wICsgdGhpcy5fc2NhbGVkQ2hhckhlaWdodCAvIDIpO1xuICAgICAgICB0aGlzLl9jdHgucmVzdG9yZSgpO1xuICAgIH07XG4gICAgQmFzZVJlbmRlckxheWVyLnByb3RvdHlwZS5fY2xpcFJvdyA9IGZ1bmN0aW9uICh0ZXJtaW5hbCwgeSkge1xuICAgICAgICB0aGlzLl9jdHguYmVnaW5QYXRoKCk7XG4gICAgICAgIHRoaXMuX2N0eC5yZWN0KDAsIHkgKiB0aGlzLl9zY2FsZWRDZWxsSGVpZ2h0LCB0ZXJtaW5hbC5jb2xzICogdGhpcy5fc2NhbGVkQ2VsbFdpZHRoLCB0aGlzLl9zY2FsZWRDZWxsSGVpZ2h0KTtcbiAgICAgICAgdGhpcy5fY3R4LmNsaXAoKTtcbiAgICB9O1xuICAgIEJhc2VSZW5kZXJMYXllci5wcm90b3R5cGUuX2dldEZvbnQgPSBmdW5jdGlvbiAodGVybWluYWwsIGlzQm9sZCwgaXNJdGFsaWMpIHtcbiAgICAgICAgdmFyIGZvbnRXZWlnaHQgPSBpc0JvbGQgPyB0ZXJtaW5hbC5vcHRpb25zLmZvbnRXZWlnaHRCb2xkIDogdGVybWluYWwub3B0aW9ucy5mb250V2VpZ2h0O1xuICAgICAgICB2YXIgZm9udFN0eWxlID0gaXNJdGFsaWMgPyAnaXRhbGljJyA6ICcnO1xuICAgICAgICByZXR1cm4gZm9udFN0eWxlICsgXCIgXCIgKyBmb250V2VpZ2h0ICsgXCIgXCIgKyB0ZXJtaW5hbC5vcHRpb25zLmZvbnRTaXplICogd2luZG93LmRldmljZVBpeGVsUmF0aW8gKyBcInB4IFwiICsgdGVybWluYWwub3B0aW9ucy5mb250RmFtaWx5O1xuICAgIH07XG4gICAgcmV0dXJuIEJhc2VSZW5kZXJMYXllcjtcbn0oKSk7XG5leHBvcnRzLkJhc2VSZW5kZXJMYXllciA9IEJhc2VSZW5kZXJMYXllcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUJhc2VSZW5kZXJMYXllci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIEJ1ZmZlckxpbmVfMSA9IHJlcXVpcmUoXCIuLi9jb3JlL2J1ZmZlci9CdWZmZXJMaW5lXCIpO1xudmFyIEpvaW5lZENlbGxEYXRhID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoSm9pbmVkQ2VsbERhdGEsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gSm9pbmVkQ2VsbERhdGEoZmlyc3RDZWxsLCBjaGFycywgd2lkdGgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuY29udGVudCA9IDA7XG4gICAgICAgIF90aGlzLmNvbWJpbmVkRGF0YSA9ICcnO1xuICAgICAgICBfdGhpcy5mZyA9IGZpcnN0Q2VsbC5mZztcbiAgICAgICAgX3RoaXMuYmcgPSBmaXJzdENlbGwuYmc7XG4gICAgICAgIF90aGlzLmNvbWJpbmVkRGF0YSA9IGNoYXJzO1xuICAgICAgICBfdGhpcy5fd2lkdGggPSB3aWR0aDtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBKb2luZWRDZWxsRGF0YS5wcm90b3R5cGUuaXNDb21iaW5lZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIDIwOTcxNTI7XG4gICAgfTtcbiAgICBKb2luZWRDZWxsRGF0YS5wcm90b3R5cGUuZ2V0V2lkdGggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl93aWR0aDtcbiAgICB9O1xuICAgIEpvaW5lZENlbGxEYXRhLnByb3RvdHlwZS5nZXRDaGFycyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tYmluZWREYXRhO1xuICAgIH07XG4gICAgSm9pbmVkQ2VsbERhdGEucHJvdG90eXBlLmdldENvZGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAweDFGRkZGRjtcbiAgICB9O1xuICAgIEpvaW5lZENlbGxEYXRhLnByb3RvdHlwZS5zZXRGcm9tQ2hhckRhdGEgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdub3QgaW1wbGVtZW50ZWQnKTtcbiAgICB9O1xuICAgIEpvaW5lZENlbGxEYXRhLnByb3RvdHlwZS5nZXRBc0NoYXJEYXRhID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gW3RoaXMuZmcsIHRoaXMuZ2V0Q2hhcnMoKSwgdGhpcy5nZXRXaWR0aCgpLCB0aGlzLmdldENvZGUoKV07XG4gICAgfTtcbiAgICByZXR1cm4gSm9pbmVkQ2VsbERhdGE7XG59KEJ1ZmZlckxpbmVfMS5BdHRyaWJ1dGVEYXRhKSk7XG5leHBvcnRzLkpvaW5lZENlbGxEYXRhID0gSm9pbmVkQ2VsbERhdGE7XG52YXIgQ2hhcmFjdGVySm9pbmVyUmVnaXN0cnkgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIENoYXJhY3RlckpvaW5lclJlZ2lzdHJ5KF90ZXJtaW5hbCkge1xuICAgICAgICB0aGlzLl90ZXJtaW5hbCA9IF90ZXJtaW5hbDtcbiAgICAgICAgdGhpcy5fY2hhcmFjdGVySm9pbmVycyA9IFtdO1xuICAgICAgICB0aGlzLl9uZXh0Q2hhcmFjdGVySm9pbmVySWQgPSAwO1xuICAgICAgICB0aGlzLl93b3JrQ2VsbCA9IG5ldyBCdWZmZXJMaW5lXzEuQ2VsbERhdGEoKTtcbiAgICB9XG4gICAgQ2hhcmFjdGVySm9pbmVyUmVnaXN0cnkucHJvdG90eXBlLnJlZ2lzdGVyQ2hhcmFjdGVySm9pbmVyID0gZnVuY3Rpb24gKGhhbmRsZXIpIHtcbiAgICAgICAgdmFyIGpvaW5lciA9IHtcbiAgICAgICAgICAgIGlkOiB0aGlzLl9uZXh0Q2hhcmFjdGVySm9pbmVySWQrKyxcbiAgICAgICAgICAgIGhhbmRsZXI6IGhhbmRsZXJcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5fY2hhcmFjdGVySm9pbmVycy5wdXNoKGpvaW5lcik7XG4gICAgICAgIHJldHVybiBqb2luZXIuaWQ7XG4gICAgfTtcbiAgICBDaGFyYWN0ZXJKb2luZXJSZWdpc3RyeS5wcm90b3R5cGUuZGVyZWdpc3RlckNoYXJhY3RlckpvaW5lciA9IGZ1bmN0aW9uIChqb2luZXJJZCkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX2NoYXJhY3RlckpvaW5lcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9jaGFyYWN0ZXJKb2luZXJzW2ldLmlkID09PSBqb2luZXJJZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2NoYXJhY3RlckpvaW5lcnMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuICAgIENoYXJhY3RlckpvaW5lclJlZ2lzdHJ5LnByb3RvdHlwZS5nZXRKb2luZWRDaGFyYWN0ZXJzID0gZnVuY3Rpb24gKHJvdykge1xuICAgICAgICBpZiAodGhpcy5fY2hhcmFjdGVySm9pbmVycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbGluZSA9IHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci5saW5lcy5nZXQocm93KTtcbiAgICAgICAgaWYgKGxpbmUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHJhbmdlcyA9IFtdO1xuICAgICAgICB2YXIgbGluZVN0ciA9IGxpbmUudHJhbnNsYXRlVG9TdHJpbmcodHJ1ZSk7XG4gICAgICAgIHZhciByYW5nZVN0YXJ0Q29sdW1uID0gMDtcbiAgICAgICAgdmFyIGN1cnJlbnRTdHJpbmdJbmRleCA9IDA7XG4gICAgICAgIHZhciByYW5nZVN0YXJ0U3RyaW5nSW5kZXggPSAwO1xuICAgICAgICB2YXIgcmFuZ2VBdHRyRkcgPSBsaW5lLmdldEZnKDApO1xuICAgICAgICB2YXIgcmFuZ2VBdHRyQkcgPSBsaW5lLmdldEJnKDApO1xuICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IGxpbmUuZ2V0VHJpbW1lZExlbmd0aCgpOyB4KyspIHtcbiAgICAgICAgICAgIGxpbmUubG9hZENlbGwoeCwgdGhpcy5fd29ya0NlbGwpO1xuICAgICAgICAgICAgaWYgKHRoaXMuX3dvcmtDZWxsLmdldFdpZHRoKCkgPT09IDApIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLl93b3JrQ2VsbC5mZyAhPT0gcmFuZ2VBdHRyRkcgfHwgdGhpcy5fd29ya0NlbGwuYmcgIT09IHJhbmdlQXR0ckJHKSB7XG4gICAgICAgICAgICAgICAgaWYgKHggLSByYW5nZVN0YXJ0Q29sdW1uID4gMSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgam9pbmVkUmFuZ2VzID0gdGhpcy5fZ2V0Sm9pbmVkUmFuZ2VzKGxpbmVTdHIsIHJhbmdlU3RhcnRTdHJpbmdJbmRleCwgY3VycmVudFN0cmluZ0luZGV4LCBsaW5lLCByYW5nZVN0YXJ0Q29sdW1uKTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBqb2luZWRSYW5nZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJhbmdlcy5wdXNoKGpvaW5lZFJhbmdlc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmFuZ2VTdGFydENvbHVtbiA9IHg7XG4gICAgICAgICAgICAgICAgcmFuZ2VTdGFydFN0cmluZ0luZGV4ID0gY3VycmVudFN0cmluZ0luZGV4O1xuICAgICAgICAgICAgICAgIHJhbmdlQXR0ckZHID0gdGhpcy5fd29ya0NlbGwuZmc7XG4gICAgICAgICAgICAgICAgcmFuZ2VBdHRyQkcgPSB0aGlzLl93b3JrQ2VsbC5iZztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGN1cnJlbnRTdHJpbmdJbmRleCArPSB0aGlzLl93b3JrQ2VsbC5nZXRDaGFycygpLmxlbmd0aCB8fCBCdWZmZXJMaW5lXzEuV0hJVEVTUEFDRV9DRUxMX0NIQVIubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl90ZXJtaW5hbC5jb2xzIC0gcmFuZ2VTdGFydENvbHVtbiA+IDEpIHtcbiAgICAgICAgICAgIHZhciBqb2luZWRSYW5nZXMgPSB0aGlzLl9nZXRKb2luZWRSYW5nZXMobGluZVN0ciwgcmFuZ2VTdGFydFN0cmluZ0luZGV4LCBjdXJyZW50U3RyaW5nSW5kZXgsIGxpbmUsIHJhbmdlU3RhcnRDb2x1bW4pO1xuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBqb2luZWRSYW5nZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICByYW5nZXMucHVzaChqb2luZWRSYW5nZXNbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByYW5nZXM7XG4gICAgfTtcbiAgICBDaGFyYWN0ZXJKb2luZXJSZWdpc3RyeS5wcm90b3R5cGUuX2dldEpvaW5lZFJhbmdlcyA9IGZ1bmN0aW9uIChsaW5lLCBzdGFydEluZGV4LCBlbmRJbmRleCwgbGluZURhdGEsIHN0YXJ0Q29sKSB7XG4gICAgICAgIHZhciB0ZXh0ID0gbGluZS5zdWJzdHJpbmcoc3RhcnRJbmRleCwgZW5kSW5kZXgpO1xuICAgICAgICB2YXIgam9pbmVkUmFuZ2VzID0gdGhpcy5fY2hhcmFjdGVySm9pbmVyc1swXS5oYW5kbGVyKHRleHQpO1xuICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IHRoaXMuX2NoYXJhY3RlckpvaW5lcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBqb2luZXJSYW5nZXMgPSB0aGlzLl9jaGFyYWN0ZXJKb2luZXJzW2ldLmhhbmRsZXIodGV4dCk7XG4gICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGpvaW5lclJhbmdlcy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgIENoYXJhY3RlckpvaW5lclJlZ2lzdHJ5Ll9tZXJnZVJhbmdlcyhqb2luZWRSYW5nZXMsIGpvaW5lclJhbmdlc1tqXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fc3RyaW5nUmFuZ2VzVG9DZWxsUmFuZ2VzKGpvaW5lZFJhbmdlcywgbGluZURhdGEsIHN0YXJ0Q29sKTtcbiAgICAgICAgcmV0dXJuIGpvaW5lZFJhbmdlcztcbiAgICB9O1xuICAgIENoYXJhY3RlckpvaW5lclJlZ2lzdHJ5LnByb3RvdHlwZS5fc3RyaW5nUmFuZ2VzVG9DZWxsUmFuZ2VzID0gZnVuY3Rpb24gKHJhbmdlcywgbGluZSwgc3RhcnRDb2wpIHtcbiAgICAgICAgdmFyIGN1cnJlbnRSYW5nZUluZGV4ID0gMDtcbiAgICAgICAgdmFyIGN1cnJlbnRSYW5nZVN0YXJ0ZWQgPSBmYWxzZTtcbiAgICAgICAgdmFyIGN1cnJlbnRTdHJpbmdJbmRleCA9IDA7XG4gICAgICAgIHZhciBjdXJyZW50UmFuZ2UgPSByYW5nZXNbY3VycmVudFJhbmdlSW5kZXhdO1xuICAgICAgICBpZiAoIWN1cnJlbnRSYW5nZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGZvciAodmFyIHggPSBzdGFydENvbDsgeCA8IHRoaXMuX3Rlcm1pbmFsLmNvbHM7IHgrKykge1xuICAgICAgICAgICAgdmFyIHdpZHRoID0gbGluZS5nZXRXaWR0aCh4KTtcbiAgICAgICAgICAgIHZhciBsZW5ndGhfMSA9IGxpbmUuZ2V0U3RyaW5nKHgpLmxlbmd0aCB8fCBCdWZmZXJMaW5lXzEuV0hJVEVTUEFDRV9DRUxMX0NIQVIubGVuZ3RoO1xuICAgICAgICAgICAgaWYgKHdpZHRoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWN1cnJlbnRSYW5nZVN0YXJ0ZWQgJiYgY3VycmVudFJhbmdlWzBdIDw9IGN1cnJlbnRTdHJpbmdJbmRleCkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRSYW5nZVswXSA9IHg7XG4gICAgICAgICAgICAgICAgY3VycmVudFJhbmdlU3RhcnRlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY3VycmVudFJhbmdlWzFdIDw9IGN1cnJlbnRTdHJpbmdJbmRleCkge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRSYW5nZVsxXSA9IHg7XG4gICAgICAgICAgICAgICAgY3VycmVudFJhbmdlID0gcmFuZ2VzWysrY3VycmVudFJhbmdlSW5kZXhdO1xuICAgICAgICAgICAgICAgIGlmICghY3VycmVudFJhbmdlKSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFJhbmdlWzBdIDw9IGN1cnJlbnRTdHJpbmdJbmRleCkge1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50UmFuZ2VbMF0gPSB4O1xuICAgICAgICAgICAgICAgICAgICBjdXJyZW50UmFuZ2VTdGFydGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGN1cnJlbnRSYW5nZVN0YXJ0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjdXJyZW50U3RyaW5nSW5kZXggKz0gbGVuZ3RoXzE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGN1cnJlbnRSYW5nZSkge1xuICAgICAgICAgICAgY3VycmVudFJhbmdlWzFdID0gdGhpcy5fdGVybWluYWwuY29scztcbiAgICAgICAgfVxuICAgIH07XG4gICAgQ2hhcmFjdGVySm9pbmVyUmVnaXN0cnkuX21lcmdlUmFuZ2VzID0gZnVuY3Rpb24gKHJhbmdlcywgbmV3UmFuZ2UpIHtcbiAgICAgICAgdmFyIGluUmFuZ2UgPSBmYWxzZTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciByYW5nZSA9IHJhbmdlc1tpXTtcbiAgICAgICAgICAgIGlmICghaW5SYW5nZSkge1xuICAgICAgICAgICAgICAgIGlmIChuZXdSYW5nZVsxXSA8PSByYW5nZVswXSkge1xuICAgICAgICAgICAgICAgICAgICByYW5nZXMuc3BsaWNlKGksIDAsIG5ld1JhbmdlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJhbmdlcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG5ld1JhbmdlWzFdIDw9IHJhbmdlWzFdKSB7XG4gICAgICAgICAgICAgICAgICAgIHJhbmdlWzBdID0gTWF0aC5taW4obmV3UmFuZ2VbMF0sIHJhbmdlWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJhbmdlcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKG5ld1JhbmdlWzBdIDwgcmFuZ2VbMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2VbMF0gPSBNYXRoLm1pbihuZXdSYW5nZVswXSwgcmFuZ2VbMF0pO1xuICAgICAgICAgICAgICAgICAgICBpblJhbmdlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAobmV3UmFuZ2VbMV0gPD0gcmFuZ2VbMF0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2VzW2kgLSAxXVsxXSA9IG5ld1JhbmdlWzFdO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmFuZ2VzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAobmV3UmFuZ2VbMV0gPD0gcmFuZ2VbMV0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmFuZ2VzW2kgLSAxXVsxXSA9IE1hdGgubWF4KG5ld1JhbmdlWzFdLCByYW5nZVsxXSk7XG4gICAgICAgICAgICAgICAgICAgIHJhbmdlcy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgICAgIGluUmFuZ2UgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJhbmdlcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmFuZ2VzLnNwbGljZShpLCAxKTtcbiAgICAgICAgICAgICAgICBpLS07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGluUmFuZ2UpIHtcbiAgICAgICAgICAgIHJhbmdlc1tyYW5nZXMubGVuZ3RoIC0gMV1bMV0gPSBuZXdSYW5nZVsxXTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJhbmdlcy5wdXNoKG5ld1JhbmdlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmFuZ2VzO1xuICAgIH07XG4gICAgcmV0dXJuIENoYXJhY3RlckpvaW5lclJlZ2lzdHJ5O1xufSgpKTtcbmV4cG9ydHMuQ2hhcmFjdGVySm9pbmVyUmVnaXN0cnkgPSBDaGFyYWN0ZXJKb2luZXJSZWdpc3RyeTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUNoYXJhY3RlckpvaW5lclJlZ2lzdHJ5LmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIERFRkFVTFRfRk9SRUdST1VORCA9IGZyb21IZXgoJyNmZmZmZmYnKTtcbnZhciBERUZBVUxUX0JBQ0tHUk9VTkQgPSBmcm9tSGV4KCcjMDAwMDAwJyk7XG52YXIgREVGQVVMVF9DVVJTT1IgPSBmcm9tSGV4KCcjZmZmZmZmJyk7XG52YXIgREVGQVVMVF9DVVJTT1JfQUNDRU5UID0gZnJvbUhleCgnIzAwMDAwMCcpO1xudmFyIERFRkFVTFRfU0VMRUNUSU9OID0ge1xuICAgIGNzczogJ3JnYmEoMjU1LCAyNTUsIDI1NSwgMC4zKScsXG4gICAgcmdiYTogMHhGRkZGRkY3N1xufTtcbmV4cG9ydHMuREVGQVVMVF9BTlNJX0NPTE9SUyA9IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGNvbG9ycyA9IFtcbiAgICAgICAgZnJvbUhleCgnIzJlMzQzNicpLFxuICAgICAgICBmcm9tSGV4KCcjY2MwMDAwJyksXG4gICAgICAgIGZyb21IZXgoJyM0ZTlhMDYnKSxcbiAgICAgICAgZnJvbUhleCgnI2M0YTAwMCcpLFxuICAgICAgICBmcm9tSGV4KCcjMzQ2NWE0JyksXG4gICAgICAgIGZyb21IZXgoJyM3NTUwN2InKSxcbiAgICAgICAgZnJvbUhleCgnIzA2OTg5YScpLFxuICAgICAgICBmcm9tSGV4KCcjZDNkN2NmJyksXG4gICAgICAgIGZyb21IZXgoJyM1NTU3NTMnKSxcbiAgICAgICAgZnJvbUhleCgnI2VmMjkyOScpLFxuICAgICAgICBmcm9tSGV4KCcjOGFlMjM0JyksXG4gICAgICAgIGZyb21IZXgoJyNmY2U5NGYnKSxcbiAgICAgICAgZnJvbUhleCgnIzcyOWZjZicpLFxuICAgICAgICBmcm9tSGV4KCcjYWQ3ZmE4JyksXG4gICAgICAgIGZyb21IZXgoJyMzNGUyZTInKSxcbiAgICAgICAgZnJvbUhleCgnI2VlZWVlYycpXG4gICAgXTtcbiAgICB2YXIgdiA9IFsweDAwLCAweDVmLCAweDg3LCAweGFmLCAweGQ3LCAweGZmXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDIxNjsgaSsrKSB7XG4gICAgICAgIHZhciByID0gdlsoaSAvIDM2KSAlIDYgfCAwXTtcbiAgICAgICAgdmFyIGcgPSB2WyhpIC8gNikgJSA2IHwgMF07XG4gICAgICAgIHZhciBiID0gdltpICUgNl07XG4gICAgICAgIGNvbG9ycy5wdXNoKHtcbiAgICAgICAgICAgIGNzczogXCIjXCIgKyB0b1BhZGRlZEhleChyKSArIHRvUGFkZGVkSGV4KGcpICsgdG9QYWRkZWRIZXgoYiksXG4gICAgICAgICAgICByZ2JhOiAoKHIgPDwgMjQpIHwgKGcgPDwgMTYpIHwgKGIgPDwgOCkgfCAweEZGKSA+Pj4gMFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyNDsgaSsrKSB7XG4gICAgICAgIHZhciBjID0gOCArIGkgKiAxMDtcbiAgICAgICAgdmFyIGNoID0gdG9QYWRkZWRIZXgoYyk7XG4gICAgICAgIGNvbG9ycy5wdXNoKHtcbiAgICAgICAgICAgIGNzczogXCIjXCIgKyBjaCArIGNoICsgY2gsXG4gICAgICAgICAgICByZ2JhOiAoKGMgPDwgMjQpIHwgKGMgPDwgMTYpIHwgKGMgPDwgOCkgfCAweEZGKSA+Pj4gMFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbG9ycztcbn0pKCk7XG5mdW5jdGlvbiBmcm9tSGV4KGNzcykge1xuICAgIHJldHVybiB7XG4gICAgICAgIGNzczogY3NzLFxuICAgICAgICByZ2JhOiBwYXJzZUludChjc3Muc2xpY2UoMSksIDE2KSA8PCA4IHwgMHhGRlxuICAgIH07XG59XG5mdW5jdGlvbiB0b1BhZGRlZEhleChjKSB7XG4gICAgdmFyIHMgPSBjLnRvU3RyaW5nKDE2KTtcbiAgICByZXR1cm4gcy5sZW5ndGggPCAyID8gJzAnICsgcyA6IHM7XG59XG52YXIgQ29sb3JNYW5hZ2VyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBDb2xvck1hbmFnZXIoZG9jdW1lbnQsIGFsbG93VHJhbnNwYXJlbmN5KSB7XG4gICAgICAgIHRoaXMuYWxsb3dUcmFuc3BhcmVuY3kgPSBhbGxvd1RyYW5zcGFyZW5jeTtcbiAgICAgICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgICAgICBjYW52YXMud2lkdGggPSAxO1xuICAgICAgICBjYW52YXMuaGVpZ2h0ID0gMTtcbiAgICAgICAgdGhpcy5fY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgIHRoaXMuX2N0eC5nbG9iYWxDb21wb3NpdGVPcGVyYXRpb24gPSAnY29weSc7XG4gICAgICAgIHRoaXMuX2xpdG11c0NvbG9yID0gdGhpcy5fY3R4LmNyZWF0ZUxpbmVhckdyYWRpZW50KDAsIDAsIDEsIDEpO1xuICAgICAgICB0aGlzLmNvbG9ycyA9IHtcbiAgICAgICAgICAgIGZvcmVncm91bmQ6IERFRkFVTFRfRk9SRUdST1VORCxcbiAgICAgICAgICAgIGJhY2tncm91bmQ6IERFRkFVTFRfQkFDS0dST1VORCxcbiAgICAgICAgICAgIGN1cnNvcjogREVGQVVMVF9DVVJTT1IsXG4gICAgICAgICAgICBjdXJzb3JBY2NlbnQ6IERFRkFVTFRfQ1VSU09SX0FDQ0VOVCxcbiAgICAgICAgICAgIHNlbGVjdGlvbjogREVGQVVMVF9TRUxFQ1RJT04sXG4gICAgICAgICAgICBhbnNpOiBleHBvcnRzLkRFRkFVTFRfQU5TSV9DT0xPUlMuc2xpY2UoKVxuICAgICAgICB9O1xuICAgIH1cbiAgICBDb2xvck1hbmFnZXIucHJvdG90eXBlLnNldFRoZW1lID0gZnVuY3Rpb24gKHRoZW1lKSB7XG4gICAgICAgIHRoaXMuY29sb3JzLmZvcmVncm91bmQgPSB0aGlzLl9wYXJzZUNvbG9yKHRoZW1lLmZvcmVncm91bmQsIERFRkFVTFRfRk9SRUdST1VORCk7XG4gICAgICAgIHRoaXMuY29sb3JzLmJhY2tncm91bmQgPSB0aGlzLl9wYXJzZUNvbG9yKHRoZW1lLmJhY2tncm91bmQsIERFRkFVTFRfQkFDS0dST1VORCk7XG4gICAgICAgIHRoaXMuY29sb3JzLmN1cnNvciA9IHRoaXMuX3BhcnNlQ29sb3IodGhlbWUuY3Vyc29yLCBERUZBVUxUX0NVUlNPUiwgdHJ1ZSk7XG4gICAgICAgIHRoaXMuY29sb3JzLmN1cnNvckFjY2VudCA9IHRoaXMuX3BhcnNlQ29sb3IodGhlbWUuY3Vyc29yQWNjZW50LCBERUZBVUxUX0NVUlNPUl9BQ0NFTlQsIHRydWUpO1xuICAgICAgICB0aGlzLmNvbG9ycy5zZWxlY3Rpb24gPSB0aGlzLl9wYXJzZUNvbG9yKHRoZW1lLnNlbGVjdGlvbiwgREVGQVVMVF9TRUxFQ1RJT04sIHRydWUpO1xuICAgICAgICB0aGlzLmNvbG9ycy5hbnNpWzBdID0gdGhpcy5fcGFyc2VDb2xvcih0aGVtZS5ibGFjaywgZXhwb3J0cy5ERUZBVUxUX0FOU0lfQ09MT1JTWzBdKTtcbiAgICAgICAgdGhpcy5jb2xvcnMuYW5zaVsxXSA9IHRoaXMuX3BhcnNlQ29sb3IodGhlbWUucmVkLCBleHBvcnRzLkRFRkFVTFRfQU5TSV9DT0xPUlNbMV0pO1xuICAgICAgICB0aGlzLmNvbG9ycy5hbnNpWzJdID0gdGhpcy5fcGFyc2VDb2xvcih0aGVtZS5ncmVlbiwgZXhwb3J0cy5ERUZBVUxUX0FOU0lfQ09MT1JTWzJdKTtcbiAgICAgICAgdGhpcy5jb2xvcnMuYW5zaVszXSA9IHRoaXMuX3BhcnNlQ29sb3IodGhlbWUueWVsbG93LCBleHBvcnRzLkRFRkFVTFRfQU5TSV9DT0xPUlNbM10pO1xuICAgICAgICB0aGlzLmNvbG9ycy5hbnNpWzRdID0gdGhpcy5fcGFyc2VDb2xvcih0aGVtZS5ibHVlLCBleHBvcnRzLkRFRkFVTFRfQU5TSV9DT0xPUlNbNF0pO1xuICAgICAgICB0aGlzLmNvbG9ycy5hbnNpWzVdID0gdGhpcy5fcGFyc2VDb2xvcih0aGVtZS5tYWdlbnRhLCBleHBvcnRzLkRFRkFVTFRfQU5TSV9DT0xPUlNbNV0pO1xuICAgICAgICB0aGlzLmNvbG9ycy5hbnNpWzZdID0gdGhpcy5fcGFyc2VDb2xvcih0aGVtZS5jeWFuLCBleHBvcnRzLkRFRkFVTFRfQU5TSV9DT0xPUlNbNl0pO1xuICAgICAgICB0aGlzLmNvbG9ycy5hbnNpWzddID0gdGhpcy5fcGFyc2VDb2xvcih0aGVtZS53aGl0ZSwgZXhwb3J0cy5ERUZBVUxUX0FOU0lfQ09MT1JTWzddKTtcbiAgICAgICAgdGhpcy5jb2xvcnMuYW5zaVs4XSA9IHRoaXMuX3BhcnNlQ29sb3IodGhlbWUuYnJpZ2h0QmxhY2ssIGV4cG9ydHMuREVGQVVMVF9BTlNJX0NPTE9SU1s4XSk7XG4gICAgICAgIHRoaXMuY29sb3JzLmFuc2lbOV0gPSB0aGlzLl9wYXJzZUNvbG9yKHRoZW1lLmJyaWdodFJlZCwgZXhwb3J0cy5ERUZBVUxUX0FOU0lfQ09MT1JTWzldKTtcbiAgICAgICAgdGhpcy5jb2xvcnMuYW5zaVsxMF0gPSB0aGlzLl9wYXJzZUNvbG9yKHRoZW1lLmJyaWdodEdyZWVuLCBleHBvcnRzLkRFRkFVTFRfQU5TSV9DT0xPUlNbMTBdKTtcbiAgICAgICAgdGhpcy5jb2xvcnMuYW5zaVsxMV0gPSB0aGlzLl9wYXJzZUNvbG9yKHRoZW1lLmJyaWdodFllbGxvdywgZXhwb3J0cy5ERUZBVUxUX0FOU0lfQ09MT1JTWzExXSk7XG4gICAgICAgIHRoaXMuY29sb3JzLmFuc2lbMTJdID0gdGhpcy5fcGFyc2VDb2xvcih0aGVtZS5icmlnaHRCbHVlLCBleHBvcnRzLkRFRkFVTFRfQU5TSV9DT0xPUlNbMTJdKTtcbiAgICAgICAgdGhpcy5jb2xvcnMuYW5zaVsxM10gPSB0aGlzLl9wYXJzZUNvbG9yKHRoZW1lLmJyaWdodE1hZ2VudGEsIGV4cG9ydHMuREVGQVVMVF9BTlNJX0NPTE9SU1sxM10pO1xuICAgICAgICB0aGlzLmNvbG9ycy5hbnNpWzE0XSA9IHRoaXMuX3BhcnNlQ29sb3IodGhlbWUuYnJpZ2h0Q3lhbiwgZXhwb3J0cy5ERUZBVUxUX0FOU0lfQ09MT1JTWzE0XSk7XG4gICAgICAgIHRoaXMuY29sb3JzLmFuc2lbMTVdID0gdGhpcy5fcGFyc2VDb2xvcih0aGVtZS5icmlnaHRXaGl0ZSwgZXhwb3J0cy5ERUZBVUxUX0FOU0lfQ09MT1JTWzE1XSk7XG4gICAgfTtcbiAgICBDb2xvck1hbmFnZXIucHJvdG90eXBlLl9wYXJzZUNvbG9yID0gZnVuY3Rpb24gKGNzcywgZmFsbGJhY2ssIGFsbG93VHJhbnNwYXJlbmN5KSB7XG4gICAgICAgIGlmIChhbGxvd1RyYW5zcGFyZW5jeSA9PT0gdm9pZCAwKSB7IGFsbG93VHJhbnNwYXJlbmN5ID0gdGhpcy5hbGxvd1RyYW5zcGFyZW5jeTsgfVxuICAgICAgICBpZiAoIWNzcykge1xuICAgICAgICAgICAgcmV0dXJuIGZhbGxiYWNrO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2N0eC5maWxsU3R5bGUgPSB0aGlzLl9saXRtdXNDb2xvcjtcbiAgICAgICAgdGhpcy5fY3R4LmZpbGxTdHlsZSA9IGNzcztcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLl9jdHguZmlsbFN0eWxlICE9PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKFwiQ29sb3I6IFwiICsgY3NzICsgXCIgaXMgaW52YWxpZCB1c2luZyBmYWxsYmFjayBcIiArIGZhbGxiYWNrLmNzcyk7XG4gICAgICAgICAgICByZXR1cm4gZmFsbGJhY2s7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fY3R4LmZpbGxSZWN0KDAsIDAsIDEsIDEpO1xuICAgICAgICB2YXIgZGF0YSA9IHRoaXMuX2N0eC5nZXRJbWFnZURhdGEoMCwgMCwgMSwgMSkuZGF0YTtcbiAgICAgICAgaWYgKCFhbGxvd1RyYW5zcGFyZW5jeSAmJiBkYXRhWzNdICE9PSAweEZGKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXCJDb2xvcjogXCIgKyBjc3MgKyBcIiBpcyB1c2luZyB0cmFuc3BhcmVuY3ksIGJ1dCBhbGxvd1RyYW5zcGFyZW5jeSBpcyBmYWxzZS4gXCIgK1xuICAgICAgICAgICAgICAgIChcIlVzaW5nIGZhbGxiYWNrIFwiICsgZmFsbGJhY2suY3NzICsgXCIuXCIpKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxsYmFjaztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY3NzOiBjc3MsXG4gICAgICAgICAgICByZ2JhOiAoZGF0YVswXSA8PCAyNCB8IGRhdGFbMV0gPDwgMTYgfCBkYXRhWzJdIDw8IDggfCBkYXRhWzNdKSA+Pj4gMFxuICAgICAgICB9O1xuICAgIH07XG4gICAgcmV0dXJuIENvbG9yTWFuYWdlcjtcbn0oKSk7XG5leHBvcnRzLkNvbG9yTWFuYWdlciA9IENvbG9yTWFuYWdlcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUNvbG9yTWFuYWdlci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIEJhc2VSZW5kZXJMYXllcl8xID0gcmVxdWlyZShcIi4vQmFzZVJlbmRlckxheWVyXCIpO1xudmFyIEJ1ZmZlckxpbmVfMSA9IHJlcXVpcmUoXCIuLi9jb3JlL2J1ZmZlci9CdWZmZXJMaW5lXCIpO1xudmFyIEJMSU5LX0lOVEVSVkFMID0gNjAwO1xudmFyIEN1cnNvclJlbmRlckxheWVyID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoQ3Vyc29yUmVuZGVyTGF5ZXIsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gQ3Vyc29yUmVuZGVyTGF5ZXIoY29udGFpbmVyLCB6SW5kZXgsIGNvbG9ycykge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBjb250YWluZXIsICdjdXJzb3InLCB6SW5kZXgsIHRydWUsIGNvbG9ycykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuX2NlbGwgPSBuZXcgQnVmZmVyTGluZV8xLkNlbGxEYXRhKCk7XG4gICAgICAgIF90aGlzLl9zdGF0ZSA9IHtcbiAgICAgICAgICAgIHg6IG51bGwsXG4gICAgICAgICAgICB5OiBudWxsLFxuICAgICAgICAgICAgaXNGb2N1c2VkOiBudWxsLFxuICAgICAgICAgICAgc3R5bGU6IG51bGwsXG4gICAgICAgICAgICB3aWR0aDogbnVsbFxuICAgICAgICB9O1xuICAgICAgICBfdGhpcy5fY3Vyc29yUmVuZGVyZXJzID0ge1xuICAgICAgICAgICAgJ2Jhcic6IF90aGlzLl9yZW5kZXJCYXJDdXJzb3IuYmluZChfdGhpcyksXG4gICAgICAgICAgICAnYmxvY2snOiBfdGhpcy5fcmVuZGVyQmxvY2tDdXJzb3IuYmluZChfdGhpcyksXG4gICAgICAgICAgICAndW5kZXJsaW5lJzogX3RoaXMuX3JlbmRlclVuZGVybGluZUN1cnNvci5iaW5kKF90aGlzKVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIEN1cnNvclJlbmRlckxheWVyLnByb3RvdHlwZS5yZXNpemUgPSBmdW5jdGlvbiAodGVybWluYWwsIGRpbSkge1xuICAgICAgICBfc3VwZXIucHJvdG90eXBlLnJlc2l6ZS5jYWxsKHRoaXMsIHRlcm1pbmFsLCBkaW0pO1xuICAgICAgICB0aGlzLl9zdGF0ZSA9IHtcbiAgICAgICAgICAgIHg6IG51bGwsXG4gICAgICAgICAgICB5OiBudWxsLFxuICAgICAgICAgICAgaXNGb2N1c2VkOiBudWxsLFxuICAgICAgICAgICAgc3R5bGU6IG51bGwsXG4gICAgICAgICAgICB3aWR0aDogbnVsbFxuICAgICAgICB9O1xuICAgIH07XG4gICAgQ3Vyc29yUmVuZGVyTGF5ZXIucHJvdG90eXBlLnJlc2V0ID0gZnVuY3Rpb24gKHRlcm1pbmFsKSB7XG4gICAgICAgIHRoaXMuX2NsZWFyQ3Vyc29yKCk7XG4gICAgICAgIGlmICh0aGlzLl9jdXJzb3JCbGlua1N0YXRlTWFuYWdlcikge1xuICAgICAgICAgICAgdGhpcy5fY3Vyc29yQmxpbmtTdGF0ZU1hbmFnZXIuZGlzcG9zZSgpO1xuICAgICAgICAgICAgdGhpcy5fY3Vyc29yQmxpbmtTdGF0ZU1hbmFnZXIgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5vbk9wdGlvbnNDaGFuZ2VkKHRlcm1pbmFsKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQ3Vyc29yUmVuZGVyTGF5ZXIucHJvdG90eXBlLm9uQmx1ciA9IGZ1bmN0aW9uICh0ZXJtaW5hbCkge1xuICAgICAgICBpZiAodGhpcy5fY3Vyc29yQmxpbmtTdGF0ZU1hbmFnZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX2N1cnNvckJsaW5rU3RhdGVNYW5hZ2VyLnBhdXNlKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGVybWluYWwucmVmcmVzaCh0ZXJtaW5hbC5idWZmZXIueSwgdGVybWluYWwuYnVmZmVyLnkpO1xuICAgIH07XG4gICAgQ3Vyc29yUmVuZGVyTGF5ZXIucHJvdG90eXBlLm9uRm9jdXMgPSBmdW5jdGlvbiAodGVybWluYWwpIHtcbiAgICAgICAgaWYgKHRoaXMuX2N1cnNvckJsaW5rU3RhdGVNYW5hZ2VyKSB7XG4gICAgICAgICAgICB0aGlzLl9jdXJzb3JCbGlua1N0YXRlTWFuYWdlci5yZXN1bWUodGVybWluYWwpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGVybWluYWwucmVmcmVzaCh0ZXJtaW5hbC5idWZmZXIueSwgdGVybWluYWwuYnVmZmVyLnkpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBDdXJzb3JSZW5kZXJMYXllci5wcm90b3R5cGUub25PcHRpb25zQ2hhbmdlZCA9IGZ1bmN0aW9uICh0ZXJtaW5hbCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodGVybWluYWwub3B0aW9ucy5jdXJzb3JCbGluaykge1xuICAgICAgICAgICAgaWYgKCF0aGlzLl9jdXJzb3JCbGlua1N0YXRlTWFuYWdlcikge1xuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnNvckJsaW5rU3RhdGVNYW5hZ2VyID0gbmV3IEN1cnNvckJsaW5rU3RhdGVNYW5hZ2VyKHRlcm1pbmFsLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLl9yZW5kZXIodGVybWluYWwsIHRydWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2N1cnNvckJsaW5rU3RhdGVNYW5hZ2VyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fY3Vyc29yQmxpbmtTdGF0ZU1hbmFnZXIuZGlzcG9zZSgpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2N1cnNvckJsaW5rU3RhdGVNYW5hZ2VyID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRlcm1pbmFsLnJlZnJlc2godGVybWluYWwuYnVmZmVyLnksIHRlcm1pbmFsLmJ1ZmZlci55KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQ3Vyc29yUmVuZGVyTGF5ZXIucHJvdG90eXBlLm9uQ3Vyc29yTW92ZSA9IGZ1bmN0aW9uICh0ZXJtaW5hbCkge1xuICAgICAgICBpZiAodGhpcy5fY3Vyc29yQmxpbmtTdGF0ZU1hbmFnZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX2N1cnNvckJsaW5rU3RhdGVNYW5hZ2VyLnJlc3RhcnRCbGlua0FuaW1hdGlvbih0ZXJtaW5hbCk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEN1cnNvclJlbmRlckxheWVyLnByb3RvdHlwZS5vbkdyaWRDaGFuZ2VkID0gZnVuY3Rpb24gKHRlcm1pbmFsLCBzdGFydFJvdywgZW5kUm93KSB7XG4gICAgICAgIGlmICghdGhpcy5fY3Vyc29yQmxpbmtTdGF0ZU1hbmFnZXIgfHwgdGhpcy5fY3Vyc29yQmxpbmtTdGF0ZU1hbmFnZXIuaXNQYXVzZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlcih0ZXJtaW5hbCwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5fY3Vyc29yQmxpbmtTdGF0ZU1hbmFnZXIucmVzdGFydEJsaW5rQW5pbWF0aW9uKHRlcm1pbmFsKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQ3Vyc29yUmVuZGVyTGF5ZXIucHJvdG90eXBlLl9yZW5kZXIgPSBmdW5jdGlvbiAodGVybWluYWwsIHRyaWdnZXJlZEJ5QW5pbWF0aW9uRnJhbWUpIHtcbiAgICAgICAgaWYgKCF0ZXJtaW5hbC5jdXJzb3JTdGF0ZSB8fCB0ZXJtaW5hbC5jdXJzb3JIaWRkZW4pIHtcbiAgICAgICAgICAgIHRoaXMuX2NsZWFyQ3Vyc29yKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGN1cnNvclkgPSB0ZXJtaW5hbC5idWZmZXIueWJhc2UgKyB0ZXJtaW5hbC5idWZmZXIueTtcbiAgICAgICAgdmFyIHZpZXdwb3J0UmVsYXRpdmVDdXJzb3JZID0gY3Vyc29yWSAtIHRlcm1pbmFsLmJ1ZmZlci55ZGlzcDtcbiAgICAgICAgaWYgKHZpZXdwb3J0UmVsYXRpdmVDdXJzb3JZIDwgMCB8fCB2aWV3cG9ydFJlbGF0aXZlQ3Vyc29yWSA+PSB0ZXJtaW5hbC5yb3dzKSB7XG4gICAgICAgICAgICB0aGlzLl9jbGVhckN1cnNvcigpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRlcm1pbmFsLmJ1ZmZlci5saW5lcy5nZXQoY3Vyc29yWSkubG9hZENlbGwodGVybWluYWwuYnVmZmVyLngsIHRoaXMuX2NlbGwpO1xuICAgICAgICBpZiAodGhpcy5fY2VsbC5jb250ZW50ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRlcm1pbmFsLmlzRm9jdXNlZCkge1xuICAgICAgICAgICAgdGhpcy5fY2xlYXJDdXJzb3IoKTtcbiAgICAgICAgICAgIHRoaXMuX2N0eC5zYXZlKCk7XG4gICAgICAgICAgICB0aGlzLl9jdHguZmlsbFN0eWxlID0gdGhpcy5fY29sb3JzLmN1cnNvci5jc3M7XG4gICAgICAgICAgICB0aGlzLl9yZW5kZXJCbHVyQ3Vyc29yKHRlcm1pbmFsLCB0ZXJtaW5hbC5idWZmZXIueCwgdmlld3BvcnRSZWxhdGl2ZUN1cnNvclksIHRoaXMuX2NlbGwpO1xuICAgICAgICAgICAgdGhpcy5fY3R4LnJlc3RvcmUoKTtcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLnggPSB0ZXJtaW5hbC5idWZmZXIueDtcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLnkgPSB2aWV3cG9ydFJlbGF0aXZlQ3Vyc29yWTtcbiAgICAgICAgICAgIHRoaXMuX3N0YXRlLmlzRm9jdXNlZCA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5fc3RhdGUuc3R5bGUgPSB0ZXJtaW5hbC5vcHRpb25zLmN1cnNvclN0eWxlO1xuICAgICAgICAgICAgdGhpcy5fc3RhdGUud2lkdGggPSB0aGlzLl9jZWxsLmdldFdpZHRoKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX2N1cnNvckJsaW5rU3RhdGVNYW5hZ2VyICYmICF0aGlzLl9jdXJzb3JCbGlua1N0YXRlTWFuYWdlci5pc0N1cnNvclZpc2libGUpIHtcbiAgICAgICAgICAgIHRoaXMuX2NsZWFyQ3Vyc29yKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5fc3RhdGUueCA9PT0gdGVybWluYWwuYnVmZmVyLnggJiZcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGF0ZS55ID09PSB2aWV3cG9ydFJlbGF0aXZlQ3Vyc29yWSAmJlxuICAgICAgICAgICAgICAgIHRoaXMuX3N0YXRlLmlzRm9jdXNlZCA9PT0gdGVybWluYWwuaXNGb2N1c2VkICYmXG4gICAgICAgICAgICAgICAgdGhpcy5fc3RhdGUuc3R5bGUgPT09IHRlcm1pbmFsLm9wdGlvbnMuY3Vyc29yU3R5bGUgJiZcbiAgICAgICAgICAgICAgICB0aGlzLl9zdGF0ZS53aWR0aCA9PT0gdGhpcy5fY2VsbC5nZXRXaWR0aCgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5fY2xlYXJDdXJzb3IoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9jdHguc2F2ZSgpO1xuICAgICAgICB0aGlzLl9jdXJzb3JSZW5kZXJlcnNbdGVybWluYWwub3B0aW9ucy5jdXJzb3JTdHlsZSB8fCAnYmxvY2snXSh0ZXJtaW5hbCwgdGVybWluYWwuYnVmZmVyLngsIHZpZXdwb3J0UmVsYXRpdmVDdXJzb3JZLCB0aGlzLl9jZWxsKTtcbiAgICAgICAgdGhpcy5fY3R4LnJlc3RvcmUoKTtcbiAgICAgICAgdGhpcy5fc3RhdGUueCA9IHRlcm1pbmFsLmJ1ZmZlci54O1xuICAgICAgICB0aGlzLl9zdGF0ZS55ID0gdmlld3BvcnRSZWxhdGl2ZUN1cnNvclk7XG4gICAgICAgIHRoaXMuX3N0YXRlLmlzRm9jdXNlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9zdGF0ZS5zdHlsZSA9IHRlcm1pbmFsLm9wdGlvbnMuY3Vyc29yU3R5bGU7XG4gICAgICAgIHRoaXMuX3N0YXRlLndpZHRoID0gdGhpcy5fY2VsbC5nZXRXaWR0aCgpO1xuICAgIH07XG4gICAgQ3Vyc29yUmVuZGVyTGF5ZXIucHJvdG90eXBlLl9jbGVhckN1cnNvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlKSB7XG4gICAgICAgICAgICB0aGlzLmNsZWFyQ2VsbHModGhpcy5fc3RhdGUueCwgdGhpcy5fc3RhdGUueSwgdGhpcy5fc3RhdGUud2lkdGgsIDEpO1xuICAgICAgICAgICAgdGhpcy5fc3RhdGUgPSB7XG4gICAgICAgICAgICAgICAgeDogbnVsbCxcbiAgICAgICAgICAgICAgICB5OiBudWxsLFxuICAgICAgICAgICAgICAgIGlzRm9jdXNlZDogbnVsbCxcbiAgICAgICAgICAgICAgICBzdHlsZTogbnVsbCxcbiAgICAgICAgICAgICAgICB3aWR0aDogbnVsbFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQ3Vyc29yUmVuZGVyTGF5ZXIucHJvdG90eXBlLl9yZW5kZXJCYXJDdXJzb3IgPSBmdW5jdGlvbiAodGVybWluYWwsIHgsIHksIGNlbGwpIHtcbiAgICAgICAgdGhpcy5fY3R4LnNhdmUoKTtcbiAgICAgICAgdGhpcy5fY3R4LmZpbGxTdHlsZSA9IHRoaXMuX2NvbG9ycy5jdXJzb3IuY3NzO1xuICAgICAgICB0aGlzLmZpbGxMZWZ0TGluZUF0Q2VsbCh4LCB5KTtcbiAgICAgICAgdGhpcy5fY3R4LnJlc3RvcmUoKTtcbiAgICB9O1xuICAgIEN1cnNvclJlbmRlckxheWVyLnByb3RvdHlwZS5fcmVuZGVyQmxvY2tDdXJzb3IgPSBmdW5jdGlvbiAodGVybWluYWwsIHgsIHksIGNlbGwpIHtcbiAgICAgICAgdGhpcy5fY3R4LnNhdmUoKTtcbiAgICAgICAgdGhpcy5fY3R4LmZpbGxTdHlsZSA9IHRoaXMuX2NvbG9ycy5jdXJzb3IuY3NzO1xuICAgICAgICB0aGlzLmZpbGxDZWxscyh4LCB5LCBjZWxsLmdldFdpZHRoKCksIDEpO1xuICAgICAgICB0aGlzLl9jdHguZmlsbFN0eWxlID0gdGhpcy5fY29sb3JzLmN1cnNvckFjY2VudC5jc3M7XG4gICAgICAgIHRoaXMuZmlsbENoYXJUcnVlQ29sb3IodGVybWluYWwsIGNlbGwsIHgsIHkpO1xuICAgICAgICB0aGlzLl9jdHgucmVzdG9yZSgpO1xuICAgIH07XG4gICAgQ3Vyc29yUmVuZGVyTGF5ZXIucHJvdG90eXBlLl9yZW5kZXJVbmRlcmxpbmVDdXJzb3IgPSBmdW5jdGlvbiAodGVybWluYWwsIHgsIHksIGNlbGwpIHtcbiAgICAgICAgdGhpcy5fY3R4LnNhdmUoKTtcbiAgICAgICAgdGhpcy5fY3R4LmZpbGxTdHlsZSA9IHRoaXMuX2NvbG9ycy5jdXJzb3IuY3NzO1xuICAgICAgICB0aGlzLmZpbGxCb3R0b21MaW5lQXRDZWxscyh4LCB5KTtcbiAgICAgICAgdGhpcy5fY3R4LnJlc3RvcmUoKTtcbiAgICB9O1xuICAgIEN1cnNvclJlbmRlckxheWVyLnByb3RvdHlwZS5fcmVuZGVyQmx1ckN1cnNvciA9IGZ1bmN0aW9uICh0ZXJtaW5hbCwgeCwgeSwgY2VsbCkge1xuICAgICAgICB0aGlzLl9jdHguc2F2ZSgpO1xuICAgICAgICB0aGlzLl9jdHguc3Ryb2tlU3R5bGUgPSB0aGlzLl9jb2xvcnMuY3Vyc29yLmNzcztcbiAgICAgICAgdGhpcy5zdHJva2VSZWN0QXRDZWxsKHgsIHksIGNlbGwuZ2V0V2lkdGgoKSwgMSk7XG4gICAgICAgIHRoaXMuX2N0eC5yZXN0b3JlKCk7XG4gICAgfTtcbiAgICByZXR1cm4gQ3Vyc29yUmVuZGVyTGF5ZXI7XG59KEJhc2VSZW5kZXJMYXllcl8xLkJhc2VSZW5kZXJMYXllcikpO1xuZXhwb3J0cy5DdXJzb3JSZW5kZXJMYXllciA9IEN1cnNvclJlbmRlckxheWVyO1xudmFyIEN1cnNvckJsaW5rU3RhdGVNYW5hZ2VyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBDdXJzb3JCbGlua1N0YXRlTWFuYWdlcih0ZXJtaW5hbCwgX3JlbmRlckNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX3JlbmRlckNhbGxiYWNrID0gX3JlbmRlckNhbGxiYWNrO1xuICAgICAgICB0aGlzLmlzQ3Vyc29yVmlzaWJsZSA9IHRydWU7XG4gICAgICAgIGlmICh0ZXJtaW5hbC5pc0ZvY3VzZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX3Jlc3RhcnRJbnRlcnZhbCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShDdXJzb3JCbGlua1N0YXRlTWFuYWdlci5wcm90b3R5cGUsIFwiaXNQYXVzZWRcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuICEodGhpcy5fYmxpbmtTdGFydFRpbWVvdXQgfHwgdGhpcy5fYmxpbmtJbnRlcnZhbCk7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIEN1cnNvckJsaW5rU3RhdGVNYW5hZ2VyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5fYmxpbmtJbnRlcnZhbCkge1xuICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwodGhpcy5fYmxpbmtJbnRlcnZhbCk7XG4gICAgICAgICAgICB0aGlzLl9ibGlua0ludGVydmFsID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fYmxpbmtTdGFydFRpbWVvdXQpIHtcbiAgICAgICAgICAgIHdpbmRvdy5jbGVhclRpbWVvdXQodGhpcy5fYmxpbmtTdGFydFRpbWVvdXQpO1xuICAgICAgICAgICAgdGhpcy5fYmxpbmtTdGFydFRpbWVvdXQgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9hbmltYXRpb25GcmFtZSkge1xuICAgICAgICAgICAgd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMuX2FuaW1hdGlvbkZyYW1lKTtcbiAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbkZyYW1lID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQ3Vyc29yQmxpbmtTdGF0ZU1hbmFnZXIucHJvdG90eXBlLnJlc3RhcnRCbGlua0FuaW1hdGlvbiA9IGZ1bmN0aW9uICh0ZXJtaW5hbCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy5pc1BhdXNlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2FuaW1hdGlvblRpbWVSZXN0YXJ0ZWQgPSBEYXRlLm5vdygpO1xuICAgICAgICB0aGlzLmlzQ3Vyc29yVmlzaWJsZSA9IHRydWU7XG4gICAgICAgIGlmICghdGhpcy5fYW5pbWF0aW9uRnJhbWUpIHtcbiAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbkZyYW1lID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX3JlbmRlckNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgX3RoaXMuX2FuaW1hdGlvbkZyYW1lID0gbnVsbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBDdXJzb3JCbGlua1N0YXRlTWFuYWdlci5wcm90b3R5cGUuX3Jlc3RhcnRJbnRlcnZhbCA9IGZ1bmN0aW9uICh0aW1lVG9TdGFydCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAodGltZVRvU3RhcnQgPT09IHZvaWQgMCkgeyB0aW1lVG9TdGFydCA9IEJMSU5LX0lOVEVSVkFMOyB9XG4gICAgICAgIGlmICh0aGlzLl9ibGlua0ludGVydmFsKSB7XG4gICAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh0aGlzLl9ibGlua0ludGVydmFsKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9ibGlua1N0YXJ0VGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKF90aGlzLl9hbmltYXRpb25UaW1lUmVzdGFydGVkKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRpbWUgPSBCTElOS19JTlRFUlZBTCAtIChEYXRlLm5vdygpIC0gX3RoaXMuX2FuaW1hdGlvblRpbWVSZXN0YXJ0ZWQpO1xuICAgICAgICAgICAgICAgIF90aGlzLl9hbmltYXRpb25UaW1lUmVzdGFydGVkID0gbnVsbDtcbiAgICAgICAgICAgICAgICBpZiAodGltZSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX3Jlc3RhcnRJbnRlcnZhbCh0aW1lKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIF90aGlzLmlzQ3Vyc29yVmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgX3RoaXMuX2FuaW1hdGlvbkZyYW1lID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX3JlbmRlckNhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgX3RoaXMuX2FuaW1hdGlvbkZyYW1lID0gbnVsbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgX3RoaXMuX2JsaW5rSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLl9hbmltYXRpb25UaW1lUmVzdGFydGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0aW1lID0gQkxJTktfSU5URVJWQUwgLSAoRGF0ZS5ub3coKSAtIF90aGlzLl9hbmltYXRpb25UaW1lUmVzdGFydGVkKTtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX2FuaW1hdGlvblRpbWVSZXN0YXJ0ZWQgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5fcmVzdGFydEludGVydmFsKHRpbWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF90aGlzLmlzQ3Vyc29yVmlzaWJsZSA9ICFfdGhpcy5pc0N1cnNvclZpc2libGU7XG4gICAgICAgICAgICAgICAgX3RoaXMuX2FuaW1hdGlvbkZyYW1lID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF90aGlzLl9yZW5kZXJDYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICBfdGhpcy5fYW5pbWF0aW9uRnJhbWUgPSBudWxsO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSwgQkxJTktfSU5URVJWQUwpO1xuICAgICAgICB9LCB0aW1lVG9TdGFydCk7XG4gICAgfTtcbiAgICBDdXJzb3JCbGlua1N0YXRlTWFuYWdlci5wcm90b3R5cGUucGF1c2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaXNDdXJzb3JWaXNpYmxlID0gdHJ1ZTtcbiAgICAgICAgaWYgKHRoaXMuX2JsaW5rSW50ZXJ2YWwpIHtcbiAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKHRoaXMuX2JsaW5rSW50ZXJ2YWwpO1xuICAgICAgICAgICAgdGhpcy5fYmxpbmtJbnRlcnZhbCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuX2JsaW5rU3RhcnRUaW1lb3V0KSB7XG4gICAgICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMuX2JsaW5rU3RhcnRUaW1lb3V0KTtcbiAgICAgICAgICAgIHRoaXMuX2JsaW5rU3RhcnRUaW1lb3V0ID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5fYW5pbWF0aW9uRnJhbWUpIHtcbiAgICAgICAgICAgIHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLl9hbmltYXRpb25GcmFtZSk7XG4gICAgICAgICAgICB0aGlzLl9hbmltYXRpb25GcmFtZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEN1cnNvckJsaW5rU3RhdGVNYW5hZ2VyLnByb3RvdHlwZS5yZXN1bWUgPSBmdW5jdGlvbiAodGVybWluYWwpIHtcbiAgICAgICAgdGhpcy5fYW5pbWF0aW9uVGltZVJlc3RhcnRlZCA9IG51bGw7XG4gICAgICAgIHRoaXMuX3Jlc3RhcnRJbnRlcnZhbCgpO1xuICAgICAgICB0aGlzLnJlc3RhcnRCbGlua0FuaW1hdGlvbih0ZXJtaW5hbCk7XG4gICAgfTtcbiAgICByZXR1cm4gQ3Vyc29yQmxpbmtTdGF0ZU1hbmFnZXI7XG59KCkpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Q3Vyc29yUmVuZGVyTGF5ZXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgR3JpZENhY2hlID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBHcmlkQ2FjaGUoKSB7XG4gICAgICAgIHRoaXMuY2FjaGUgPSBbXTtcbiAgICB9XG4gICAgR3JpZENhY2hlLnByb3RvdHlwZS5yZXNpemUgPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCkge1xuICAgICAgICBmb3IgKHZhciB4ID0gMDsgeCA8IHdpZHRoOyB4KyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNhY2hlLmxlbmd0aCA8PSB4KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jYWNoZS5wdXNoKFtdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAodmFyIHkgPSB0aGlzLmNhY2hlW3hdLmxlbmd0aDsgeSA8IGhlaWdodDsgeSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jYWNoZVt4XS5wdXNoKG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5jYWNoZVt4XS5sZW5ndGggPSBoZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jYWNoZS5sZW5ndGggPSB3aWR0aDtcbiAgICB9O1xuICAgIEdyaWRDYWNoZS5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgdGhpcy5jYWNoZS5sZW5ndGg7IHgrKykge1xuICAgICAgICAgICAgZm9yICh2YXIgeSA9IDA7IHkgPCB0aGlzLmNhY2hlW3hdLmxlbmd0aDsgeSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jYWNoZVt4XVt5XSA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHJldHVybiBHcmlkQ2FjaGU7XG59KCkpO1xuZXhwb3J0cy5HcmlkQ2FjaGUgPSBHcmlkQ2FjaGU7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1HcmlkQ2FjaGUuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBCYXNlUmVuZGVyTGF5ZXJfMSA9IHJlcXVpcmUoXCIuL0Jhc2VSZW5kZXJMYXllclwiKTtcbnZhciBUeXBlc18xID0gcmVxdWlyZShcIi4vYXRsYXMvVHlwZXNcIik7XG52YXIgQ2hhckF0bGFzVXRpbHNfMSA9IHJlcXVpcmUoXCIuL2F0bGFzL0NoYXJBdGxhc1V0aWxzXCIpO1xudmFyIExpbmtSZW5kZXJMYXllciA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKExpbmtSZW5kZXJMYXllciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBMaW5rUmVuZGVyTGF5ZXIoY29udGFpbmVyLCB6SW5kZXgsIGNvbG9ycywgdGVybWluYWwpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgY29udGFpbmVyLCAnbGluaycsIHpJbmRleCwgdHJ1ZSwgY29sb3JzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5fc3RhdGUgPSBudWxsO1xuICAgICAgICB0ZXJtaW5hbC5saW5raWZpZXIub25MaW5rSG92ZXIoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLl9vbkxpbmtIb3ZlcihlKTsgfSk7XG4gICAgICAgIHRlcm1pbmFsLmxpbmtpZmllci5vbkxpbmtMZWF2ZShmdW5jdGlvbiAoZSkgeyByZXR1cm4gX3RoaXMuX29uTGlua0xlYXZlKGUpOyB9KTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBMaW5rUmVuZGVyTGF5ZXIucHJvdG90eXBlLnJlc2l6ZSA9IGZ1bmN0aW9uICh0ZXJtaW5hbCwgZGltKSB7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUucmVzaXplLmNhbGwodGhpcywgdGVybWluYWwsIGRpbSk7XG4gICAgICAgIHRoaXMuX3N0YXRlID0gbnVsbDtcbiAgICB9O1xuICAgIExpbmtSZW5kZXJMYXllci5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAodGVybWluYWwpIHtcbiAgICAgICAgdGhpcy5fY2xlYXJDdXJyZW50TGluaygpO1xuICAgIH07XG4gICAgTGlua1JlbmRlckxheWVyLnByb3RvdHlwZS5fY2xlYXJDdXJyZW50TGluayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlKSB7XG4gICAgICAgICAgICB0aGlzLmNsZWFyQ2VsbHModGhpcy5fc3RhdGUueDEsIHRoaXMuX3N0YXRlLnkxLCB0aGlzLl9zdGF0ZS5jb2xzIC0gdGhpcy5fc3RhdGUueDEsIDEpO1xuICAgICAgICAgICAgdmFyIG1pZGRsZVJvd0NvdW50ID0gdGhpcy5fc3RhdGUueTIgLSB0aGlzLl9zdGF0ZS55MSAtIDE7XG4gICAgICAgICAgICBpZiAobWlkZGxlUm93Q291bnQgPiAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jbGVhckNlbGxzKDAsIHRoaXMuX3N0YXRlLnkxICsgMSwgdGhpcy5fc3RhdGUuY29scywgbWlkZGxlUm93Q291bnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5jbGVhckNlbGxzKDAsIHRoaXMuX3N0YXRlLnkyLCB0aGlzLl9zdGF0ZS54MiwgMSk7XG4gICAgICAgICAgICB0aGlzLl9zdGF0ZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIExpbmtSZW5kZXJMYXllci5wcm90b3R5cGUuX29uTGlua0hvdmVyID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYgKGUuZmcgPT09IFR5cGVzXzEuSU5WRVJURURfREVGQVVMVF9DT0xPUikge1xuICAgICAgICAgICAgdGhpcy5fY3R4LmZpbGxTdHlsZSA9IHRoaXMuX2NvbG9ycy5iYWNrZ3JvdW5kLmNzcztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChDaGFyQXRsYXNVdGlsc18xLmlzMjU2Q29sb3IoZS5mZykpIHtcbiAgICAgICAgICAgIHRoaXMuX2N0eC5maWxsU3R5bGUgPSB0aGlzLl9jb2xvcnMuYW5zaVtlLmZnXS5jc3M7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLl9jdHguZmlsbFN0eWxlID0gdGhpcy5fY29sb3JzLmZvcmVncm91bmQuY3NzO1xuICAgICAgICB9XG4gICAgICAgIGlmIChlLnkxID09PSBlLnkyKSB7XG4gICAgICAgICAgICB0aGlzLmZpbGxCb3R0b21MaW5lQXRDZWxscyhlLngxLCBlLnkxLCBlLngyIC0gZS54MSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmZpbGxCb3R0b21MaW5lQXRDZWxscyhlLngxLCBlLnkxLCBlLmNvbHMgLSBlLngxKTtcbiAgICAgICAgICAgIGZvciAodmFyIHkgPSBlLnkxICsgMTsgeSA8IGUueTI7IHkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlsbEJvdHRvbUxpbmVBdENlbGxzKDAsIHksIGUuY29scyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmZpbGxCb3R0b21MaW5lQXRDZWxscygwLCBlLnkyLCBlLngyKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9zdGF0ZSA9IGU7XG4gICAgfTtcbiAgICBMaW5rUmVuZGVyTGF5ZXIucHJvdG90eXBlLl9vbkxpbmtMZWF2ZSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHRoaXMuX2NsZWFyQ3VycmVudExpbmsoKTtcbiAgICB9O1xuICAgIHJldHVybiBMaW5rUmVuZGVyTGF5ZXI7XG59KEJhc2VSZW5kZXJMYXllcl8xLkJhc2VSZW5kZXJMYXllcikpO1xuZXhwb3J0cy5MaW5rUmVuZGVyTGF5ZXIgPSBMaW5rUmVuZGVyTGF5ZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1MaW5rUmVuZGVyTGF5ZXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBUZXh0UmVuZGVyTGF5ZXJfMSA9IHJlcXVpcmUoXCIuL1RleHRSZW5kZXJMYXllclwiKTtcbnZhciBTZWxlY3Rpb25SZW5kZXJMYXllcl8xID0gcmVxdWlyZShcIi4vU2VsZWN0aW9uUmVuZGVyTGF5ZXJcIik7XG52YXIgQ3Vyc29yUmVuZGVyTGF5ZXJfMSA9IHJlcXVpcmUoXCIuL0N1cnNvclJlbmRlckxheWVyXCIpO1xudmFyIENvbG9yTWFuYWdlcl8xID0gcmVxdWlyZShcIi4vQ29sb3JNYW5hZ2VyXCIpO1xudmFyIExpbmtSZW5kZXJMYXllcl8xID0gcmVxdWlyZShcIi4vTGlua1JlbmRlckxheWVyXCIpO1xudmFyIFJlbmRlckRlYm91bmNlcl8xID0gcmVxdWlyZShcIi4uL3VpL1JlbmRlckRlYm91bmNlclwiKTtcbnZhciBTY3JlZW5EcHJNb25pdG9yXzEgPSByZXF1aXJlKFwiLi4vdWkvU2NyZWVuRHByTW9uaXRvclwiKTtcbnZhciBDaGFyYWN0ZXJKb2luZXJSZWdpc3RyeV8xID0gcmVxdWlyZShcIi4uL3JlbmRlcmVyL0NoYXJhY3RlckpvaW5lclJlZ2lzdHJ5XCIpO1xudmFyIEV2ZW50RW1pdHRlcjJfMSA9IHJlcXVpcmUoXCIuLi9jb21tb24vRXZlbnRFbWl0dGVyMlwiKTtcbnZhciBMaWZlY3ljbGVfMSA9IHJlcXVpcmUoXCIuLi9jb21tb24vTGlmZWN5Y2xlXCIpO1xudmFyIFJlbmRlcmVyID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoUmVuZGVyZXIsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gUmVuZGVyZXIoX3Rlcm1pbmFsLCB0aGVtZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5fdGVybWluYWwgPSBfdGVybWluYWw7XG4gICAgICAgIF90aGlzLl9pc1BhdXNlZCA9IGZhbHNlO1xuICAgICAgICBfdGhpcy5fbmVlZHNGdWxsUmVmcmVzaCA9IGZhbHNlO1xuICAgICAgICBfdGhpcy5fb25DYW52YXNSZXNpemUgPSBuZXcgRXZlbnRFbWl0dGVyMl8xLkV2ZW50RW1pdHRlcjIoKTtcbiAgICAgICAgX3RoaXMuX29uUmVuZGVyID0gbmV3IEV2ZW50RW1pdHRlcjJfMS5FdmVudEVtaXR0ZXIyKCk7XG4gICAgICAgIHZhciBhbGxvd1RyYW5zcGFyZW5jeSA9IF90aGlzLl90ZXJtaW5hbC5vcHRpb25zLmFsbG93VHJhbnNwYXJlbmN5O1xuICAgICAgICBfdGhpcy5jb2xvck1hbmFnZXIgPSBuZXcgQ29sb3JNYW5hZ2VyXzEuQ29sb3JNYW5hZ2VyKGRvY3VtZW50LCBhbGxvd1RyYW5zcGFyZW5jeSk7XG4gICAgICAgIF90aGlzLl9jaGFyYWN0ZXJKb2luZXJSZWdpc3RyeSA9IG5ldyBDaGFyYWN0ZXJKb2luZXJSZWdpc3RyeV8xLkNoYXJhY3RlckpvaW5lclJlZ2lzdHJ5KF90ZXJtaW5hbCk7XG4gICAgICAgIGlmICh0aGVtZSkge1xuICAgICAgICAgICAgX3RoaXMuY29sb3JNYW5hZ2VyLnNldFRoZW1lKHRoZW1lKTtcbiAgICAgICAgfVxuICAgICAgICBfdGhpcy5fcmVuZGVyTGF5ZXJzID0gW1xuICAgICAgICAgICAgbmV3IFRleHRSZW5kZXJMYXllcl8xLlRleHRSZW5kZXJMYXllcihfdGhpcy5fdGVybWluYWwuc2NyZWVuRWxlbWVudCwgMCwgX3RoaXMuY29sb3JNYW5hZ2VyLmNvbG9ycywgX3RoaXMuX2NoYXJhY3RlckpvaW5lclJlZ2lzdHJ5LCBhbGxvd1RyYW5zcGFyZW5jeSksXG4gICAgICAgICAgICBuZXcgU2VsZWN0aW9uUmVuZGVyTGF5ZXJfMS5TZWxlY3Rpb25SZW5kZXJMYXllcihfdGhpcy5fdGVybWluYWwuc2NyZWVuRWxlbWVudCwgMSwgX3RoaXMuY29sb3JNYW5hZ2VyLmNvbG9ycyksXG4gICAgICAgICAgICBuZXcgTGlua1JlbmRlckxheWVyXzEuTGlua1JlbmRlckxheWVyKF90aGlzLl90ZXJtaW5hbC5zY3JlZW5FbGVtZW50LCAyLCBfdGhpcy5jb2xvck1hbmFnZXIuY29sb3JzLCBfdGhpcy5fdGVybWluYWwpLFxuICAgICAgICAgICAgbmV3IEN1cnNvclJlbmRlckxheWVyXzEuQ3Vyc29yUmVuZGVyTGF5ZXIoX3RoaXMuX3Rlcm1pbmFsLnNjcmVlbkVsZW1lbnQsIDMsIF90aGlzLmNvbG9yTWFuYWdlci5jb2xvcnMpXG4gICAgICAgIF07XG4gICAgICAgIF90aGlzLmRpbWVuc2lvbnMgPSB7XG4gICAgICAgICAgICBzY2FsZWRDaGFyV2lkdGg6IG51bGwsXG4gICAgICAgICAgICBzY2FsZWRDaGFySGVpZ2h0OiBudWxsLFxuICAgICAgICAgICAgc2NhbGVkQ2VsbFdpZHRoOiBudWxsLFxuICAgICAgICAgICAgc2NhbGVkQ2VsbEhlaWdodDogbnVsbCxcbiAgICAgICAgICAgIHNjYWxlZENoYXJMZWZ0OiBudWxsLFxuICAgICAgICAgICAgc2NhbGVkQ2hhclRvcDogbnVsbCxcbiAgICAgICAgICAgIHNjYWxlZENhbnZhc1dpZHRoOiBudWxsLFxuICAgICAgICAgICAgc2NhbGVkQ2FudmFzSGVpZ2h0OiBudWxsLFxuICAgICAgICAgICAgY2FudmFzV2lkdGg6IG51bGwsXG4gICAgICAgICAgICBjYW52YXNIZWlnaHQ6IG51bGwsXG4gICAgICAgICAgICBhY3R1YWxDZWxsV2lkdGg6IG51bGwsXG4gICAgICAgICAgICBhY3R1YWxDZWxsSGVpZ2h0OiBudWxsXG4gICAgICAgIH07XG4gICAgICAgIF90aGlzLl9kZXZpY2VQaXhlbFJhdGlvID0gd2luZG93LmRldmljZVBpeGVsUmF0aW87XG4gICAgICAgIF90aGlzLl91cGRhdGVEaW1lbnNpb25zKCk7XG4gICAgICAgIF90aGlzLm9uT3B0aW9uc0NoYW5nZWQoKTtcbiAgICAgICAgX3RoaXMuX3JlbmRlckRlYm91bmNlciA9IG5ldyBSZW5kZXJEZWJvdW5jZXJfMS5SZW5kZXJEZWJvdW5jZXIoX3RoaXMuX3JlbmRlclJvd3MuYmluZChfdGhpcykpO1xuICAgICAgICBfdGhpcy5fc2NyZWVuRHByTW9uaXRvciA9IG5ldyBTY3JlZW5EcHJNb25pdG9yXzEuU2NyZWVuRHByTW9uaXRvcigpO1xuICAgICAgICBfdGhpcy5fc2NyZWVuRHByTW9uaXRvci5zZXRMaXN0ZW5lcihmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5vbldpbmRvd1Jlc2l6ZSh3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyk7IH0pO1xuICAgICAgICBfdGhpcy5yZWdpc3RlcihfdGhpcy5fc2NyZWVuRHByTW9uaXRvcik7XG4gICAgICAgIGlmICgnSW50ZXJzZWN0aW9uT2JzZXJ2ZXInIGluIHdpbmRvdykge1xuICAgICAgICAgICAgdmFyIG9ic2VydmVyXzEgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLm9uSW50ZXJzZWN0aW9uQ2hhbmdlKGVbZS5sZW5ndGggLSAxXSk7IH0sIHsgdGhyZXNob2xkOiAwIH0pO1xuICAgICAgICAgICAgb2JzZXJ2ZXJfMS5vYnNlcnZlKF90aGlzLl90ZXJtaW5hbC5lbGVtZW50KTtcbiAgICAgICAgICAgIF90aGlzLnJlZ2lzdGVyKHsgZGlzcG9zZTogZnVuY3Rpb24gKCkgeyByZXR1cm4gb2JzZXJ2ZXJfMS5kaXNjb25uZWN0KCk7IH0gfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoUmVuZGVyZXIucHJvdG90eXBlLCBcIm9uQ2FudmFzUmVzaXplXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLl9vbkNhbnZhc1Jlc2l6ZS5ldmVudDsgfSxcbiAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXG4gICAgfSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFJlbmRlcmVyLnByb3RvdHlwZSwgXCJvblJlbmRlclwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fb25SZW5kZXIuZXZlbnQ7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIFJlbmRlcmVyLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmRpc3Bvc2UuY2FsbCh0aGlzKTtcbiAgICAgICAgdGhpcy5fcmVuZGVyTGF5ZXJzLmZvckVhY2goZnVuY3Rpb24gKGwpIHsgcmV0dXJuIGwuZGlzcG9zZSgpOyB9KTtcbiAgICB9O1xuICAgIFJlbmRlcmVyLnByb3RvdHlwZS5vbkludGVyc2VjdGlvbkNoYW5nZSA9IGZ1bmN0aW9uIChlbnRyeSkge1xuICAgICAgICB0aGlzLl9pc1BhdXNlZCA9IGVudHJ5LmludGVyc2VjdGlvblJhdGlvID09PSAwO1xuICAgICAgICBpZiAoIXRoaXMuX2lzUGF1c2VkICYmIHRoaXMuX25lZWRzRnVsbFJlZnJlc2gpIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnJlZnJlc2goMCwgdGhpcy5fdGVybWluYWwucm93cyAtIDEpO1xuICAgICAgICAgICAgdGhpcy5fbmVlZHNGdWxsUmVmcmVzaCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBSZW5kZXJlci5wcm90b3R5cGUub25XaW5kb3dSZXNpemUgPSBmdW5jdGlvbiAoZGV2aWNlUGl4ZWxSYXRpbykge1xuICAgICAgICBpZiAodGhpcy5fZGV2aWNlUGl4ZWxSYXRpbyAhPT0gZGV2aWNlUGl4ZWxSYXRpbykge1xuICAgICAgICAgICAgdGhpcy5fZGV2aWNlUGl4ZWxSYXRpbyA9IGRldmljZVBpeGVsUmF0aW87XG4gICAgICAgICAgICB0aGlzLm9uUmVzaXplKHRoaXMuX3Rlcm1pbmFsLmNvbHMsIHRoaXMuX3Rlcm1pbmFsLnJvd3MpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBSZW5kZXJlci5wcm90b3R5cGUuc2V0VGhlbWUgPSBmdW5jdGlvbiAodGhlbWUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5jb2xvck1hbmFnZXIuc2V0VGhlbWUodGhlbWUpO1xuICAgICAgICB0aGlzLl9yZW5kZXJMYXllcnMuZm9yRWFjaChmdW5jdGlvbiAobCkge1xuICAgICAgICAgICAgbC5vblRoZW1lQ2hhbmdlZChfdGhpcy5fdGVybWluYWwsIF90aGlzLmNvbG9yTWFuYWdlci5jb2xvcnMpO1xuICAgICAgICAgICAgbC5yZXNldChfdGhpcy5fdGVybWluYWwpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHRoaXMuX2lzUGF1c2VkKSB7XG4gICAgICAgICAgICB0aGlzLl9uZWVkc0Z1bGxSZWZyZXNoID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnJlZnJlc2goMCwgdGhpcy5fdGVybWluYWwucm93cyAtIDEpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLmNvbG9yTWFuYWdlci5jb2xvcnM7XG4gICAgfTtcbiAgICBSZW5kZXJlci5wcm90b3R5cGUub25SZXNpemUgPSBmdW5jdGlvbiAoY29scywgcm93cykge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLl91cGRhdGVEaW1lbnNpb25zKCk7XG4gICAgICAgIHRoaXMuX3JlbmRlckxheWVycy5mb3JFYWNoKGZ1bmN0aW9uIChsKSB7IHJldHVybiBsLnJlc2l6ZShfdGhpcy5fdGVybWluYWwsIF90aGlzLmRpbWVuc2lvbnMpOyB9KTtcbiAgICAgICAgaWYgKHRoaXMuX2lzUGF1c2VkKSB7XG4gICAgICAgICAgICB0aGlzLl9uZWVkc0Z1bGxSZWZyZXNoID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnJlZnJlc2goMCwgdGhpcy5fdGVybWluYWwucm93cyAtIDEpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNjcmVlbkVsZW1lbnQuc3R5bGUud2lkdGggPSB0aGlzLmRpbWVuc2lvbnMuY2FudmFzV2lkdGggKyBcInB4XCI7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNjcmVlbkVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gdGhpcy5kaW1lbnNpb25zLmNhbnZhc0hlaWdodCArIFwicHhcIjtcbiAgICAgICAgdGhpcy5fb25DYW52YXNSZXNpemUuZmlyZSh7XG4gICAgICAgICAgICB3aWR0aDogdGhpcy5kaW1lbnNpb25zLmNhbnZhc1dpZHRoLFxuICAgICAgICAgICAgaGVpZ2h0OiB0aGlzLmRpbWVuc2lvbnMuY2FudmFzSGVpZ2h0XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgUmVuZGVyZXIucHJvdG90eXBlLm9uQ2hhclNpemVDaGFuZ2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLm9uUmVzaXplKHRoaXMuX3Rlcm1pbmFsLmNvbHMsIHRoaXMuX3Rlcm1pbmFsLnJvd3MpO1xuICAgIH07XG4gICAgUmVuZGVyZXIucHJvdG90eXBlLm9uQmx1ciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5fcnVuT3BlcmF0aW9uKGZ1bmN0aW9uIChsKSB7IHJldHVybiBsLm9uQmx1cihfdGhpcy5fdGVybWluYWwpOyB9KTtcbiAgICB9O1xuICAgIFJlbmRlcmVyLnByb3RvdHlwZS5vbkZvY3VzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLl9ydW5PcGVyYXRpb24oZnVuY3Rpb24gKGwpIHsgcmV0dXJuIGwub25Gb2N1cyhfdGhpcy5fdGVybWluYWwpOyB9KTtcbiAgICB9O1xuICAgIFJlbmRlcmVyLnByb3RvdHlwZS5vblNlbGVjdGlvbkNoYW5nZWQgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCwgY29sdW1uU2VsZWN0TW9kZSkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICBpZiAoY29sdW1uU2VsZWN0TW9kZSA9PT0gdm9pZCAwKSB7IGNvbHVtblNlbGVjdE1vZGUgPSBmYWxzZTsgfVxuICAgICAgICB0aGlzLl9ydW5PcGVyYXRpb24oZnVuY3Rpb24gKGwpIHsgcmV0dXJuIGwub25TZWxlY3Rpb25DaGFuZ2VkKF90aGlzLl90ZXJtaW5hbCwgc3RhcnQsIGVuZCwgY29sdW1uU2VsZWN0TW9kZSk7IH0pO1xuICAgIH07XG4gICAgUmVuZGVyZXIucHJvdG90eXBlLm9uQ3Vyc29yTW92ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5fcnVuT3BlcmF0aW9uKGZ1bmN0aW9uIChsKSB7IHJldHVybiBsLm9uQ3Vyc29yTW92ZShfdGhpcy5fdGVybWluYWwpOyB9KTtcbiAgICB9O1xuICAgIFJlbmRlcmVyLnByb3RvdHlwZS5vbk9wdGlvbnNDaGFuZ2VkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLmNvbG9yTWFuYWdlci5hbGxvd1RyYW5zcGFyZW5jeSA9IHRoaXMuX3Rlcm1pbmFsLm9wdGlvbnMuYWxsb3dUcmFuc3BhcmVuY3k7XG4gICAgICAgIHRoaXMuX3J1bk9wZXJhdGlvbihmdW5jdGlvbiAobCkgeyByZXR1cm4gbC5vbk9wdGlvbnNDaGFuZ2VkKF90aGlzLl90ZXJtaW5hbCk7IH0pO1xuICAgIH07XG4gICAgUmVuZGVyZXIucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLl9ydW5PcGVyYXRpb24oZnVuY3Rpb24gKGwpIHsgcmV0dXJuIGwucmVzZXQoX3RoaXMuX3Rlcm1pbmFsKTsgfSk7XG4gICAgfTtcbiAgICBSZW5kZXJlci5wcm90b3R5cGUuX3J1bk9wZXJhdGlvbiA9IGZ1bmN0aW9uIChvcGVyYXRpb24pIHtcbiAgICAgICAgaWYgKHRoaXMuX2lzUGF1c2VkKSB7XG4gICAgICAgICAgICB0aGlzLl9uZWVkc0Z1bGxSZWZyZXNoID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3JlbmRlckxheWVycy5mb3JFYWNoKGZ1bmN0aW9uIChsKSB7IHJldHVybiBvcGVyYXRpb24obCk7IH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBSZW5kZXJlci5wcm90b3R5cGUucmVmcmVzaFJvd3MgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkge1xuICAgICAgICBpZiAodGhpcy5faXNQYXVzZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX25lZWRzRnVsbFJlZnJlc2ggPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3JlbmRlckRlYm91bmNlci5yZWZyZXNoKHN0YXJ0LCBlbmQsIHRoaXMuX3Rlcm1pbmFsLnJvd3MpO1xuICAgIH07XG4gICAgUmVuZGVyZXIucHJvdG90eXBlLl9yZW5kZXJSb3dzID0gZnVuY3Rpb24gKHN0YXJ0LCBlbmQpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5fcmVuZGVyTGF5ZXJzLmZvckVhY2goZnVuY3Rpb24gKGwpIHsgcmV0dXJuIGwub25HcmlkQ2hhbmdlZChfdGhpcy5fdGVybWluYWwsIHN0YXJ0LCBlbmQpOyB9KTtcbiAgICAgICAgdGhpcy5fb25SZW5kZXIuZmlyZSh7IHN0YXJ0OiBzdGFydCwgZW5kOiBlbmQgfSk7XG4gICAgfTtcbiAgICBSZW5kZXJlci5wcm90b3R5cGUuX3VwZGF0ZURpbWVuc2lvbnMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5fdGVybWluYWwuY2hhck1lYXN1cmUud2lkdGggfHwgIXRoaXMuX3Rlcm1pbmFsLmNoYXJNZWFzdXJlLmhlaWdodCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZGltZW5zaW9ucy5zY2FsZWRDaGFyV2lkdGggPSBNYXRoLmZsb29yKHRoaXMuX3Rlcm1pbmFsLmNoYXJNZWFzdXJlLndpZHRoICogd2luZG93LmRldmljZVBpeGVsUmF0aW8pO1xuICAgICAgICB0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2hhckhlaWdodCA9IE1hdGguY2VpbCh0aGlzLl90ZXJtaW5hbC5jaGFyTWVhc3VyZS5oZWlnaHQgKiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyk7XG4gICAgICAgIHRoaXMuZGltZW5zaW9ucy5zY2FsZWRDZWxsSGVpZ2h0ID0gTWF0aC5mbG9vcih0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2hhckhlaWdodCAqIHRoaXMuX3Rlcm1pbmFsLm9wdGlvbnMubGluZUhlaWdodCk7XG4gICAgICAgIHRoaXMuZGltZW5zaW9ucy5zY2FsZWRDaGFyVG9wID0gdGhpcy5fdGVybWluYWwub3B0aW9ucy5saW5lSGVpZ2h0ID09PSAxID8gMCA6IE1hdGgucm91bmQoKHRoaXMuZGltZW5zaW9ucy5zY2FsZWRDZWxsSGVpZ2h0IC0gdGhpcy5kaW1lbnNpb25zLnNjYWxlZENoYXJIZWlnaHQpIC8gMik7XG4gICAgICAgIHRoaXMuZGltZW5zaW9ucy5zY2FsZWRDZWxsV2lkdGggPSB0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2hhcldpZHRoICsgTWF0aC5yb3VuZCh0aGlzLl90ZXJtaW5hbC5vcHRpb25zLmxldHRlclNwYWNpbmcpO1xuICAgICAgICB0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2hhckxlZnQgPSBNYXRoLmZsb29yKHRoaXMuX3Rlcm1pbmFsLm9wdGlvbnMubGV0dGVyU3BhY2luZyAvIDIpO1xuICAgICAgICB0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2FudmFzSGVpZ2h0ID0gdGhpcy5fdGVybWluYWwucm93cyAqIHRoaXMuZGltZW5zaW9ucy5zY2FsZWRDZWxsSGVpZ2h0O1xuICAgICAgICB0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2FudmFzV2lkdGggPSB0aGlzLl90ZXJtaW5hbC5jb2xzICogdGhpcy5kaW1lbnNpb25zLnNjYWxlZENlbGxXaWR0aDtcbiAgICAgICAgdGhpcy5kaW1lbnNpb25zLmNhbnZhc0hlaWdodCA9IE1hdGgucm91bmQodGhpcy5kaW1lbnNpb25zLnNjYWxlZENhbnZhc0hlaWdodCAvIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKTtcbiAgICAgICAgdGhpcy5kaW1lbnNpb25zLmNhbnZhc1dpZHRoID0gTWF0aC5yb3VuZCh0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2FudmFzV2lkdGggLyB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyk7XG4gICAgICAgIHRoaXMuZGltZW5zaW9ucy5hY3R1YWxDZWxsSGVpZ2h0ID0gdGhpcy5kaW1lbnNpb25zLmNhbnZhc0hlaWdodCAvIHRoaXMuX3Rlcm1pbmFsLnJvd3M7XG4gICAgICAgIHRoaXMuZGltZW5zaW9ucy5hY3R1YWxDZWxsV2lkdGggPSB0aGlzLmRpbWVuc2lvbnMuY2FudmFzV2lkdGggLyB0aGlzLl90ZXJtaW5hbC5jb2xzO1xuICAgIH07XG4gICAgUmVuZGVyZXIucHJvdG90eXBlLnJlZ2lzdGVyQ2hhcmFjdGVySm9pbmVyID0gZnVuY3Rpb24gKGhhbmRsZXIpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoYXJhY3RlckpvaW5lclJlZ2lzdHJ5LnJlZ2lzdGVyQ2hhcmFjdGVySm9pbmVyKGhhbmRsZXIpO1xuICAgIH07XG4gICAgUmVuZGVyZXIucHJvdG90eXBlLmRlcmVnaXN0ZXJDaGFyYWN0ZXJKb2luZXIgPSBmdW5jdGlvbiAoam9pbmVySWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NoYXJhY3RlckpvaW5lclJlZ2lzdHJ5LmRlcmVnaXN0ZXJDaGFyYWN0ZXJKb2luZXIoam9pbmVySWQpO1xuICAgIH07XG4gICAgcmV0dXJuIFJlbmRlcmVyO1xufShMaWZlY3ljbGVfMS5EaXNwb3NhYmxlKSk7XG5leHBvcnRzLlJlbmRlcmVyID0gUmVuZGVyZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1SZW5kZXJlci5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIEJhc2VSZW5kZXJMYXllcl8xID0gcmVxdWlyZShcIi4vQmFzZVJlbmRlckxheWVyXCIpO1xudmFyIFNlbGVjdGlvblJlbmRlckxheWVyID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoU2VsZWN0aW9uUmVuZGVyTGF5ZXIsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gU2VsZWN0aW9uUmVuZGVyTGF5ZXIoY29udGFpbmVyLCB6SW5kZXgsIGNvbG9ycykge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzLCBjb250YWluZXIsICdzZWxlY3Rpb24nLCB6SW5kZXgsIHRydWUsIGNvbG9ycykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuX2NsZWFyU3RhdGUoKTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBTZWxlY3Rpb25SZW5kZXJMYXllci5wcm90b3R5cGUuX2NsZWFyU3RhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3N0YXRlID0ge1xuICAgICAgICAgICAgc3RhcnQ6IG51bGwsXG4gICAgICAgICAgICBlbmQ6IG51bGwsXG4gICAgICAgICAgICBjb2x1bW5TZWxlY3RNb2RlOiBudWxsLFxuICAgICAgICAgICAgeWRpc3A6IG51bGxcbiAgICAgICAgfTtcbiAgICB9O1xuICAgIFNlbGVjdGlvblJlbmRlckxheWVyLnByb3RvdHlwZS5yZXNpemUgPSBmdW5jdGlvbiAodGVybWluYWwsIGRpbSkge1xuICAgICAgICBfc3VwZXIucHJvdG90eXBlLnJlc2l6ZS5jYWxsKHRoaXMsIHRlcm1pbmFsLCBkaW0pO1xuICAgICAgICB0aGlzLl9jbGVhclN0YXRlKCk7XG4gICAgfTtcbiAgICBTZWxlY3Rpb25SZW5kZXJMYXllci5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAodGVybWluYWwpIHtcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLnN0YXJ0ICYmIHRoaXMuX3N0YXRlLmVuZCkge1xuICAgICAgICAgICAgdGhpcy5fY2xlYXJTdGF0ZSgpO1xuICAgICAgICAgICAgdGhpcy5jbGVhckFsbCgpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBTZWxlY3Rpb25SZW5kZXJMYXllci5wcm90b3R5cGUub25TZWxlY3Rpb25DaGFuZ2VkID0gZnVuY3Rpb24gKHRlcm1pbmFsLCBzdGFydCwgZW5kLCBjb2x1bW5TZWxlY3RNb2RlKSB7XG4gICAgICAgIGlmICghdGhpcy5fZGlkU3RhdGVDaGFuZ2Uoc3RhcnQsIGVuZCwgY29sdW1uU2VsZWN0TW9kZSwgdGVybWluYWwuYnVmZmVyLnlkaXNwKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2xlYXJBbGwoKTtcbiAgICAgICAgaWYgKCFzdGFydCB8fCAhZW5kKSB7XG4gICAgICAgICAgICB0aGlzLl9jbGVhclN0YXRlKCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHZpZXdwb3J0U3RhcnRSb3cgPSBzdGFydFsxXSAtIHRlcm1pbmFsLmJ1ZmZlci55ZGlzcDtcbiAgICAgICAgdmFyIHZpZXdwb3J0RW5kUm93ID0gZW5kWzFdIC0gdGVybWluYWwuYnVmZmVyLnlkaXNwO1xuICAgICAgICB2YXIgdmlld3BvcnRDYXBwZWRTdGFydFJvdyA9IE1hdGgubWF4KHZpZXdwb3J0U3RhcnRSb3csIDApO1xuICAgICAgICB2YXIgdmlld3BvcnRDYXBwZWRFbmRSb3cgPSBNYXRoLm1pbih2aWV3cG9ydEVuZFJvdywgdGVybWluYWwucm93cyAtIDEpO1xuICAgICAgICBpZiAodmlld3BvcnRDYXBwZWRTdGFydFJvdyA+PSB0ZXJtaW5hbC5yb3dzIHx8IHZpZXdwb3J0Q2FwcGVkRW5kUm93IDwgMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2N0eC5maWxsU3R5bGUgPSB0aGlzLl9jb2xvcnMuc2VsZWN0aW9uLmNzcztcbiAgICAgICAgaWYgKGNvbHVtblNlbGVjdE1vZGUpIHtcbiAgICAgICAgICAgIHZhciBzdGFydENvbCA9IHN0YXJ0WzBdO1xuICAgICAgICAgICAgdmFyIHdpZHRoID0gZW5kWzBdIC0gc3RhcnRDb2w7XG4gICAgICAgICAgICB2YXIgaGVpZ2h0ID0gdmlld3BvcnRDYXBwZWRFbmRSb3cgLSB2aWV3cG9ydENhcHBlZFN0YXJ0Um93ICsgMTtcbiAgICAgICAgICAgIHRoaXMuZmlsbENlbGxzKHN0YXJ0Q29sLCB2aWV3cG9ydENhcHBlZFN0YXJ0Um93LCB3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHZhciBzdGFydENvbCA9IHZpZXdwb3J0U3RhcnRSb3cgPT09IHZpZXdwb3J0Q2FwcGVkU3RhcnRSb3cgPyBzdGFydFswXSA6IDA7XG4gICAgICAgICAgICB2YXIgc3RhcnRSb3dFbmRDb2wgPSB2aWV3cG9ydENhcHBlZFN0YXJ0Um93ID09PSB2aWV3cG9ydENhcHBlZEVuZFJvdyA/IGVuZFswXSA6IHRlcm1pbmFsLmNvbHM7XG4gICAgICAgICAgICB0aGlzLmZpbGxDZWxscyhzdGFydENvbCwgdmlld3BvcnRDYXBwZWRTdGFydFJvdywgc3RhcnRSb3dFbmRDb2wgLSBzdGFydENvbCwgMSk7XG4gICAgICAgICAgICB2YXIgbWlkZGxlUm93c0NvdW50ID0gTWF0aC5tYXgodmlld3BvcnRDYXBwZWRFbmRSb3cgLSB2aWV3cG9ydENhcHBlZFN0YXJ0Um93IC0gMSwgMCk7XG4gICAgICAgICAgICB0aGlzLmZpbGxDZWxscygwLCB2aWV3cG9ydENhcHBlZFN0YXJ0Um93ICsgMSwgdGVybWluYWwuY29scywgbWlkZGxlUm93c0NvdW50KTtcbiAgICAgICAgICAgIGlmICh2aWV3cG9ydENhcHBlZFN0YXJ0Um93ICE9PSB2aWV3cG9ydENhcHBlZEVuZFJvdykge1xuICAgICAgICAgICAgICAgIHZhciBlbmRDb2wgPSB2aWV3cG9ydEVuZFJvdyA9PT0gdmlld3BvcnRDYXBwZWRFbmRSb3cgPyBlbmRbMF0gOiB0ZXJtaW5hbC5jb2xzO1xuICAgICAgICAgICAgICAgIHRoaXMuZmlsbENlbGxzKDAsIHZpZXdwb3J0Q2FwcGVkRW5kUm93LCBlbmRDb2wsIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3N0YXRlLnN0YXJ0ID0gW3N0YXJ0WzBdLCBzdGFydFsxXV07XG4gICAgICAgIHRoaXMuX3N0YXRlLmVuZCA9IFtlbmRbMF0sIGVuZFsxXV07XG4gICAgICAgIHRoaXMuX3N0YXRlLmNvbHVtblNlbGVjdE1vZGUgPSBjb2x1bW5TZWxlY3RNb2RlO1xuICAgICAgICB0aGlzLl9zdGF0ZS55ZGlzcCA9IHRlcm1pbmFsLmJ1ZmZlci55ZGlzcDtcbiAgICB9O1xuICAgIFNlbGVjdGlvblJlbmRlckxheWVyLnByb3RvdHlwZS5fZGlkU3RhdGVDaGFuZ2UgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCwgY29sdW1uU2VsZWN0TW9kZSwgeWRpc3ApIHtcbiAgICAgICAgcmV0dXJuICF0aGlzLl9hcmVDb29yZGluYXRlc0VxdWFsKHN0YXJ0LCB0aGlzLl9zdGF0ZS5zdGFydCkgfHxcbiAgICAgICAgICAgICF0aGlzLl9hcmVDb29yZGluYXRlc0VxdWFsKGVuZCwgdGhpcy5fc3RhdGUuZW5kKSB8fFxuICAgICAgICAgICAgY29sdW1uU2VsZWN0TW9kZSAhPT0gdGhpcy5fc3RhdGUuY29sdW1uU2VsZWN0TW9kZSB8fFxuICAgICAgICAgICAgeWRpc3AgIT09IHRoaXMuX3N0YXRlLnlkaXNwO1xuICAgIH07XG4gICAgU2VsZWN0aW9uUmVuZGVyTGF5ZXIucHJvdG90eXBlLl9hcmVDb29yZGluYXRlc0VxdWFsID0gZnVuY3Rpb24gKGNvb3JkMSwgY29vcmQyKSB7XG4gICAgICAgIGlmICghY29vcmQxIHx8ICFjb29yZDIpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29vcmQxWzBdID09PSBjb29yZDJbMF0gJiYgY29vcmQxWzFdID09PSBjb29yZDJbMV07XG4gICAgfTtcbiAgICByZXR1cm4gU2VsZWN0aW9uUmVuZGVyTGF5ZXI7XG59KEJhc2VSZW5kZXJMYXllcl8xLkJhc2VSZW5kZXJMYXllcikpO1xuZXhwb3J0cy5TZWxlY3Rpb25SZW5kZXJMYXllciA9IFNlbGVjdGlvblJlbmRlckxheWVyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9U2VsZWN0aW9uUmVuZGVyTGF5ZXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBHcmlkQ2FjaGVfMSA9IHJlcXVpcmUoXCIuL0dyaWRDYWNoZVwiKTtcbnZhciBCYXNlUmVuZGVyTGF5ZXJfMSA9IHJlcXVpcmUoXCIuL0Jhc2VSZW5kZXJMYXllclwiKTtcbnZhciBCdWZmZXJMaW5lXzEgPSByZXF1aXJlKFwiLi4vY29yZS9idWZmZXIvQnVmZmVyTGluZVwiKTtcbnZhciBDaGFyYWN0ZXJKb2luZXJSZWdpc3RyeV8xID0gcmVxdWlyZShcIi4vQ2hhcmFjdGVySm9pbmVyUmVnaXN0cnlcIik7XG52YXIgVGV4dFJlbmRlckxheWVyID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoVGV4dFJlbmRlckxheWVyLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIFRleHRSZW5kZXJMYXllcihjb250YWluZXIsIHpJbmRleCwgY29sb3JzLCBjaGFyYWN0ZXJKb2luZXJSZWdpc3RyeSwgYWxwaGEpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgY29udGFpbmVyLCAndGV4dCcsIHpJbmRleCwgYWxwaGEsIGNvbG9ycykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuX2NoYXJhY3Rlck92ZXJsYXBDYWNoZSA9IHt9O1xuICAgICAgICBfdGhpcy5fd29ya0NlbGwgPSBuZXcgQnVmZmVyTGluZV8xLkNlbGxEYXRhKCk7XG4gICAgICAgIF90aGlzLl9zdGF0ZSA9IG5ldyBHcmlkQ2FjaGVfMS5HcmlkQ2FjaGUoKTtcbiAgICAgICAgX3RoaXMuX2NoYXJhY3RlckpvaW5lclJlZ2lzdHJ5ID0gY2hhcmFjdGVySm9pbmVyUmVnaXN0cnk7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgVGV4dFJlbmRlckxheWVyLnByb3RvdHlwZS5yZXNpemUgPSBmdW5jdGlvbiAodGVybWluYWwsIGRpbSkge1xuICAgICAgICBfc3VwZXIucHJvdG90eXBlLnJlc2l6ZS5jYWxsKHRoaXMsIHRlcm1pbmFsLCBkaW0pO1xuICAgICAgICB2YXIgdGVybWluYWxGb250ID0gdGhpcy5fZ2V0Rm9udCh0ZXJtaW5hbCwgZmFsc2UsIGZhbHNlKTtcbiAgICAgICAgaWYgKHRoaXMuX2NoYXJhY3RlcldpZHRoICE9PSBkaW0uc2NhbGVkQ2hhcldpZHRoIHx8IHRoaXMuX2NoYXJhY3RlckZvbnQgIT09IHRlcm1pbmFsRm9udCkge1xuICAgICAgICAgICAgdGhpcy5fY2hhcmFjdGVyV2lkdGggPSBkaW0uc2NhbGVkQ2hhcldpZHRoO1xuICAgICAgICAgICAgdGhpcy5fY2hhcmFjdGVyRm9udCA9IHRlcm1pbmFsRm9udDtcbiAgICAgICAgICAgIHRoaXMuX2NoYXJhY3Rlck92ZXJsYXBDYWNoZSA9IHt9O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3N0YXRlLmNsZWFyKCk7XG4gICAgICAgIHRoaXMuX3N0YXRlLnJlc2l6ZSh0ZXJtaW5hbC5jb2xzLCB0ZXJtaW5hbC5yb3dzKTtcbiAgICB9O1xuICAgIFRleHRSZW5kZXJMYXllci5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAodGVybWluYWwpIHtcbiAgICAgICAgdGhpcy5fc3RhdGUuY2xlYXIoKTtcbiAgICAgICAgdGhpcy5jbGVhckFsbCgpO1xuICAgIH07XG4gICAgVGV4dFJlbmRlckxheWVyLnByb3RvdHlwZS5fZm9yRWFjaENlbGwgPSBmdW5jdGlvbiAodGVybWluYWwsIGZpcnN0Um93LCBsYXN0Um93LCBqb2luZXJSZWdpc3RyeSwgY2FsbGJhY2spIHtcbiAgICAgICAgZm9yICh2YXIgeSA9IGZpcnN0Um93OyB5IDw9IGxhc3RSb3c7IHkrKykge1xuICAgICAgICAgICAgdmFyIHJvdyA9IHkgKyB0ZXJtaW5hbC5idWZmZXIueWRpc3A7XG4gICAgICAgICAgICB2YXIgbGluZSA9IHRlcm1pbmFsLmJ1ZmZlci5saW5lcy5nZXQocm93KTtcbiAgICAgICAgICAgIHZhciBqb2luZWRSYW5nZXMgPSBqb2luZXJSZWdpc3RyeSA/IGpvaW5lclJlZ2lzdHJ5LmdldEpvaW5lZENoYXJhY3RlcnMocm93KSA6IFtdO1xuICAgICAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB0ZXJtaW5hbC5jb2xzOyB4KyspIHtcbiAgICAgICAgICAgICAgICBsaW5lLmxvYWRDZWxsKHgsIHRoaXMuX3dvcmtDZWxsKTtcbiAgICAgICAgICAgICAgICB2YXIgY2VsbCA9IHRoaXMuX3dvcmtDZWxsO1xuICAgICAgICAgICAgICAgIHZhciBpc0pvaW5lZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHZhciBsYXN0Q2hhclggPSB4O1xuICAgICAgICAgICAgICAgIGlmIChjZWxsLmdldFdpZHRoKCkgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChqb2luZWRSYW5nZXMubGVuZ3RoID4gMCAmJiB4ID09PSBqb2luZWRSYW5nZXNbMF1bMF0pIHtcbiAgICAgICAgICAgICAgICAgICAgaXNKb2luZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB2YXIgcmFuZ2UgPSBqb2luZWRSYW5nZXMuc2hpZnQoKTtcbiAgICAgICAgICAgICAgICAgICAgY2VsbCA9IG5ldyBDaGFyYWN0ZXJKb2luZXJSZWdpc3RyeV8xLkpvaW5lZENlbGxEYXRhKHRoaXMuX3dvcmtDZWxsLCBsaW5lLnRyYW5zbGF0ZVRvU3RyaW5nKHRydWUsIHJhbmdlWzBdLCByYW5nZVsxXSksIHJhbmdlWzFdIC0gcmFuZ2VbMF0pO1xuICAgICAgICAgICAgICAgICAgICBsYXN0Q2hhclggPSByYW5nZVsxXSAtIDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghaXNKb2luZWQgJiYgdGhpcy5faXNPdmVybGFwcGluZyhjZWxsKSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobGFzdENoYXJYIDwgbGluZS5sZW5ndGggLSAxICYmIGxpbmUuZ2V0Q29kZVBvaW50KGxhc3RDaGFyWCArIDEpID09PSBCdWZmZXJMaW5lXzEuTlVMTF9DRUxMX0NPREUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNlbGwuY29udGVudCAmPSB+MTI1ODI5MTI7XG4gICAgICAgICAgICAgICAgICAgICAgICBjZWxsLmNvbnRlbnQgfD0gMiA8PCAyMjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYWxsYmFjayhjZWxsLCB4LCB5KTtcbiAgICAgICAgICAgICAgICB4ID0gbGFzdENoYXJYO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBUZXh0UmVuZGVyTGF5ZXIucHJvdG90eXBlLl9kcmF3QmFja2dyb3VuZCA9IGZ1bmN0aW9uICh0ZXJtaW5hbCwgZmlyc3RSb3csIGxhc3RSb3cpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIGN0eCA9IHRoaXMuX2N0eDtcbiAgICAgICAgdmFyIGNvbHMgPSB0ZXJtaW5hbC5jb2xzO1xuICAgICAgICB2YXIgc3RhcnRYID0gMDtcbiAgICAgICAgdmFyIHN0YXJ0WSA9IDA7XG4gICAgICAgIHZhciBwcmV2RmlsbFN0eWxlID0gbnVsbDtcbiAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgdGhpcy5fZm9yRWFjaENlbGwodGVybWluYWwsIGZpcnN0Um93LCBsYXN0Um93LCBudWxsLCBmdW5jdGlvbiAoY2VsbCwgeCwgeSkge1xuICAgICAgICAgICAgdmFyIG5leHRGaWxsU3R5bGUgPSBudWxsO1xuICAgICAgICAgICAgaWYgKGNlbGwuaXNJbnZlcnNlKCkpIHtcbiAgICAgICAgICAgICAgICBpZiAoY2VsbC5pc0ZnRGVmYXVsdCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIG5leHRGaWxsU3R5bGUgPSBfdGhpcy5fY29sb3JzLmZvcmVncm91bmQuY3NzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjZWxsLmlzRmdSR0IoKSkge1xuICAgICAgICAgICAgICAgICAgICBuZXh0RmlsbFN0eWxlID0gXCJyZ2IoXCIgKyBCdWZmZXJMaW5lXzEuQXR0cmlidXRlRGF0YS50b0NvbG9yUkdCKGNlbGwuZ2V0RmdDb2xvcigpKS5qb2luKCcsJykgKyBcIilcIjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG5leHRGaWxsU3R5bGUgPSBfdGhpcy5fY29sb3JzLmFuc2lbY2VsbC5nZXRGZ0NvbG9yKCldLmNzcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjZWxsLmlzQmdSR0IoKSkge1xuICAgICAgICAgICAgICAgIG5leHRGaWxsU3R5bGUgPSBcInJnYihcIiArIEJ1ZmZlckxpbmVfMS5BdHRyaWJ1dGVEYXRhLnRvQ29sb3JSR0IoY2VsbC5nZXRCZ0NvbG9yKCkpLmpvaW4oJywnKSArIFwiKVwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY2VsbC5pc0JnUGFsZXR0ZSgpKSB7XG4gICAgICAgICAgICAgICAgbmV4dEZpbGxTdHlsZSA9IF90aGlzLl9jb2xvcnMuYW5zaVtjZWxsLmdldEJnQ29sb3IoKV0uY3NzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHByZXZGaWxsU3R5bGUgPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBzdGFydFggPSB4O1xuICAgICAgICAgICAgICAgIHN0YXJ0WSA9IHk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoeSAhPT0gc3RhcnRZKSB7XG4gICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IHByZXZGaWxsU3R5bGU7XG4gICAgICAgICAgICAgICAgX3RoaXMuZmlsbENlbGxzKHN0YXJ0WCwgc3RhcnRZLCBjb2xzIC0gc3RhcnRYLCAxKTtcbiAgICAgICAgICAgICAgICBzdGFydFggPSB4O1xuICAgICAgICAgICAgICAgIHN0YXJ0WSA9IHk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChwcmV2RmlsbFN0eWxlICE9PSBuZXh0RmlsbFN0eWxlKSB7XG4gICAgICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IHByZXZGaWxsU3R5bGU7XG4gICAgICAgICAgICAgICAgX3RoaXMuZmlsbENlbGxzKHN0YXJ0WCwgc3RhcnRZLCB4IC0gc3RhcnRYLCAxKTtcbiAgICAgICAgICAgICAgICBzdGFydFggPSB4O1xuICAgICAgICAgICAgICAgIHN0YXJ0WSA9IHk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBwcmV2RmlsbFN0eWxlID0gbmV4dEZpbGxTdHlsZTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChwcmV2RmlsbFN0eWxlICE9PSBudWxsKSB7XG4gICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gcHJldkZpbGxTdHlsZTtcbiAgICAgICAgICAgIHRoaXMuZmlsbENlbGxzKHN0YXJ0WCwgc3RhcnRZLCBjb2xzIC0gc3RhcnRYLCAxKTtcbiAgICAgICAgfVxuICAgICAgICBjdHgucmVzdG9yZSgpO1xuICAgIH07XG4gICAgVGV4dFJlbmRlckxheWVyLnByb3RvdHlwZS5fZHJhd0ZvcmVncm91bmQgPSBmdW5jdGlvbiAodGVybWluYWwsIGZpcnN0Um93LCBsYXN0Um93KSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuX2ZvckVhY2hDZWxsKHRlcm1pbmFsLCBmaXJzdFJvdywgbGFzdFJvdywgdGhpcy5fY2hhcmFjdGVySm9pbmVyUmVnaXN0cnksIGZ1bmN0aW9uIChjZWxsLCB4LCB5KSB7XG4gICAgICAgICAgICBpZiAoY2VsbC5pc0ludmlzaWJsZSgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNlbGwuaXNVbmRlcmxpbmUoKSkge1xuICAgICAgICAgICAgICAgIF90aGlzLl9jdHguc2F2ZSgpO1xuICAgICAgICAgICAgICAgIGlmIChjZWxsLmlzSW52ZXJzZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjZWxsLmlzQmdEZWZhdWx0KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLl9jdHguZmlsbFN0eWxlID0gX3RoaXMuX2NvbG9ycy5iYWNrZ3JvdW5kLmNzcztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChjZWxsLmlzQmdSR0IoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuX2N0eC5maWxsU3R5bGUgPSBcInJnYihcIiArIEJ1ZmZlckxpbmVfMS5BdHRyaWJ1dGVEYXRhLnRvQ29sb3JSR0IoY2VsbC5nZXRCZ0NvbG9yKCkpLmpvaW4oJywnKSArIFwiKVwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuX2N0eC5maWxsU3R5bGUgPSBfdGhpcy5fY29sb3JzLmFuc2lbY2VsbC5nZXRCZ0NvbG9yKCldLmNzcztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNlbGwuaXNGZ0RlZmF1bHQoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuX2N0eC5maWxsU3R5bGUgPSBfdGhpcy5fY29sb3JzLmZvcmVncm91bmQuY3NzO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNlbGwuaXNGZ1JHQigpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5fY3R4LmZpbGxTdHlsZSA9IFwicmdiKFwiICsgQnVmZmVyTGluZV8xLkF0dHJpYnV0ZURhdGEudG9Db2xvclJHQihjZWxsLmdldEZnQ29sb3IoKSkuam9pbignLCcpICsgXCIpXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZmcgPSBjZWxsLmdldEZnQ29sb3IoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0ZXJtaW5hbC5vcHRpb25zLmRyYXdCb2xkVGV4dEluQnJpZ2h0Q29sb3JzICYmIGNlbGwuaXNCb2xkKCkgJiYgZmcgPCA4KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmcgKz0gODtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLl9jdHguZmlsbFN0eWxlID0gX3RoaXMuX2NvbG9ycy5hbnNpW2ZnXS5jc3M7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgX3RoaXMuZmlsbEJvdHRvbUxpbmVBdENlbGxzKHgsIHksIGNlbGwuZ2V0V2lkdGgoKSk7XG4gICAgICAgICAgICAgICAgX3RoaXMuX2N0eC5yZXN0b3JlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBfdGhpcy5kcmF3Q2hhcnModGVybWluYWwsIGNlbGwsIHgsIHkpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFRleHRSZW5kZXJMYXllci5wcm90b3R5cGUub25HcmlkQ2hhbmdlZCA9IGZ1bmN0aW9uICh0ZXJtaW5hbCwgZmlyc3RSb3csIGxhc3RSb3cpIHtcbiAgICAgICAgaWYgKHRoaXMuX3N0YXRlLmNhY2hlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLl9jaGFyQXRsYXMpIHtcbiAgICAgICAgICAgIHRoaXMuX2NoYXJBdGxhcy5iZWdpbkZyYW1lKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jbGVhckNlbGxzKDAsIGZpcnN0Um93LCB0ZXJtaW5hbC5jb2xzLCBsYXN0Um93IC0gZmlyc3RSb3cgKyAxKTtcbiAgICAgICAgdGhpcy5fZHJhd0JhY2tncm91bmQodGVybWluYWwsIGZpcnN0Um93LCBsYXN0Um93KTtcbiAgICAgICAgdGhpcy5fZHJhd0ZvcmVncm91bmQodGVybWluYWwsIGZpcnN0Um93LCBsYXN0Um93KTtcbiAgICB9O1xuICAgIFRleHRSZW5kZXJMYXllci5wcm90b3R5cGUub25PcHRpb25zQ2hhbmdlZCA9IGZ1bmN0aW9uICh0ZXJtaW5hbCkge1xuICAgICAgICB0aGlzLnNldFRyYW5zcGFyZW5jeSh0ZXJtaW5hbCwgdGVybWluYWwub3B0aW9ucy5hbGxvd1RyYW5zcGFyZW5jeSk7XG4gICAgfTtcbiAgICBUZXh0UmVuZGVyTGF5ZXIucHJvdG90eXBlLl9pc092ZXJsYXBwaW5nID0gZnVuY3Rpb24gKGNlbGwpIHtcbiAgICAgICAgaWYgKGNlbGwuZ2V0V2lkdGgoKSAhPT0gMSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjZWxsLmdldENvZGUoKSA8IDI1Nikge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjaGFycyA9IGNlbGwuZ2V0Q2hhcnMoKTtcbiAgICAgICAgaWYgKHRoaXMuX2NoYXJhY3Rlck92ZXJsYXBDYWNoZS5oYXNPd25Qcm9wZXJ0eShjaGFycykpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jaGFyYWN0ZXJPdmVybGFwQ2FjaGVbY2hhcnNdO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2N0eC5zYXZlKCk7XG4gICAgICAgIHRoaXMuX2N0eC5mb250ID0gdGhpcy5fY2hhcmFjdGVyRm9udDtcbiAgICAgICAgdmFyIG92ZXJsYXBzID0gTWF0aC5mbG9vcih0aGlzLl9jdHgubWVhc3VyZVRleHQoY2hhcnMpLndpZHRoKSA+IHRoaXMuX2NoYXJhY3RlcldpZHRoO1xuICAgICAgICB0aGlzLl9jdHgucmVzdG9yZSgpO1xuICAgICAgICB0aGlzLl9jaGFyYWN0ZXJPdmVybGFwQ2FjaGVbY2hhcnNdID0gb3ZlcmxhcHM7XG4gICAgICAgIHJldHVybiBvdmVybGFwcztcbiAgICB9O1xuICAgIHJldHVybiBUZXh0UmVuZGVyTGF5ZXI7XG59KEJhc2VSZW5kZXJMYXllcl8xLkJhc2VSZW5kZXJMYXllcikpO1xuZXhwb3J0cy5UZXh0UmVuZGVyTGF5ZXIgPSBUZXh0UmVuZGVyTGF5ZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1UZXh0UmVuZGVyTGF5ZXIuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgQmFzZUNoYXJBdGxhcyA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQmFzZUNoYXJBdGxhcygpIHtcbiAgICAgICAgdGhpcy5fZGlkV2FybVVwID0gZmFsc2U7XG4gICAgfVxuICAgIEJhc2VDaGFyQXRsYXMucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7IH07XG4gICAgQmFzZUNoYXJBdGxhcy5wcm90b3R5cGUud2FybVVwID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuX2RpZFdhcm1VcCkge1xuICAgICAgICAgICAgdGhpcy5fZG9XYXJtVXAoKTtcbiAgICAgICAgICAgIHRoaXMuX2RpZFdhcm1VcCA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEJhc2VDaGFyQXRsYXMucHJvdG90eXBlLl9kb1dhcm1VcCA9IGZ1bmN0aW9uICgpIHsgfTtcbiAgICBCYXNlQ2hhckF0bGFzLnByb3RvdHlwZS5iZWdpbkZyYW1lID0gZnVuY3Rpb24gKCkgeyB9O1xuICAgIHJldHVybiBCYXNlQ2hhckF0bGFzO1xufSgpKTtcbmV4cG9ydHMuZGVmYXVsdCA9IEJhc2VDaGFyQXRsYXM7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1CYXNlQ2hhckF0bGFzLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIENoYXJBdGxhc1V0aWxzXzEgPSByZXF1aXJlKFwiLi9DaGFyQXRsYXNVdGlsc1wiKTtcbnZhciBEeW5hbWljQ2hhckF0bGFzXzEgPSByZXF1aXJlKFwiLi9EeW5hbWljQ2hhckF0bGFzXCIpO1xudmFyIE5vbmVDaGFyQXRsYXNfMSA9IHJlcXVpcmUoXCIuL05vbmVDaGFyQXRsYXNcIik7XG52YXIgU3RhdGljQ2hhckF0bGFzXzEgPSByZXF1aXJlKFwiLi9TdGF0aWNDaGFyQXRsYXNcIik7XG52YXIgY2hhckF0bGFzSW1wbGVtZW50YXRpb25zID0ge1xuICAgICdub25lJzogTm9uZUNoYXJBdGxhc18xLmRlZmF1bHQsXG4gICAgJ3N0YXRpYyc6IFN0YXRpY0NoYXJBdGxhc18xLmRlZmF1bHQsXG4gICAgJ2R5bmFtaWMnOiBEeW5hbWljQ2hhckF0bGFzXzEuZGVmYXVsdFxufTtcbnZhciBjaGFyQXRsYXNDYWNoZSA9IFtdO1xuZnVuY3Rpb24gYWNxdWlyZUNoYXJBdGxhcyh0ZXJtaW5hbCwgY29sb3JzLCBzY2FsZWRDaGFyV2lkdGgsIHNjYWxlZENoYXJIZWlnaHQpIHtcbiAgICB2YXIgbmV3Q29uZmlnID0gQ2hhckF0bGFzVXRpbHNfMS5nZW5lcmF0ZUNvbmZpZyhzY2FsZWRDaGFyV2lkdGgsIHNjYWxlZENoYXJIZWlnaHQsIHRlcm1pbmFsLCBjb2xvcnMpO1xuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhckF0bGFzQ2FjaGUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGVudHJ5ID0gY2hhckF0bGFzQ2FjaGVbaV07XG4gICAgICAgIHZhciBvd25lZEJ5SW5kZXggPSBlbnRyeS5vd25lZEJ5LmluZGV4T2YodGVybWluYWwpO1xuICAgICAgICBpZiAob3duZWRCeUluZGV4ID49IDApIHtcbiAgICAgICAgICAgIGlmIChDaGFyQXRsYXNVdGlsc18xLmNvbmZpZ0VxdWFscyhlbnRyeS5jb25maWcsIG5ld0NvbmZpZykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZW50cnkuYXRsYXM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZW50cnkub3duZWRCeS5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICBlbnRyeS5hdGxhcy5kaXNwb3NlKCk7XG4gICAgICAgICAgICAgICAgY2hhckF0bGFzQ2FjaGUuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZW50cnkub3duZWRCeS5zcGxpY2Uob3duZWRCeUluZGV4LCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhckF0bGFzQ2FjaGUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdmFyIGVudHJ5ID0gY2hhckF0bGFzQ2FjaGVbaV07XG4gICAgICAgIGlmIChDaGFyQXRsYXNVdGlsc18xLmNvbmZpZ0VxdWFscyhlbnRyeS5jb25maWcsIG5ld0NvbmZpZykpIHtcbiAgICAgICAgICAgIGVudHJ5Lm93bmVkQnkucHVzaCh0ZXJtaW5hbCk7XG4gICAgICAgICAgICByZXR1cm4gZW50cnkuYXRsYXM7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdmFyIG5ld0VudHJ5ID0ge1xuICAgICAgICBhdGxhczogbmV3IGNoYXJBdGxhc0ltcGxlbWVudGF0aW9uc1t0ZXJtaW5hbC5vcHRpb25zLmV4cGVyaW1lbnRhbENoYXJBdGxhc10oZG9jdW1lbnQsIG5ld0NvbmZpZyksXG4gICAgICAgIGNvbmZpZzogbmV3Q29uZmlnLFxuICAgICAgICBvd25lZEJ5OiBbdGVybWluYWxdXG4gICAgfTtcbiAgICBjaGFyQXRsYXNDYWNoZS5wdXNoKG5ld0VudHJ5KTtcbiAgICByZXR1cm4gbmV3RW50cnkuYXRsYXM7XG59XG5leHBvcnRzLmFjcXVpcmVDaGFyQXRsYXMgPSBhY3F1aXJlQ2hhckF0bGFzO1xuZnVuY3Rpb24gcmVtb3ZlVGVybWluYWxGcm9tQ2FjaGUodGVybWluYWwpIHtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoYXJBdGxhc0NhY2hlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIHZhciBpbmRleCA9IGNoYXJBdGxhc0NhY2hlW2ldLm93bmVkQnkuaW5kZXhPZih0ZXJtaW5hbCk7XG4gICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgIGlmIChjaGFyQXRsYXNDYWNoZVtpXS5vd25lZEJ5Lmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIGNoYXJBdGxhc0NhY2hlW2ldLmF0bGFzLmRpc3Bvc2UoKTtcbiAgICAgICAgICAgICAgICBjaGFyQXRsYXNDYWNoZS5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjaGFyQXRsYXNDYWNoZVtpXS5vd25lZEJ5LnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydHMucmVtb3ZlVGVybWluYWxGcm9tQ2FjaGUgPSByZW1vdmVUZXJtaW5hbEZyb21DYWNoZTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUNoYXJBdGxhc0NhY2hlLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIFBsYXRmb3JtXzEgPSByZXF1aXJlKFwiLi4vLi4vY29tbW9uL1BsYXRmb3JtXCIpO1xudmFyIFR5cGVzXzEgPSByZXF1aXJlKFwiLi9UeXBlc1wiKTtcbmZ1bmN0aW9uIGdlbmVyYXRlU3RhdGljQ2hhckF0bGFzVGV4dHVyZShjb250ZXh0LCBjYW52YXNGYWN0b3J5LCBjb25maWcpIHtcbiAgICB2YXIgY2VsbFdpZHRoID0gY29uZmlnLnNjYWxlZENoYXJXaWR0aCArIFR5cGVzXzEuQ0hBUl9BVExBU19DRUxMX1NQQUNJTkc7XG4gICAgdmFyIGNlbGxIZWlnaHQgPSBjb25maWcuc2NhbGVkQ2hhckhlaWdodCArIFR5cGVzXzEuQ0hBUl9BVExBU19DRUxMX1NQQUNJTkc7XG4gICAgdmFyIGNhbnZhcyA9IGNhbnZhc0ZhY3RvcnkoMjU1ICogY2VsbFdpZHRoLCAoMiArIDE2ICsgMTYpICogY2VsbEhlaWdodCk7XG4gICAgdmFyIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcsIHsgYWxwaGE6IGNvbmZpZy5hbGxvd1RyYW5zcGFyZW5jeSB9KTtcbiAgICBjdHguZmlsbFN0eWxlID0gY29uZmlnLmNvbG9ycy5iYWNrZ3JvdW5kLmNzcztcbiAgICBjdHguZmlsbFJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTtcbiAgICBjdHguc2F2ZSgpO1xuICAgIGN0eC5maWxsU3R5bGUgPSBjb25maWcuY29sb3JzLmZvcmVncm91bmQuY3NzO1xuICAgIGN0eC5mb250ID0gZ2V0Rm9udChjb25maWcuZm9udFdlaWdodCwgY29uZmlnKTtcbiAgICBjdHgudGV4dEJhc2VsaW5lID0gJ21pZGRsZSc7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyNTY7IGkrKykge1xuICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgICAgIGN0eC5yZWN0KGkgKiBjZWxsV2lkdGgsIDAsIGNlbGxXaWR0aCwgY2VsbEhlaWdodCk7XG4gICAgICAgIGN0eC5jbGlwKCk7XG4gICAgICAgIGN0eC5maWxsVGV4dChTdHJpbmcuZnJvbUNoYXJDb2RlKGkpLCBpICogY2VsbFdpZHRoLCBjZWxsSGVpZ2h0IC8gMik7XG4gICAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgfVxuICAgIGN0eC5zYXZlKCk7XG4gICAgY3R4LmZvbnQgPSBnZXRGb250KGNvbmZpZy5mb250V2VpZ2h0Qm9sZCwgY29uZmlnKTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI1NjsgaSsrKSB7XG4gICAgICAgIGN0eC5zYXZlKCk7XG4gICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgY3R4LnJlY3QoaSAqIGNlbGxXaWR0aCwgY2VsbEhlaWdodCwgY2VsbFdpZHRoLCBjZWxsSGVpZ2h0KTtcbiAgICAgICAgY3R4LmNsaXAoKTtcbiAgICAgICAgY3R4LmZpbGxUZXh0KFN0cmluZy5mcm9tQ2hhckNvZGUoaSksIGkgKiBjZWxsV2lkdGgsIGNlbGxIZWlnaHQgKiAxLjUpO1xuICAgICAgICBjdHgucmVzdG9yZSgpO1xuICAgIH1cbiAgICBjdHgucmVzdG9yZSgpO1xuICAgIGN0eC5mb250ID0gZ2V0Rm9udChjb25maWcuZm9udFdlaWdodCwgY29uZmlnKTtcbiAgICBmb3IgKHZhciBjb2xvckluZGV4ID0gMDsgY29sb3JJbmRleCA8IDE2OyBjb2xvckluZGV4KyspIHtcbiAgICAgICAgdmFyIHkgPSAoY29sb3JJbmRleCArIDIpICogY2VsbEhlaWdodDtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAyNTY7IGkrKykge1xuICAgICAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgIGN0eC5yZWN0KGkgKiBjZWxsV2lkdGgsIHksIGNlbGxXaWR0aCwgY2VsbEhlaWdodCk7XG4gICAgICAgICAgICBjdHguY2xpcCgpO1xuICAgICAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGNvbmZpZy5jb2xvcnMuYW5zaVtjb2xvckluZGV4XS5jc3M7XG4gICAgICAgICAgICBjdHguZmlsbFRleHQoU3RyaW5nLmZyb21DaGFyQ29kZShpKSwgaSAqIGNlbGxXaWR0aCwgeSArIGNlbGxIZWlnaHQgLyAyKTtcbiAgICAgICAgICAgIGN0eC5yZXN0b3JlKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY3R4LmZvbnQgPSBnZXRGb250KGNvbmZpZy5mb250V2VpZ2h0Qm9sZCwgY29uZmlnKTtcbiAgICBmb3IgKHZhciBjb2xvckluZGV4ID0gMDsgY29sb3JJbmRleCA8IDE2OyBjb2xvckluZGV4KyspIHtcbiAgICAgICAgdmFyIHkgPSAoY29sb3JJbmRleCArIDIgKyAxNikgKiBjZWxsSGVpZ2h0O1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IDI1NjsgaSsrKSB7XG4gICAgICAgICAgICBjdHguc2F2ZSgpO1xuICAgICAgICAgICAgY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgY3R4LnJlY3QoaSAqIGNlbGxXaWR0aCwgeSwgY2VsbFdpZHRoLCBjZWxsSGVpZ2h0KTtcbiAgICAgICAgICAgIGN0eC5jbGlwKCk7XG4gICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gY29uZmlnLmNvbG9ycy5hbnNpW2NvbG9ySW5kZXhdLmNzcztcbiAgICAgICAgICAgIGN0eC5maWxsVGV4dChTdHJpbmcuZnJvbUNoYXJDb2RlKGkpLCBpICogY2VsbFdpZHRoLCB5ICsgY2VsbEhlaWdodCAvIDIpO1xuICAgICAgICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjdHgucmVzdG9yZSgpO1xuICAgIGlmICghKCdjcmVhdGVJbWFnZUJpdG1hcCcgaW4gY29udGV4dCkgfHwgUGxhdGZvcm1fMS5pc0ZpcmVmb3ggfHwgUGxhdGZvcm1fMS5pc1NhZmFyaSkge1xuICAgICAgICByZXR1cm4gY2FudmFzO1xuICAgIH1cbiAgICB2YXIgY2hhckF0bGFzSW1hZ2VEYXRhID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgIGNsZWFyQ29sb3IoY2hhckF0bGFzSW1hZ2VEYXRhLCBjb25maWcuY29sb3JzLmJhY2tncm91bmQpO1xuICAgIHJldHVybiBjb250ZXh0LmNyZWF0ZUltYWdlQml0bWFwKGNoYXJBdGxhc0ltYWdlRGF0YSk7XG59XG5leHBvcnRzLmdlbmVyYXRlU3RhdGljQ2hhckF0bGFzVGV4dHVyZSA9IGdlbmVyYXRlU3RhdGljQ2hhckF0bGFzVGV4dHVyZTtcbmZ1bmN0aW9uIGNsZWFyQ29sb3IoaW1hZ2VEYXRhLCBjb2xvcikge1xuICAgIHZhciBpc0VtcHR5ID0gdHJ1ZTtcbiAgICB2YXIgciA9IGNvbG9yLnJnYmEgPj4+IDI0O1xuICAgIHZhciBnID0gY29sb3IucmdiYSA+Pj4gMTYgJiAweEZGO1xuICAgIHZhciBiID0gY29sb3IucmdiYSA+Pj4gOCAmIDB4RkY7XG4gICAgZm9yICh2YXIgb2Zmc2V0ID0gMDsgb2Zmc2V0IDwgaW1hZ2VEYXRhLmRhdGEubGVuZ3RoOyBvZmZzZXQgKz0gNCkge1xuICAgICAgICBpZiAoaW1hZ2VEYXRhLmRhdGFbb2Zmc2V0XSA9PT0gciAmJlxuICAgICAgICAgICAgaW1hZ2VEYXRhLmRhdGFbb2Zmc2V0ICsgMV0gPT09IGcgJiZcbiAgICAgICAgICAgIGltYWdlRGF0YS5kYXRhW29mZnNldCArIDJdID09PSBiKSB7XG4gICAgICAgICAgICBpbWFnZURhdGEuZGF0YVtvZmZzZXQgKyAzXSA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpc0VtcHR5ID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGlzRW1wdHk7XG59XG5leHBvcnRzLmNsZWFyQ29sb3IgPSBjbGVhckNvbG9yO1xuZnVuY3Rpb24gZ2V0Rm9udChmb250V2VpZ2h0LCBjb25maWcpIHtcbiAgICByZXR1cm4gZm9udFdlaWdodCArIFwiIFwiICsgY29uZmlnLmZvbnRTaXplICogY29uZmlnLmRldmljZVBpeGVsUmF0aW8gKyBcInB4IFwiICsgY29uZmlnLmZvbnRGYW1pbHk7XG59XG4vLyMgc291cmNlTWFwcGluZ1VSTD1DaGFyQXRsYXNHZW5lcmF0b3IuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgVHlwZXNfMSA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vVHlwZXNcIik7XG5mdW5jdGlvbiBnZW5lcmF0ZUNvbmZpZyhzY2FsZWRDaGFyV2lkdGgsIHNjYWxlZENoYXJIZWlnaHQsIHRlcm1pbmFsLCBjb2xvcnMpIHtcbiAgICB2YXIgY2xvbmVkQ29sb3JzID0ge1xuICAgICAgICBmb3JlZ3JvdW5kOiBjb2xvcnMuZm9yZWdyb3VuZCxcbiAgICAgICAgYmFja2dyb3VuZDogY29sb3JzLmJhY2tncm91bmQsXG4gICAgICAgIGN1cnNvcjogbnVsbCxcbiAgICAgICAgY3Vyc29yQWNjZW50OiBudWxsLFxuICAgICAgICBzZWxlY3Rpb246IG51bGwsXG4gICAgICAgIGFuc2k6IGNvbG9ycy5hbnNpLnNsaWNlKDAsIDE2KVxuICAgIH07XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZTogdGVybWluYWwub3B0aW9ucy5leHBlcmltZW50YWxDaGFyQXRsYXMsXG4gICAgICAgIGRldmljZVBpeGVsUmF0aW86IHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvLFxuICAgICAgICBzY2FsZWRDaGFyV2lkdGg6IHNjYWxlZENoYXJXaWR0aCxcbiAgICAgICAgc2NhbGVkQ2hhckhlaWdodDogc2NhbGVkQ2hhckhlaWdodCxcbiAgICAgICAgZm9udEZhbWlseTogdGVybWluYWwub3B0aW9ucy5mb250RmFtaWx5LFxuICAgICAgICBmb250U2l6ZTogdGVybWluYWwub3B0aW9ucy5mb250U2l6ZSxcbiAgICAgICAgZm9udFdlaWdodDogdGVybWluYWwub3B0aW9ucy5mb250V2VpZ2h0LFxuICAgICAgICBmb250V2VpZ2h0Qm9sZDogdGVybWluYWwub3B0aW9ucy5mb250V2VpZ2h0Qm9sZCxcbiAgICAgICAgYWxsb3dUcmFuc3BhcmVuY3k6IHRlcm1pbmFsLm9wdGlvbnMuYWxsb3dUcmFuc3BhcmVuY3ksXG4gICAgICAgIGNvbG9yczogY2xvbmVkQ29sb3JzXG4gICAgfTtcbn1cbmV4cG9ydHMuZ2VuZXJhdGVDb25maWcgPSBnZW5lcmF0ZUNvbmZpZztcbmZ1bmN0aW9uIGNvbmZpZ0VxdWFscyhhLCBiKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhLmNvbG9ycy5hbnNpLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChhLmNvbG9ycy5hbnNpW2ldLnJnYmEgIT09IGIuY29sb3JzLmFuc2lbaV0ucmdiYSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBhLnR5cGUgPT09IGIudHlwZSAmJlxuICAgICAgICBhLmRldmljZVBpeGVsUmF0aW8gPT09IGIuZGV2aWNlUGl4ZWxSYXRpbyAmJlxuICAgICAgICBhLmZvbnRGYW1pbHkgPT09IGIuZm9udEZhbWlseSAmJlxuICAgICAgICBhLmZvbnRTaXplID09PSBiLmZvbnRTaXplICYmXG4gICAgICAgIGEuZm9udFdlaWdodCA9PT0gYi5mb250V2VpZ2h0ICYmXG4gICAgICAgIGEuZm9udFdlaWdodEJvbGQgPT09IGIuZm9udFdlaWdodEJvbGQgJiZcbiAgICAgICAgYS5hbGxvd1RyYW5zcGFyZW5jeSA9PT0gYi5hbGxvd1RyYW5zcGFyZW5jeSAmJlxuICAgICAgICBhLnNjYWxlZENoYXJXaWR0aCA9PT0gYi5zY2FsZWRDaGFyV2lkdGggJiZcbiAgICAgICAgYS5zY2FsZWRDaGFySGVpZ2h0ID09PSBiLnNjYWxlZENoYXJIZWlnaHQgJiZcbiAgICAgICAgYS5jb2xvcnMuZm9yZWdyb3VuZCA9PT0gYi5jb2xvcnMuZm9yZWdyb3VuZCAmJlxuICAgICAgICBhLmNvbG9ycy5iYWNrZ3JvdW5kID09PSBiLmNvbG9ycy5iYWNrZ3JvdW5kO1xufVxuZXhwb3J0cy5jb25maWdFcXVhbHMgPSBjb25maWdFcXVhbHM7XG5mdW5jdGlvbiBpczI1NkNvbG9yKGNvbG9yQ29kZSkge1xuICAgIHJldHVybiBjb2xvckNvZGUgPCBUeXBlc18xLkRFRkFVTFRfQ09MT1I7XG59XG5leHBvcnRzLmlzMjU2Q29sb3IgPSBpczI1NkNvbG9yO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Q2hhckF0bGFzVXRpbHMuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBUeXBlc18xID0gcmVxdWlyZShcIi4vVHlwZXNcIik7XG52YXIgQmFzZUNoYXJBdGxhc18xID0gcmVxdWlyZShcIi4vQmFzZUNoYXJBdGxhc1wiKTtcbnZhciBDb2xvck1hbmFnZXJfMSA9IHJlcXVpcmUoXCIuLi9Db2xvck1hbmFnZXJcIik7XG52YXIgQ2hhckF0bGFzR2VuZXJhdG9yXzEgPSByZXF1aXJlKFwiLi9DaGFyQXRsYXNHZW5lcmF0b3JcIik7XG52YXIgTFJVTWFwXzEgPSByZXF1aXJlKFwiLi9MUlVNYXBcIik7XG52YXIgUGxhdGZvcm1fMSA9IHJlcXVpcmUoXCIuLi8uLi9jb21tb24vUGxhdGZvcm1cIik7XG52YXIgVEVYVFVSRV9XSURUSCA9IDEwMjQ7XG52YXIgVEVYVFVSRV9IRUlHSFQgPSAxMDI0O1xudmFyIFRSQU5TUEFSRU5UX0NPTE9SID0ge1xuICAgIGNzczogJ3JnYmEoMCwgMCwgMCwgMCknLFxuICAgIHJnYmE6IDBcbn07XG52YXIgRlJBTUVfQ0FDSEVfRFJBV19MSU1JVCA9IDEwMDtcbnZhciBHTFlQSF9CSVRNQVBfQ09NTUlUX0RFTEFZID0gMTAwO1xuZnVuY3Rpb24gZ2V0R2x5cGhDYWNoZUtleShnbHlwaCkge1xuICAgIHJldHVybiBnbHlwaC5jb2RlIDw8IDIxIHwgZ2x5cGguYmcgPDwgMTIgfCBnbHlwaC5mZyA8PCAzIHwgKGdseXBoLmJvbGQgPyAwIDogNCkgKyAoZ2x5cGguZGltID8gMCA6IDIpICsgKGdseXBoLml0YWxpYyA/IDAgOiAxKTtcbn1cbmV4cG9ydHMuZ2V0R2x5cGhDYWNoZUtleSA9IGdldEdseXBoQ2FjaGVLZXk7XG52YXIgRHluYW1pY0NoYXJBdGxhcyA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKER5bmFtaWNDaGFyQXRsYXMsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gRHluYW1pY0NoYXJBdGxhcyhkb2N1bWVudCwgX2NvbmZpZykge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5fY29uZmlnID0gX2NvbmZpZztcbiAgICAgICAgX3RoaXMuX2RyYXdUb0NhY2hlQ291bnQgPSAwO1xuICAgICAgICBfdGhpcy5fZ2x5cGhzV2FpdGluZ09uQml0bWFwID0gW107XG4gICAgICAgIF90aGlzLl9iaXRtYXBDb21taXRUaW1lb3V0ID0gbnVsbDtcbiAgICAgICAgX3RoaXMuX2JpdG1hcCA9IG51bGw7XG4gICAgICAgIF90aGlzLl9jYWNoZUNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgICAgICBfdGhpcy5fY2FjaGVDYW52YXMud2lkdGggPSBURVhUVVJFX1dJRFRIO1xuICAgICAgICBfdGhpcy5fY2FjaGVDYW52YXMuaGVpZ2h0ID0gVEVYVFVSRV9IRUlHSFQ7XG4gICAgICAgIF90aGlzLl9jYWNoZUN0eCA9IF90aGlzLl9jYWNoZUNhbnZhcy5nZXRDb250ZXh0KCcyZCcsIHsgYWxwaGE6IHRydWUgfSk7XG4gICAgICAgIHZhciB0bXBDYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICAgICAgdG1wQ2FudmFzLndpZHRoID0gX3RoaXMuX2NvbmZpZy5zY2FsZWRDaGFyV2lkdGg7XG4gICAgICAgIHRtcENhbnZhcy5oZWlnaHQgPSBfdGhpcy5fY29uZmlnLnNjYWxlZENoYXJIZWlnaHQ7XG4gICAgICAgIF90aGlzLl90bXBDdHggPSB0bXBDYW52YXMuZ2V0Q29udGV4dCgnMmQnLCB7IGFscGhhOiBfdGhpcy5fY29uZmlnLmFsbG93VHJhbnNwYXJlbmN5IH0pO1xuICAgICAgICBfdGhpcy5fd2lkdGggPSBNYXRoLmZsb29yKFRFWFRVUkVfV0lEVEggLyBfdGhpcy5fY29uZmlnLnNjYWxlZENoYXJXaWR0aCk7XG4gICAgICAgIF90aGlzLl9oZWlnaHQgPSBNYXRoLmZsb29yKFRFWFRVUkVfSEVJR0hUIC8gX3RoaXMuX2NvbmZpZy5zY2FsZWRDaGFySGVpZ2h0KTtcbiAgICAgICAgdmFyIGNhcGFjaXR5ID0gX3RoaXMuX3dpZHRoICogX3RoaXMuX2hlaWdodDtcbiAgICAgICAgX3RoaXMuX2NhY2hlTWFwID0gbmV3IExSVU1hcF8xLmRlZmF1bHQoY2FwYWNpdHkpO1xuICAgICAgICBfdGhpcy5fY2FjaGVNYXAucHJlYWxsb2MoY2FwYWNpdHkpO1xuICAgICAgICByZXR1cm4gX3RoaXM7XG4gICAgfVxuICAgIER5bmFtaWNDaGFyQXRsYXMucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl9iaXRtYXBDb21taXRUaW1lb3V0ICE9PSBudWxsKSB7XG4gICAgICAgICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMuX2JpdG1hcENvbW1pdFRpbWVvdXQpO1xuICAgICAgICAgICAgdGhpcy5fYml0bWFwQ29tbWl0VGltZW91dCA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIER5bmFtaWNDaGFyQXRsYXMucHJvdG90eXBlLmJlZ2luRnJhbWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX2RyYXdUb0NhY2hlQ291bnQgPSAwO1xuICAgIH07XG4gICAgRHluYW1pY0NoYXJBdGxhcy5wcm90b3R5cGUuZHJhdyA9IGZ1bmN0aW9uIChjdHgsIGdseXBoLCB4LCB5KSB7XG4gICAgICAgIGlmIChnbHlwaC5jb2RlID09PSAzMikge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLl9jYW5DYWNoZShnbHlwaCkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZ2x5cGhLZXkgPSBnZXRHbHlwaENhY2hlS2V5KGdseXBoKTtcbiAgICAgICAgdmFyIGNhY2hlVmFsdWUgPSB0aGlzLl9jYWNoZU1hcC5nZXQoZ2x5cGhLZXkpO1xuICAgICAgICBpZiAoY2FjaGVWYWx1ZSAhPT0gbnVsbCAmJiBjYWNoZVZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuX2RyYXdGcm9tQ2FjaGUoY3R4LCBjYWNoZVZhbHVlLCB4LCB5KTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMuX2RyYXdUb0NhY2hlQ291bnQgPCBGUkFNRV9DQUNIRV9EUkFXX0xJTUlUKSB7XG4gICAgICAgICAgICB2YXIgaW5kZXggPSB2b2lkIDA7XG4gICAgICAgICAgICBpZiAodGhpcy5fY2FjaGVNYXAuc2l6ZSA8IHRoaXMuX2NhY2hlTWFwLmNhcGFjaXR5KSB7XG4gICAgICAgICAgICAgICAgaW5kZXggPSB0aGlzLl9jYWNoZU1hcC5zaXplO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaW5kZXggPSB0aGlzLl9jYWNoZU1hcC5wZWVrKCkuaW5kZXg7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgY2FjaGVWYWx1ZV8xID0gdGhpcy5fZHJhd1RvQ2FjaGUoZ2x5cGgsIGluZGV4KTtcbiAgICAgICAgICAgIHRoaXMuX2NhY2hlTWFwLnNldChnbHlwaEtleSwgY2FjaGVWYWx1ZV8xKTtcbiAgICAgICAgICAgIHRoaXMuX2RyYXdGcm9tQ2FjaGUoY3R4LCBjYWNoZVZhbHVlXzEsIHgsIHkpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgRHluYW1pY0NoYXJBdGxhcy5wcm90b3R5cGUuX2NhbkNhY2hlID0gZnVuY3Rpb24gKGdseXBoKSB7XG4gICAgICAgIHJldHVybiBnbHlwaC5jb2RlIDwgMjU2O1xuICAgIH07XG4gICAgRHluYW1pY0NoYXJBdGxhcy5wcm90b3R5cGUuX3RvQ29vcmRpbmF0ZVggPSBmdW5jdGlvbiAoaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIChpbmRleCAlIHRoaXMuX3dpZHRoKSAqIHRoaXMuX2NvbmZpZy5zY2FsZWRDaGFyV2lkdGg7XG4gICAgfTtcbiAgICBEeW5hbWljQ2hhckF0bGFzLnByb3RvdHlwZS5fdG9Db29yZGluYXRlWSA9IGZ1bmN0aW9uIChpbmRleCkge1xuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihpbmRleCAvIHRoaXMuX3dpZHRoKSAqIHRoaXMuX2NvbmZpZy5zY2FsZWRDaGFySGVpZ2h0O1xuICAgIH07XG4gICAgRHluYW1pY0NoYXJBdGxhcy5wcm90b3R5cGUuX2RyYXdGcm9tQ2FjaGUgPSBmdW5jdGlvbiAoY3R4LCBjYWNoZVZhbHVlLCB4LCB5KSB7XG4gICAgICAgIGlmIChjYWNoZVZhbHVlLmlzRW1wdHkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgY2FjaGVYID0gdGhpcy5fdG9Db29yZGluYXRlWChjYWNoZVZhbHVlLmluZGV4KTtcbiAgICAgICAgdmFyIGNhY2hlWSA9IHRoaXMuX3RvQ29vcmRpbmF0ZVkoY2FjaGVWYWx1ZS5pbmRleCk7XG4gICAgICAgIGN0eC5kcmF3SW1hZ2UoY2FjaGVWYWx1ZS5pbkJpdG1hcCA/IHRoaXMuX2JpdG1hcCA6IHRoaXMuX2NhY2hlQ2FudmFzLCBjYWNoZVgsIGNhY2hlWSwgdGhpcy5fY29uZmlnLnNjYWxlZENoYXJXaWR0aCwgdGhpcy5fY29uZmlnLnNjYWxlZENoYXJIZWlnaHQsIHgsIHksIHRoaXMuX2NvbmZpZy5zY2FsZWRDaGFyV2lkdGgsIHRoaXMuX2NvbmZpZy5zY2FsZWRDaGFySGVpZ2h0KTtcbiAgICB9O1xuICAgIER5bmFtaWNDaGFyQXRsYXMucHJvdG90eXBlLl9nZXRDb2xvckZyb21BbnNpSW5kZXggPSBmdW5jdGlvbiAoaWR4KSB7XG4gICAgICAgIGlmIChpZHggPCB0aGlzLl9jb25maWcuY29sb3JzLmFuc2kubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fY29uZmlnLmNvbG9ycy5hbnNpW2lkeF07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIENvbG9yTWFuYWdlcl8xLkRFRkFVTFRfQU5TSV9DT0xPUlNbaWR4XTtcbiAgICB9O1xuICAgIER5bmFtaWNDaGFyQXRsYXMucHJvdG90eXBlLl9nZXRCYWNrZ3JvdW5kQ29sb3IgPSBmdW5jdGlvbiAoZ2x5cGgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2NvbmZpZy5hbGxvd1RyYW5zcGFyZW5jeSkge1xuICAgICAgICAgICAgcmV0dXJuIFRSQU5TUEFSRU5UX0NPTE9SO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGdseXBoLmJnID09PSBUeXBlc18xLklOVkVSVEVEX0RFRkFVTFRfQ09MT1IpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb25maWcuY29sb3JzLmZvcmVncm91bmQ7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZ2x5cGguYmcgPCAyNTYpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9nZXRDb2xvckZyb21BbnNpSW5kZXgoZ2x5cGguYmcpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9jb25maWcuY29sb3JzLmJhY2tncm91bmQ7XG4gICAgfTtcbiAgICBEeW5hbWljQ2hhckF0bGFzLnByb3RvdHlwZS5fZ2V0Rm9yZWdyb3VuZENvbG9yID0gZnVuY3Rpb24gKGdseXBoKSB7XG4gICAgICAgIGlmIChnbHlwaC5mZyA9PT0gVHlwZXNfMS5JTlZFUlRFRF9ERUZBVUxUX0NPTE9SKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fY29uZmlnLmNvbG9ycy5iYWNrZ3JvdW5kO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGdseXBoLmZnIDwgMjU2KSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0Q29sb3JGcm9tQW5zaUluZGV4KGdseXBoLmZnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fY29uZmlnLmNvbG9ycy5mb3JlZ3JvdW5kO1xuICAgIH07XG4gICAgRHluYW1pY0NoYXJBdGxhcy5wcm90b3R5cGUuX2RyYXdUb0NhY2hlID0gZnVuY3Rpb24gKGdseXBoLCBpbmRleCkge1xuICAgICAgICB0aGlzLl9kcmF3VG9DYWNoZUNvdW50Kys7XG4gICAgICAgIHRoaXMuX3RtcEN0eC5zYXZlKCk7XG4gICAgICAgIHZhciBiYWNrZ3JvdW5kQ29sb3IgPSB0aGlzLl9nZXRCYWNrZ3JvdW5kQ29sb3IoZ2x5cGgpO1xuICAgICAgICB0aGlzLl90bXBDdHguZ2xvYmFsQ29tcG9zaXRlT3BlcmF0aW9uID0gJ2NvcHknO1xuICAgICAgICB0aGlzLl90bXBDdHguZmlsbFN0eWxlID0gYmFja2dyb3VuZENvbG9yLmNzcztcbiAgICAgICAgdGhpcy5fdG1wQ3R4LmZpbGxSZWN0KDAsIDAsIHRoaXMuX2NvbmZpZy5zY2FsZWRDaGFyV2lkdGgsIHRoaXMuX2NvbmZpZy5zY2FsZWRDaGFySGVpZ2h0KTtcbiAgICAgICAgdGhpcy5fdG1wQ3R4Lmdsb2JhbENvbXBvc2l0ZU9wZXJhdGlvbiA9ICdzb3VyY2Utb3Zlcic7XG4gICAgICAgIHZhciBmb250V2VpZ2h0ID0gZ2x5cGguYm9sZCA/IHRoaXMuX2NvbmZpZy5mb250V2VpZ2h0Qm9sZCA6IHRoaXMuX2NvbmZpZy5mb250V2VpZ2h0O1xuICAgICAgICB2YXIgZm9udFN0eWxlID0gZ2x5cGguaXRhbGljID8gJ2l0YWxpYycgOiAnJztcbiAgICAgICAgdGhpcy5fdG1wQ3R4LmZvbnQgPVxuICAgICAgICAgICAgZm9udFN0eWxlICsgXCIgXCIgKyBmb250V2VpZ2h0ICsgXCIgXCIgKyB0aGlzLl9jb25maWcuZm9udFNpemUgKiB0aGlzLl9jb25maWcuZGV2aWNlUGl4ZWxSYXRpbyArIFwicHggXCIgKyB0aGlzLl9jb25maWcuZm9udEZhbWlseTtcbiAgICAgICAgdGhpcy5fdG1wQ3R4LnRleHRCYXNlbGluZSA9ICdtaWRkbGUnO1xuICAgICAgICB0aGlzLl90bXBDdHguZmlsbFN0eWxlID0gdGhpcy5fZ2V0Rm9yZWdyb3VuZENvbG9yKGdseXBoKS5jc3M7XG4gICAgICAgIGlmIChnbHlwaC5kaW0pIHtcbiAgICAgICAgICAgIHRoaXMuX3RtcEN0eC5nbG9iYWxBbHBoYSA9IFR5cGVzXzEuRElNX09QQUNJVFk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fdG1wQ3R4LmZpbGxUZXh0KGdseXBoLmNoYXJzLCAwLCB0aGlzLl9jb25maWcuc2NhbGVkQ2hhckhlaWdodCAvIDIpO1xuICAgICAgICB0aGlzLl90bXBDdHgucmVzdG9yZSgpO1xuICAgICAgICB2YXIgaW1hZ2VEYXRhID0gdGhpcy5fdG1wQ3R4LmdldEltYWdlRGF0YSgwLCAwLCB0aGlzLl9jb25maWcuc2NhbGVkQ2hhcldpZHRoLCB0aGlzLl9jb25maWcuc2NhbGVkQ2hhckhlaWdodCk7XG4gICAgICAgIHZhciBpc0VtcHR5ID0gZmFsc2U7XG4gICAgICAgIGlmICghdGhpcy5fY29uZmlnLmFsbG93VHJhbnNwYXJlbmN5KSB7XG4gICAgICAgICAgICBpc0VtcHR5ID0gQ2hhckF0bGFzR2VuZXJhdG9yXzEuY2xlYXJDb2xvcihpbWFnZURhdGEsIGJhY2tncm91bmRDb2xvcik7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHggPSB0aGlzLl90b0Nvb3JkaW5hdGVYKGluZGV4KTtcbiAgICAgICAgdmFyIHkgPSB0aGlzLl90b0Nvb3JkaW5hdGVZKGluZGV4KTtcbiAgICAgICAgdGhpcy5fY2FjaGVDdHgucHV0SW1hZ2VEYXRhKGltYWdlRGF0YSwgeCwgeSk7XG4gICAgICAgIHZhciBjYWNoZVZhbHVlID0ge1xuICAgICAgICAgICAgaW5kZXg6IGluZGV4LFxuICAgICAgICAgICAgaXNFbXB0eTogaXNFbXB0eSxcbiAgICAgICAgICAgIGluQml0bWFwOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLl9hZGRHbHlwaFRvQml0bWFwKGNhY2hlVmFsdWUpO1xuICAgICAgICByZXR1cm4gY2FjaGVWYWx1ZTtcbiAgICB9O1xuICAgIER5bmFtaWNDaGFyQXRsYXMucHJvdG90eXBlLl9hZGRHbHlwaFRvQml0bWFwID0gZnVuY3Rpb24gKGNhY2hlVmFsdWUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKCEoJ2NyZWF0ZUltYWdlQml0bWFwJyBpbiB3aW5kb3cpIHx8IFBsYXRmb3JtXzEuaXNGaXJlZm94IHx8IFBsYXRmb3JtXzEuaXNTYWZhcmkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9nbHlwaHNXYWl0aW5nT25CaXRtYXAucHVzaChjYWNoZVZhbHVlKTtcbiAgICAgICAgaWYgKHRoaXMuX2JpdG1hcENvbW1pdFRpbWVvdXQgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9iaXRtYXBDb21taXRUaW1lb3V0ID0gd2luZG93LnNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX2dlbmVyYXRlQml0bWFwKCk7IH0sIEdMWVBIX0JJVE1BUF9DT01NSVRfREVMQVkpO1xuICAgIH07XG4gICAgRHluYW1pY0NoYXJBdGxhcy5wcm90b3R5cGUuX2dlbmVyYXRlQml0bWFwID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB2YXIgZ2x5cGhzTW92aW5nVG9CaXRtYXAgPSB0aGlzLl9nbHlwaHNXYWl0aW5nT25CaXRtYXA7XG4gICAgICAgIHRoaXMuX2dseXBoc1dhaXRpbmdPbkJpdG1hcCA9IFtdO1xuICAgICAgICB3aW5kb3cuY3JlYXRlSW1hZ2VCaXRtYXAodGhpcy5fY2FjaGVDYW52YXMpLnRoZW4oZnVuY3Rpb24gKGJpdG1hcCkge1xuICAgICAgICAgICAgX3RoaXMuX2JpdG1hcCA9IGJpdG1hcDtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ2x5cGhzTW92aW5nVG9CaXRtYXAubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBnbHlwaHNNb3ZpbmdUb0JpdG1hcFtpXTtcbiAgICAgICAgICAgICAgICB2YWx1ZS5pbkJpdG1hcCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLl9iaXRtYXBDb21taXRUaW1lb3V0ID0gbnVsbDtcbiAgICB9O1xuICAgIHJldHVybiBEeW5hbWljQ2hhckF0bGFzO1xufShCYXNlQ2hhckF0bGFzXzEuZGVmYXVsdCkpO1xuZXhwb3J0cy5kZWZhdWx0ID0gRHluYW1pY0NoYXJBdGxhcztcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUR5bmFtaWNDaGFyQXRsYXMuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgTFJVTWFwID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBMUlVNYXAoY2FwYWNpdHkpIHtcbiAgICAgICAgdGhpcy5jYXBhY2l0eSA9IGNhcGFjaXR5O1xuICAgICAgICB0aGlzLl9tYXAgPSB7fTtcbiAgICAgICAgdGhpcy5faGVhZCA9IG51bGw7XG4gICAgICAgIHRoaXMuX3RhaWwgPSBudWxsO1xuICAgICAgICB0aGlzLl9ub2RlUG9vbCA9IFtdO1xuICAgICAgICB0aGlzLnNpemUgPSAwO1xuICAgIH1cbiAgICBMUlVNYXAucHJvdG90eXBlLl91bmxpbmtOb2RlID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgdmFyIHByZXYgPSBub2RlLnByZXY7XG4gICAgICAgIHZhciBuZXh0ID0gbm9kZS5uZXh0O1xuICAgICAgICBpZiAobm9kZSA9PT0gdGhpcy5faGVhZCkge1xuICAgICAgICAgICAgdGhpcy5faGVhZCA9IG5leHQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5vZGUgPT09IHRoaXMuX3RhaWwpIHtcbiAgICAgICAgICAgIHRoaXMuX3RhaWwgPSBwcmV2O1xuICAgICAgICB9XG4gICAgICAgIGlmIChwcmV2ICE9PSBudWxsKSB7XG4gICAgICAgICAgICBwcmV2Lm5leHQgPSBuZXh0O1xuICAgICAgICB9XG4gICAgICAgIGlmIChuZXh0ICE9PSBudWxsKSB7XG4gICAgICAgICAgICBuZXh0LnByZXYgPSBwcmV2O1xuICAgICAgICB9XG4gICAgfTtcbiAgICBMUlVNYXAucHJvdG90eXBlLl9hcHBlbmROb2RlID0gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICAgICAgdmFyIHRhaWwgPSB0aGlzLl90YWlsO1xuICAgICAgICBpZiAodGFpbCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgdGFpbC5uZXh0ID0gbm9kZTtcbiAgICAgICAgfVxuICAgICAgICBub2RlLnByZXYgPSB0YWlsO1xuICAgICAgICBub2RlLm5leHQgPSBudWxsO1xuICAgICAgICB0aGlzLl90YWlsID0gbm9kZTtcbiAgICAgICAgaWYgKHRoaXMuX2hlYWQgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuX2hlYWQgPSBub2RlO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBMUlVNYXAucHJvdG90eXBlLnByZWFsbG9jID0gZnVuY3Rpb24gKGNvdW50KSB7XG4gICAgICAgIHZhciBub2RlUG9vbCA9IHRoaXMuX25vZGVQb29sO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdW50OyBpKyspIHtcbiAgICAgICAgICAgIG5vZGVQb29sLnB1c2goe1xuICAgICAgICAgICAgICAgIHByZXY6IG51bGwsXG4gICAgICAgICAgICAgICAgbmV4dDogbnVsbCxcbiAgICAgICAgICAgICAgICBrZXk6IG51bGwsXG4gICAgICAgICAgICAgICAgdmFsdWU6IG51bGxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBMUlVNYXAucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgdmFyIG5vZGUgPSB0aGlzLl9tYXBba2V5XTtcbiAgICAgICAgaWYgKG5vZGUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5fdW5saW5rTm9kZShub2RlKTtcbiAgICAgICAgICAgIHRoaXMuX2FwcGVuZE5vZGUobm9kZSk7XG4gICAgICAgICAgICByZXR1cm4gbm9kZS52YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xuICAgIExSVU1hcC5wcm90b3R5cGUucGVla1ZhbHVlID0gZnVuY3Rpb24gKGtleSkge1xuICAgICAgICB2YXIgbm9kZSA9IHRoaXMuX21hcFtrZXldO1xuICAgICAgICBpZiAobm9kZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gbm9kZS52YWx1ZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9O1xuICAgIExSVU1hcC5wcm90b3R5cGUucGVlayA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGhlYWQgPSB0aGlzLl9oZWFkO1xuICAgICAgICByZXR1cm4gaGVhZCA9PT0gbnVsbCA/IG51bGwgOiBoZWFkLnZhbHVlO1xuICAgIH07XG4gICAgTFJVTWFwLnByb3RvdHlwZS5zZXQgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICB2YXIgbm9kZSA9IHRoaXMuX21hcFtrZXldO1xuICAgICAgICBpZiAobm9kZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBub2RlID0gdGhpcy5fbWFwW2tleV07XG4gICAgICAgICAgICB0aGlzLl91bmxpbmtOb2RlKG5vZGUpO1xuICAgICAgICAgICAgbm9kZS52YWx1ZSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRoaXMuc2l6ZSA+PSB0aGlzLmNhcGFjaXR5KSB7XG4gICAgICAgICAgICBub2RlID0gdGhpcy5faGVhZDtcbiAgICAgICAgICAgIHRoaXMuX3VubGlua05vZGUobm9kZSk7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fbWFwW25vZGUua2V5XTtcbiAgICAgICAgICAgIG5vZGUua2V5ID0ga2V5O1xuICAgICAgICAgICAgbm9kZS52YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgdGhpcy5fbWFwW2tleV0gPSBub2RlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdmFyIG5vZGVQb29sID0gdGhpcy5fbm9kZVBvb2w7XG4gICAgICAgICAgICBpZiAobm9kZVBvb2wubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIG5vZGUgPSBub2RlUG9vbC5wb3AoKTtcbiAgICAgICAgICAgICAgICBub2RlLmtleSA9IGtleTtcbiAgICAgICAgICAgICAgICBub2RlLnZhbHVlID0gdmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBub2RlID0ge1xuICAgICAgICAgICAgICAgICAgICBwcmV2OiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBuZXh0OiBudWxsLFxuICAgICAgICAgICAgICAgICAgICBrZXk6IGtleSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IHZhbHVlXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuX21hcFtrZXldID0gbm9kZTtcbiAgICAgICAgICAgIHRoaXMuc2l6ZSsrO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2FwcGVuZE5vZGUobm9kZSk7XG4gICAgfTtcbiAgICByZXR1cm4gTFJVTWFwO1xufSgpKTtcbmV4cG9ydHMuZGVmYXVsdCA9IExSVU1hcDtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPUxSVU1hcC5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIEJhc2VDaGFyQXRsYXNfMSA9IHJlcXVpcmUoXCIuL0Jhc2VDaGFyQXRsYXNcIik7XG52YXIgTm9uZUNoYXJBdGxhcyA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKE5vbmVDaGFyQXRsYXMsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gTm9uZUNoYXJBdGxhcyhkb2N1bWVudCwgY29uZmlnKSB7XG4gICAgICAgIHJldHVybiBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgIH1cbiAgICBOb25lQ2hhckF0bGFzLnByb3RvdHlwZS5kcmF3ID0gZnVuY3Rpb24gKGN0eCwgZ2x5cGgsIHgsIHkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG4gICAgcmV0dXJuIE5vbmVDaGFyQXRsYXM7XG59KEJhc2VDaGFyQXRsYXNfMS5kZWZhdWx0KSk7XG5leHBvcnRzLmRlZmF1bHQgPSBOb25lQ2hhckF0bGFzO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9Tm9uZUNoYXJBdGxhcy5qcy5tYXAiLCJcInVzZSBzdHJpY3RcIjtcbnZhciBfX2V4dGVuZHMgPSAodGhpcyAmJiB0aGlzLl9fZXh0ZW5kcykgfHwgKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKGIuaGFzT3duUHJvcGVydHkocCkpIGRbcF0gPSBiW3BdOyB9O1xuICAgICAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICB9O1xuICAgIHJldHVybiBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgICAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cbiAgICAgICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xuICAgIH07XG59KSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIFR5cGVzXzEgPSByZXF1aXJlKFwiLi9UeXBlc1wiKTtcbnZhciBDaGFyQXRsYXNHZW5lcmF0b3JfMSA9IHJlcXVpcmUoXCIuL0NoYXJBdGxhc0dlbmVyYXRvclwiKTtcbnZhciBCYXNlQ2hhckF0bGFzXzEgPSByZXF1aXJlKFwiLi9CYXNlQ2hhckF0bGFzXCIpO1xudmFyIENoYXJBdGxhc1V0aWxzXzEgPSByZXF1aXJlKFwiLi9DaGFyQXRsYXNVdGlsc1wiKTtcbnZhciBUeXBlc18yID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9UeXBlc1wiKTtcbnZhciBTdGF0aWNDaGFyQXRsYXMgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhTdGF0aWNDaGFyQXRsYXMsIF9zdXBlcik7XG4gICAgZnVuY3Rpb24gU3RhdGljQ2hhckF0bGFzKF9kb2N1bWVudCwgX2NvbmZpZykge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xuICAgICAgICBfdGhpcy5fZG9jdW1lbnQgPSBfZG9jdW1lbnQ7XG4gICAgICAgIF90aGlzLl9jb25maWcgPSBfY29uZmlnO1xuICAgICAgICBfdGhpcy5fY2FudmFzRmFjdG9yeSA9IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0KSB7XG4gICAgICAgICAgICB2YXIgY2FudmFzID0gX3RoaXMuX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgICAgICAgICAgY2FudmFzLndpZHRoID0gd2lkdGg7XG4gICAgICAgICAgICBjYW52YXMuaGVpZ2h0ID0gaGVpZ2h0O1xuICAgICAgICAgICAgcmV0dXJuIGNhbnZhcztcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIF90aGlzO1xuICAgIH1cbiAgICBTdGF0aWNDaGFyQXRsYXMucHJvdG90eXBlLl9kb1dhcm1VcCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIHJlc3VsdCA9IENoYXJBdGxhc0dlbmVyYXRvcl8xLmdlbmVyYXRlU3RhdGljQ2hhckF0bGFzVGV4dHVyZSh3aW5kb3csIHRoaXMuX2NhbnZhc0ZhY3RvcnksIHRoaXMuX2NvbmZpZyk7XG4gICAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBIVE1MQ2FudmFzRWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5fdGV4dHVyZSA9IHJlc3VsdDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdC50aGVuKGZ1bmN0aW9uICh0ZXh0dXJlKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuX3RleHR1cmUgPSB0ZXh0dXJlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIFN0YXRpY0NoYXJBdGxhcy5wcm90b3R5cGUuX2lzQ2FjaGVkID0gZnVuY3Rpb24gKGdseXBoLCBjb2xvckluZGV4KSB7XG4gICAgICAgIHZhciBpc0FzY2lpID0gZ2x5cGguY29kZSA8IDI1NjtcbiAgICAgICAgdmFyIGlzQmFzaWNDb2xvciA9IGdseXBoLmZnIDwgMTY7XG4gICAgICAgIHZhciBpc0RlZmF1bHRDb2xvciA9IGdseXBoLmZnID09PSBUeXBlc18yLkRFRkFVTFRfQ09MT1I7XG4gICAgICAgIHZhciBpc0RlZmF1bHRCYWNrZ3JvdW5kID0gZ2x5cGguYmcgPT09IFR5cGVzXzIuREVGQVVMVF9DT0xPUjtcbiAgICAgICAgcmV0dXJuIGlzQXNjaWkgJiYgKGlzQmFzaWNDb2xvciB8fCBpc0RlZmF1bHRDb2xvcikgJiYgaXNEZWZhdWx0QmFja2dyb3VuZCAmJiAhZ2x5cGguaXRhbGljO1xuICAgIH07XG4gICAgU3RhdGljQ2hhckF0bGFzLnByb3RvdHlwZS5kcmF3ID0gZnVuY3Rpb24gKGN0eCwgZ2x5cGgsIHgsIHkpIHtcbiAgICAgICAgaWYgKHRoaXMuX3RleHR1cmUgPT09IG51bGwgfHwgdGhpcy5fdGV4dHVyZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGNvbG9ySW5kZXggPSAwO1xuICAgICAgICBpZiAoQ2hhckF0bGFzVXRpbHNfMS5pczI1NkNvbG9yKGdseXBoLmZnKSkge1xuICAgICAgICAgICAgY29sb3JJbmRleCA9IDIgKyBnbHlwaC5mZyArIChnbHlwaC5ib2xkID8gMTYgOiAwKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChnbHlwaC5mZyA9PT0gVHlwZXNfMi5ERUZBVUxUX0NPTE9SKSB7XG4gICAgICAgICAgICBpZiAoZ2x5cGguYm9sZCkge1xuICAgICAgICAgICAgICAgIGNvbG9ySW5kZXggPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5faXNDYWNoZWQoZ2x5cGgsIGNvbG9ySW5kZXgpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgY3R4LnNhdmUoKTtcbiAgICAgICAgdmFyIGNoYXJBdGxhc0NlbGxXaWR0aCA9IHRoaXMuX2NvbmZpZy5zY2FsZWRDaGFyV2lkdGggKyBUeXBlc18xLkNIQVJfQVRMQVNfQ0VMTF9TUEFDSU5HO1xuICAgICAgICB2YXIgY2hhckF0bGFzQ2VsbEhlaWdodCA9IHRoaXMuX2NvbmZpZy5zY2FsZWRDaGFySGVpZ2h0ICsgVHlwZXNfMS5DSEFSX0FUTEFTX0NFTExfU1BBQ0lORztcbiAgICAgICAgaWYgKGdseXBoLmRpbSkge1xuICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gVHlwZXNfMS5ESU1fT1BBQ0lUWTtcbiAgICAgICAgfVxuICAgICAgICBjdHguZHJhd0ltYWdlKHRoaXMuX3RleHR1cmUsIGdseXBoLmNvZGUgKiBjaGFyQXRsYXNDZWxsV2lkdGgsIGNvbG9ySW5kZXggKiBjaGFyQXRsYXNDZWxsSGVpZ2h0LCBjaGFyQXRsYXNDZWxsV2lkdGgsIHRoaXMuX2NvbmZpZy5zY2FsZWRDaGFySGVpZ2h0LCB4LCB5LCBjaGFyQXRsYXNDZWxsV2lkdGgsIHRoaXMuX2NvbmZpZy5zY2FsZWRDaGFySGVpZ2h0KTtcbiAgICAgICAgY3R4LnJlc3RvcmUoKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfTtcbiAgICByZXR1cm4gU3RhdGljQ2hhckF0bGFzO1xufShCYXNlQ2hhckF0bGFzXzEuZGVmYXVsdCkpO1xuZXhwb3J0cy5kZWZhdWx0ID0gU3RhdGljQ2hhckF0bGFzO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9U3RhdGljQ2hhckF0bGFzLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xuZXhwb3J0cy5JTlZFUlRFRF9ERUZBVUxUX0NPTE9SID0gMjU3O1xuZXhwb3J0cy5ESU1fT1BBQ0lUWSA9IDAuNTtcbmV4cG9ydHMuQ0hBUl9BVExBU19DRUxMX1NQQUNJTkcgPSAxO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9VHlwZXMuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19leHRlbmRzID0gKHRoaXMgJiYgdGhpcy5fX2V4dGVuZHMpIHx8IChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbiAoZCwgYikge1xuICAgICAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XG4gICAgICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XG4gICAgICAgICAgICBmdW5jdGlvbiAoZCwgYikgeyBmb3IgKHZhciBwIGluIGIpIGlmIChiLmhhc093blByb3BlcnR5KHApKSBkW3BdID0gYltwXTsgfTtcbiAgICAgICAgcmV0dXJuIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcbiAgICAgICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XG4gICAgICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcbiAgICB9O1xufSkoKTtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciBDb2xvck1hbmFnZXJfMSA9IHJlcXVpcmUoXCIuLi9Db2xvck1hbmFnZXJcIik7XG52YXIgUmVuZGVyRGVib3VuY2VyXzEgPSByZXF1aXJlKFwiLi4vLi4vdWkvUmVuZGVyRGVib3VuY2VyXCIpO1xudmFyIERvbVJlbmRlcmVyUm93RmFjdG9yeV8xID0gcmVxdWlyZShcIi4vRG9tUmVuZGVyZXJSb3dGYWN0b3J5XCIpO1xudmFyIFR5cGVzXzEgPSByZXF1aXJlKFwiLi4vYXRsYXMvVHlwZXNcIik7XG52YXIgRXZlbnRFbWl0dGVyMl8xID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9FdmVudEVtaXR0ZXIyXCIpO1xudmFyIExpZmVjeWNsZV8xID0gcmVxdWlyZShcIi4uLy4uL2NvbW1vbi9MaWZlY3ljbGVcIik7XG52YXIgVEVSTUlOQUxfQ0xBU1NfUFJFRklYID0gJ3h0ZXJtLWRvbS1yZW5kZXJlci1vd25lci0nO1xudmFyIFJPV19DT05UQUlORVJfQ0xBU1MgPSAneHRlcm0tcm93cyc7XG52YXIgRkdfQ0xBU1NfUFJFRklYID0gJ3h0ZXJtLWZnLSc7XG52YXIgQkdfQ0xBU1NfUFJFRklYID0gJ3h0ZXJtLWJnLSc7XG52YXIgRk9DVVNfQ0xBU1MgPSAneHRlcm0tZm9jdXMnO1xudmFyIFNFTEVDVElPTl9DTEFTUyA9ICd4dGVybS1zZWxlY3Rpb24nO1xudmFyIG5leHRUZXJtaW5hbElkID0gMTtcbnZhciBEb21SZW5kZXJlciA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKERvbVJlbmRlcmVyLCBfc3VwZXIpO1xuICAgIGZ1bmN0aW9uIERvbVJlbmRlcmVyKF90ZXJtaW5hbCwgdGhlbWUpIHtcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuX3Rlcm1pbmFsID0gX3Rlcm1pbmFsO1xuICAgICAgICBfdGhpcy5fdGVybWluYWxDbGFzcyA9IG5leHRUZXJtaW5hbElkKys7XG4gICAgICAgIF90aGlzLl9yb3dFbGVtZW50cyA9IFtdO1xuICAgICAgICBfdGhpcy5fb25DYW52YXNSZXNpemUgPSBuZXcgRXZlbnRFbWl0dGVyMl8xLkV2ZW50RW1pdHRlcjIoKTtcbiAgICAgICAgX3RoaXMuX29uUmVuZGVyID0gbmV3IEV2ZW50RW1pdHRlcjJfMS5FdmVudEVtaXR0ZXIyKCk7XG4gICAgICAgIHZhciBhbGxvd1RyYW5zcGFyZW5jeSA9IF90aGlzLl90ZXJtaW5hbC5vcHRpb25zLmFsbG93VHJhbnNwYXJlbmN5O1xuICAgICAgICBfdGhpcy5jb2xvck1hbmFnZXIgPSBuZXcgQ29sb3JNYW5hZ2VyXzEuQ29sb3JNYW5hZ2VyKGRvY3VtZW50LCBhbGxvd1RyYW5zcGFyZW5jeSk7XG4gICAgICAgIF90aGlzLnNldFRoZW1lKHRoZW1lKTtcbiAgICAgICAgX3RoaXMuX3Jvd0NvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICBfdGhpcy5fcm93Q29udGFpbmVyLmNsYXNzTGlzdC5hZGQoUk9XX0NPTlRBSU5FUl9DTEFTUyk7XG4gICAgICAgIF90aGlzLl9yb3dDb250YWluZXIuc3R5bGUubGluZUhlaWdodCA9ICdub3JtYWwnO1xuICAgICAgICBfdGhpcy5fcm93Q29udGFpbmVyLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCAndHJ1ZScpO1xuICAgICAgICBfdGhpcy5fcmVmcmVzaFJvd0VsZW1lbnRzKF90aGlzLl90ZXJtaW5hbC5jb2xzLCBfdGhpcy5fdGVybWluYWwucm93cyk7XG4gICAgICAgIF90aGlzLl9zZWxlY3Rpb25Db250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgX3RoaXMuX3NlbGVjdGlvbkNvbnRhaW5lci5jbGFzc0xpc3QuYWRkKFNFTEVDVElPTl9DTEFTUyk7XG4gICAgICAgIF90aGlzLl9zZWxlY3Rpb25Db250YWluZXIuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XG4gICAgICAgIF90aGlzLmRpbWVuc2lvbnMgPSB7XG4gICAgICAgICAgICBzY2FsZWRDaGFyV2lkdGg6IG51bGwsXG4gICAgICAgICAgICBzY2FsZWRDaGFySGVpZ2h0OiBudWxsLFxuICAgICAgICAgICAgc2NhbGVkQ2VsbFdpZHRoOiBudWxsLFxuICAgICAgICAgICAgc2NhbGVkQ2VsbEhlaWdodDogbnVsbCxcbiAgICAgICAgICAgIHNjYWxlZENoYXJMZWZ0OiBudWxsLFxuICAgICAgICAgICAgc2NhbGVkQ2hhclRvcDogbnVsbCxcbiAgICAgICAgICAgIHNjYWxlZENhbnZhc1dpZHRoOiBudWxsLFxuICAgICAgICAgICAgc2NhbGVkQ2FudmFzSGVpZ2h0OiBudWxsLFxuICAgICAgICAgICAgY2FudmFzV2lkdGg6IG51bGwsXG4gICAgICAgICAgICBjYW52YXNIZWlnaHQ6IG51bGwsXG4gICAgICAgICAgICBhY3R1YWxDZWxsV2lkdGg6IG51bGwsXG4gICAgICAgICAgICBhY3R1YWxDZWxsSGVpZ2h0OiBudWxsXG4gICAgICAgIH07XG4gICAgICAgIF90aGlzLl91cGRhdGVEaW1lbnNpb25zKCk7XG4gICAgICAgIF90aGlzLl9yZW5kZXJEZWJvdW5jZXIgPSBuZXcgUmVuZGVyRGVib3VuY2VyXzEuUmVuZGVyRGVib3VuY2VyKF90aGlzLl9yZW5kZXJSb3dzLmJpbmQoX3RoaXMpKTtcbiAgICAgICAgX3RoaXMuX3Jvd0ZhY3RvcnkgPSBuZXcgRG9tUmVuZGVyZXJSb3dGYWN0b3J5XzEuRG9tUmVuZGVyZXJSb3dGYWN0b3J5KF90ZXJtaW5hbC5vcHRpb25zLCBkb2N1bWVudCk7XG4gICAgICAgIF90aGlzLl90ZXJtaW5hbC5lbGVtZW50LmNsYXNzTGlzdC5hZGQoVEVSTUlOQUxfQ0xBU1NfUFJFRklYICsgX3RoaXMuX3Rlcm1pbmFsQ2xhc3MpO1xuICAgICAgICBfdGhpcy5fdGVybWluYWwuc2NyZWVuRWxlbWVudC5hcHBlbmRDaGlsZChfdGhpcy5fcm93Q29udGFpbmVyKTtcbiAgICAgICAgX3RoaXMuX3Rlcm1pbmFsLnNjcmVlbkVsZW1lbnQuYXBwZW5kQ2hpbGQoX3RoaXMuX3NlbGVjdGlvbkNvbnRhaW5lcik7XG4gICAgICAgIF90aGlzLl90ZXJtaW5hbC5saW5raWZpZXIub25MaW5rSG92ZXIoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLl9vbkxpbmtIb3ZlcihlKTsgfSk7XG4gICAgICAgIF90aGlzLl90ZXJtaW5hbC5saW5raWZpZXIub25MaW5rTGVhdmUoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIF90aGlzLl9vbkxpbmtMZWF2ZShlKTsgfSk7XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KERvbVJlbmRlcmVyLnByb3RvdHlwZSwgXCJvbkNhbnZhc1Jlc2l6ZVwiLCB7XG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5fb25DYW52YXNSZXNpemUuZXZlbnQ7IH0sXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShEb21SZW5kZXJlci5wcm90b3R5cGUsIFwib25SZW5kZXJcIiwge1xuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuX29uUmVuZGVyLmV2ZW50OyB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBEb21SZW5kZXJlci5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuZWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKFRFUk1JTkFMX0NMQVNTX1BSRUZJWCArIHRoaXMuX3Rlcm1pbmFsQ2xhc3MpO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5zY3JlZW5FbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMuX3Jvd0NvbnRhaW5lcik7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNjcmVlbkVsZW1lbnQucmVtb3ZlQ2hpbGQodGhpcy5fc2VsZWN0aW9uQ29udGFpbmVyKTtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuc2NyZWVuRWxlbWVudC5yZW1vdmVDaGlsZCh0aGlzLl90aGVtZVN0eWxlRWxlbWVudCk7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNjcmVlbkVsZW1lbnQucmVtb3ZlQ2hpbGQodGhpcy5fZGltZW5zaW9uc1N0eWxlRWxlbWVudCk7XG4gICAgICAgIF9zdXBlci5wcm90b3R5cGUuZGlzcG9zZS5jYWxsKHRoaXMpO1xuICAgIH07XG4gICAgRG9tUmVuZGVyZXIucHJvdG90eXBlLl91cGRhdGVEaW1lbnNpb25zID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2hhcldpZHRoID0gdGhpcy5fdGVybWluYWwuY2hhck1lYXN1cmUud2lkdGggKiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbztcbiAgICAgICAgdGhpcy5kaW1lbnNpb25zLnNjYWxlZENoYXJIZWlnaHQgPSBNYXRoLmNlaWwodGhpcy5fdGVybWluYWwuY2hhck1lYXN1cmUuaGVpZ2h0ICogd2luZG93LmRldmljZVBpeGVsUmF0aW8pO1xuICAgICAgICB0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2VsbFdpZHRoID0gdGhpcy5kaW1lbnNpb25zLnNjYWxlZENoYXJXaWR0aCArIE1hdGgucm91bmQodGhpcy5fdGVybWluYWwub3B0aW9ucy5sZXR0ZXJTcGFjaW5nKTtcbiAgICAgICAgdGhpcy5kaW1lbnNpb25zLnNjYWxlZENlbGxIZWlnaHQgPSBNYXRoLmZsb29yKHRoaXMuZGltZW5zaW9ucy5zY2FsZWRDaGFySGVpZ2h0ICogdGhpcy5fdGVybWluYWwub3B0aW9ucy5saW5lSGVpZ2h0KTtcbiAgICAgICAgdGhpcy5kaW1lbnNpb25zLnNjYWxlZENoYXJMZWZ0ID0gMDtcbiAgICAgICAgdGhpcy5kaW1lbnNpb25zLnNjYWxlZENoYXJUb3AgPSAwO1xuICAgICAgICB0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2FudmFzV2lkdGggPSB0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2VsbFdpZHRoICogdGhpcy5fdGVybWluYWwuY29scztcbiAgICAgICAgdGhpcy5kaW1lbnNpb25zLnNjYWxlZENhbnZhc0hlaWdodCA9IHRoaXMuZGltZW5zaW9ucy5zY2FsZWRDZWxsSGVpZ2h0ICogdGhpcy5fdGVybWluYWwucm93cztcbiAgICAgICAgdGhpcy5kaW1lbnNpb25zLmNhbnZhc1dpZHRoID0gTWF0aC5yb3VuZCh0aGlzLmRpbWVuc2lvbnMuc2NhbGVkQ2FudmFzV2lkdGggLyB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyk7XG4gICAgICAgIHRoaXMuZGltZW5zaW9ucy5jYW52YXNIZWlnaHQgPSBNYXRoLnJvdW5kKHRoaXMuZGltZW5zaW9ucy5zY2FsZWRDYW52YXNIZWlnaHQgLyB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyk7XG4gICAgICAgIHRoaXMuZGltZW5zaW9ucy5hY3R1YWxDZWxsV2lkdGggPSB0aGlzLmRpbWVuc2lvbnMuY2FudmFzV2lkdGggLyB0aGlzLl90ZXJtaW5hbC5jb2xzO1xuICAgICAgICB0aGlzLmRpbWVuc2lvbnMuYWN0dWFsQ2VsbEhlaWdodCA9IHRoaXMuZGltZW5zaW9ucy5jYW52YXNIZWlnaHQgLyB0aGlzLl90ZXJtaW5hbC5yb3dzO1xuICAgICAgICB0aGlzLl9yb3dFbGVtZW50cy5mb3JFYWNoKGZ1bmN0aW9uIChlbGVtZW50KSB7XG4gICAgICAgICAgICBlbGVtZW50LnN0eWxlLndpZHRoID0gX3RoaXMuZGltZW5zaW9ucy5jYW52YXNXaWR0aCArIFwicHhcIjtcbiAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUuaGVpZ2h0ID0gX3RoaXMuZGltZW5zaW9ucy5hY3R1YWxDZWxsSGVpZ2h0ICsgXCJweFwiO1xuICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5saW5lSGVpZ2h0ID0gX3RoaXMuZGltZW5zaW9ucy5hY3R1YWxDZWxsSGVpZ2h0ICsgXCJweFwiO1xuICAgICAgICAgICAgZWxlbWVudC5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCF0aGlzLl9kaW1lbnNpb25zU3R5bGVFbGVtZW50KSB7XG4gICAgICAgICAgICB0aGlzLl9kaW1lbnNpb25zU3R5bGVFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNjcmVlbkVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5fZGltZW5zaW9uc1N0eWxlRWxlbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHN0eWxlcyA9IHRoaXMuX3Rlcm1pbmFsU2VsZWN0b3IgKyBcIiAuXCIgKyBST1dfQ09OVEFJTkVSX0NMQVNTICsgXCIgc3BhbiB7XCIgK1xuICAgICAgICAgICAgXCIgZGlzcGxheTogaW5saW5lLWJsb2NrO1wiICtcbiAgICAgICAgICAgIFwiIGhlaWdodDogMTAwJTtcIiArXG4gICAgICAgICAgICBcIiB2ZXJ0aWNhbC1hbGlnbjogdG9wO1wiICtcbiAgICAgICAgICAgIChcIiB3aWR0aDogXCIgKyB0aGlzLmRpbWVuc2lvbnMuYWN0dWFsQ2VsbFdpZHRoICsgXCJweFwiKSArXG4gICAgICAgICAgICBcIn1cIjtcbiAgICAgICAgdGhpcy5fZGltZW5zaW9uc1N0eWxlRWxlbWVudC5pbm5lckhUTUwgPSBzdHlsZXM7XG4gICAgICAgIHRoaXMuX3NlbGVjdGlvbkNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSB0aGlzLl90ZXJtaW5hbC5fdmlld3BvcnRFbGVtZW50LnN0eWxlLmhlaWdodDtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuc2NyZWVuRWxlbWVudC5zdHlsZS53aWR0aCA9IHRoaXMuZGltZW5zaW9ucy5jYW52YXNXaWR0aCArIFwicHhcIjtcbiAgICAgICAgdGhpcy5fdGVybWluYWwuc2NyZWVuRWxlbWVudC5zdHlsZS5oZWlnaHQgPSB0aGlzLmRpbWVuc2lvbnMuY2FudmFzSGVpZ2h0ICsgXCJweFwiO1xuICAgIH07XG4gICAgRG9tUmVuZGVyZXIucHJvdG90eXBlLnNldFRoZW1lID0gZnVuY3Rpb24gKHRoZW1lKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIGlmICh0aGVtZSkge1xuICAgICAgICAgICAgdGhpcy5jb2xvck1hbmFnZXIuc2V0VGhlbWUodGhlbWUpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5fdGhlbWVTdHlsZUVsZW1lbnQpIHtcbiAgICAgICAgICAgIHRoaXMuX3RoZW1lU3R5bGVFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTtcbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsLnNjcmVlbkVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5fdGhlbWVTdHlsZUVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBzdHlsZXMgPSB0aGlzLl90ZXJtaW5hbFNlbGVjdG9yICsgXCIgLlwiICsgUk9XX0NPTlRBSU5FUl9DTEFTUyArIFwiIHtcIiArXG4gICAgICAgICAgICAoXCIgY29sb3I6IFwiICsgdGhpcy5jb2xvck1hbmFnZXIuY29sb3JzLmZvcmVncm91bmQuY3NzICsgXCI7XCIpICtcbiAgICAgICAgICAgIChcIiBiYWNrZ3JvdW5kLWNvbG9yOiBcIiArIHRoaXMuY29sb3JNYW5hZ2VyLmNvbG9ycy5iYWNrZ3JvdW5kLmNzcyArIFwiO1wiKSArXG4gICAgICAgICAgICAoXCIgZm9udC1mYW1pbHk6IFwiICsgdGhpcy5fdGVybWluYWwub3B0aW9ucy5mb250RmFtaWx5ICsgXCI7XCIpICtcbiAgICAgICAgICAgIChcIiBmb250LXNpemU6IFwiICsgdGhpcy5fdGVybWluYWwub3B0aW9ucy5mb250U2l6ZSArIFwicHg7XCIpICtcbiAgICAgICAgICAgIFwifVwiO1xuICAgICAgICBzdHlsZXMgKz1cbiAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsU2VsZWN0b3IgKyBcIiBzcGFuOm5vdCguXCIgKyBEb21SZW5kZXJlclJvd0ZhY3RvcnlfMS5CT0xEX0NMQVNTICsgXCIpIHtcIiArXG4gICAgICAgICAgICAgICAgKFwiIGZvbnQtd2VpZ2h0OiBcIiArIHRoaXMuX3Rlcm1pbmFsLm9wdGlvbnMuZm9udFdlaWdodCArIFwiO1wiKSArXG4gICAgICAgICAgICAgICAgXCJ9XCIgK1xuICAgICAgICAgICAgICAgICh0aGlzLl90ZXJtaW5hbFNlbGVjdG9yICsgXCIgc3Bhbi5cIiArIERvbVJlbmRlcmVyUm93RmFjdG9yeV8xLkJPTERfQ0xBU1MgKyBcIiB7XCIpICtcbiAgICAgICAgICAgICAgICAoXCIgZm9udC13ZWlnaHQ6IFwiICsgdGhpcy5fdGVybWluYWwub3B0aW9ucy5mb250V2VpZ2h0Qm9sZCArIFwiO1wiKSArXG4gICAgICAgICAgICAgICAgXCJ9XCIgK1xuICAgICAgICAgICAgICAgICh0aGlzLl90ZXJtaW5hbFNlbGVjdG9yICsgXCIgc3Bhbi5cIiArIERvbVJlbmRlcmVyUm93RmFjdG9yeV8xLklUQUxJQ19DTEFTUyArIFwiIHtcIikgK1xuICAgICAgICAgICAgICAgIFwiIGZvbnQtc3R5bGU6IGl0YWxpYztcIiArXG4gICAgICAgICAgICAgICAgXCJ9XCI7XG4gICAgICAgIHN0eWxlcyArPVxuICAgICAgICAgICAgXCJAa2V5ZnJhbWVzIGJsaW5rIHtcIiArXG4gICAgICAgICAgICAgICAgXCIgMCUgeyBvcGFjaXR5OiAxLjA7IH1cIiArXG4gICAgICAgICAgICAgICAgXCIgNTAlIHsgb3BhY2l0eTogMC4wOyB9XCIgK1xuICAgICAgICAgICAgICAgIFwiIDEwMCUgeyBvcGFjaXR5OiAxLjA7IH1cIiArXG4gICAgICAgICAgICAgICAgXCJ9XCI7XG4gICAgICAgIHN0eWxlcyArPVxuICAgICAgICAgICAgdGhpcy5fdGVybWluYWxTZWxlY3RvciArIFwiIC5cIiArIFJPV19DT05UQUlORVJfQ0xBU1MgKyBcIjpub3QoLlwiICsgRk9DVVNfQ0xBU1MgKyBcIikgLlwiICsgRG9tUmVuZGVyZXJSb3dGYWN0b3J5XzEuQ1VSU09SX0NMQVNTICsgXCIge1wiICtcbiAgICAgICAgICAgICAgICAoXCIgb3V0bGluZTogMXB4IHNvbGlkIFwiICsgdGhpcy5jb2xvck1hbmFnZXIuY29sb3JzLmN1cnNvci5jc3MgKyBcIjtcIikgK1xuICAgICAgICAgICAgICAgIFwiIG91dGxpbmUtb2Zmc2V0OiAtMXB4O1wiICtcbiAgICAgICAgICAgICAgICBcIn1cIiArXG4gICAgICAgICAgICAgICAgKHRoaXMuX3Rlcm1pbmFsU2VsZWN0b3IgKyBcIiAuXCIgKyBST1dfQ09OVEFJTkVSX0NMQVNTICsgXCIuXCIgKyBGT0NVU19DTEFTUyArIFwiIC5cIiArIERvbVJlbmRlcmVyUm93RmFjdG9yeV8xLkNVUlNPUl9DTEFTUyArIFwiLlwiICsgRG9tUmVuZGVyZXJSb3dGYWN0b3J5XzEuQ1VSU09SX0JMSU5LX0NMQVNTICsgXCIge1wiKSArXG4gICAgICAgICAgICAgICAgXCIgYW5pbWF0aW9uOiBibGluayAxcyBzdGVwLWVuZCBpbmZpbml0ZTtcIiArXG4gICAgICAgICAgICAgICAgXCJ9XCIgK1xuICAgICAgICAgICAgICAgICh0aGlzLl90ZXJtaW5hbFNlbGVjdG9yICsgXCIgLlwiICsgUk9XX0NPTlRBSU5FUl9DTEFTUyArIFwiLlwiICsgRk9DVVNfQ0xBU1MgKyBcIiAuXCIgKyBEb21SZW5kZXJlclJvd0ZhY3RvcnlfMS5DVVJTT1JfQ0xBU1MgKyBcIi5cIiArIERvbVJlbmRlcmVyUm93RmFjdG9yeV8xLkNVUlNPUl9TVFlMRV9CTE9DS19DTEFTUyArIFwiIHtcIikgK1xuICAgICAgICAgICAgICAgIChcIiBiYWNrZ3JvdW5kLWNvbG9yOiBcIiArIHRoaXMuY29sb3JNYW5hZ2VyLmNvbG9ycy5jdXJzb3IuY3NzICsgXCI7XCIpICtcbiAgICAgICAgICAgICAgICAoXCIgY29sb3I6IFwiICsgdGhpcy5jb2xvck1hbmFnZXIuY29sb3JzLmN1cnNvckFjY2VudC5jc3MgKyBcIjtcIikgK1xuICAgICAgICAgICAgICAgIFwifVwiICtcbiAgICAgICAgICAgICAgICAodGhpcy5fdGVybWluYWxTZWxlY3RvciArIFwiIC5cIiArIFJPV19DT05UQUlORVJfQ0xBU1MgKyBcIi5cIiArIEZPQ1VTX0NMQVNTICsgXCIgLlwiICsgRG9tUmVuZGVyZXJSb3dGYWN0b3J5XzEuQ1VSU09SX0NMQVNTICsgXCIuXCIgKyBEb21SZW5kZXJlclJvd0ZhY3RvcnlfMS5DVVJTT1JfU1RZTEVfQkFSX0NMQVNTICsgXCIge1wiKSArXG4gICAgICAgICAgICAgICAgKFwiIGJveC1zaGFkb3c6IDFweCAwIDAgXCIgKyB0aGlzLmNvbG9yTWFuYWdlci5jb2xvcnMuY3Vyc29yLmNzcyArIFwiIGluc2V0O1wiKSArXG4gICAgICAgICAgICAgICAgXCJ9XCIgK1xuICAgICAgICAgICAgICAgICh0aGlzLl90ZXJtaW5hbFNlbGVjdG9yICsgXCIgLlwiICsgUk9XX0NPTlRBSU5FUl9DTEFTUyArIFwiLlwiICsgRk9DVVNfQ0xBU1MgKyBcIiAuXCIgKyBEb21SZW5kZXJlclJvd0ZhY3RvcnlfMS5DVVJTT1JfQ0xBU1MgKyBcIi5cIiArIERvbVJlbmRlcmVyUm93RmFjdG9yeV8xLkNVUlNPUl9TVFlMRV9VTkRFUkxJTkVfQ0xBU1MgKyBcIiB7XCIpICtcbiAgICAgICAgICAgICAgICAoXCIgYm94LXNoYWRvdzogMCAtMXB4IDAgXCIgKyB0aGlzLmNvbG9yTWFuYWdlci5jb2xvcnMuY3Vyc29yLmNzcyArIFwiIGluc2V0O1wiKSArXG4gICAgICAgICAgICAgICAgXCJ9XCI7XG4gICAgICAgIHN0eWxlcyArPVxuICAgICAgICAgICAgdGhpcy5fdGVybWluYWxTZWxlY3RvciArIFwiIC5cIiArIFNFTEVDVElPTl9DTEFTUyArIFwiIHtcIiArXG4gICAgICAgICAgICAgICAgXCIgcG9zaXRpb246IGFic29sdXRlO1wiICtcbiAgICAgICAgICAgICAgICBcIiB0b3A6IDA7XCIgK1xuICAgICAgICAgICAgICAgIFwiIGxlZnQ6IDA7XCIgK1xuICAgICAgICAgICAgICAgIFwiIHotaW5kZXg6IDE7XCIgK1xuICAgICAgICAgICAgICAgIFwiIHBvaW50ZXItZXZlbnRzOiBub25lO1wiICtcbiAgICAgICAgICAgICAgICBcIn1cIiArXG4gICAgICAgICAgICAgICAgKHRoaXMuX3Rlcm1pbmFsU2VsZWN0b3IgKyBcIiAuXCIgKyBTRUxFQ1RJT05fQ0xBU1MgKyBcIiBkaXYge1wiKSArXG4gICAgICAgICAgICAgICAgXCIgcG9zaXRpb246IGFic29sdXRlO1wiICtcbiAgICAgICAgICAgICAgICAoXCIgYmFja2dyb3VuZC1jb2xvcjogXCIgKyB0aGlzLmNvbG9yTWFuYWdlci5jb2xvcnMuc2VsZWN0aW9uLmNzcyArIFwiO1wiKSArXG4gICAgICAgICAgICAgICAgXCJ9XCI7XG4gICAgICAgIHRoaXMuY29sb3JNYW5hZ2VyLmNvbG9ycy5hbnNpLmZvckVhY2goZnVuY3Rpb24gKGMsIGkpIHtcbiAgICAgICAgICAgIHN0eWxlcyArPVxuICAgICAgICAgICAgICAgIF90aGlzLl90ZXJtaW5hbFNlbGVjdG9yICsgXCIgLlwiICsgRkdfQ0xBU1NfUFJFRklYICsgaSArIFwiIHsgY29sb3I6IFwiICsgYy5jc3MgKyBcIjsgfVwiICtcbiAgICAgICAgICAgICAgICAgICAgKF90aGlzLl90ZXJtaW5hbFNlbGVjdG9yICsgXCIgLlwiICsgQkdfQ0xBU1NfUFJFRklYICsgaSArIFwiIHsgYmFja2dyb3VuZC1jb2xvcjogXCIgKyBjLmNzcyArIFwiOyB9XCIpO1xuICAgICAgICB9KTtcbiAgICAgICAgc3R5bGVzICs9XG4gICAgICAgICAgICB0aGlzLl90ZXJtaW5hbFNlbGVjdG9yICsgXCIgLlwiICsgRkdfQ0xBU1NfUFJFRklYICsgVHlwZXNfMS5JTlZFUlRFRF9ERUZBVUxUX0NPTE9SICsgXCIgeyBjb2xvcjogXCIgKyB0aGlzLmNvbG9yTWFuYWdlci5jb2xvcnMuYmFja2dyb3VuZC5jc3MgKyBcIjsgfVwiICtcbiAgICAgICAgICAgICAgICAodGhpcy5fdGVybWluYWxTZWxlY3RvciArIFwiIC5cIiArIEJHX0NMQVNTX1BSRUZJWCArIFR5cGVzXzEuSU5WRVJURURfREVGQVVMVF9DT0xPUiArIFwiIHsgYmFja2dyb3VuZC1jb2xvcjogXCIgKyB0aGlzLmNvbG9yTWFuYWdlci5jb2xvcnMuZm9yZWdyb3VuZC5jc3MgKyBcIjsgfVwiKTtcbiAgICAgICAgdGhpcy5fdGhlbWVTdHlsZUVsZW1lbnQuaW5uZXJIVE1MID0gc3R5bGVzO1xuICAgICAgICByZXR1cm4gdGhpcy5jb2xvck1hbmFnZXIuY29sb3JzO1xuICAgIH07XG4gICAgRG9tUmVuZGVyZXIucHJvdG90eXBlLm9uV2luZG93UmVzaXplID0gZnVuY3Rpb24gKGRldmljZVBpeGVsUmF0aW8pIHtcbiAgICAgICAgdGhpcy5fdXBkYXRlRGltZW5zaW9ucygpO1xuICAgIH07XG4gICAgRG9tUmVuZGVyZXIucHJvdG90eXBlLl9yZWZyZXNoUm93RWxlbWVudHMgPSBmdW5jdGlvbiAoY29scywgcm93cykge1xuICAgICAgICBmb3IgKHZhciBpID0gdGhpcy5fcm93RWxlbWVudHMubGVuZ3RoOyBpIDw9IHJvd3M7IGkrKykge1xuICAgICAgICAgICAgdmFyIHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgICAgICAgICAgdGhpcy5fcm93Q29udGFpbmVyLmFwcGVuZENoaWxkKHJvdyk7XG4gICAgICAgICAgICB0aGlzLl9yb3dFbGVtZW50cy5wdXNoKHJvdyk7XG4gICAgICAgIH1cbiAgICAgICAgd2hpbGUgKHRoaXMuX3Jvd0VsZW1lbnRzLmxlbmd0aCA+IHJvd3MpIHtcbiAgICAgICAgICAgIHRoaXMuX3Jvd0NvbnRhaW5lci5yZW1vdmVDaGlsZCh0aGlzLl9yb3dFbGVtZW50cy5wb3AoKSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIERvbVJlbmRlcmVyLnByb3RvdHlwZS5vblJlc2l6ZSA9IGZ1bmN0aW9uIChjb2xzLCByb3dzKSB7XG4gICAgICAgIHRoaXMuX3JlZnJlc2hSb3dFbGVtZW50cyhjb2xzLCByb3dzKTtcbiAgICAgICAgdGhpcy5fdXBkYXRlRGltZW5zaW9ucygpO1xuICAgICAgICB0aGlzLl9vbkNhbnZhc1Jlc2l6ZS5maXJlKHtcbiAgICAgICAgICAgIHdpZHRoOiB0aGlzLmRpbWVuc2lvbnMuY2FudmFzV2lkdGgsXG4gICAgICAgICAgICBoZWlnaHQ6IHRoaXMuZGltZW5zaW9ucy5jYW52YXNIZWlnaHRcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBEb21SZW5kZXJlci5wcm90b3R5cGUub25DaGFyU2l6ZUNoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3VwZGF0ZURpbWVuc2lvbnMoKTtcbiAgICB9O1xuICAgIERvbVJlbmRlcmVyLnByb3RvdHlwZS5vbkJsdXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3Jvd0NvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKEZPQ1VTX0NMQVNTKTtcbiAgICB9O1xuICAgIERvbVJlbmRlcmVyLnByb3RvdHlwZS5vbkZvY3VzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLl9yb3dDb250YWluZXIuY2xhc3NMaXN0LmFkZChGT0NVU19DTEFTUyk7XG4gICAgfTtcbiAgICBEb21SZW5kZXJlci5wcm90b3R5cGUub25TZWxlY3Rpb25DaGFuZ2VkID0gZnVuY3Rpb24gKHN0YXJ0LCBlbmQsIGNvbHVtblNlbGVjdE1vZGUpIHtcbiAgICAgICAgd2hpbGUgKHRoaXMuX3NlbGVjdGlvbkNvbnRhaW5lci5jaGlsZHJlbi5sZW5ndGgpIHtcbiAgICAgICAgICAgIHRoaXMuX3NlbGVjdGlvbkNvbnRhaW5lci5yZW1vdmVDaGlsZCh0aGlzLl9zZWxlY3Rpb25Db250YWluZXIuY2hpbGRyZW5bMF0pO1xuICAgICAgICB9XG4gICAgICAgIGlmICghc3RhcnQgfHwgIWVuZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHZhciB2aWV3cG9ydFN0YXJ0Um93ID0gc3RhcnRbMV0gLSB0aGlzLl90ZXJtaW5hbC5idWZmZXIueWRpc3A7XG4gICAgICAgIHZhciB2aWV3cG9ydEVuZFJvdyA9IGVuZFsxXSAtIHRoaXMuX3Rlcm1pbmFsLmJ1ZmZlci55ZGlzcDtcbiAgICAgICAgdmFyIHZpZXdwb3J0Q2FwcGVkU3RhcnRSb3cgPSBNYXRoLm1heCh2aWV3cG9ydFN0YXJ0Um93LCAwKTtcbiAgICAgICAgdmFyIHZpZXdwb3J0Q2FwcGVkRW5kUm93ID0gTWF0aC5taW4odmlld3BvcnRFbmRSb3csIHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxKTtcbiAgICAgICAgaWYgKHZpZXdwb3J0Q2FwcGVkU3RhcnRSb3cgPj0gdGhpcy5fdGVybWluYWwucm93cyB8fCB2aWV3cG9ydENhcHBlZEVuZFJvdyA8IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgZG9jdW1lbnRGcmFnbWVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcbiAgICAgICAgaWYgKGNvbHVtblNlbGVjdE1vZGUpIHtcbiAgICAgICAgICAgIGRvY3VtZW50RnJhZ21lbnQuYXBwZW5kQ2hpbGQodGhpcy5fY3JlYXRlU2VsZWN0aW9uRWxlbWVudCh2aWV3cG9ydENhcHBlZFN0YXJ0Um93LCBzdGFydFswXSwgZW5kWzBdLCB2aWV3cG9ydENhcHBlZEVuZFJvdyAtIHZpZXdwb3J0Q2FwcGVkU3RhcnRSb3cgKyAxKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB2YXIgc3RhcnRDb2wgPSB2aWV3cG9ydFN0YXJ0Um93ID09PSB2aWV3cG9ydENhcHBlZFN0YXJ0Um93ID8gc3RhcnRbMF0gOiAwO1xuICAgICAgICAgICAgdmFyIGVuZENvbCA9IHZpZXdwb3J0Q2FwcGVkU3RhcnRSb3cgPT09IHZpZXdwb3J0Q2FwcGVkRW5kUm93ID8gZW5kWzBdIDogdGhpcy5fdGVybWluYWwuY29scztcbiAgICAgICAgICAgIGRvY3VtZW50RnJhZ21lbnQuYXBwZW5kQ2hpbGQodGhpcy5fY3JlYXRlU2VsZWN0aW9uRWxlbWVudCh2aWV3cG9ydENhcHBlZFN0YXJ0Um93LCBzdGFydENvbCwgZW5kQ29sKSk7XG4gICAgICAgICAgICB2YXIgbWlkZGxlUm93c0NvdW50ID0gdmlld3BvcnRDYXBwZWRFbmRSb3cgLSB2aWV3cG9ydENhcHBlZFN0YXJ0Um93IC0gMTtcbiAgICAgICAgICAgIGRvY3VtZW50RnJhZ21lbnQuYXBwZW5kQ2hpbGQodGhpcy5fY3JlYXRlU2VsZWN0aW9uRWxlbWVudCh2aWV3cG9ydENhcHBlZFN0YXJ0Um93ICsgMSwgMCwgdGhpcy5fdGVybWluYWwuY29scywgbWlkZGxlUm93c0NvdW50KSk7XG4gICAgICAgICAgICBpZiAodmlld3BvcnRDYXBwZWRTdGFydFJvdyAhPT0gdmlld3BvcnRDYXBwZWRFbmRSb3cpIHtcbiAgICAgICAgICAgICAgICB2YXIgZW5kQ29sXzEgPSB2aWV3cG9ydEVuZFJvdyA9PT0gdmlld3BvcnRDYXBwZWRFbmRSb3cgPyBlbmRbMF0gOiB0aGlzLl90ZXJtaW5hbC5jb2xzO1xuICAgICAgICAgICAgICAgIGRvY3VtZW50RnJhZ21lbnQuYXBwZW5kQ2hpbGQodGhpcy5fY3JlYXRlU2VsZWN0aW9uRWxlbWVudCh2aWV3cG9ydENhcHBlZEVuZFJvdywgMCwgZW5kQ29sXzEpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9zZWxlY3Rpb25Db250YWluZXIuYXBwZW5kQ2hpbGQoZG9jdW1lbnRGcmFnbWVudCk7XG4gICAgfTtcbiAgICBEb21SZW5kZXJlci5wcm90b3R5cGUuX2NyZWF0ZVNlbGVjdGlvbkVsZW1lbnQgPSBmdW5jdGlvbiAocm93LCBjb2xTdGFydCwgY29sRW5kLCByb3dDb3VudCkge1xuICAgICAgICBpZiAocm93Q291bnQgPT09IHZvaWQgMCkgeyByb3dDb3VudCA9IDE7IH1cbiAgICAgICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgZWxlbWVudC5zdHlsZS5oZWlnaHQgPSByb3dDb3VudCAqIHRoaXMuZGltZW5zaW9ucy5hY3R1YWxDZWxsSGVpZ2h0ICsgXCJweFwiO1xuICAgICAgICBlbGVtZW50LnN0eWxlLnRvcCA9IHJvdyAqIHRoaXMuZGltZW5zaW9ucy5hY3R1YWxDZWxsSGVpZ2h0ICsgXCJweFwiO1xuICAgICAgICBlbGVtZW50LnN0eWxlLmxlZnQgPSBjb2xTdGFydCAqIHRoaXMuZGltZW5zaW9ucy5hY3R1YWxDZWxsV2lkdGggKyBcInB4XCI7XG4gICAgICAgIGVsZW1lbnQuc3R5bGUud2lkdGggPSB0aGlzLmRpbWVuc2lvbnMuYWN0dWFsQ2VsbFdpZHRoICogKGNvbEVuZCAtIGNvbFN0YXJ0KSArIFwicHhcIjtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQ7XG4gICAgfTtcbiAgICBEb21SZW5kZXJlci5wcm90b3R5cGUub25DdXJzb3JNb3ZlID0gZnVuY3Rpb24gKCkge1xuICAgIH07XG4gICAgRG9tUmVuZGVyZXIucHJvdG90eXBlLm9uT3B0aW9uc0NoYW5nZWQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuX3VwZGF0ZURpbWVuc2lvbnMoKTtcbiAgICAgICAgdGhpcy5zZXRUaGVtZSh1bmRlZmluZWQpO1xuICAgICAgICB0aGlzLl90ZXJtaW5hbC5yZWZyZXNoKDAsIHRoaXMuX3Rlcm1pbmFsLnJvd3MgLSAxKTtcbiAgICB9O1xuICAgIERvbVJlbmRlcmVyLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5fcm93RWxlbWVudHMuZm9yRWFjaChmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS5pbm5lckhUTUwgPSAnJzsgfSk7XG4gICAgfTtcbiAgICBEb21SZW5kZXJlci5wcm90b3R5cGUucmVmcmVzaFJvd3MgPSBmdW5jdGlvbiAoc3RhcnQsIGVuZCkge1xuICAgICAgICB0aGlzLl9yZW5kZXJEZWJvdW5jZXIucmVmcmVzaChzdGFydCwgZW5kLCB0aGlzLl90ZXJtaW5hbC5yb3dzKTtcbiAgICB9O1xuICAgIERvbVJlbmRlcmVyLnByb3RvdHlwZS5fcmVuZGVyUm93cyA9IGZ1bmN0aW9uIChzdGFydCwgZW5kKSB7XG4gICAgICAgIHZhciB0ZXJtaW5hbCA9IHRoaXMuX3Rlcm1pbmFsO1xuICAgICAgICB2YXIgY3Vyc29yQWJzb2x1dGVZID0gdGVybWluYWwuYnVmZmVyLnliYXNlICsgdGVybWluYWwuYnVmZmVyLnk7XG4gICAgICAgIHZhciBjdXJzb3JYID0gdGhpcy5fdGVybWluYWwuYnVmZmVyLng7XG4gICAgICAgIHZhciBjdXJzb3JCbGluayA9IHRoaXMuX3Rlcm1pbmFsLm9wdGlvbnMuY3Vyc29yQmxpbms7XG4gICAgICAgIGZvciAodmFyIHkgPSBzdGFydDsgeSA8PSBlbmQ7IHkrKykge1xuICAgICAgICAgICAgdmFyIHJvd0VsZW1lbnQgPSB0aGlzLl9yb3dFbGVtZW50c1t5XTtcbiAgICAgICAgICAgIHJvd0VsZW1lbnQuaW5uZXJIVE1MID0gJyc7XG4gICAgICAgICAgICB2YXIgcm93ID0geSArIHRlcm1pbmFsLmJ1ZmZlci55ZGlzcDtcbiAgICAgICAgICAgIHZhciBsaW5lRGF0YSA9IHRlcm1pbmFsLmJ1ZmZlci5saW5lcy5nZXQocm93KTtcbiAgICAgICAgICAgIHZhciBjdXJzb3JTdHlsZSA9IHRlcm1pbmFsLm9wdGlvbnMuY3Vyc29yU3R5bGU7XG4gICAgICAgICAgICByb3dFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuX3Jvd0ZhY3RvcnkuY3JlYXRlUm93KGxpbmVEYXRhLCByb3cgPT09IGN1cnNvckFic29sdXRlWSwgY3Vyc29yU3R5bGUsIGN1cnNvclgsIGN1cnNvckJsaW5rLCB0aGlzLmRpbWVuc2lvbnMuYWN0dWFsQ2VsbFdpZHRoLCB0ZXJtaW5hbC5jb2xzKSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fb25SZW5kZXIuZmlyZSh7IHN0YXJ0OiBzdGFydCwgZW5kOiBlbmQgfSk7XG4gICAgfTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoRG9tUmVuZGVyZXIucHJvdG90eXBlLCBcIl90ZXJtaW5hbFNlbGVjdG9yXCIsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gXCIuXCIgKyBURVJNSU5BTF9DTEFTU19QUkVGSVggKyB0aGlzLl90ZXJtaW5hbENsYXNzO1xuICAgICAgICB9LFxuICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICB9KTtcbiAgICBEb21SZW5kZXJlci5wcm90b3R5cGUucmVnaXN0ZXJDaGFyYWN0ZXJKb2luZXIgPSBmdW5jdGlvbiAoaGFuZGxlcikgeyByZXR1cm4gLTE7IH07XG4gICAgRG9tUmVuZGVyZXIucHJvdG90eXBlLmRlcmVnaXN0ZXJDaGFyYWN0ZXJKb2luZXIgPSBmdW5jdGlvbiAoam9pbmVySWQpIHsgcmV0dXJuIGZhbHNlOyB9O1xuICAgIERvbVJlbmRlcmVyLnByb3RvdHlwZS5fb25MaW5rSG92ZXIgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB0aGlzLl9zZXRDZWxsVW5kZXJsaW5lKGUueDEsIGUueDIsIGUueTEsIGUueTIsIGUuY29scywgdHJ1ZSk7XG4gICAgfTtcbiAgICBEb21SZW5kZXJlci5wcm90b3R5cGUuX29uTGlua0xlYXZlID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdGhpcy5fc2V0Q2VsbFVuZGVybGluZShlLngxLCBlLngyLCBlLnkxLCBlLnkyLCBlLmNvbHMsIGZhbHNlKTtcbiAgICB9O1xuICAgIERvbVJlbmRlcmVyLnByb3RvdHlwZS5fc2V0Q2VsbFVuZGVybGluZSA9IGZ1bmN0aW9uICh4LCB4MiwgeSwgeTIsIGNvbHMsIGVuYWJsZWQpIHtcbiAgICAgICAgd2hpbGUgKHggIT09IHgyIHx8IHkgIT09IHkyKSB7XG4gICAgICAgICAgICB2YXIgcm93ID0gdGhpcy5fcm93RWxlbWVudHNbeV07XG4gICAgICAgICAgICBpZiAoIXJvdykge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBzcGFuID0gcm93LmNoaWxkcmVuW3hdO1xuICAgICAgICAgICAgaWYgKHNwYW4pIHtcbiAgICAgICAgICAgICAgICBzcGFuLnN0eWxlLnRleHREZWNvcmF0aW9uID0gZW5hYmxlZCA/ICd1bmRlcmxpbmUnIDogJ25vbmUnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCsreCA+PSBjb2xzKSB7XG4gICAgICAgICAgICAgICAgeCA9IDA7XG4gICAgICAgICAgICAgICAgeSsrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICByZXR1cm4gRG9tUmVuZGVyZXI7XG59KExpZmVjeWNsZV8xLkRpc3Bvc2FibGUpKTtcbmV4cG9ydHMuRG9tUmVuZGVyZXIgPSBEb21SZW5kZXJlcjtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPURvbVJlbmRlcmVyLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIFR5cGVzXzEgPSByZXF1aXJlKFwiLi4vYXRsYXMvVHlwZXNcIik7XG52YXIgQnVmZmVyTGluZV8xID0gcmVxdWlyZShcIi4uLy4uL2NvcmUvYnVmZmVyL0J1ZmZlckxpbmVcIik7XG5leHBvcnRzLkJPTERfQ0xBU1MgPSAneHRlcm0tYm9sZCc7XG5leHBvcnRzLkRJTV9DTEFTUyA9ICd4dGVybS1kaW0nO1xuZXhwb3J0cy5JVEFMSUNfQ0xBU1MgPSAneHRlcm0taXRhbGljJztcbmV4cG9ydHMuVU5ERVJMSU5FX0NMQVNTID0gJ3h0ZXJtLXVuZGVybGluZSc7XG5leHBvcnRzLkNVUlNPUl9DTEFTUyA9ICd4dGVybS1jdXJzb3InO1xuZXhwb3J0cy5DVVJTT1JfQkxJTktfQ0xBU1MgPSAneHRlcm0tY3Vyc29yLWJsaW5rJztcbmV4cG9ydHMuQ1VSU09SX1NUWUxFX0JMT0NLX0NMQVNTID0gJ3h0ZXJtLWN1cnNvci1ibG9jayc7XG5leHBvcnRzLkNVUlNPUl9TVFlMRV9CQVJfQ0xBU1MgPSAneHRlcm0tY3Vyc29yLWJhcic7XG5leHBvcnRzLkNVUlNPUl9TVFlMRV9VTkRFUkxJTkVfQ0xBU1MgPSAneHRlcm0tY3Vyc29yLXVuZGVybGluZSc7XG52YXIgRG9tUmVuZGVyZXJSb3dGYWN0b3J5ID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBEb21SZW5kZXJlclJvd0ZhY3RvcnkoX3Rlcm1pbmFsT3B0aW9ucywgX2RvY3VtZW50KSB7XG4gICAgICAgIHRoaXMuX3Rlcm1pbmFsT3B0aW9ucyA9IF90ZXJtaW5hbE9wdGlvbnM7XG4gICAgICAgIHRoaXMuX2RvY3VtZW50ID0gX2RvY3VtZW50O1xuICAgICAgICB0aGlzLl93b3JrQ2VsbCA9IG5ldyBCdWZmZXJMaW5lXzEuQ2VsbERhdGEoKTtcbiAgICB9XG4gICAgRG9tUmVuZGVyZXJSb3dGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGVSb3cgPSBmdW5jdGlvbiAobGluZURhdGEsIGlzQ3Vyc29yUm93LCBjdXJzb3JTdHlsZSwgY3Vyc29yWCwgY3Vyc29yQmxpbmssIGNlbGxXaWR0aCwgY29scykge1xuICAgICAgICB2YXIgZnJhZ21lbnQgPSB0aGlzLl9kb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCk7XG4gICAgICAgIHZhciBsaW5lTGVuZ3RoID0gMDtcbiAgICAgICAgZm9yICh2YXIgeCA9IE1hdGgubWluKGxpbmVEYXRhLmxlbmd0aCwgY29scykgLSAxOyB4ID49IDA7IHgtLSkge1xuICAgICAgICAgICAgaWYgKGxpbmVEYXRhLmxvYWRDZWxsKHgsIHRoaXMuX3dvcmtDZWxsKS5nZXRDb2RlKCkgIT09IEJ1ZmZlckxpbmVfMS5OVUxMX0NFTExfQ09ERSB8fCAoaXNDdXJzb3JSb3cgJiYgeCA9PT0gY3Vyc29yWCkpIHtcbiAgICAgICAgICAgICAgICBsaW5lTGVuZ3RoID0geCArIDE7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCBsaW5lTGVuZ3RoOyB4KyspIHtcbiAgICAgICAgICAgIGxpbmVEYXRhLmxvYWRDZWxsKHgsIHRoaXMuX3dvcmtDZWxsKTtcbiAgICAgICAgICAgIHZhciB3aWR0aCA9IHRoaXMuX3dvcmtDZWxsLmdldFdpZHRoKCk7XG4gICAgICAgICAgICBpZiAod2lkdGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBjaGFyRWxlbWVudCA9IHRoaXMuX2RvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTtcbiAgICAgICAgICAgIGlmICh3aWR0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICBjaGFyRWxlbWVudC5zdHlsZS53aWR0aCA9IGNlbGxXaWR0aCAqIHdpZHRoICsgXCJweFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzQ3Vyc29yUm93ICYmIHggPT09IGN1cnNvclgpIHtcbiAgICAgICAgICAgICAgICBjaGFyRWxlbWVudC5jbGFzc0xpc3QuYWRkKGV4cG9ydHMuQ1VSU09SX0NMQVNTKTtcbiAgICAgICAgICAgICAgICBpZiAoY3Vyc29yQmxpbmspIHtcbiAgICAgICAgICAgICAgICAgICAgY2hhckVsZW1lbnQuY2xhc3NMaXN0LmFkZChleHBvcnRzLkNVUlNPUl9CTElOS19DTEFTUyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHN3aXRjaCAoY3Vyc29yU3R5bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYmFyJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoYXJFbGVtZW50LmNsYXNzTGlzdC5hZGQoZXhwb3J0cy5DVVJTT1JfU1RZTEVfQkFSX0NMQVNTKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICd1bmRlcmxpbmUnOlxuICAgICAgICAgICAgICAgICAgICAgICAgY2hhckVsZW1lbnQuY2xhc3NMaXN0LmFkZChleHBvcnRzLkNVUlNPUl9TVFlMRV9VTkRFUkxJTkVfQ0xBU1MpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGFyRWxlbWVudC5jbGFzc0xpc3QuYWRkKGV4cG9ydHMuQ1VSU09SX1NUWUxFX0JMT0NLX0NMQVNTKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLl93b3JrQ2VsbC5pc0JvbGQoKSAmJiB0aGlzLl90ZXJtaW5hbE9wdGlvbnMuZW5hYmxlQm9sZCkge1xuICAgICAgICAgICAgICAgIGNoYXJFbGVtZW50LmNsYXNzTGlzdC5hZGQoZXhwb3J0cy5CT0xEX0NMQVNTKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLl93b3JrQ2VsbC5pc0l0YWxpYygpKSB7XG4gICAgICAgICAgICAgICAgY2hhckVsZW1lbnQuY2xhc3NMaXN0LmFkZChleHBvcnRzLklUQUxJQ19DTEFTUyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5fd29ya0NlbGwuaXNEaW0oKSkge1xuICAgICAgICAgICAgICAgIGNoYXJFbGVtZW50LmNsYXNzTGlzdC5hZGQoZXhwb3J0cy5ESU1fQ0xBU1MpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuX3dvcmtDZWxsLmlzVW5kZXJsaW5lKCkpIHtcbiAgICAgICAgICAgICAgICBjaGFyRWxlbWVudC5jbGFzc0xpc3QuYWRkKGV4cG9ydHMuVU5ERVJMSU5FX0NMQVNTKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNoYXJFbGVtZW50LnRleHRDb250ZW50ID0gdGhpcy5fd29ya0NlbGwuZ2V0Q2hhcnMoKSB8fCBCdWZmZXJMaW5lXzEuV0hJVEVTUEFDRV9DRUxMX0NIQVI7XG4gICAgICAgICAgICB2YXIgc3dhcENvbG9yID0gdGhpcy5fd29ya0NlbGwuaXNJbnZlcnNlKCk7XG4gICAgICAgICAgICBpZiAodGhpcy5fd29ya0NlbGwuaXNGZ1JHQigpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0eWxlID0gY2hhckVsZW1lbnQuZ2V0QXR0cmlidXRlKCdzdHlsZScpIHx8ICcnO1xuICAgICAgICAgICAgICAgIHN0eWxlICs9IChzd2FwQ29sb3IgPyAnYmFja2dyb3VuZC0nIDogJycpICsgXCJjb2xvcjpyZ2IoXCIgKyAoQnVmZmVyTGluZV8xLkF0dHJpYnV0ZURhdGEudG9Db2xvclJHQih0aGlzLl93b3JrQ2VsbC5nZXRGZ0NvbG9yKCkpKS5qb2luKCcsJykgKyBcIik7XCI7XG4gICAgICAgICAgICAgICAgY2hhckVsZW1lbnQuc2V0QXR0cmlidXRlKCdzdHlsZScsIHN0eWxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuX3dvcmtDZWxsLmlzRmdQYWxldHRlKCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmcgPSB0aGlzLl93b3JrQ2VsbC5nZXRGZ0NvbG9yKCk7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuX3dvcmtDZWxsLmlzQm9sZCgpICYmIGZnIDwgOCAmJiAhc3dhcENvbG9yICYmXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Rlcm1pbmFsT3B0aW9ucy5lbmFibGVCb2xkICYmIHRoaXMuX3Rlcm1pbmFsT3B0aW9ucy5kcmF3Qm9sZFRleHRJbkJyaWdodENvbG9ycykge1xuICAgICAgICAgICAgICAgICAgICBmZyArPSA4O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjaGFyRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwieHRlcm0tXCIgKyAoc3dhcENvbG9yID8gJ2InIDogJ2YnKSArIFwiZy1cIiArIGZnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHN3YXBDb2xvcikge1xuICAgICAgICAgICAgICAgIGNoYXJFbGVtZW50LmNsYXNzTGlzdC5hZGQoXCJ4dGVybS1iZy1cIiArIFR5cGVzXzEuSU5WRVJURURfREVGQVVMVF9DT0xPUik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5fd29ya0NlbGwuaXNCZ1JHQigpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHN0eWxlID0gY2hhckVsZW1lbnQuZ2V0QXR0cmlidXRlKCdzdHlsZScpIHx8ICcnO1xuICAgICAgICAgICAgICAgIHN0eWxlICs9IChzd2FwQ29sb3IgPyAnJyA6ICdiYWNrZ3JvdW5kLScpICsgXCJjb2xvcjpyZ2IoXCIgKyAoQnVmZmVyTGluZV8xLkF0dHJpYnV0ZURhdGEudG9Db2xvclJHQih0aGlzLl93b3JrQ2VsbC5nZXRCZ0NvbG9yKCkpKS5qb2luKCcsJykgKyBcIik7XCI7XG4gICAgICAgICAgICAgICAgY2hhckVsZW1lbnQuc2V0QXR0cmlidXRlKCdzdHlsZScsIHN0eWxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuX3dvcmtDZWxsLmlzQmdQYWxldHRlKCkpIHtcbiAgICAgICAgICAgICAgICBjaGFyRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwieHRlcm0tXCIgKyAoc3dhcENvbG9yID8gJ2YnIDogJ2InKSArIFwiZy1cIiArIHRoaXMuX3dvcmtDZWxsLmdldEJnQ29sb3IoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChzd2FwQ29sb3IpIHtcbiAgICAgICAgICAgICAgICBjaGFyRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwieHRlcm0tZmctXCIgKyBUeXBlc18xLklOVkVSVEVEX0RFRkFVTFRfQ09MT1IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQoY2hhckVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmcmFnbWVudDtcbiAgICB9O1xuICAgIHJldHVybiBEb21SZW5kZXJlclJvd0ZhY3Rvcnk7XG59KCkpO1xuZXhwb3J0cy5Eb21SZW5kZXJlclJvd0ZhY3RvcnkgPSBEb21SZW5kZXJlclJvd0ZhY3Rvcnk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1Eb21SZW5kZXJlclJvd0ZhY3RvcnkuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG5mdW5jdGlvbiBhZGREaXNwb3NhYmxlRG9tTGlzdGVuZXIobm9kZSwgdHlwZSwgaGFuZGxlciwgdXNlQ2FwdHVyZSkge1xuICAgIG5vZGUuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBoYW5kbGVyLCB1c2VDYXB0dXJlKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBkaXNwb3NlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIWhhbmRsZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgaGFuZGxlciwgdXNlQ2FwdHVyZSk7XG4gICAgICAgIH1cbiAgICB9O1xufVxuZXhwb3J0cy5hZGREaXNwb3NhYmxlRG9tTGlzdGVuZXIgPSBhZGREaXNwb3NhYmxlRG9tTGlzdGVuZXI7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1MaWZlY3ljbGUuanMubWFwIiwiXCJ1c2Ugc3RyaWN0XCI7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgUmVuZGVyRGVib3VuY2VyID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBSZW5kZXJEZWJvdW5jZXIoX3JlbmRlckNhbGxiYWNrKSB7XG4gICAgICAgIHRoaXMuX3JlbmRlckNhbGxiYWNrID0gX3JlbmRlckNhbGxiYWNrO1xuICAgIH1cbiAgICBSZW5kZXJEZWJvdW5jZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl9hbmltYXRpb25GcmFtZSkge1xuICAgICAgICAgICAgd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMuX2FuaW1hdGlvbkZyYW1lKTtcbiAgICAgICAgICAgIHRoaXMuX2FuaW1hdGlvbkZyYW1lID0gdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBSZW5kZXJEZWJvdW5jZXIucHJvdG90eXBlLnJlZnJlc2ggPSBmdW5jdGlvbiAocm93U3RhcnQsIHJvd0VuZCwgcm93Q291bnQpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdGhpcy5fcm93Q291bnQgPSByb3dDb3VudDtcbiAgICAgICAgcm93U3RhcnQgPSByb3dTdGFydCAhPT0gdW5kZWZpbmVkID8gcm93U3RhcnQgOiAwO1xuICAgICAgICByb3dFbmQgPSByb3dFbmQgIT09IHVuZGVmaW5lZCA/IHJvd0VuZCA6IHRoaXMuX3Jvd0NvdW50IC0gMTtcbiAgICAgICAgdGhpcy5fcm93U3RhcnQgPSB0aGlzLl9yb3dTdGFydCAhPT0gdW5kZWZpbmVkID8gTWF0aC5taW4odGhpcy5fcm93U3RhcnQsIHJvd1N0YXJ0KSA6IHJvd1N0YXJ0O1xuICAgICAgICB0aGlzLl9yb3dFbmQgPSB0aGlzLl9yb3dFbmQgIT09IHVuZGVmaW5lZCA/IE1hdGgubWF4KHRoaXMuX3Jvd0VuZCwgcm93RW5kKSA6IHJvd0VuZDtcbiAgICAgICAgaWYgKHRoaXMuX2FuaW1hdGlvbkZyYW1lKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fYW5pbWF0aW9uRnJhbWUgPSB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9pbm5lclJlZnJlc2goKTsgfSk7XG4gICAgfTtcbiAgICBSZW5kZXJEZWJvdW5jZXIucHJvdG90eXBlLl9pbm5lclJlZnJlc2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLl9yb3dTdGFydCA9PT0gdW5kZWZpbmVkIHx8IHRoaXMuX3Jvd0VuZCA9PT0gdW5kZWZpbmVkIHx8IHRoaXMuX3Jvd0NvdW50ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9yb3dTdGFydCA9IE1hdGgubWF4KHRoaXMuX3Jvd1N0YXJ0LCAwKTtcbiAgICAgICAgdGhpcy5fcm93RW5kID0gTWF0aC5taW4odGhpcy5fcm93RW5kLCB0aGlzLl9yb3dDb3VudCAtIDEpO1xuICAgICAgICB0aGlzLl9yZW5kZXJDYWxsYmFjayh0aGlzLl9yb3dTdGFydCwgdGhpcy5fcm93RW5kKTtcbiAgICAgICAgdGhpcy5fcm93U3RhcnQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuX3Jvd0VuZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5fYW5pbWF0aW9uRnJhbWUgPSB1bmRlZmluZWQ7XG4gICAgfTtcbiAgICByZXR1cm4gUmVuZGVyRGVib3VuY2VyO1xufSgpKTtcbmV4cG9ydHMuUmVuZGVyRGVib3VuY2VyID0gUmVuZGVyRGVib3VuY2VyO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9UmVuZGVyRGVib3VuY2VyLmpzLm1hcCIsIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZXh0ZW5kcyA9ICh0aGlzICYmIHRoaXMuX19leHRlbmRzKSB8fCAoZnVuY3Rpb24gKCkge1xuICAgIHZhciBleHRlbmRTdGF0aWNzID0gZnVuY3Rpb24gKGQsIGIpIHtcbiAgICAgICAgZXh0ZW5kU3RhdGljcyA9IE9iamVjdC5zZXRQcm90b3R5cGVPZiB8fFxuICAgICAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxuICAgICAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XG4gICAgICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xuICAgIH07XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChkLCBiKSB7XG4gICAgICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gICAgICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICAgICAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG4gICAgfTtcbn0pKCk7XG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XG52YXIgTGlmZWN5Y2xlXzEgPSByZXF1aXJlKFwiLi4vY29tbW9uL0xpZmVjeWNsZVwiKTtcbnZhciBTY3JlZW5EcHJNb25pdG9yID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoU2NyZWVuRHByTW9uaXRvciwgX3N1cGVyKTtcbiAgICBmdW5jdGlvbiBTY3JlZW5EcHJNb25pdG9yKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcbiAgICAgICAgX3RoaXMuX2N1cnJlbnREZXZpY2VQaXhlbFJhdGlvID0gd2luZG93LmRldmljZVBpeGVsUmF0aW87XG4gICAgICAgIHJldHVybiBfdGhpcztcbiAgICB9XG4gICAgU2NyZWVuRHByTW9uaXRvci5wcm90b3R5cGUuc2V0TGlzdGVuZXIgPSBmdW5jdGlvbiAobGlzdGVuZXIpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKHRoaXMuX2xpc3RlbmVyKSB7XG4gICAgICAgICAgICB0aGlzLmNsZWFyTGlzdGVuZXIoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9saXN0ZW5lciA9IGxpc3RlbmVyO1xuICAgICAgICB0aGlzLl9vdXRlckxpc3RlbmVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCFfdGhpcy5fbGlzdGVuZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBfdGhpcy5fbGlzdGVuZXIod2luZG93LmRldmljZVBpeGVsUmF0aW8sIF90aGlzLl9jdXJyZW50RGV2aWNlUGl4ZWxSYXRpbyk7XG4gICAgICAgICAgICBfdGhpcy5fdXBkYXRlRHByKCk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX3VwZGF0ZURwcigpO1xuICAgIH07XG4gICAgU2NyZWVuRHByTW9uaXRvci5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5kaXNwb3NlLmNhbGwodGhpcyk7XG4gICAgICAgIHRoaXMuY2xlYXJMaXN0ZW5lcigpO1xuICAgIH07XG4gICAgU2NyZWVuRHByTW9uaXRvci5wcm90b3R5cGUuX3VwZGF0ZURwciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9yZXNvbHV0aW9uTWVkaWFNYXRjaExpc3QgfHwgIXRoaXMuX291dGVyTGlzdGVuZXIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9yZXNvbHV0aW9uTWVkaWFNYXRjaExpc3QucmVtb3ZlTGlzdGVuZXIodGhpcy5fb3V0ZXJMaXN0ZW5lcik7XG4gICAgICAgIHRoaXMuX2N1cnJlbnREZXZpY2VQaXhlbFJhdGlvID0gd2luZG93LmRldmljZVBpeGVsUmF0aW87XG4gICAgICAgIHRoaXMuX3Jlc29sdXRpb25NZWRpYU1hdGNoTGlzdCA9IHdpbmRvdy5tYXRjaE1lZGlhKFwic2NyZWVuIGFuZCAocmVzb2x1dGlvbjogXCIgKyB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbyArIFwiZHBweClcIik7XG4gICAgICAgIHRoaXMuX3Jlc29sdXRpb25NZWRpYU1hdGNoTGlzdC5hZGRMaXN0ZW5lcih0aGlzLl9vdXRlckxpc3RlbmVyKTtcbiAgICB9O1xuICAgIFNjcmVlbkRwck1vbml0b3IucHJvdG90eXBlLmNsZWFyTGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5fcmVzb2x1dGlvbk1lZGlhTWF0Y2hMaXN0IHx8ICF0aGlzLl9saXN0ZW5lciB8fCAhdGhpcy5fb3V0ZXJMaXN0ZW5lcikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX3Jlc29sdXRpb25NZWRpYU1hdGNoTGlzdC5yZW1vdmVMaXN0ZW5lcih0aGlzLl9vdXRlckxpc3RlbmVyKTtcbiAgICAgICAgdGhpcy5fcmVzb2x1dGlvbk1lZGlhTWF0Y2hMaXN0ID0gdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLl9saXN0ZW5lciA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5fb3V0ZXJMaXN0ZW5lciA9IHVuZGVmaW5lZDtcbiAgICB9O1xuICAgIHJldHVybiBTY3JlZW5EcHJNb25pdG9yO1xufShMaWZlY3ljbGVfMS5EaXNwb3NhYmxlKSk7XG5leHBvcnRzLlNjcmVlbkRwck1vbml0b3IgPSBTY3JlZW5EcHJNb25pdG9yO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9U2NyZWVuRHByTW9uaXRvci5qcy5tYXAiLCIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxOSBUaGUgeHRlcm0uanMgYXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqIEBsaWNlbnNlIE1JVFxuICovXG5cbmltcG9ydCB7IFRlcm1pbmFsIH0gZnJvbSAneHRlcm0nO1xuaW1wb3J0IHsgQXR0YWNoQWRkb24gfSBmcm9tICcuLic7XG5cbig8YW55PndpbmRvdykuVGVybWluYWwgPSBUZXJtaW5hbDtcbig8YW55PndpbmRvdykuQXR0YWNoQWRkb24gPSBBdHRhY2hBZGRvbjtcbiJdLCJzb3VyY2VSb290IjoiIn0=